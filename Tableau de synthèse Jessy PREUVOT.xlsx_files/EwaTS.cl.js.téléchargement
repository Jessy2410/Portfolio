'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[12],{1016:function(A,u,a){a.d(u,"a",function(){return c});A=a(0);class c{}c.$bg=31E3;c.m5d=8E3;Object(A.a)(c,"RealtimeChannelStaticConstants",null,[])},1139:function(A,u,a){a.d(u,"a",function(){return c});A=a(0);class c{constructor(){this.jZe=!1;this.iid=null;this.DJe=0;this.Lad=this.Nmf();this.Wdc=this.Nmf();this.CSa=this.Abb=0;this.SF=()=>new Date}get LWk(){return this.jZe}Nmf(){const b=Array(6);for(let h=0;h<
b.length;h++)b[h]=0;return b}SLi(){return this.Lad.toString()}$Hi(){return this.Wdc.toString()}QUk(){this.iid=this.SF()}k4b(b,h,r){if(!this.LWk){if(void 0===r?0:r)this.jZe=!0;r=this.SF();0===b&&5<this.Abb||1===b&&5<this.CSa||(this.DJe<b?(1===this.Abb%2&&(this.Lad[this.Abb]=-1,this.Abb++),this.DJe=b,1===h&&(this.Wdc[this.CSa]=-1,this.CSa++),this.Wdc[this.CSa]=this.tve(r),this.CSa++):0===b?(this.Lad[this.Abb]=this.tve(r),this.Abb++):(this.Wdc[this.CSa]=this.tve(r),this.CSa++))}}tve(b){const h=b.getTime()-
this.iid.getTime();this.iid=b;return h}static get instance(){c.Va||(c.Va=new c);return c.Va}static set instance(b){c.Va=b}}c.Va=null;Object(A.a)(c,"LatencyMetrics",null,[])},1300:function(A,u,a){a.d(u,"a",function(){return c});A=a(0);class c extends Sys.EventArgs{constructor(b,h,r,f){super();this.type=b;this.Lja=h;this.Cdi=r;this.y$b=f}}Object(A.a)(c,"SendUpdateNotificationEventArgs",Sys.EventArgs,[])},1301:function(A,u,a){a.d(u,"a",function(){return c});A=a(0);class c{}c.Cme="rr";c.ovk="rd";c.mvk=
"rbp";c.$ne="sa";Object(A.a)(c,"RtcReconnectParams",null,[])},1302:function(A,u,a){a.d(u,"a",function(){return c});A=a(0);class c{constructor(b,h,r,f){this.tGj=b;this.PQa=h;this.rFj=r;this.J0i=f}}Object(A.a)(c,"ThrottlerManagerSettings",null,[])},1371:function(A,u,a){a.d(u,"a",function(){return K});A=a(0);class c extends Sys.EventArgs{constructor(F,W){super();this.newState=F;this.oldState=W}}Object(A.a)(c,"ChangedConnectionStateEventArgs",Sys.EventArgs,[]);class b extends Sys.EventArgs{constructor(F,
W){super();this.XXh=F;this.y$b=W}}Object(A.a)(b,"ClientInfoEventArgs",Sys.EventArgs,[]);class h extends Sys.EventArgs{constructor(F){super();this.Lde=F}}Object(A.a)(h,"MyPresenceUpdatedEventArgs",Sys.EventArgs,[]);class r extends Sys.EventArgs{constructor(F){super();this.trc=F}}Object(A.a)(r,"PersistentStateClearedEventArgs",Sys.EventArgs,[]);class f extends Sys.EventArgs{constructor(F,W){super();this.type=F;this.b_=W}}Object(A.a)(f,"PersistentStateUpdateEventArgs",Sys.EventArgs,[]);var l=a(1479);
class m extends Sys.EventArgs{constructor(F,W){W=void 0===W?null:W;super();this.eR=F;this.Zuh=W}get type(){return this.eR}get Lja(){return this.Zuh}}Object(A.a)(m,"UpdateNotificationEventArgs",Sys.EventArgs,[]);class x extends Sys.EventArgs{constructor(){super()}}Object(A.a)(x,"GotCompletePersistentStateWithMetadataEventArgs",Sys.EventArgs,[]);class n extends Sys.EventArgs{constructor(F,W,J,L,M,Q){super();this.gAb=F;this.Vxd=W;this.L0h=J;this.jyf=M;this.jwd=L;this.stopwatch=Q}}Object(A.a)(n,"RefreshAllPersistentStateEventArgs",
Sys.EventArgs,[]);class t extends Sys.EventArgs{constructor(F){super();this.hubConnection=F}}Object(A.a)(t,"RefreshProxyEventArgs",Sys.EventArgs,[]);class w extends Sys.EventArgs{constructor(F,W){super();this.errorMessage=W}}Object(A.a)(w,"RtcConnectFailedEventArgs",Sys.EventArgs,[]);class v extends Sys.EventArgs{constructor(F,W,J){super();this.type=F;this.Lde=W;this.y$b=J}}Object(A.a)(v,"SendPersistentStateEventArgs",Sys.EventArgs,[]);var k=a(1300);class y extends Sys.EventArgs{constructor(){super()}}
Object(A.a)(y,"SessionPropertiesChangedEventArgs",Sys.EventArgs,[]);class C extends Sys.EventArgs{constructor(F){super();this.trc=F}}Object(A.a)(C,"UpdatePersistentStateClearedRequestEventArgs",Sys.EventArgs,[]);class B extends Sys.EventArgs{constructor(F,W){super();this.type=F;this.ral=W}}Object(A.a)(B,"UpdatePersistentStateRequestEventArgs",Sys.EventArgs,[]);var E=a(113);class K{constructor(){this.hh=new E.a}tck(F,W){this.hh.raiseEvent("CSC",new c(F,W))}odk(F){this.hh.raiseEvent("RP",new t(F))}wTc(F){this.hh.raiseEvent("RC",
F)}qdk(){this.hh.raiseEvent("RMID")}ndk(F,W,J,L,M,Q){this.hh.raiseEvent("RPS",new n(F,W,J,L,M,Q))}eAg(F,W){this.hh.raiseEvent("UPSR",new B(F,W))}Ozg(F,W){this.hh.raiseEvent("PU",new l.a(F,W))}Tck(F){this.hh.raiseEvent("MPU",new h(F))}Lfe(F,W,J,L){this.hh.raiseEvent("SUN",new k.a(F,W,J,L))}Gdk(F,W){this.hh.raiseEvent("UNR",new m(F,W))}Xzg(F,W,J){this.hh.raiseEvent("SP",new v(F,W,J))}Mzg(F,W){this.hh.raiseEvent("PSU",new f(F,W))}fdk(F){this.hh.raiseEvent("PSC",new r(F))}Pck(F){this.hh.raiseEvent("IPSC",
new r(F))}Hdk(F){this.hh.raiseEvent("UPSC",new C(F))}vdk(F,W){this.hh.raiseEvent("SPC",new y(F,W))}Uzg(F,W){this.hh.raiseEvent("RCF",new w(F,W))}Hck(F){this.hh.raiseEvent("CPSWM",new x(F))}Fdk(F,W){this.hh.raiseEvent("UCI",new b(F,W))}mGa(F){this.hh.addHandler("CSC",F)}R6a(F){this.hh.removeHandler("CSC",F)}lEh(F){this.hh.addHandler("RP",F)}dok(F){this.hh.removeHandler("RP",F)}kEh(F){this.hh.addHandler("RC",F)}cok(F){this.hh.removeHandler("RC",F)}pEh(F){this.hh.addHandler("RMID",F)}jEh(F){this.hh.addHandler("RPS",
F)}bok(F){this.hh.removeHandler("RPS",F)}YEh(F){this.hh.addHandler("UPSR",F)}Sok(F){this.hh.removeHandler("UPSR",F)}jIb(F){this.hh.addHandler("PU",F)}rvb(F){this.hh.removeHandler("PU",F)}PCh(F){this.hh.addHandler("IPU",F)}Xmk(F){this.hh.removeHandler("IPU",F)}WEh(F){this.hh.addHandler("UCI",F)}Qok(F){this.hh.removeHandler("UCI",F)}EEh(F){this.hh.addHandler("SUN",F)}xok(F){this.hh.removeHandler("SUN",F)}QCh(F){this.hh.addHandler("IUNR",F)}Ymk(F){this.hh.removeHandler("IUNR",F)}Peb(F){this.hh.addHandler("UNR",
F)}r5b(F){this.hh.removeHandler("UNR",F)}Lpd(F){this.hh.addHandler("PSU",F)}mje(F){this.hh.removeHandler("PSU",F)}OCh(F){this.hh.addHandler("IPSU",F)}Wmk(F){this.hh.removeHandler("IPSU",F)}Kpd(F){this.hh.addHandler("PSC",F)}lje(F){this.hh.removeHandler("PSC",F)}NCh(F){this.hh.addHandler("IPSC",F)}Vmk(F){this.hh.removeHandler("IPSC",F)}XEh(F){this.hh.addHandler("UPSC",F)}Rok(F){this.hh.removeHandler("UPSC",F)}DEh(F){this.hh.addHandler("SP",F)}wok(F){this.hh.removeHandler("SP",F)}GEh(F){this.hh.addHandler("SPC",
F)}Aok(F){this.hh.removeHandler("SPC",F)}static getInstance(){return K.Va||(K.Va=new K)}}K.Va=null;Object(A.a)(K,"RtcEventHub",null,[462])},1394:function(A,u,a){a.d(u,"a",function(){return m});A=a(0);var c=a(15),b=a(142),h=a(92),r;(function(x){x[x.Njl=0]="SendNotification";x[x.Ojl=1]="SendPersistentState";x[x.Zhl=2]="FindSession";x[x.jdh=3]="Last"})(r||(r={}));Object(A.b)("ApiType",r);var f;(function(x){x[x.Dgl=0]="AttemptCount";x[x.Yjl=1]="SuccessCount";x[x.phl=2]="DropCount";x[x.Thl=3]="FailedCount";
x[x.Dil=4]="LatencyOverThresholdCount";x[x.Eil=5]="LatencyUnderThresholdCount";x[x.jkl=6]="ThrottledCount";x[x.jdh=7]="Last"})(f||(f={}));Object(A.b)("EventCountType",f);var l=a(1139);class m{constructor(x){this.sif=this.Zzf=null;this.Zbg=this.pCf=0;this.Dt=null;this.SRe=this.Kfd=0;this.Yn=x;this.Tcj();this.rad=this.$Le=this.egd=!1;this.Ffd=0}get Kti(){return this.rad}MUk(x){this.SRe=x;window.setInterval(Object(b.a)(this,this.b3d,"logMetricsBatchAndReset"),x);this.Kfd=(new Date).getTime()}wH(x,n){this.BKk(x)&&
!this.$Le||this.Kti||!window.navigator.onLine||this.Yn.Mob||(this.Dt[x][n]++,this.egd=!0)}Tcj(){this.Dt=Array(3);for(let x=0;3>x;x++){this.Dt[x]=Array(7);for(let n=0;7>n;n++)this.Dt[x][n]=0}}qPh(){const x={};for(let n=0;3>n;n++)for(let t=0;7>t;t++)this.mtj(n,t)&&(x[r[n]+f[t]]=this.Dt[n][t]);x.FSDomain=this.Zzf;x.ConnectionDomain=this.sif;x.FSRetryInterval=this.pCf;x.MaxPayloadSize=this.Zbg;x.LogNumber=this.Ffd;1===this.Ffd&&(x.FSLatencies=l.a.instance.SLi(),x.ConLatencies=l.a.instance.$Hi());return x}mtj(x,
n){return 2===x&&3!==n&&0!==n?!1:!0}BKk(x){return 2===x?!1:!0}b3d(){if(this.egd){this.Ffd++;if((new Date).getTime()-this.Kfd<5E3+this.SRe){var x=h.a.toJSON(this.qPh());c.ULS.sendTraceTag(50644352,500,15,x)}this.Kfd=(new Date).getTime();for(x=0;3>x;x++)for(let n=0;7>n;n++)this.Dt[x][n]=0;this.egd=!1}}vEj(){this.$Le=!0}static get instance(){return m.Va}static create(x){m.instance||(m.Va=new m(x));return m.instance}}m.Va=null;Object(A.a)(m,"FrequentLoggingMetrics",null,[967])},1479:function(A,u,a){a.d(u,
"a",function(){return c});A=a(0);class c extends Sys.EventArgs{constructor(b,h){super();this.b_=b;this.Nma=h}}Object(A.a)(c,"PresenceUpdatedEventArgs",Sys.EventArgs,[])},1480:function(A,u,a){a.r(u);a.d(u,"RealtimeChannelMetrics",function(){return f});A=a(0);var c=a(15),b=a(241),h=a(92),r=a(989);class f{constructor(){this.vTe=this.wTe=this.xTe=this.tTe=this.sTe=this.uTe=this.QEb=this.Qgd=0;this.yka=this.hfd=this.bEb=this.$ed=this.Gsa=this.Med=this.LEa=this.WDb=this.hcb=this.Led=this.ufc=this.sbb=null;
this.Ufd=this.xEb=this.KXe=this.MIe=0;this.xSe=!1;this.BBg=this.Ige;this.EBg=this.Lge;this.DBg=this.Kge;this.IBg=this.Nge;this.HBg=this.Mge;this.Tge=this.Uge;this.l4b=this.Rge;this.p6a=this.Pge;this.q6a=this.Qge;this.CBg=this.Jge;this.Krb=this.$6d;this.c0b=this.b7d}Ige(){this.Qgd++;this.Led=new Date;this.sbb||(this.sbb=new Date)}Lge(){this.QEb++;this.LEa=new Date;this.ufc||(this.ufc=this.LEa);this.bEb=this.LEa;this.d0h()}Kge(){this.uTe++;this.Med=new Date}Nge(){this.sTe++;this.hcb=new Date}Mge(){this.tTe++;
this.WDb=new Date}Rge(){this.Gsa=new Date;this.xTe++}Qge(){this.yka||(this.yka=new Date);this.wTe++}Pge(){this.$ed=new Date;this.vTe++}Uge(){!this.xSe&&this.Qgd&&(c.ULS.sendTraceTag(39321871,500,15,h.a.toJSON(this.gZh())),this.xSe=!0)}Jge(l){const {nTf:m,pTf:x,exception:n}=r.RtcUtils.Yti(l);m&&m!==b.a.HL&&(c.ULS.sendTraceTag(40157596,500,15,h.a.toJSON({["HttpErrorCode"]:m,["HttpErrorStatus"]:x,["Exception"]:n})),b.a.PXf(m)&&this.MIe++,b.a.J2f(m)&&this.KXe++)}$6d(){this.hfd=new Date}b7d(){this.hcb=
this.bEb=new Date}gZh(){return{["numberOfConnectionAttempts"]:this.Qgd,["numberOfSuccessfulConnections"]:this.QEb,["numberOfFailedConnections"]:this.uTe,["numberOfDisconnectedConnections"]:this.sTe,["numberOfExplicitDisconnectedConnections"]:this.tTe,["numberOfSentMessages"]:this.xTe,["numberOfReceivedMessages"]:this.wTe,["numberOfLostMessages"]:this.vTe,["firstConnectionAttempt"]:this.sbb?this.sbb:null,["firstMessageReceived"]:this.yka?this.yka:null,["firstConnectionSuccess"]:this.ufc?this.ufc:null,
["lastConnectionAttempt"]:this.Led?this.Led:null,["lastConnectionSuccess"]:this.LEa?this.LEa:null,["lastConnectionFailure"]:this.Med?this.Med:null,["lastMessageSent"]:this.Gsa?this.Gsa:null,["lastMessageLost"]:this.$ed?this.$ed:null,["lastDisconnect"]:this.hcb?this.hcb:null,["lastExplicitDisconnect"]:this.WDb?this.WDb:null,["lastTimeOnline"]:this.bEb?this.bEb:null,["lastTimeOffline"]:this.hfd?this.hfd:null,["maxDisconnectedTimeMs"]:this.xEb,["maxExplicitDisconnectedTimeMs"]:this.Ufd,["clientConnectionErrors"]:this.MIe,
["serverConnectionErrors"]:this.KXe}}d0h(){this.sbb&&1===this.QEb&&(this.xEb=Math.max(this.xEb,this.LEa.getTime()-this.sbb.getTime()));this.hcb&&1<this.QEb&&(this.xEb=Math.max(this.xEb,this.LEa.getTime()-this.hcb.getTime()));this.WDb&&1<this.QEb&&(this.Ufd=Math.max(this.Ufd,this.LEa.getTime()-this.WDb.getTime()))}static createInstance(l){f.Va||(f.Va=new f,c.ULS.sendTraceTag(39321870,500,50,"RealtimeChannelMetrics initialized for client {0}",l));return f.Va}}f.Va=null;Object(A.a)(f,"RealtimeChannelMetrics",
null,[965,136])},1512:function(A,u,a){a.r(u);a.d(u,"RealtimeChannel",function(){return za});A=a(0);var c=a(15),b=a(142),h=a(183),r;(function(la){la[la.unspecified=0]="unspecified";la[la.word=1]="word";la[la.excel=2]="excel";la[la.powerPoint=3]="powerPoint";la[la.test=4]="test";la[la.$Be=5]="wacFrontEnd";la[la.oneNote=6]="oneNote";la[la.Xdl=7]="visio";la[la.Gtl=8]="officeMobile";la[la.Qll=9]="cosmosDBChangefeed";la[la.last=10]="last"})(r||(r={}));Object(A.b)("RtcClientAppName",r);var f=a(1140),l=a(106),
m=a(6);class x{constructor(la,Ca){this.status=la;this.e3a=Ca}}Object(A.a)(x,"UserStatusInfo",null,[]);var n=a(79),t=a(1139);class w{constructor(la,Ca){this.data=la;this.timeStamp=Ca}}Object(A.a)(w,"PresenceData",null,[]);var v=a(435),k=a(1016);class y{constructor(){this.k8c=this.yHe=!1;this.i8c=0;this.v9c=this.rkd=this.qkd=this.E7c=!1;this.Mad=0;this.$We=!1;this.ZWe=this.YWe=0;this.ujd=!1;this.zjd=this.xjd=this.Ajd=this.vjd=0;this.yjd=!1}get OLh(){return this.k8c}get NLh(){return this.i8c}get PGh(){return this.E7c}get LLk(){return this.qkd}get MLk(){return this.rkd}get YXh(){return this.v9c}get Cyc(){return this.Mad}get rtcJsClientFrequentlyLogsMetrics(){return this.$We}get hKg(){return this.YWe}get rvk(){return this.ZWe}get rtcClientMessageTelemetryEnabled(){return this.ujd}get nvk(){return this.vjd}get lKg(){return this.Ajd}get iKg(){return this.xjd}get kKg(){return this.zjd}get jKg(){return this.yjd}static createInstance(la){return la?
Object.assign(new y,{yHe:la.ka("AwayStatusManagerIsEnabled"),k8c:la.ka("AwayStatusOneMinuteTimeoutIsEnabled"),i8c:la.Lj("AwayCoauthorThresholdMs",9E5),E7c:la.ka("RtcAllowCrossDomainAccessEnabled"),qkd:la.ka("ShouldLogOnContentNotification"),rkd:la.ka("ShouldLogOnHostSubscriptionNotification"),v9c:la.ka("RtcClientMetricsEnabled"),Mad:la.Lj("RtcFindSessionRequestTimeoutInMS",6E4),$We:la.ka("RtcJsClientFrequentlyLogsMetrics"),YWe:la.Lj("RtcJsClientFrequentMetricsLatencyThresholdInMS",1E3),ZWe:la.Lj("RtcJsClientFrequentMetricsLogIntervalInMS",
3E5),ujd:la.ka("RtcClientMessageTelemetryEnabled"),vjd:la.Lj("RtcClientMessageTelemetrySampleSize",5),Ajd:la.Lj("RtcSendTelemetryMessageIntervalInMS",3E5),xjd:la.Lj("RtcLogClientMessageMetricsTimeOutInMs",2E4),zjd:la.Lj("RtcMaxPayloadSizeInCharactersOverride",k.a.m5d),yjd:la.getBooleanFeatureGate("Microsoft.Office.SharedOnline.RTCLogSignalrHeartBeatMessages",!1)}):Object.assign(new y,{yHe:!1,k8c:!1,i8c:9E5,E7c:!1,qkd:!1,rkd:!0,v9c:!1,Mad:9E4,ujd:!1,vjd:5,Ajd:3E5,xjd:2E4,zjd:k.a.m5d,yjd:!1})}}Object(A.a)(y,
"RealtimeChannelSettings",null,[974]);var C=a(113),B=a(1302);class E{constructor(la,Ca){this.rCb=this.GGb=0;this.Mdd=!1;this.Ndb=this.Fkc=null;this.bcb=!1;this.IXe=la;this.x0g=void 0===Ca?"":Ca;this.setTimeout=E.zBd;this.TUa=this.GGb=this.rCb=0}Sge(){0<this.TUa&&0<this.rCb&&c.ULS.sendTraceTag(36545635,500,50,"Throttler [{0}] dropped [{1}] messages out of [{2}]",this.x0g,this.rCb,this.TUa);0<this.TUa&&0<this.GGb&&c.ULS.sendTraceTag(36545634,500,50,"Throttler [{0}] throttled [{1}] messages out of [{2}]",
this.x0g,this.GGb,this.TUa)}get Iob(){return this.Mdd}ZYc(la,Ca){this.GGb++;this.lLb(!0);this.Mdd=!0;this.Fkc=la;this.Ndb=Ca}lLb(la){this.Mdd=!1;this.Ndb&&la&&(this.rCb++,this.Ndb.markAsCancelled());this.Ndb=this.Fkc=null}static zBd(la,Ca){return window.setTimeout(la,Ca)}}Object(A.a)(E,"ThrottlerBase",null,[]);class K{constructor(){this.jIe=this.R9c=!1;this.callback=null}jsb(la){this.callback=la;this.$1g()}ubg(la){this.R9c||(this.R9c=!0,this.ojh=la,this.$1g())}$1g(){this.R9c&&this.callback&&!this.jIe&&
(this.jIe=!0,this.callback(this.ojh))}}Object(A.a)(K,"CompletionTask",null,[]);class F{constructor(){this.uSe=new K;this.sSe=new K}OPc(la){this.uSe.jsb(la)}NPc(la){this.sSe.jsb(la)}l_b(la){this.uSe.ubg(la)}TMa(la){this.sSe.ubg(la)}markAsCancelled(){this.l_b(2);this.TMa(2)}}Object(A.a)(F,"MessageStatus",null,[982]);class W extends E{constructor(la,Ca){super(la,void 0===Ca?"":Ca);this.urb=0;this.xAk=()=>{if(this.Iob){const Va=this.Fkc,ia=this.Ndb;this.lLb(!1);this.a7b(Va,ia)}};this.$Db=(new Date(0)).getTime();
this.currentTime=()=>(new Date).getTime()}init(la){this.bcb||(this.urb=la,this.bcb=!0)}add(la){this.bcb||this.init(W.Xnf);this.TUa++;const Ca=this.currentTime(),Va=new F;this.$Db>Ca&&(this.$Db=Ca);this.Iob?(this.lLb(!0),this.ZYc(la,Va)):this.$Db+this.urb<=Ca?this.a7b(la,Va):(this.ZYc(la,Va),this.setTimeout(this.xAk,this.$Db+this.urb-Ca));return Va}a7b(la,Ca){this.$Db=this.currentTime();la=this.IXe(la);la.OPc(Va=>{Ca.l_b(Va)});la.NPc(Va=>{Ca.TMa(Va)})}static createInstance(la,Ca){return new W(la,void 0===
Ca?"":Ca)}}W.Xnf=200;Object(A.a)(W,"MaxRateThrottler",E,[980,981]);class J extends E{constructor(la,Ca){super(la,void 0===Ca?"":Ca);this.krb=this.PQa=0;this.hh=new C.a;this.acb=!1;this.hec=this.Xdc=this.Fld=0;this.zAk=()=>{this.acb=!1;if(this.Iob){const Va=this.Fkc,ia=this.Ndb;this.lLb(!1);this.a7b(Va,ia)}};this.HWj=()=>{++this.hec;this.hec>Math.floor(this.krb/2)&&(this.hec=-1E9,this.hh.raiseEvent("TMUDM"))};this.Thc=0;this.Kkc=[];this.clearTimeout=J.rBd}add(la){this.bcb||this.init(J.rof,J.iof);this.TUa++;
const Ca=new F;this.Iob?this.ZYc(la,Ca):this.Thc<this.krb?this.a7b(la,Ca):(this.ZYc(la,Ca),this.acb=!1);return Ca}a7b(la,Ca){la=this.IXe(la);const Va=this.setTimeout(this.HWj,this.PQa);++this.Thc;Array.add(this.Kkc,Va);const ia=this.Xdc;la.OPc(wa=>{Ca.l_b(wa)});la.NPc(wa=>{this.Xdc===ia&&(this.GWj(ia,Va),Ca.TMa(wa))})}GWj(la,Ca){this.Xdc===la&&(--this.Thc,this.clearTimeout(Ca),Array.remove(this.Kkc,Ca),this.Iob&&this.yAk())}yAk(){this.Iob&&!this.acb&&(this.Fld=this.setTimeout(this.zAk,0),this.acb=
!0)}fnc(la){this.hh.addHandler("TMUDM",la)}XFg(la){this.hh.removeHandler("TMUDM",la)}reset(){this.TUa=this.GGb=this.rCb=this.hec=0;++this.Xdc;for(const la of this.Kkc)this.clearTimeout(la);this.Thc=0;this.Kkc=[];this.lLb(!0);this.acb&&(this.clearTimeout(this.Fld),this.Fld=0,this.acb=!1)}init(la,Ca){this.bcb||(this.PQa=la,this.krb=Ca,this.bcb=!0)}static createInstance(la,Ca){return new J(la,void 0===Ca?"":Ca)}static rBd(la){window.clearTimeout(la)}}J.rof=15E3;J.iof=5;Object(A.a)(J,"MaxOutstandingThrottler",
E,[983,981]);class L{constructor(la){this.Wk=null;this.FG=!1;this.hh=new C.a;this.Zfd=new l.a;this.Yfd=new l.a;this.Gld=la;this.Cbb=this.Gld.xlf(Ca=>Ca.send(),"GlobalMaxOustandingThrottler");this.Cbb.fnc(()=>{this.hh.raiseEvent("TMUDM")})}init(la){this.FG||(this.Wk=la,this.Cbb.init(this.Wk.PQa,this.Wk.J0i),this.FG=!0)}PYi(la){this.FG||this.init(new B.a(W.Xnf,J.rof,J.iof,L.sFj));let Ca;if(!(()=>{let ia=this.Zfd.wj(la);({value:Ca}=ia);return ia})().returnValue){let ia;if(!(()=>{let wa=this.Yfd.wj(la);
({value:ia}=wa);return wa})().returnValue){var Va="MaxOutstandingThrottler-"+la;ia=this.Gld.xlf(Object(b.a)(this.Cbb,this.Cbb.add,"add"),Va);ia.init(this.Wk.PQa,this.Wk.rFj);ia.fnc(()=>{this.hh.raiseEvent("TMUDM")});this.Yfd.add(la,ia)}Va="MaxRateThrottler-"+la;Ca=this.Gld.x7h(Object(b.a)(ia,ia.add,"add"),Va);Ca.init(this.Wk.tGj);this.Zfd.add(la,Ca)}return Ca}reset(){for(const la of this.Zfd)la.value.Sge();for(const la of this.Yfd)la.value.Sge(),la.value.reset();this.Cbb.Sge();this.Cbb.reset()}fnc(la){this.hh.addHandler("TMUDM",
la)}XFg(la){this.hh.removeHandler("TMUDM",la)}}L.sFj=1E3;Object(A.a)(L,"ThrottlerManager",null,[973]);class M{}M.h9i="realtimeChannelHub";M.Qac="UpdatePresence";M.$ia="SendUpdateNotification";M.RKd="GetCompletePersistentStateWithMetadata";M.Mzb="UpdatePersistentState";M.m$a="UpdateClientInfo";Object(A.a)(M,"RtcHubMethodNames",null,[]);class Q{constructor(la){this.hla=!1;this.Odb=0;this.T9c=!1;this.FBj=()=>{c.ULS.sendTraceTag(4539720,500,50,"Usage statement for the Rtc_ConnectedEver KPI for [{0}]",
this.As)};this.setTimeout=Q.zBd;this.clearTimeout=Q.rBd;this.qCj=this.FBj;this.As=la}HPj(){this.hla||(this.Odb=this.setTimeout(()=>{this.hla=!1;this.K9f()},8E3),this.hla=!0,this.T9c=!1)}QQj(){this.JX()}S_j(){this.K9f()}K9f(){this.JX();this.T9c||(this.T9c=!0,this.qCj())}JX(){this.hla&&this.clearTimeout(this.Odb);this.Odb=0;this.hla=!1}static zBd(la,Ca){return window.setTimeout(la,Ca)}static rBd(la){window.clearTimeout(la)}}Object(A.a)(Q,"ConnectedUsageKpiLogger",null,[972]);class H{constructor(){this.BBg=
this.Ige;this.EBg=this.Lge;this.DBg=this.Kge;this.IBg=this.Nge;this.HBg=this.Mge;this.Tge=this.Uge;this.l4b=this.Rge;this.p6a=this.Pge;this.q6a=this.Qge;this.CBg=this.Jge;this.Krb=this.$6d;this.c0b=this.b7d}Ige(){}Lge(){}Kge(){}Nge(){}Mge(){}Rge(){}Qge(){}Pge(){}Uge(){}Jge(){}$6d(){}b7d(){}}Object(A.a)(H,"NoopRealtimeChannelMetrics",null,[965,136]);class ba{}ba.Qac="presenceUpdated";ba.updateNotification="updateNotification";ba.Pug="persistentStateCleared";ba.Mzb="persistentStateUpdated";Object(A.a)(ba,
"RtcClientMethodNames",null,[]);class U{constructor(la){this.bB=la}Kik(la){this.bB.on(ba.Qac,la)}kjk(la){this.bB.on(ba.updateNotification,la)}Gik(la){this.bB.on(ba.Mzb,la)}Fik(la){this.bB.on(ba.Pug,la)}N5k(la){this.bB.off(ba.Qac,la)}V5k(la){this.bB.off(ba.updateNotification,la)}M5k(la){this.bB.off(ba.Mzb,la)}L5k(la){this.bB.off(ba.Pug,la)}Qac(la){return this.bB.invoke(M.Qac,la)}m$a(la){return this.bB.invoke(M.m$a,la)}$ia(la,Ca){return this.bB.invoke(M.$ia,la,Ca)}RKd(la){return this.bB.invoke(M.RKd,
la)}Mzb(la,Ca){return this.bB.invoke(M.Mzb,la,Ca)}}Object(A.a)(U,"RealtimeChannelProxy",null,[969,970,971]);var D=a(1371),I=a(153);class X{constructor(la){this.QUa=null;this.yqa=0;this.oZa=!1;this.tl=la;this.tl.mGa(Object(b.a)(this,this.K1,"onConnectionStateChanged"))}K1(la,Ca){this.yqa=Ca.newState}Crg(){c.ULS.sendTraceTag(18637070,500,15,"Too many undelivered messages. Restarting RTC connection.");this.tl.wTc()}hbj(la){this.QUa.init(la)}}Object(A.a)(X,"ARtcMessageHandler",null,[]);var Y=a(660);class ja{constructor(){this.Presence=
null;this.TimeStamp=0}}Object(A.a)(ja,"PresenceDataEntryForClients",null,[]);var Ua=a(92);class ka{constructor(la,Ca){this.vsh=la;this.WQ=void 0===Ca?"":Ca}send(){return this.vsh()}get messageId(){return this.WQ}}Object(A.a)(ka,"MessageHandler",null,[984]);class fb extends Sys.EventArgs{constructor(la,Ca,Va,ia){super();this.$je=la;this.reconnectDelay=Ca;this.reason=Va;this.$ne=ia}}Object(A.a)(fb,"RefreshConnectionReconnectArgs",Sys.EventArgs,[]);var ha=a(1300);class ea{constructor(){this.Xkd=this.jt=
null}get zi(){return this.jt?this.Xkd?this.Xkd.getTime()-this.jt.getTime():(new Date).getTime()-this.jt.getTime():0}start(){this.jt=new Date}stop(){this.Xkd=new Date}}Object(A.a)(ea,"SimpleStopwatch",null,[]);var aa=a(1301),ca;(function(la){la[la.Nll=0]="contentUpdate";la[la.jml=1]="editorsTableUpdate";la[la.kyc=2]="fileNameUpdate";la[la.Xvl=3]="wetContentUpdate";la[la.bul=4]="persistedContentUpdate";la[la.Fll=5]="clientRtcReconnectRequest";la[la.Bul=6]="replicationTelemetry";la[la.Onl=7]="lockUpdate";
la[la.Jll=8]="collabServiceContentUpdate";la[la.Fvl=9]="trackChangeSettingUpdate";la[la.Hul=10]="saveTargetUpdate";la[la.Lvl=11]="uploadToOcsUpdate";la[la.Bnl=12]="labelUpdate";la[la.Sml=13]="hostNotificationSubscriptionStatus";la[la.mvl=14]="subscribeOrExtend";la[la.kml=15]="elapsedBootTelemetry";la[la.Hll=16]="clientToClientTelemetryMessage";la[la.Gll=17]="clientToClientResponseMessage";la[la.Tvl=18]="verifyNotificationPipeline";la[la.Rml=19]="hostNotificationHeartbeat";la[la.Lul=20]="secondaryMetadataUpdate";
la[la.last=21]="last"})(ca||(ca={}));Object(A.b)("UpdateNotificationType",ca);var xa=a(357),Oa=a(989);class ua extends X{constructor(la,Ca,Va,ia,wa,Jb,$a,Ka,nb,sa){super($a);this.bB=null;this.XVe=this.sdc=this.NRe=!1;this.WQ=0;this.Ihd=new v.a;this.Joh=ua.nIi();this.shd=m.AFrameworkApplication.fa.Ya("OwningFeatureCrewForRtcNotificationKpis");this.Wk=la;this.pTe=this.oTe=0;this.QUa=Ca;this.QUa.fnc(Object(b.a)(this,this.Crg,"onTooManyUndeliveredMessages"));this._clientId=Va;this.frh=wa;this.tl.lEh(Object(b.a)(this,
this.ipg,"onRefreshProxyRequired"));this.tl.jEh(Object(b.a)(this,this.fpg,"onRefreshAllPersistentStateRequest"));this.tl.EEh(Object(b.a)(this,this.$ia,"sendUpdateNotification"));this.tl.PCh(Object(b.a)(this,this.nmg,"onInternalPresenceUpdated"));this.tl.QCh(Object(b.a)(this,this.omg,"onInternalUpdateNotificationReceived"));this.tl.OCh(Object(b.a)(this,this.mmg,"onInternalPersistentStateUpdated"));this.tl.NCh(Object(b.a)(this,this.lmg,"onInternalPersistentStateCleared"));this.tl.DEh(Object(b.a)(this,
this.c7b,"sendPersistentState"));this.tl.WEh(Object(b.a)(this,this.m$a,"updateClientInfo"));this.Io=Jb;this.As=ia;this.Dt=Ka;this.OL=nb;this.yEb=sa;this.ADa=Object(I.a)(String,m.AFrameworkApplication.ii.Application)||""}ipg(la,Ca){this.bB=this.frh(Ca.hubConnection);this.QUa.reset();this.bB.Kik(Object(b.a)(this,this.eAa,"onPresenceUpdated"));this.bB.Gik(Object(b.a)(this,this.R4a,"onPersistentStateUpdated"));this.bB.Fik(Object(b.a)(this,this.X$d,"onPersistentStateCleared"));this.bB.kjk(Object(b.a)(this,
this.Epa,"onUpdateNotificationReceived"))}K1(la,Ca){this.yqa=Ca.newState;2===Ca.newState&&this.jAk()}jAk(){for(const la of this.Ihd)this.$ia(null,new ha.a(la.key,la.value,!1,new h.a));this.Ihd=new v.a}fpg(la,Ca){Ca.jwd();for(la=0;3>la;++la)this.Ozk(la,Ca)}Ozk(la,Ca){try{this.bB.RKd(la).done(Va=>{Ca.gAb(Ca.Vxd,"GetCompletePresenceSuccess")&&(Ca.L0h.S_j(),c.ULS.sendTraceTag(3249540,500,50,"Successfully retrieved complete session state for [{0}] of type [{1}]",this.As,la),this.tl.qdk(),this.QXj(la,Va),
this.tl.Hck(Va),Ca.jyf.lh(la)&&this.tl.Xzg(la,Ca.jyf.na(la),new h.a))}).fail(Va=>{Ca.gAb(Ca.Vxd,"GetCompletePresenceFail")&&(c.ULS.sendTraceTag(3249541,500,15,"Failed to retrieve complete session state : {0} for [{1}] of type [{2}]",Oa.RtcUtils.Yrb(Va),this.As,la),this.tl.wTc())}).always(()=>{Ca.stopwatch&&Ca.stopwatch.stop()})}catch(Va){c.ULS.sendTraceTag(595132428,500,10,"Exception thrown while calling hub method GetCompletePersistentStateWithMetadata. Promise not even created. Current event token: {0}, Exception message: {1}",
Ca.Vxd,Va.message)}}c7b(la,Ca){la=Ca.Lde;let Va;const ia=Ca.y$b;this.OL.wH(1,0);try{Va=Oa.RtcUtils.Lvd(la,this.yEb)}catch($a){this.OL.wH(1,3);c.ULS.sendTraceTag(574407636,500,10,"Exception thrown while trying to serialize presence. Exception message: {0}",$a.message);ia.setException($a);return}const wa=new l.a;wa.ga(this._clientId,Object.assign(new ja,{Presence:la,TimeStamp:(new Date).getTime()}));this.tl.eAg(Ca.type,wa);if(2!==this.yqa)this.Dt.p6a(),this.OL.wH(1,2),ia.setResult(null);else{var Jb=
this.WQ.toString();++this.WQ;la=new ka(()=>this.lAk(Ca.type,Va,Jb),Jb);la=this.w0g(0,Ca.type).add(la);la.OPc($a=>{2===$a&&(this.OL.wH(1,6),this.sdc||2!==Ca.type||c.ULS.sendTraceTag(508651234,500,15,"First persistent state update of type LiveMeeting for [{0}] was throttled",this.As));ia.setResult(null)});la.NPc(()=>{})}}lAk(la,Ca,Va){let ia=null;const wa=new ea,Jb=new F;c.ULS.sendTraceTag(3249501,500,50,"Sending presence update for [{0}] of type [{1}]",this.As,la);if(2!==this.yqa)return this.Dt.p6a(),
this.OL.wH(1,2),c.ULS.sendTraceTag(7934171,500,15,"Connection is lost - unable to send the message for [{0}] of type [{1}]",this.As,la),Jb.markAsCancelled(),Jb;this.Io&&20>this.oTe&&(ia=this.Io.Li("WebServiceCall","Send Presence Message"),this.oTe++);wa.start();Jb.l_b(1);try{this.bB.Mzb(la,Ca).done(()=>{this.Dt.l4b();this.OL.wH(1,1);c.ULS.sendTraceTag(3249502,500,50,"Successfully delivered presence update message [{0}] for [{1}] of type [{2}]",Va,this.As,la);2===la&&(this.sdc=!0);Jb.TMa(1);wa&&(wa.stop(),
wa.zi>this.Wk.hKg?this.OL.wH(1,4):this.OL.wH(1,5))}).fail($a=>{this.oZa||(this.Dt.p6a(),this.OL.wH(1,3),this.sdc||2!==la||c.ULS.sendTraceTag(508651233,500,15,"First persistent state update of type LiveMeeting for [{0}] failed",this.As),c.ULS.sendTraceTag(3249503,500,15,"Server failed to process the presence update message [{0}]: [{1}] for [{2}]",Va,Oa.RtcUtils.Yrb($a),this.As));Jb.TMa(2)}).always(()=>{ia&&ia.stop()})}catch($a){c.ULS.sendTraceTag(593072906,500,15,"Exception when invoking hub method UpdatePersistentState, error: {1}",
$a.message),this.OL.wH(1,3),this.sdc||2!==la||c.ULS.sendTraceTag(508651232,500,15,"First persistent state update of type LiveMeeting for [{0}] hit an exception",this.As),Jb.TMa(2)}return Jb}m$a(la,Ca){la=Ca.XXh;const Va=Ca.y$b;let ia;try{ia=Oa.RtcUtils.Lvd(la,this.yEb)}catch(wa){c.ULS.sendTraceTag(544318999,500,10,"Exception thrown while trying to serialize clientInfo. Exception message: {0}",wa.message);Va.setException(wa);return}try{this.bB.m$a(ia).done(()=>{c.ULS.sendTraceTag(544319E3,500,50,"Successfully delivered clientInfo.")}).fail(wa=>
{this.oZa||c.ULS.sendTraceTag(544319001,500,15,"Server failed to process udpate clientInfo: {0}.",Oa.RtcUtils.Yrb(wa));Va.setResult(null)})}catch(wa){c.ULS.sendTraceTag(544319002,500,15,"Exception when invoking hub method UpdateClientInfo: error: {0}",wa.message),Va.setResult(null)}}$ia(la,Ca){const Va=Ca.type;la=Ca.Lja;const ia=Ca.Cdi,wa=Ca.y$b;let Jb;this.OL.wH(0,0);try{Jb=Oa.RtcUtils.Lvd(la,this.yEb)}catch(Ka){this.OL.wH(0,3);c.ULS.sendTraceTag(574407637,500,10,"Exception thrown while trying to serialize updateHint. Exception message: {0}",
Ka.message);wa.setException(Ka);return}if(2!==this.yqa)ia?this.Ihd.ga(Va,la):(this.Dt.p6a(),this.OL.wH(0,2)),wa.setResult(null);else{var $a=this.WQ.toString();++this.WQ;Ca=new ka(()=>this.LAk(Va,Jb,$a),$a);Ca=this.w0g(1,Va).add(Ca);Ca.OPc(Ka=>{2===Ka&&this.OL.wH(0,6);wa.setResult(null)});Ca.NPc(()=>{})}}LAk(la,Ca,Va){let ia=null;const wa=new ea,Jb=new F;c.ULS.sendTraceTag(3249505,500,50,"Sending update notification for [{0}] of type [{1}]",this.As,la);if(2!==this.yqa)return this.Dt.p6a(),this.OL.wH(0,
2),c.ULS.sendTraceTag(7934172,500,15,"Connection is lost - unable to send the message for [{0}]",this.As),Jb.markAsCancelled(),Jb;this.Io&&3===la&&20>this.pTe&&(ia=this.Io.Li("WebServiceCall","Send WetContent Update"),this.pTe++);wa.start();Jb.l_b(1);this.bB.$ia(la,Ca).done(()=>{this.Dt.l4b();this.OL.wH(0,1);c.ULS.sendTraceTag(3249506,500,50,"Successfully delivered update notification message [{0}] for [{1}] of type [{2}]",Va,this.As,la);Jb.TMa(1);wa&&(wa.stop(),wa.zi>this.Wk.hKg?this.OL.wH(0,4):
this.OL.wH(0,5))}).fail($a=>{this.oZa||(this.Dt.p6a(),this.OL.wH(0,3),c.ULS.sendTraceTag(3249507,500,15,"Server failed to process the update notification message [{0}] : [{1}] for [{2}]",Va,Oa.RtcUtils.Yrb($a),this.As));Jb.TMa(2)}).always(()=>{ia&&ia.stop()});return Jb}mF(){this.bB.N5k(Object(b.a)(this,this.eAa,"onPresenceUpdated"));this.bB.M5k(Object(b.a)(this,this.R4a,"onPersistentStateUpdated"));this.bB.L5k(Object(b.a)(this,this.X$d,"onPersistentStateCleared"));this.bB.V5k(Object(b.a)(this,this.Epa,
"onUpdateNotificationReceived"))}hei(){this.Xrk();this.tl.R6a(Object(b.a)(this,this.K1,"onConnectionStateChanged"));this.tl.dok(Object(b.a)(this,this.ipg,"onRefreshProxyRequired"));this.tl.bok(Object(b.a)(this,this.fpg,"onRefreshAllPersistentStateRequest"));this.tl.xok(Object(b.a)(this,this.$ia,"sendUpdateNotification"));this.tl.Xmk(Object(b.a)(this,this.nmg,"onInternalPresenceUpdated"));this.tl.Ymk(Object(b.a)(this,this.omg,"onInternalUpdateNotificationReceived"));this.tl.Wmk(Object(b.a)(this,this.mmg,
"onInternalPersistentStateUpdated"));this.tl.Vmk(Object(b.a)(this,this.lmg,"onInternalPersistentStateCleared"));this.tl.wok(Object(b.a)(this,this.c7b,"sendPersistentState"));this.tl.Qok(Object(b.a)(this,this.m$a,"updateClientInfo"))}nmg(la,Ca){this.eAa(Ca.b_,Ca.Nma)}eAa(la){this.Dt.q6a();this.R4a(0,la)}mmg(la,Ca){this.R4a(Ca.type,Ca.b_)}QXj(la,Ca){const Va={};for(const ia in Ca)Va[ia]=Ca[ia].Presence;this.nog(la,Va,Ca)}R4a(la,Ca){this.Dt.q6a();this.nog(la,Ca)}nog(la,Ca,Va){Va=void 0===Va?null:Va;
if(c.ULS.Wqa(500,100))for(var ia in Ca);delete Ca[this._clientId];if(!Ua.a.isEmpty(Ca)){for(var wa in Ca)ia=wa,Ca[ia]=Oa.RtcUtils.deserialize(Ca[wa],"Presence",ia,!1,this.yEb);wa=new l.a;ia=(new Date).getTime();for(const $a in Ca){var Jb=Ca[$a];const Ka=$a;let nb;Va?(nb=Va[Ka],nb.Presence=Jb):nb=Object.assign(new ja,{Presence:Jb,TimeStamp:ia});wa.ga(Ka,nb)}this.tl.eAg(la,wa);switch(la){case 0:this.NRe||(c.ULS.sendTraceTag(4539734,500,50,"Raising first presence update notification for [{0}]",this.As),
this.NRe=!0,m.AFrameworkApplication.xl&&m.AFrameworkApplication.xl.rEj());this.tl.Ozg(Ca,[]);break;case 2:this.XVe||(c.ULS.sendTraceTag(508867081,500,50,"Raising first live meeting update notification for [{0}]",this.As),this.XVe=!0);this.tl.Mzg(la,Ca);break;default:this.tl.Mzg(la,Ca)}}}lmg(la,Ca){this.X$d(Ca.trc)}X$d(la){this.Dt.q6a();if(c.ULS.Wqa(500,100))for(let Ca=0;Ca<la.length;++Ca);la.length&&(this.tl.Hdk(la),this.tl.fdk(la),this.tl.Ozg({},la))}omg(la,Ca){this.Epa(Ca.type,Ca.Lja)}Epa(la,Ca){Ca=
void 0===Ca?null:Ca;this.Wk.LLk&&0===la&&c.ULS.sendTraceTag(40128990,500,50,"Received ContentUpdate notification from the server");if(0===la&&this.shd&&0<this.shd.length){const Va=Y.a.getInstance({d2c:"ContentUpdateNotificationReceived",featureName:"RtcNotification",Ama:this.shd,iAb:"RealTimeCoauth"});Va&&Va.Dba(this.Joh)}this.Wk.MLk&&13===la&&c.ULS.sendTraceTag(575221780,500,50,String.format("Received HostSubscription notification from the server : {0}",Ca||"<none>"));this.Dt.q6a();5===la?(Ca=(la=
this.P4j(Ca))?String.format("Received client reconnection request from the server. Reason: {0}, Backoff time: {1} ",la.reason,la.reconnectDelay):"Received client reconnection request from the server without params.",c.ULS.sendTraceTag(18637071,500,50,Ca),this.tl.wTc(la)):(Ca=Oa.RtcUtils.deserialize(Ca,String.format("UpdateNotification-{0}",ca[la]),null,!1,this.yEb),this.tl.Gdk(la,Ca))}P4j(la){try{if(!la||""===la)return null;const Ca=JSON.parse(la);return new fb(Ca[aa.a.Cme],Ca[aa.a.mvk],Ca[aa.a.ovk],
Ca[aa.a.$ne])}catch(Ca){return c.ULS.sendTraceTag(593844380,500,15,"Error when parsing reconnect hint: {0}",Ca.message),null}}w0g(la,Ca){return this.QUa.PYi(this.QYi(la,Ca))}QYi(la,Ca){return la+","+Ca}Xrk(){this.QUa.reset();this.QUa.XFg(Object(b.a)(this,this.Crg,"onTooManyUndeliveredMessages"))}static nIi(){var la=new Map;la.set("SkipAria","True");la=Object.assign({},{extendedProperties:la});return{Gw:"ContentUpdateNotificationReceived",Ypb:xa.b.FailureBased,Ak:la,agb:3E5}}}Object(A.a)(ua,"RtcMessageHandler",
X,[]);class Ia{xlf(la,Ca){return J.createInstance(la,void 0===Ca?"":Ca)}x7h(la,Ca){return W.createInstance(la,void 0===Ca?"":Ca)}}Object(A.a)(Ia,"ThrottlerFactory",null,[968]);var Sa=a(1394),Ya=a(671),da=a(210);class Ea{constructor(la){this.messageId=la;this.AAk=(new Date).getTime();this.D1d=new da.a}}Object(A.a)(Ea,"MessageLatencyDetails",null,[]);class oa{constructor(la,Ca,Va){this.Nka=null;this.Lfd=this.Vjd=0;this.sendMessage=()=>{if(this.YFb){const ia=Ya.a.create().toString();this.Nka=new Ea(ia);
this.tl.Lfe(16,ia,!1,new h.a);window.setTimeout(()=>{this.IAj(ia)},this.Lfd)}};this.wfk=(ia,wa)=>{16===wa.type?this.tl.Lfe(17,wa.Lja,!1,new h.a):17===wa.type&&this.YFb&&wa.Lja&&this.processMessage(wa.Lja)};this.Wk=Ca;this.vSe=Va;this.YFb=!1;this.tl=la;this.tl.Peb(this.wfk)}start(){if(this.vSe&&!this.YFb){const la=this.Wk.lKg;this.Lfd=this.Wk.iKg;la<=this.Lfd?(c.ULS.sendTraceTag(570975114,500,15,"LogMetrics cannot be started because configuration values are incorrect. RtcSendTelemetryMessageIntervalInMS({0}) should be greater than RtcLogClientMessageMetricsTimeOutInMs({1})",
this.Wk.lKg,this.Wk.iKg),this.vSe=!1):(this.YFb=!0,this.Vjd=window.setInterval(this.sendMessage,la))}}IAj(la){this.Nka&&this.Nka.messageId===la&&(0<this.Nka.D1d.count?(la=this.Nka.D1d.toArray().join(","),c.ULS.sendTraceTag(571339719,500,15,"ClientMessageLatencies:[{0}]",la)):c.ULS.sendTraceTag(562312150,500,50,"No client message latencies recorded"),this.Nka=null)}stop(){this.Vjd&&(window.clearInterval(this.Vjd),this.YFb=!1)}processMessage(la){la&&this.Nka&&la.toString()===this.Nka.messageId&&(la=
(new Date).getTime()-this.Nka.AAk,this.Nka.D1d.add(la))}static get instance(){return oa.Va}static zNd(la,Ca,Va){return oa.instance||(oa.Va=new oa(la,Ca,Va))}}oa.Va=null;Object(A.a)(oa,"ClientToClientMessageTelemetry",null,[]);class za{constructor(la,Ca,Va,ia,wa,Jb,$a,Ka,nb,sa,na,ab){this.Wkd=!1;this.Eda=null;this.ZQ=new l.a;this.CBb=1;this.l_=null;this.oD=!1;this.Ned=(new Date(0)).getTime();this.zYe=0;this.KXg=()=>{const Ja=this.CBb;this.Wkd=!1;this.Dt.BBg();this.CDa.yVi(this.H0h,this.gkg,Object(b.a)(this.iBa,
this.iBa.hbj,"initThrottlerManager"),Object(b.a)(this,this.gAb,"verifyConnectionToken"),Ja)};this.gkg=Ja=>{Ja=void 0===Ja?null:Ja;this.Dt.DBg();let Pa=null;!Ja||"documentsessiondeleted"!==(Pa=Ja.toLowerCase())&&"documentsessionexpired"!==Pa?this.$Nb():(c.ULS.sendTraceTag(508396225,500,15,"In RealtimeChannel method OnFailureToConnect: Disconnect was called for [{0}], due to non-retriable RtcErrorCode:{1}",this.As,Ja),this.disconnect())};this.$Nb=(Ja,Pa)=>{Pa=void 0===Pa?null:Pa;c.ULS.sendTraceTag(508396224,
500,50,"Disconnecting the connection [{0}]",this.Eda);Ja=(Ja=2===this.QW||1===this.QW)&&!this.iBa.oZa;let hb=!0,ac=0;Pa&&Object.getType(Pa)!==Object.getType(Sys.EventArgs.Empty)&&Pa.$je&&""!==Pa.$je&&(Ja=!0,this.CDa.DGk(Pa.$je),hb=Pa.$ne,ac=Pa.reconnectDelay);Ja&&this.K1(1,this.QW);++this.CBb;this.iBa.mF();this.MVk(hb);this.CDa.Jgi();this.Hlf();Ja&&window.setTimeout(this.KXg,Math.min(ac,3E4))};this.s5g=()=>{let Ja=null;const Pa=(()=>{let hb=this.CDa.IGf();({correlationId:Ja}=hb);return hb})().returnValue;
this.l_.qs=Pa;c.ULS.sendTraceTag(40768457,500,50,"Connection parameters refresh finished for client [{0}], CorrelationId:{1}",this.As,Ja)};this.H0h=Ja=>{this.Ned=(new Date).getTime();let Pa=null;this.l_.qs=(()=>{let ac=this.CDa.IGf();({correlationId:Pa}=ac);return ac})().returnValue;this.Wk.PGh&&(this.l_.url=Ja,Sa.a.instance&&(Sa.a.instance.sif=n.a.WU(Ja)));let hb=null;this.Io&&(hb=this.Io.Li("WebServiceCall","ConnectToServer"));c.ULS.sendTraceTag(3290048,500,50,"Connecting to server for client [{0}]",
this.As);Ja={};this.Qkc&&(Ja.transport=1===this.Qkc.length?this.Qkc[0]:this.Qkc);Ja.pingInterval=null;t.a.instance.k4b(1,0);Ja.waitForPageLoad=!1;this.l_.start(Ja,null).done(ac=>{this.Dt.EBg();t.a.instance.k4b(1,1,!0);c.ULS.sendTraceTag(508396195,500,50,"Successfully connected to server using connection [{0}], CorrelationId:{1}",ac.id,Pa)}).fail(ac=>{c.ULS.sendTraceTag(3457858,500,15,"Failed to connect to server : connection string: {0}, CorrelationId:{1},  ClientDetails: [{2}]",this.CDa.rM,Pa,this.As);
this.gkg();this.Dt.CBg(ac);t.a.instance.k4b(1,1,!1);this.tl.Uzg(0,{["CorrelationId"]:Pa,["ErrorDetails"]:ac,["ConnectionState"]:f.a[this.QW]})}).always(()=>{hb&&hb.stop();Sa.a.instance&&(Sa.a.instance.rad=!1)})};this.Vrg=(Ja,Pa)=>{for(const hb of Pa.ral)this.ZQ.lh(hb.key)||this.ZQ.ga(hb.key,new v.a),Ja=hb.value,this.ZQ.na(hb.key).ga(Pa.type,new w(Ja.Presence,new Date(Ja.TimeStamp))),hb.key===this._clientId&&0===Pa.type&&this.tl.Tck(Ja.Presence)};this.Urg=(Ja,Pa)=>{for(const hb of Pa.trc)this.ZQ.remove(hb)};
this.jwd=()=>{let Ja;const Pa=[];(()=>{let hb=this.ZQ.wj(this._clientId);({value:Ja}=hb);return hb})().returnValue&&this.ZQ.remove(this._clientId);for(const hb of this.ZQ.keys)Array.add(Pa,hb);for(const hb of Pa)this.ZQ.remove(hb);Ja&&this.ZQ.ga(this._clientId,Ja);this.tl.Pck(Pa)};this._clientId=la;this.Qkc=Ca;this.QW=0;this.Io=ia;this.S9c=Ka;this.ksh=$a;this.Kgh=nb;this.qjh=wa;this.CDa=Jb;this.As=Va;this.Dt=sa;this.Wk=na;this.Yn=ab;this.ith=1>100*Math.random()}get N3a(){return this.CDa.N3a}set N3a(la){this.CDa.N3a=
la}get iBa(){return this.ksh}get tl(){return this.Kgh}init(){this.tl.kEh(this.$Nb);this.tl.YEh(this.Vrg);this.tl.XEh(this.Urg);this.Yn.NHb(this.Dt);m.AFrameworkApplication.BQa(()=>{this.Dt.Tge();Sa.a.instance&&Sa.a.instance.b3d()});this.Hlf();this.Ffi();this.tl.GEh(this.s5g)}Ffi(){try{const Va=$.signalR;if(!Va)throw Error.invalidOperation("Failed to retrieve Signalr object");const ia=Va.version;if(!ia)throw Error.invalidOperation("Signalr object is missing version information");if("2.1.1"===ia){var la=
Va.transports;if(!la)throw Error.invalidOperation("Failed to retrieve transports object");var Ca=la.longPolling;if(!Ca)throw Error.invalidOperation("Failed to retrieve longPolling object");if(!Ca.supportsKeepAlive)throw Error.invalidOperation("LongPolling object does not have a field called supportsKeepAlive");Ca.supportsKeepAlive=this.b$h()}}catch(Va){c.ULS.sendTraceTag(508396227,500,15,"Failed to disable longPolling KeepAlives: {0}",Va.message)}}b$h(){return()=>!1}Hlf(){const la=++this.CBb;this.Ned=
(new Date(0)).getTime();this.l_=this.qjh();this.tl.odk(this.l_);this.l_.stateChanged(Ca=>{this.JPj(Ca,la)});this.l_.connectionSlow(Object(b.a)(this,this.F_j,"onSlowConnection"));this.l_.error(Object(b.a)(this,this.s_j,"onSignalRError"));this.l_.log=Object(b.a)(this,this.t_j,"onSignalRLog")}gAb(la,Ca){return la!==this.CBb?(c.ULS.sendTraceTag(508396226,500,50,"ConnectionToken verification failed for {0}",Ca),!1):!0}connect(){2!==this.QW&&1!==this.QW&&(c.ULS.sendTraceTag(4539721,500,50,"Starting a new RTC connection for client [{0}]",
this.As),this.S9c.HPj(),t.a.instance.QUk(),this.K1(1,this.QW),this.KXg())}disconnect(){0===this.QW?c.ULS.sendTraceTag(508396194,500,50,"Disconnect for [{0}] was called but the channel is already Disconnected",this.As):(this.Dt.HBg(),Sa.a.instance&&(Sa.a.instance.rad=!0),c.ULS.sendTraceTag(508396193,500,50,"Starting explicit disconnect for [{0}]",this.As),this.iBa.oZa=!0,this.S9c.QQj(),this.K1(0,this.QW),this.$Nb(),this.iBa.oZa=!1)}MVk(la){const Ca=this.OSh(),Va=this.l_,ia=this.Eda,wa=()=>{if(this.Wkd)c.ULS.sendTraceTag(508396191,
500,15,"Stop connection was called twice, possibly on the same connection.");else try{this.Wkd=!0,Va.stop(!0,la)}catch(Jb){c.ULS.sendTraceTag(508396192,500,15,"Stopping connection failed: {0}",Jb.message)}};0<Ca?(c.ULS.sendTraceTag(508396190,500,50,"Waiting to stop connection [{0}]: [{1}] ms.",ia,Ca),window.setTimeout(wa,Ca)):(c.ULS.sendTraceTag(508396189,500,50,"Stopping connection [{0}].",ia),wa())}OSh(){let la=0;0===this.l_.state&&(la=this.Ned+za.oel-(new Date).getTime(),0>la&&(la=0));return la}get connectionState(){return this.QW}mGa(la){this.tl.mGa(la)}R6a(la){this.tl.R6a(la)}nAk(la){this.c7b(0,
la)}c7b(la,Ca){const Va=new h.a;this.tl.Xzg(la,Ca,Va);return Va.task}jIb(la){this.tl.jIb(la)}rvb(la){this.tl.rvb(la)}Lpd(la){this.tl.Lpd(la)}mje(la){this.tl.mje(la)}Kpd(la){this.tl.Kpd(la)}lje(la){this.tl.lje(la)}R_a(la){return this.e_i(la)}tEi(){return this.WQb(0)}WQb(la){const Ca={};for(const Va of this.ZQ)Va.value.lh(la)&&(Ca[Va.key]=Va.value.na(la).data);return Ca}e_i(la){return this.ZQ.lh(la)&&this.ZQ.na(la).lh(0)?this.ZQ.na(la).na(0).data:null}sEi(){const la=new v.a;if(!this.ZQ.lh(this._clientId))return la;
for(const Ca of this.ZQ.na(this._clientId))la.ga(Ca.key,Ca.value.data);return la}$ia(la,Ca,Va){Ca=void 0===Ca?null:Ca;Va=void 0===Va?!1:Va;const ia=new h.a;this.tl.Lfe(la,Ca,Va,ia);return ia.task}Peb(la){this.tl.Peb(la)}r5b(la){this.tl.r5b(la)}U0(la){let Ca,Va;return(()=>{let ia=this.ZQ.wj(la);({value:Ca}=ia);return ia})().returnValue&&(()=>{let ia=Ca.wj(0);({value:Va}=ia);return ia})().returnValue?new x(this.i_i(Va),Va.timeStamp):null}yEi(){const la={};for(const Ca of this.ZQ)Ca.value.wj(0).returnValue&&
(la[Ca.key]=this.U0(Ca.key));return la}m$a(la){const Ca=new h.a;this.tl.Fdk(la,Ca);return Ca.task}get clientId(){return this._clientId}get TRk(){return this.ith}dispose(){var la;if(!this.oD){if(null===(la=m.AFrameworkApplication.fa)||void 0===la?0:la.ka("DetachRtcEventHandlerOnDispose"))this.gei(),this.iBa.hei();this.iBa.mF();this.Yn.uie(this.Dt);this.Dt.Tge();Sa.a.instance&&Sa.a.instance.b3d();this.oD=!0}}JPj(la,Ca){this.gAb(Ca,"StateChangedSignalR")&&this.K1(this.qjf(la.newState),this.qjf(la.oldState))}K1(la,
Ca){if((1!==this.QW||0!==Ca||1!==la)&&this.QW!==Ca){var Va=String.format.apply(null,["Unexpected connection state change : Current state is '{0}' while the event indicates ('{1}'->'{2}') transition"].concat([this.QW,Ca,la]));c.ULS.sendTraceTag(508396188,500,10,Va)}if(this.QW!==la){switch(la){case 2:Sa.a.instance&&Sa.a.instance.vEj();this.Eda=this.l_.id;c.ULS.sendTraceTag(3249539,500,50,"Established connection [{0}] for client [{1}]",this.Eda,this.As);this.gCj(this.l_);c.ULS.sendTraceTag(508396186,
500,50,"Retrieving complete session state");Va=null;this.Io&&(Va=this.Io.Li("WebServiceCall","Receive First Presence"));const ia=this.CBb;this.tl.ndk(Object(b.a)(this,this.gAb,"verifyConnectionToken"),ia,this.S9c,this.jwd,this.sEi(),Va);this.Wk.rtcClientMessageTelemetryEnabled&&oa.zNd(this.tl,this.Wk,100*Math.random()<=this.Wk.nvk).start();break;case 1:2===Ca&&c.ULS.sendTraceTag(508396185,500,50,"Lost connection [{0}] to the server ...trying to re-establish it",this.Eda);break;case 0:if(oa.instance&&
oa.instance.stop(),this.iBa.oZa)c.ULS.sendTraceTag(508396182,500,50,"Connection [{0}] has been explicitly closed",this.Eda);else{1===Ca&&(c.ULS.sendTraceTag(508396184,500,50,"Signalr detected an unexpected disconnect event while attempting to re-establish connection [{0}]. Kicking off global reconnect logic ...",this.Eda),this.Dt.IBg());2===Ca&&c.ULS.sendTraceTag(508396183,500,50,"Signalr detected a disconnect event triggered by a period of client inactivity for connection [{0}]. Kicking off global reconnect logic ...",
this.Eda);this.$Nb();return}}this.QW=la;this.tl.tck(la,Ca)}}gei(){this.tl.cok(this.$Nb);this.tl.Sok(this.Vrg);this.tl.Rok(this.Urg);this.tl.Aok(this.s5g)}gCj(la){if(la&&la.transport&&la.transport.name){la=la.transport.name;var Ca=la.toLowerCase();"websockets"===Ca?c.ULS.sendTraceTag(4290723,500,50,"Transport name - {0} for [{1}]",la,this.As):"serversentevents"===Ca?c.ULS.sendTraceTag(4290752,500,50,"Transport name - {0} for [{1}]",la,this.As):"foreverframe"===Ca?c.ULS.sendTraceTag(4290753,500,50,
"Transport name - {0} for [{1}]",la,this.As):"longpolling"===Ca?c.ULS.sendTraceTag(4290754,500,50,"Transport name - {0} for [{1}]",la,this.As):"mocktransport"!==Ca&&c.ULS.sendTraceTag(508396180,500,15,"Unknown transport protocol encountered - '{0}'",la)}else c.ULS.sendTraceTag(508396181,500,10,"Transport protocol name is missing")}F_j(){if(this.Wk.jKg){const la=n.a.Fz(this.N3a,"mid");c.ULS.sendTraceTag(508396178,500,15,"Detected that the connection [{0}] is slow for target machine [{1}]",this.Eda,
la)}else c.ULS.sendTraceTag(508396177,500,50,"Detected that the connection [{0}] is slow",this.Eda)}s_j(){c.ULS.sendTraceTag(508396176,600,15,"SignalR ERROR for connection [{0}];",this.Eda)}t_j(la){la=a(989).RtcUtils.Yrb(la);if(this.Wk.jKg&&la.startsWith("Keep alive timed out.")){const Ca=n.a.Fz(this.N3a,"mid");c.ULS.sendTraceTag(508396175,500,15,"SignalR lib: {0}. Target Machine: {1}",la,Ca)}else this.TRk&&2E3>this.zYe&&!la.startsWith("Invok")&&!la.startsWith("Trigger")&&(c.ULS.sendTraceTag(508396174,
500,50,"SignalR lib: {0}",la),this.zYe++)}qjf(la){switch(la){case 0:return 1;case 2:return 1;case 1:return 2;case 4:return 0;default:throw Error.argumentOutOfRange("state",la,"Unknown SignalR state");}}i_i(la){return la&&la.timeStamp?(new Date).getTime()-la.timeStamp.getTime()>(this.Wk.OLh?6E4:this.Wk.NLh)?2:1:1}static createInstance(la,Ca,Va,ia,wa,Jb,$a,Ka,nb,sa,na,ab,Ja){return za.b6h(la,Ca,Va,void 0===Ja?null:Ja,ia,wa,Jb,$a,void 0===Ka?null:Ka,void 0===nb?null:nb,void 0===sa?null:sa,void 0===ab?
null:ab)}static b6h(la,Ca,Va,ia,wa,Jb,$a,Ka,nb,sa,na,ab){nb=void 0===nb?null:nb;sa=void 0===sa?null:sa;na=void 0===na?null:na;ab=void 0===ab?null:ab;const Ja=y.createInstance(m.AFrameworkApplication.fa),Pa=m.AFrameworkApplication.buildVersion?m.AFrameworkApplication.buildVersion:"1.0",hb=za.lBi(la,Ca,$a),ac=Ja.YXh?a(1480).RealtimeChannelMetrics.createInstance(hb):new H;var Hc=Sa.a.create(wa);Ja.rtcJsClientFrequentlyLogsMetrics&&Hc.MUk(Ja.rvk);var bd="";bd=nb&&""!==nb?nb:"/rtc2/";Hc.Zzf=n.a.WU(bd);
const zc=bd+"signalr";nb=bd+"findsession";const oc=M.h9i;bd=new Ia;na=na||D.a.getInstance();c.ULS.shipAssertTag(508396228,500,Ja.kKg<=k.a.$bg,"Client attempting to override max payload size beyond absolute limit");const Nb=Math.min(Ja.kKg,k.a.$bg);Hc.Zbg=Nb;Hc=new ua(Ja,new L(bd),la,hb,Aa=>new U(Aa.createHubProxy(oc)),Ka,na,ac,Hc,Nb);sa||(sa=a(1514).FindSessionStrategy.createInstance(Ca,wa,nb,Ka,Pa,$a,la,hb,na,Jb,ia,ab));sa.Cyc=Ja.Cyc;Ca=new Q(hb);Va=Va?Va.split(","):null;la=new (a(1512).RealtimeChannel)(la,
Va,hb,Ka,()=>$.hubConnection(zc),sa,Hc,Ca,na,ac,Ja,wa);la.init();return la}static lBi(la,Ca,Va){return String.format("ClientID={0}, App={1}, ClientType={2}, SessionId={3}",la,this.sqc(r[Va]),this.sqc("browser"),Ca)}static sqc(la){return la?la.charAt(0).toLocaleUpperCase()+la.substring(1,la.length):la}}za.oel=15E3;Object(A.a)(za,"RealtimeChannel",null,[433,950])},1514:function(A,u,a){a.r(u);a.d(u,"FindSessionStrategy",function(){return ba});A=a(0);var c=a(15),b=a(142),h=a(210),r=a(1140);class f{}f.urb=
"throttling_messageDelay";f.jXb="enabled";f.PQa="throttling_timeToWaitForResponse";f.krb="throttling_maxNumberOfOutstandingMessages";f.gOf="throttling_globalMaxNumberOfOutstandingMessages";f.errorMessage="errorMessage";f.BWg="url";f.yia="queryString";f.rM="connectionString";Object(A.a)(f,"RtcFindSessionOutputFieldNameConstants",null,[]);var l=a(6),m=a(79),x=a(59),n=a(858),t=a(92),w=a(33),v=a(189);class k{constructor(){this.hOf=this.Vbg=this.Wbg=this.ecg=0;this.vJc=!1;this.correlationId=this.rM=this.yia=
this.Wxd=this.errorMessage=null}get R_h(){return this.Wxd+"?"+this.yia}}Object(A.a)(k,"FindSessionResponse",null,[]);class y{}y.clientId="ClientId";y.$al="UserApp";y.userSessionId="usid";y.userType="UserType";y.qbl="UserVersion";y.iTc="qs";y.aYh="clientProtocol";y.oKj="NoAuth";Object(A.a)(y,"RtcFindSessionInputQueryParamConstants",null,[]);class C{constructor(U,D,I,X,Y,ja){this.nUa=null;this.krh=U;U=String.format("{0}={1}",y.clientId,w.a.Al(X));U=String.format("{0}&{1}={2}",U,y.userSessionId,w.a.Al(Y));
U=String.format("{0}&{1}={2}",U,y.$al,w.a.Al(I.toString()));U=String.format("{0}&{1}={2}",U,y.userType,w.a.Al("1"));U=String.format("{0}&{1}={2}",U,y.qbl,w.a.Al(D));U=String.format("{0}&{1}={2}",U,y.aYh,w.a.Al(C.ZXh));(D=C.dFi(I,ja))&&(U=String.format("{0}&{1}",U,D));this.ujh=U}rCg(){this.nUa=this.krh()}rJd(){this.nUa&&""!==this.nUa||(this.rCg(),c.ULS.sendTraceTag(575784194,500,this.nUa&&""!==this.nUa?50:15,"Query signature delegate called for refresh returned: {0} ",this.nUa));const U=String.format("{0}={1}",
y.iTc,w.a.Al(this.nUa));return String.format("{0}&{1}",U,this.ujh)}static dFi(U,D){return 4===U?String.format("{0}={1}",y.oKj,"1"):D?D.m_i():null}}C.ZXh="1.0";Object(A.a)(C,"FindSessionQueryStringGenerator",null,[]);var B=a(1394),E=a(1139),K=a(989),F=a(1302);class W{}W.Swi="FSType";Object(A.a)(W,"RtcFindSessionRequestHeaders",null,[]);class J{}J.Sek="polling";Object(A.a)(J,"RtcFindSessionTypes",null,[]);var L=a(1301);class M{}M.Ycl="RTC-TokenProofkey";M.Atj="RTC-IsWacJsBootFsRequest";Object(A.a)(M,
"RtcRequestHeaders",null,[]);var Q=a(89),H=a(1078);class ba{constructor(U,D,I,X,Y,ja,Ua,ka,fb,ha,ea,aa,ca){ca=void 0===ca?null:ca;this.JQe=(new Date(0)).getTime();this.XRe=0;this.thc=!1;this.NXe=null;this.dhe=36E5;this.Qab=ba.QUf;this.BCb=0;this.f7a=null;this.yqa=0;this.gwb=this.uif=null;this.Qrh=[f.jXb,f.errorMessage,f.BWg,f.rM,f.yia,f.gOf,f.krb,f.PQa,f.urb];this.Prh=[f.jXb,f.errorMessage];this.rM=this.N3a=null;this.WLe=new C(ea?ea:()=>l.AFrameworkApplication.Jo,Y,ja,Ua,U,D);this.lBb=aa;this.Io=
X;this.Yn=D;this.Blh=I;this.As=ka;this.tl=fb;this.KCb=ca;this.XLe=!1;this.Cyc=9E4;ha&&ha.execute(xa=>{Object(H.a)()?xa.Gpd():xa.hua(()=>{c.ULS.sendTraceTag(40768456,500,50,"Connection parameters refresh requested for client [{0}]",this.As);this.WLe.rCg()})});2>=100*Math.random()&&(this.dhe=3E5);B.a.instance&&(B.a.instance.pCf=this.dhe)}DGk(U){this.gwb=U}init(){this.tl.pEh(Object(b.a)(this,this.nsk,"resetGetMachineIdDelay"));this.tl.mGa(Object(b.a)(this,this.K1,"onConnectionStateChanged"))}K1(U,D){this.yqa=
D.newState;2===D.newState&&(this.BCb=0)}IGf(){let U;U=this.f7a.correlationId;return{returnValue:String.format("{0}&{1}={2}",this.f7a.yia,ba.Mjf,w.a.Al(U)),correlationId:U}}yVi(U,D,I,X,Y){this.Mzk(()=>{X(Y,"GetMachineIdSuccess")&&(c.ULS.sendTraceTag(17956951,500,50,"Successfully retrieved Rtc MachineId [{0}] for [{1}]",this.rM,this.As),U(this.NXe),I(this.RYi()))},ja=>{X(Y,"GetMachineIdFailure")&&(c.ULS.sendTraceTag(4060129,500,15,"Failed to retrieve Rtc MachineId for [{0}]",this.As),D(ja))},X,Y)}Jgi(){this.Kff();
this.m$i()}Mzk(U,D,I,X){c.ULS.sendTraceTag(17956952,500,50,"Retrieving Rtc MachineId from server. Getting from last findsession, connectionString is [{0}]",this.rM);if(this.rM)U();else{var Y=this.pSh();window.setTimeout(()=>{this.sendFindSessionRequestToServerInternal(U,D,I,X)},Y)}}sendFindSessionRequestToServerInternal(U,D,I,X){I(X,"RequestMachineId")&&(this.JQe=(new Date).getTime(),I=x.a.Dj(),this.JGf(Y=>{const ja=x.a.Dj();this.Ttg(Y);this.Bpe();U();Y=x.a.Dj()-ja;c.ULS.sendTraceTag(577356039,345,
50,"SFSRTS Success - TimeElapsed: {0}",Y)},Y=>{const ja=x.a.Dj();this.Kff();B.a.instance&&B.a.instance.wH(2,3);D(Y);Y=x.a.Dj()-ja;c.ULS.sendTraceTag(577356040,345,50,"SFSRTS Failure - TimeElapsed: {0}",Y)},!1),I=x.a.Dj()-I,c.ULS.sendTraceTag(577599296,345,50,"SFSRTS - TimeElapsed: {0}",I))}m$i(){this.Qab+=ba.JPi;this.Qab=Math.min(this.Qab,ba.fFj)}pSh(){var U=(new Date).getTime();U=this.JQe+this.Qab-U;0>U&&(U=0);return U}Ttg(U){try{this.f7a=U,this.N3a=U.R_h,this.rM=U.rM,this.uif=U.yia,this.NXe=U.Wxd}catch(D){c.ULS.sendTraceTag(17956953,
500,10,"FindSession response contains invalid fields. Exception {0}, is thrown",D.toString())}}Kff(){this.rM=null;this.Lff()}Bpe(){this.Lff();this.thc=!0;this.XRe=window.setTimeout(Object(b.a)(this,this.ahk,"refreshMachineId"),this.dhe)}Lff(){this.thc&&(window.clearTimeout(this.XRe),this.thc=!1)}ahk(){this.thc=!1;this.JGf(U=>{const D=this.uif!==U.yia,I=this.rM!==U.rM,X=this.rM;this.Ttg(U);0!==this.yqa&&(I?(c.ULS.sendTraceTag(17956955,500,15,"Recycling RTC connection due to RTC machine id change. old={0}, new={1}",
X||"null",U.rM),this.tl.wTc()):(this.tl.vdk(D,I),this.Bpe()))},()=>{B.a.instance&&B.a.instance.wH(2,3);this.Bpe()},!0)}nsk(){this.Qab=ba.QUf}RYi(){return new F.a(this.f7a.ecg,this.f7a.Wbg,this.f7a.Vbg,this.f7a.hOf)}K1k(U){if(Object.getType(U)!==Object)return null;for(let D in U);return this.g6h(U)}g6h(U){if(!(f.jXb in U))return null;const D=U[f.jXb];var I=D?this.Qrh:this.Prh;for(const X of I)if(!(X in U))return null;I=Object.assign(new k,{vJc:U[f.jXb],errorMessage:U[f.errorMessage],correlationId:v.a.create().toString()});
D&&(I.Wxd=U[f.BWg],I.yia=U[f.yia],I.rM=U[f.rM],I.hOf=U[f.gOf],I.Vbg=U[f.krb],I.Wbg=U[f.PQa],I.ecg=U[f.urb]);return I}TLi(U,D){c.ULS.sendTraceTag(50448152,500,50,"Using FindSessionUtils find session response");this.KCb.Qwi.continueWith(()=>{this.KCb.Qwi.result?(c.ULS.sendTraceTag(50448153,500,50,"FindSessionUtils find Session resulted in success"),U(this.KCb.Rwi)):(c.ULS.sendTraceTag(50448154,500,15,"FindSessionUtils find Session resulted in error"),D(this.KCb.Rwi))})}DHg(U,D,I,X,Y){Y=void 0===Y?!1:
Y;return ja=>{E.a.instance.k4b(0,1);U&&U.stop();this.lBb=this.gwb=null;this.I9f(ja.data,!0,D);var Ua=K.RtcUtils.deserialize(ja.data.responseData,"FindSession",null);if(Ua)if(Ua=this.K1k(Ua)){if(Ua.vJc&&Ua.yia&&Ua.rM){c.ULS.sendTraceTag(4317446,500,50,"Successfully retrieved MachineId from server for [{0}]",this.As);this.Hzj(ja.data);I(Ua);return}D.FindSessionFailureReason="FindSessionInvalidResponse";D.IsRtcEnabled=Ua.vJc;D.IsQueryStringEmpty=!Ua.yia;D.IsConnectionStringEmpty=!Ua.rM;c.ULS.sendTraceTag(4290720,
500,15,"Response did not contain valid MachineId [ConnectionUrl and/or QueryString] for [{0}]; IsRtcEnabled:{1}; IsQueryStringEmpty:{2}; IsConnectionStringEmpty:{3}",this.As,Ua.vJc,!Ua.yia,!Ua.rM)}else D.FindSessionFailureReason="FindSessionTranslateServerResponseFailed",c.ULS.sendTraceTag(8745097,500,15,"Could not translate server response to findSession response for [{0}]",this.As);else D.FindSessionFailureReason="FindSessionDeserializeServerResponseFailed",c.ULS.sendTraceTag(7372827,500,10,"Could not deserialize response data for [{0}]",
this.As);this.Vzg(D,Y);X(null)}}yHg(U,D,I,X){X=void 0===X?!1:X;return Y=>{E.a.instance.k4b(0,1);U&&U.stop();this.lBb=this.gwb=null;this.I9f(Y.data,!1,D);let ja=null;var Ua="unknown";let ka="unknown";Y.data&&((Ua=Y.data.responseHeaders)&&ba.fwb in Ua&&null!=Ua[ba.fwb]&&(ja=Ua[ba.fwb].toString()),Ua=n.a[Y.data.status],ka=Y.data.httpStatus.toString());D.FindSessionFailureReason="FindSessionRequestFailed";D.HttpErrorCode=ka;D.HttpErrorStatus=Ua;D[ba.fwb]=ja;c.ULS.sendTraceTag(4290721,500,15,"Request for MachineId failed with Status='{0}'; HttpStatus='{1}' for [{2}]; RtcErrorCode='{3}'. Polling: '{4}' '",
Ua,ka,this.As,ja,X);this.Vzg(D,X);I(ka)}}JGf(U,D,I){I=void 0===I?!1:I;let X=null;c.ULS.sendTraceTag(4317445,500,50,"Getting MachineId from server for [{0}]",this.As);const Y={};var ja=this.WLe.rJd();Y[Q.a.K$]=v.a.create().toString();this.gwb&&""!==this.gwb?ja=String.format("{0}&{1}={2}",ja,L.a.Cme,this.gwb):this.lBb&&""!==this.lBb&&(ja=String.format("{0}&{1}={2}",ja,L.a.Cme,this.lBb),Y[M.Ycl]="True",Y[M.Atj]="True");ja=this.Blh+"?"+ja;I&&(Y[W.Swi]=J.Sek);const Ua={};Ua.IsNetworkOfflineBeforeSendRequest=
this.Yn.Mob;Ua.HasAvailableConnectionsBeforeSendRequest=this.Yn.AQf;Ua.MaxConnectionsAllowed=this.Yn.$Mc;Ua.IsRefreshMachineId=I;this.KCb&&!this.XLe?(this.TLi(this.DHg(null,Ua,U,D,I),this.yHg(null,Ua,D,I)),this.XLe=!0):(this.Io&&(X=this.Io.Li("WebServiceCall","GetMachineIdFromTheServer")),B.a.instance&&B.a.instance.wH(2,0),0>this.Yn.c$(ja,1,null,Y,[ba.Nsc,ba.fwb,ba.C0b,ba.Ame,ba.Hdg,ba.mgg,ba.lgg],!1,1,this.DHg(X,Ua,U,D,I),this.yHg(X,Ua,D,I),null,null,!1,null,this.Cyc,"3",null,!0)&&(5<this.BCb&&200>
this.BCb&&c.ULS.sendTraceTag(578166985,500,15,"FindSession request not scheduled due to expired token. Manually triggered failure callback {0} times.",this.BCb),window.setTimeout(()=>{this.BCb++;D("-1")},1E3)))}I9f(U,D,I){I||(I={});I.IsNetworkOfflineAfterRequestComplete=this.Yn.Mob;I.IsRequestSucceeded=D;U&&(I.EnqueueTime=U.UOb,I.InvokedTime=U.tP,I.CompletedTime=U.G$,U.responseHeaders&&(ba.Nsc in U.responseHeaders&&(I.CorrelationId=U.responseHeaders[ba.Nsc]),ba.C0b in U.responseHeaders&&(I[ba.C0b]=
U.responseHeaders[ba.C0b])));c.ULS.sendTraceTag(38633565,500,D?50:15,K.RtcUtils.Yrb(I))}Vzg(U,D){U||(U={});U.ConnectionState=r.a[this.yqa];D||this.tl.Uzg(1,U)}Hzj(U){try{var D=!1,I=!1,X=U.responseHeaders,Y=m.a.WU(U.request.get_url());if(X&&ba.Ame in X){const ha=X[ba.Ame].toString().toLocaleLowerCase();I="true"===ha;D="false"===ha}X=!1;const fb=0<=Y.toLocaleLowerCase().indexOf("collab");I&&!fb?X=!0:D&&fb&&(X=!0);if(X){D={};D.HostName=Y;D.Status=n.a[U.status];D.HttpStatus=U.httpStatus.toString();var ja=
U.request.get_headers();for(let ha in ja){var Ua=ja[ha];(Y=ha)&&0<Y.length&&(I=0,Ua&&(I=Ua.toString().length),D["r_"+Y]=I)}if(U.responseHeaders){const ha=new h.a;ha.add(ba.Nsc);ha.add(ba.C0b);ha.add(ba.fwb);ha.add(ba.mgg);ha.add(ba.lgg);ha.add(ba.Hdg);ba.Lzh(D,U.responseHeaders,ha)}ba.wzh(U.request.get_url(),D);var ka=t.a.toJSON(D);c.ULS.sendTraceTag(559437006,500,15,ka)}}catch(fb){c.ULS.sendTraceTag(559437007,500,10,"DomainLandingIncorretDC exception[{0}]",fb.toString())}}static createInstance(U,
D,I,X,Y,ja,Ua,ka,fb,ha,ea,aa){return ba.$6h(U,D,I,X,Y,ja,Ua,ka,fb,ha,ea,void 0===aa?null:aa)}static $6h(U,D,I,X,Y,ja,Ua,ka,fb,ha,ea,aa){aa=void 0===aa?null:aa;U=U||v.a.create().toString();U=new ba(U,D,I,X,Y,ja,Ua,ka,fb,ha,null,ea,aa);U.init();return U}static Lzh(U,D,I){for(let X of I)X in D&&(U[X]=D[X])}static wzh(U,D){if(U){var I=U.indexOf("?");if(-1!==I)for(U=U.substr(I+1).split("&"),I=0;I<U.length;++I){var X=U[I].split("=");if(2===X.length){const Y=X[0];if(Y&&0<Y.length){let ja=0;if(X=X[1])ja=
X.length;D["q_"+Y]=ja}}}}}}ba.JPi=3E3;ba.fFj=3E5;ba.QUf=1E3;ba.Nsc="X-CorrelationId";ba.Mjf="corrid";ba.fwb="RtcErrorCode";ba.C0b="X-OfficeCluster";ba.Ame="X-NewEnv";ba.Hdg="X-MSEdge-Ref";ba.lgg="X-OFFICEFD";ba.mgg="X-OfficeFE";Object(A.a)(ba,"FindSessionStrategy",null,[964])},363:function(A,u,a){a.r(u);var c={};a.r(c);var b={};a.r(b);a.d(b,"NamedSheetViewConversionManager",function(){return ca});var h={};a.r(h);a.d(h,"PresenceConverter",function(){return Ia});var r={};a.r(r);a.d(r,"PresenceTelemetry",
function(){return za});var f={};a.r(f);a.d(f,"PresenceView",function(){return jd});var l={};a.r(l);a.d(l,"RealTimeChannelController",function(){return vd});var m={};a.r(m);a.d(m,"SelectionPresenceManager",function(){return tc});var x=a(0),n=a(15),t=a(210),w=a(113),v=a(125),k=a(26),y=a(67),C=a(22);class B{constructor(Rb,Gb,Cc,cb,pc,Ic,rd,Rd,va){va=void 0===va?!1:va;this.tDa=null;this.Sad=!0;this.Zhd=this.kw=this.j8c=null;this.hh=new w.a;this.zaj=()=>{this.hea.result&&this.nVe.result&&(this.kw=this.hea.result,
this.Zhd=this.nVe.result,this.kw.jIb(this.eAa),this.j8c=new v.a(2,2,this.zHe,this.M6k,88),B.vk.jm(this.j8c))};this.eAa=(Bb,Ac)=>{(this.Sad||this.Afk(Ac.b_))&&B.vk.zca(this.j8c,0)};this.M6k=Bb=>{var Ac=this.kw.yEi();if(Ac){var Nc=new Date,hd=!1;if(this.Sad){this.tDa=Ac;this.Sad=!1;var qd=this.tDa;for(var je in qd){Ac=je;var Ie=qd[je];Ie.e3a<Nc&&(Nc=Ie.e3a);2===Ie.status&&(hd=!0,this.Zhd.GEg(Ac))}hd&&this.gAg();B.vk.zca(Bb,this.sJf(Nc))}else{Ie=new t.a;je=!1;var Oe=this.tDa;for(qd in Oe){Oe=qd;if(!(Oe in
this.tDa)||this.Fph.clientId===Oe)continue;var Vb=this.tDa[Oe];const fd=Ac[Oe];if(Vb&&fd){Vb=Vb.status;const Qd=fd.status;2===Vb&&1===Qd?(Ie.add(Oe),n.ULS.sendTraceTag(38052609,392,50,Oe+" returned from away")):1===Vb&&2===Qd&&(je=hd=!0,this.Zhd.GEg(Oe),n.ULS.sendTraceTag(38052610,392,50,Oe+" went away"));1===Qd&&fd.e3a<Nc&&(Nc=fd.e3a)}}this.tDa=Ac;B.vk.zca(Bb,this.sJf(Nc));(0<Ie.count||hd)&&this.gAg();0<Ie.count&&!this.Arh?(Bb=this.sHi(Ie),this.L_k(Bb)):Bb=new t.a;(je||0<Bb.count)&&this.brh(k.a.Zwd,
2)}}};this.Fph=Rb;this.hea=Gb;this.nVe=Cc;this.lVe=cb;this.zHe=Ic;B.vk=pc;this.brh=rd;this.dFa=Rd;this.Arh=va;y.Task.WAA(Gb,Cc).continueWith(this.zaj)}gAg(){this.hh.raiseEvent("u",null,this)}Afk(Rb){for(const Cc in Rb){var Gb=this.lVe.yKf({key:Cc,value:Rb[Cc]});if(Gb&&Gb.clientId&&(Gb=Gb.clientId.toLowerCase(),(Gb=this.tDa[Gb]||this.tDa[Gb.toUpperCase()])&&2===Gb.status))return!0}return!1}L_k(Rb){if(Rb.count)for(const Gb of Rb)Rb=this.dFa.PX(String.format(Object(C.a)("EditorsToastArriving"),Gb),!1),
Rb.image=5,Rb.Z0="CoAuth_AuthorStatus_16x16x32",this.dFa.EF(Rb)}sHi(Rb){const Gb=this.kw.tEi(),Cc=new t.a;for(const cb in Gb){const pc={key:cb,value:Gb[cb]};if(Rb.contains(pc.key)){const Ic=this.lVe.yKf(pc);Ic&&(Cc.add(Ic.userName),Rb.remove(pc.key))}}Cc.count||n.ULS.sendTraceTag(38052611,392,10,"There were no coauthor names found");return Cc}sJf(Rb){const Gb=new Date;return Math.max(Rb.getTime()+this.zHe-Gb.getTime(),0)}}B.vk=null;Object(x.a)(B,"AwayManager",null,[]);var E=a(504),K=a(97),F=a(6),
W=a(95),J=a(5),L=a(183),M=a(142),Q=a(2),H=a(766);class ba{EF(){n.ULS.sendTraceTag(537154380,0,50,"PresenceBootstrapper.AddNotificationBarEntry: User state changed from inactive to active")}removeEntry(){}get isVisible(){return!1}PX(Rb,Gb){return new H.a(Rb,Gb)}dispose(){}static get instance(){ba.Va||(ba.Va=new ba);return ba.Va}}ba.Va=null;Object(x.a)(ba,"NoOpNotificationBar",null,[269,4]);Object(W.b)(J.u,{Fk:"singleton"})(Rb=>Lo(function*(){const Gb=yield W.a.resolve(J.Nb,Rb);var Cc=yield W.a.resolve(J.jf,
Rb);const cb=yield W.a.resolve(J.Se,Rb),pc=yield W.a.resolve(J.Ue,Rb),Ic=new L.a;Cc.dmf(Object(M.a)(Ic,Ic.setResult,"setResult"));Cc=new L.a;Cc.setResult(pc);return new B(Object(Q.a)(new E.a,{clientId:Gb.workbookContext.ClientId}),Ic.task,Cc.task,cb,K.TaskManager.instance,F.AFrameworkApplication.fa.ka("AwayStatusOneMinuteTimeoutIsEnabled")?6E4:F.AFrameworkApplication.fa.Lj("AwayCoauthorThresholdMs",9E5),Object(M.a)(F.AFrameworkApplication.yh,F.AFrameworkApplication.yh.gl,"processAction"),ba.instance)}));
var U=a(135),D=a(40);class I{}Object(x.a)(I,"NamedSheetViewConversionEntry",null,[]);var X=a(10),Y=a(124),ja=a(36),Ua=a(1),ka=a(64),fb=a(46),ha=a(28);const ea=(Rb,Gb,Cc)=>!!Rb&&!!Gb&&Rb.SheetName===Gb.SheetName&&(!!Rb.NamedObjectName&&Rb.NamedObjectName===Gb.NamedObjectName||!Rb.NamedObjectName&&!Gb.NamedObjectName&&((void 0===Cc?0:Cc)?fb.H(Rb).topRight.Xi(fb.H(Gb).topRight):fb.H(Rb).Xi(fb.H(Gb)))),aa=(Rb,Gb,Cc)=>{if(!Gb||!Gb.$h)return null;for(let cb=0;cb<Gb.$h.count;cb++){const pc=Gb.$h.getItem(cb);
if(pc&&pc.type===Cc&&pc.usedRange&&pc.usedRange.contains(fb.H(Rb))&&ha.a.equals(pc.sheetName,Rb.SheetName,!0))return pc}return null};let ca=class extends D.a{constructor(Rb){super();this.Rhb=this.AHa=null;this.z5c=this.lIa=!1;this.Dl=()=>{const Gb=this.$.ea.Qq;if(null===Gb||void 0===Gb?0:Gb.SheetChanges)for(const Cc of Gb.SheetChanges)if(2===Cc.Type){if(this.AHa)for(const cb of this.AHa)cb.Range.SheetName===Cc.Name&&(cb.Range.SheetName=Cc.NewName);if(this.Rhb)for(const cb of this.Rhb)cb.Range.SheetName===
Cc.Name&&(cb.Range.SheetName=Cc.NewName)}};this.xlg=()=>{n.ULS.sendTraceTag(537154395,0,50,"NamedSheetViewConversionManager.OnGridLoaded");this.z5c=!1;this.VOc(this,Sys.EventArgs.Empty)};this.ej=()=>{n.ULS.sendTraceTag(537154394,0,50,"NamedSheetViewConversionManager.OnWorkbookClosing");this.z5c=!0};this.VOc=()=>{n.ULS.sendTraceTag(50620166,0,50,`NamedSheetViewConversionManager.OnConversionOutdatedEvent: triggered with version [${this.$.ea.eNa}]`);if(!this.$.isEditMode||!this.$.ea.ki||this.$.ea.Fmb||
this.z5c||this.$.ea.eNa===X.a.xuc)n.ULS.sendTraceTag(537154393,0,50,`NamedSheetViewConversionManager.OnConversionOutdatedEvent: Request skipped [Edit Mode: ${this.$.isEditMode}] [IsSessionActive: ${this.$.ea.ki}] [HasRaisedSessionEnded: ${this.$.ea.Fmb}] [WorkbookClosed: ${this.z5c}]`);else{this.Rhb=this.AHa=null;var Gb=this.$.pa.ta.Vh(),Cc=this.$.pa.ta,cb=this.UTj,pc=this.TTj;const Ic=Cc.$a(1,null);ka.h(Cc,"GetNamedSheetViewConversion",Ic,cb,pc,null,Gb,132)}};this.UTj=Gb=>{if(ja.a.Lx(Gb.Errors)){this.lIa=
!0;const Cc=[-1100324317,-1857233882];ja.a.ko(Gb.Errors,Cc)&&n.ULS.sendTraceTag(537154392,0,10,`NamedSheetViewConversionManager.OnGetNamedSheetViewConversionSuccess Errors: [${ja.a.Yh(Gb.Errors)}]`);Gb=ja.a.WS(Gb.Errors,Cc,"NamedSheetViewConversionManager:OnGetNamedSheetViewConversionSuccess");this.$.ea.sx(Gb)}else this.lIa=!1,Gb=Gb.Result,this.$.ea.eNa=Gb.ConversionVersion,this.$$j(Gb.NamedSheetViewConversionEntries),this.uck()};this.TTj=Gb=>{this.lIa=!0;Gb=Y.a.gk(Gb.data);let Cc=!1;Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:6401332_RefreshTokenException")&&
Gb.forEach(cb=>{-1537615947===cb.MessageId&&(Cc=!0)});Cc?n.ULS.sendTraceTag(512274778,0,50,`NamedSheetViewConversionManager.OnGetNamedSheetViewConversionFailure: Errors: [${ja.a.Yh(Gb)}].`):n.ULS.sendTraceTag(537154391,0,10,`NamedSheetViewConversionManager.OnGetNamedSheetViewConversionFailure: Errors: [${ja.a.Yh(Gb)}].`)};this.$=Rb;n.ULS.shipAssertTag(537154397,0,!!this.$.ea,"NamedSheetViewConversionManager ctor: EwaControl.SessionStateManager should not be null");this.$.gq(this.ej);this.$.ea.vX(this.xlg);
this.$.ea.uDh(this.VOc);this.$.ea.pz(this.Dl);this.$.ea.wA&&this.VOc(this,Sys.EventArgs.Empty)}y4e(Rb){this.addHandler("SVCU",Rb)}AFg(Rb){this.removeHandler("SVCU",Rb)}dispose(){this.Rhb=this.AHa=null;this.$&&this.$.Yu(this.ej);this.$.ea&&(this.$.ea.uZ(this.xlg),this.$.ea.znk(this.VOc),this.$.ea.LA(this.Dl));this.$=null;super.dispose()}F2h(Rb){return this.lIa?null:this.ojf(Rb,this.Rhb,"ConvertPresencePublicToPrivate")}E2h(Rb){return this.lIa?null:this.ojf(Rb,this.AHa,"ConvertPresencePrivateToPublic")}$$j(Rb){Rb?
(this.Nbi(Rb),this.AHa=Rb,this.Rhb=this.c7h(this.AHa)):n.ULS.sendTraceTag(537154396,0,10,"NamedSheetViewConversionManager.ProcessConversionEntries: conversionEntries can be empty but not null")}uck(){n.ULS.sendTraceTag(537154390,0,50,"NamedSheetViewConversionManager.RaiseConversionUpdatedEvent: new version is update on client from server");this.raiseEvent("SVCU")}ojf(Rb,Gb,Cc){if(!Gb||!Gb.length)return n.ULS.sendTraceTag(537154389,0,50,`NamedSheetViewConversionManager.${Cc}: skipping convert due to ${Gb?
"empty":"null"} ConversionEntries. `),Rb;for(const cb of Rb){for(const pc of Gb)!pc.IsRow||!ea(pc.Range,cb)||cb.FirstRow<=pc.Range.FirstRow&&cb.LastRow>=pc.Range.LastRow||(Cc={},Cc.SheetName=cb.SheetName,Cc.FirstRow=Cc.LastRow=cb.FirstRow,Cc.FirstColumn=Cc.LastColumn=cb.FirstColumn,ea(pc.Range,Cc)?(Cc=cb.FirstRow-pc.Range.FirstRow,0>Cc||Cc>=pc.ConversionMap.length?n.ULS.sendTraceTag(537154388,0,10,`NamedSheetViewConversionManager.ConvertRanges: invalid mapIndex after adjust. Index: [${Cc}], ConversionMap.Length: ${pc.ConversionMap.length}`):
(Cc=pc.ConversionMap[Cc]-Cc,cb.FirstRow+=Cc,cb.LastRow=cb.FirstRow,cb.LastColumn=Math.min(cb.LastColumn,pc.Range.LastColumn))):cb.FirstRow<pc.Range.FirstRow&&cb.LastRow>=pc.Range.FirstRow?cb.LastRow=pc.Range.FirstRow-1:cb.LastColumn>=pc.Range.FirstColumn&&(cb.LastColumn=pc.Range.FirstColumn-1));if(0>cb.FirstRow||cb.FirstRow>X.a.eG)cb.FirstRow=Math.max(Math.min(cb.FirstRow,X.a.eG),0);if(0>cb.LastRow||cb.LastRow>X.a.eG)cb.LastRow=Math.max(Math.min(cb.LastRow,X.a.eG),0);if(0>cb.FirstColumn||cb.FirstColumn>
X.a.PE)cb.FirstColumn=Math.max(Math.min(cb.FirstColumn,X.a.PE),0);if(0>cb.LastColumn||cb.LastColumn>X.a.PE)cb.LastColumn=Math.max(Math.min(cb.LastColumn,X.a.PE),0)}return Rb}c7h(Rb){if(!Rb||!Rb.length)return n.ULS.sendTraceTag(537154387,0,50,`NamedSheetViewConversionManager.CreateInverseConversionEntries: skip creating inverse due to ${this.AHa?"empty":"null"} ConversionEntries. `),Rb;const Gb=Array(Rb.length);for(let Cc=0;Cc<Rb.length;++Cc){const cb=new I;cb.Range=Rb[Cc].Range;cb.IsRow=Rb[Cc].IsRow;
cb.ConversionMap=Array(Rb[Cc].ConversionMap.length);cb.IsRow||(this.lIa=!0,n.ULS.sendTraceTag(537154386,0,10,"NamedSheetViewConversionManager.CreateInverseConversionEntries: adjusting presence against column sort map is NYI."));for(let pc=0;pc<Rb[Cc].ConversionMap.length;++pc)cb.ConversionMap[Rb[Cc].ConversionMap[pc]]=pc;Gb[Rb.length-Cc-1]=cb}return Gb}Nbi(Rb){if(Rb&&Rb.length)for(const Gb of Rb)this.Mbi(Gb),Rb=Gb.IsRow?Gb.Range.LastRow-Gb.Range.FirstRow+1:Gb.Range.LastColumn-Gb.Range.FirstColumn+
1,Gb.ConversionMap.length!==Rb&&(n.ULS.shipAssertTag(537154385,0,!1,`NamedSheetViewConversionManager.DecompressEntries: decompressed conversion map doesn't match expected size - Expected: [${Rb}] | Actual: [${Gb.ConversionMap.length}]`),this.lIa=!0)}Mbi(Rb){const Gb=Rb.ConversionMap;if(Gb&&Gb.length)if(0>Gb[0])n.ULS.shipAssertTag(537154384,0,!1,"NamedSheetViewConversionManager.DecompressConversionMap: conversionMap starts with a negative number"),this.lIa=!0;else{var Cc=[];for(let cb=0;cb<Gb.length;++cb)if(0>
Gb[cb]){const pc=Gb[cb-1],Ic=-1*Gb[cb];for(let rd=1;rd<=Ic;++rd)Cc.push(pc+rd)}else Cc.push(Gb[cb]);Rb.ConversionMap=Cc}}};ca=Object(U.__decorate)([Object(W.d)(J.Yd),Object(U.__param)(0,Object(J.Nb)())],ca);Object(x.a)(ca,"NamedSheetViewConversionManager",D.a,[444,4]);var xa=a(1299),Oa=a(1063),ua=a(625);let Ia=class{yKf(Rb){const Gb=Rb.key;Rb=Rb.value;if(!Rb)return null;const Cc=Rb.SupportsChat?4:0;return Object(Q.a)(new E.a,{clientId:Gb,Ivd:Rb.ChatThreadId,Hvd:Rb.ChatThreadDiscoveryUri,tUb:Rb.InChat,
email:Rb.Cid,capabilities:new ua.a(Cc),isAnonymous:Rb.IsAnonymous})}};Ia=Object(U.__decorate)([Object(W.d)(J.Se)],Ia);Object(x.a)(Ia,"PresenceConverter",null,[442]);var Sa=a(489),Ya=a(173),da=a(56),Ea=a(154),oa=a(155);let za=class{constructor(Rb){this.Hwg=this.Qde=this.Jwg=this.Fwg=this.xug=this.zme=this.gKg=this.nKg=this.mKg=!1;this.Rde=this.qce=this.s6b=this.t6b=this.IWc=this.Dme=0;this.t2f=!1;this.T6d=this.hKb=0;this.HJc=!1;this.ij=()=>{this.HJc=!0;this.$.ea.Uq(this.ij)};this.$=Rb;Sa.a.t4&&(this.T6d=
window.performance.timing.navigationStart);this.T6d||n.ULS.sendTraceTag(537154379,0,15,"Navigation start time is zero");this.$.ea.$q(this.ij)}M9f(Rb){this.mKg||(this.Dme=Rb,this.mKg=!0)}GBj(Rb){this.nKg||(this.IWc=Rb,this.nKg=!0)}L9f(Rb,Gb){this.gKg||(this.t6b=Gb,this.t2f=Rb,this.gKg=!0)}J9f(Rb){this.zme||(this.s6b=Rb,this.zme=!0)}jBj(Rb){!this.Qde&&this.zme&&(this.Rde=Rb,this.Qde=!0)}w9f(Rb){this.xug||(this.qce=Rb,this.xug=!0)}iBj(Rb){if(!this.Fwg&&this.qua&&!this.HJc){this.Fwg=!0;const Gb=this.QKd();
Gb.RtcIntializeToPeopleWellServiceCreate=this.qce-this.t6b;Gb.PeopleWellServiceCreateToPresenceGalleryRender=Rb-this.qce;Gb.PresenceGalleryRenderTotalTime=Rb-this.qua;oa.b(this.$).Aj(Ea.a.Gwg,Gb,void 0,!0)}}lBj(Rb){if(!this.Jwg&&this.qua&&!this.HJc){this.Jwg=!0;const Gb=this.QKd();Gb.RtcIntializeToRtcConnect=this.s6b-this.t6b;Gb.RtcConnectToPresenceSent=Rb-this.s6b;Gb.PresenceSentTotalTime=Rb-this.qua;oa.b(this.$).Aj(Ea.a.Kwg,Gb,void 0,!0)}}kBj(Rb){if(!this.Hwg&&this.Qde&&this.qua&&!this.HJc){this.Hwg=
!0;const Gb=this.QKd();Gb.RtcIntializeToRtcConnect=this.s6b-this.t6b;Gb.RtcConnectToPresenceRenderInitiate=this.Rde-this.s6b;Gb.PresenceRenderInitiateToPresenceRenderFinish=Rb-this.Rde;Gb.PresenceRenderTotalTime=Rb-this.qua;oa.b(this.$).Aj(Ea.a.Iwg,Gb,void 0,!0)}}dispose(){this.$=null}QKd(){const Rb={};Rb.CoAuthorCountsOnBoot=this.$.ea.Wt.length;Rb.RtcConnectedLaterInSession=this.t2f;Rb.BrowserVisibilityChanged=this.bOh();Rb.AppInteractiveAbsTime=this.qua;Rb.NavigationStartTime=this.T6d;Rb.AppInteractiveToRtcSliceDownloadInitialize=
this.Dme-this.qua;Rb.RtcSliceDownloadInitializeToRtcSliceLoad=this.IWc-this.Dme;Rb.AppInteractiveToRtcSliceLoad=this.IWc-this.qua;Rb.RtcSliceLoadToRtcInitialize=this.t6b-this.IWc;return Rb}get qua(){if(this.hKb)return this.hKb;Ya.a.instance.I$("AppInitStatus_interactivityReady")&&(this.hKb=Ya.a.instance.EE("AppInitStatus_interactivityReady"));this.hKb||n.ULS.sendTraceTag(537154378,0,15,"App interactive time is zero");return this.hKb}bOh(){return Sa.a.t4&&Ya.a.instance.I$(da.a.nbc)?0<Ya.a.instance.EE(da.a.nbc)[da.a.I9g]:
!1}};za=Object(U.__decorate)([Object(W.d)(J.Te),Object(U.__param)(0,Object(J.Nb)())],za);Object(x.a)(za,"PresenceTelemetry",null,[436,4]);var la=a(605),Ca=a(42),Va=a(94),ia=a(1479),wa=a(153),Jb=a(91),$a=a(39),Ka=a(58),nb=a(54),sa=a(32),na=a(146),ab=a(12),Ja=a(23),Pa=a(78);class hb extends D.a{constructor(Rb){super();this.K_e=Rb;this.hid=this.nFa=null}get rbc(){return this.K_e}get Ji(){return this.nFa||{}}set Ji(Rb){this.hid=this.nFa;this.nFa=Rb;this.raiseEvent("userPresenceChanged")}get oee(){return this.hid}dispose(){this.raiseEvent("userPresenceChanged");
this.raiseEvent("userLeft");this.hid=this.nFa=this.K_e=null;super.dispose()}}Object(x.a)(hb,"UserPresence",D.a,[]);class ac extends Pa.a{constructor(){super();this.oVe=this.mVe=this.HJ=null}get pG(){return this.mVe}uqe(Rb){this.mVe=Rb}get Gp(){return this.oVe}vqe(Rb){this.oVe=Rb}get Ji(){return this.HJ.Ji}set Ji(Rb){this.HJ.Ji=Rb}chb(){}Vlb(){return null}QLd(){return null}lWg(){}mWg(){}K6g(){}W8b(){}VTb(){}static L9k(Rb,Gb){const Cc=Rb.HJ.Ji;Va.a.gj(Rb.pG);Va.a.gj([Rb.HJ]);Rb.HJ=null;Rb.HJ=new hb(Gb);
Rb.uqe([]);Rb.vqe(Gb);Rb.Ji=Cc}}Object(x.a)(ac,"IUserGridPresence",Pa.a,[]);var Hc=a(1373),bd=a(1039),zc=a(41),oc=a(103),Nb=a(1230),Aa=a(59),Ub=a(184),Db=a(16),Ib=a(137);class yc extends D.a{constructor(Rb,Gb,Cc,cb,pc){super();this.yH=[];this.vgb=null;this.visible=!1;this.mJb=this.iqb=null;this.gna=!1;this.BRk=()=>{Va.a.dh(this.mJb);this.mJb=null;this.visible&&(this.a2a()?this.raiseEvent("showPresenceTooltip"):this.Vga(!0))};this.u$d=Ic=>{this.O6a(Ic)};this.jJ=()=>{this.k5g()};this.PP=()=>{this.k5g()};
this.domElement=Rb;this.da=Gb;this.dmd=Rb.id;this.iFa=cb;this.$=pc;this.zJc=!1;this.aUb();this.$hd=Cc;this.vl=null;this.WJ={};this.WJ.FirstColumn=0;this.WJ.FirstRow=0;this.WJ.LastColumn=0;this.WJ.LastRow=0}opd(Rb){this.addHandler("hidePresenceTooltip",Rb)}Zie(Rb){this.removeHandler("hidePresenceTooltip",Rb)}Ypd(Rb){this.addHandler("showPresenceTooltip",Rb)}zje(Rb){this.removeHandler("showPresenceTooltip",Rb)}Xpd(Rb){this.addHandler("showFullPresenceTooltip",Rb)}yje(Rb){this.removeHandler("showFullPresenceTooltip",
Rb)}BVa(Rb){this.addHandler("presenceChanged",Rb)}$Oa(Rb){this.removeHandler("presenceChanged",Rb)}get gI(){return this.dmd}get a2(){return this.$hd}get paneType(){return this.iFa}get FSc(){if(!this.domElement)return null;var Rb=this.da.sl(this.paneType).Vr,Gb=this.da.rtl,Cc=this.domElement.offsetWidth;if(!this.vl&&4>=Cc){if(this.WJ){if(this.WJ.SheetName!==this.$.activeItemName)return this.iqb;Cc=this.da.Dp;var cb=this.WJ.FirstRow;Gb=Gb?this.WJ.FirstColumn:this.WJ.LastColumn;if(Cc&&!(cb>=Cc.top&&
cb<=Cc.bottom&&Gb>=Cc.left&&Gb<=Cc.right))return cb=cb<=Cc.top?Rb.y:Rb.y+(cb>=Cc.bottom?Rb.height:Rb.height/2),Gb=Gb<=Cc.left?Rb.x:Rb.x+(Gb>=Cc.right?Rb.width:Rb.width/2),this.iqb=new Sys.UI.Point(Gb,cb)}return this.iqb}if(this.vl){Rb=this.domElement.offsetTop-2;cb=this.Mce(this.domElement.style.left);let pc=0;Gb&&(pc=this.Mce(this.domElement.parentNode.style.width)-Cc-cb,pc-=this.da.GZ.S2a&&this.da.GZ.U_d?Ib.a.ey:0);return this.iqb=new Sys.UI.Point((Gb?pc:cb)+Cc+4,Rb)}return this.iqb=new Sys.UI.Point(this.Mce(Gb?
this.domElement.style.right:this.domElement.style.left)+Cc,this.domElement.offsetTop)}get range(){return fb.H(this.WJ)}dispose(){this.raiseEvent("hidePresenceTooltip");this.raiseEvent("presenceChanged");this.Uff();this.i$a();Va.a.dh(this.mJb);this.domElement=this.da=null;super.dispose()}Nte(Rb,Gb){const Cc=!!Rb&&!fb.H(Rb).equals(fb.H(this.WJ)),cb=!!Gb&&(!this.vl||this.vl.get_id()!==Gb.get_id());if(Cc||cb)this.raiseEvent("presenceChanged"),this.Uff(),this.gna=!1,this.WJ=Rb,this.vl=Gb,this.iqb=null}Vga(Rb){this.visible=
this.gna=!1;Rb&&this.raiseEvent("hidePresenceTooltip")}bua(Rb){this.yH.push(Rb);this.aUb();Rb.BVa(this.u$d)}UBa(Rb,Gb){Rb?(this.visible=!0,Gb&&(this.mJb=Ub.AsyncMethodContext.wC(this.BRk,this.$.ua.ShowTooltipDelayInMs,nb.a.E0k,this.mJb))):this.Vga(Gb)}Mce(Rb){return Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:8164905_FixPresenceTooltipPositioning")?parseFloat(Rb):parseInt(Rb,10)}d$b(){}xzb(){if(this.domElement&&this.visible){this.vgb=Db.DOMElementExtensions.getBoundingClientRect(this.domElement);
const Rb=Math.floor(this.vgb.x);this.vgb.x=Rb===this.vgb.x?Rb:Rb+1;this.vgb.y=Math.floor(this.vgb.y)}}a2a(){if(!this.WJ)return!1;const Rb=this.mTi();return Rb?this.da.Lpj(Rb,this.paneType):!1}mTi(){if(this.range.isSingle){var Rb=this.da.za.gxa(this.range,this.$.activeItemName);return Rb?(Rb=Rb.tB(this.range))?Rb.AC:null:null}return this.range}Uff(){for(let Rb=0,Gb=this.yH.length;Rb<Gb;Rb++)this.yH[Rb].$Oa(this.u$d);this.yH.length=0;this.i$a()}aUb(){!this.zJc&&1<=this.yH.length&&(this.zJc=!0,this.da.za.lU(this.jJ),
this.da.za.nz(this.jJ),this.da.view.oz(this.PP))}i$a(){this.zJc&&!this.yH.length&&(this.zJc=!1,this.da&&(this.da.za.UV(this.jJ),this.da.za.Zy(this.jJ),this.da.view.dy(this.PP)))}O6a(Rb){Rb.$Oa(this.u$d);Array.remove(this.yH,Rb);this.i$a()}k5g(){this.xzb();for(let Rb=0,Gb=this.yH.length;Rb<Gb;Rb++)this.yH[Rb].xzb()}}Object(x.a)(yc,"TooltipNotificationUnit",D.a,[502,4]);var xc=a(655);class zb extends D.a{constructor(Rb,Gb,Cc,cb,pc,Ic,rd,Rd){super();this.Oh=null;this.hJ={};this.f1e=0;this.vl=this.dGa=
null;this.iFa=0;this.l1b=va=>{this.dGa&&this.dGa!==va||(this.dGa=null,this.Vga(!1));this.raiseEvent("hidePresenceTooltip")};this.S1b=va=>{this.dGa&&this.dGa!==va||(this.dGa=null,this.UBa(!0,!1));this.raiseEvent("showPresenceTooltip")};this.R1b=va=>{this.dGa||this.raiseEvent("showFullPresenceTooltip");this.dGa=va};this.E1b=()=>{this.Vga(!1);this.raiseEvent("presenceChanged")};Rd=Cc===ab.a.instance.sh(87)||Rd;this.$hd=new E.a(Gb,Cc,cb,new ua.a,null,null,null,null,Rd);this.da=Rb;this.dmd=Gb;this.highlight=
pc;this.VC=Ic;this.$=rd}opd(Rb){this.addHandler("hidePresenceTooltip",Rb)}Zie(Rb){this.removeHandler("hidePresenceTooltip",Rb)}Ypd(Rb){this.addHandler("showPresenceTooltip",Rb)}zje(Rb){this.removeHandler("showPresenceTooltip",Rb)}Xpd(Rb){this.addHandler("showFullPresenceTooltip",Rb)}yje(Rb){this.removeHandler("showFullPresenceTooltip",Rb)}BVa(Rb){this.addHandler("presenceChanged",Rb)}$Oa(Rb){this.removeHandler("presenceChanged",Rb)}get gI(){return this.dmd}get a2(){return this.$hd}get paneType(){return this.iFa}get range(){return this.Oh}get FSc(){return this.Oh||
this.vl?Nb.a(this.da.sl(this.paneType),this.nKa(this.paneType).FSc,!0):null}get gna(){return this.nKa(this.paneType).gna}set gna(Rb){const Gb=this.hJ;for(const Cc in Gb)Gb[Cc].gna=Rb}dispose(){this.raiseEvent("hidePresenceTooltip");this.raiseEvent("presenceChanged");this.VC&&this.VC.e5k(this.gI);const Rb=this.hJ;for(const Gb in Rb){const Cc=Rb[Gb];Cc.Zie(this.l1b);Cc.zje(this.S1b);Cc.yje(this.R1b);Cc.$Oa(this.E1b);Cc.dispose()}this.VC=this.Oh=this.highlight=this.da=this.hJ=null;super.dispose()}AWg(Rb,
Gb,Cc){Cc=void 0===Cc?null:Cc;Rb?(this.Oh=fb.H(Rb),this.iFa=this.da.fh.Lo(this.Oh.topRight)):Cc?(this.vl=Cc,this.iFa=Cc.xm.paneType):this.iFa=1;this.f1e=Gb;this.nKa(this.paneType);this.Nte(Rb,Cc)}Nte(Rb,Gb){const Cc=this.hJ;for(const cb in Cc)Cc[cb].Nte(Rb,Gb)}Vga(Rb){this.nKa(this.paneType).Vga(Rb);Rb=this.hJ;for(const Gb in Rb)Rb[Gb].Vga(!1)}V2e(Rb){const Gb=this.hJ;for(const Cc in Gb){const cb=Gb[Cc];cb.bua(Rb.nKa(cb.paneType))}}bua(Rb){this.nKa(Rb.paneType).bua(Rb)}a2a(){let Rb=this.nKa(this.paneType).a2a();
const Gb=this.hJ;for(const Cc in Gb)Rb=Gb[Cc].a2a()||Rb;return Rb}UBa(Rb,Gb){this.VC.HAe(this);this.nKa(this.paneType).UBa(Rb,Gb);Gb=this.hJ;for(const Cc in Gb)Gb[Cc].UBa(Rb,!1)}d$b(Rb){const Gb=this.hJ;for(const Cc in Gb)Gb[Cc].d$b(Rb)}xzb(){const Rb=this.hJ;for(const Gb in Rb)Rb[Gb].xzb();this.VC.HAe(this)}nKa(Rb){return this.bSi(Rb,this.f1e)}fAe(Rb){this.VC.fAe(Rb)}bSi(Rb,Gb){const Cc=this.highlight?this.highlight.VU(Gb,Rb).rl:this.vl?xc.b()?this.vl.domElement:this.vl.get_element():null;Gb=zb.HZi(Gb,
Rb);let cb=zc.a.wj(this.hJ,Gb);cb||(cb=new yc(Cc,this.da,this.a2,Rb,this.$),this.hJ[Gb]=cb,cb.opd(this.l1b),cb.Ypd(this.S1b),cb.Xpd(this.R1b),cb.BVa(this.E1b));return cb}static HZi(Rb,Gb){return Rb.toString()+Gb.toString()}}Object(x.a)(zb,"PaneInvariantTooltipNotificationUnit",D.a,[502,4]);var vb=a(1007);class bb{constructor(Rb,Gb,Cc){this.vl=this.objectId=this.yfc=null;this.Gp=Rb;this.$=Gb;this.VC=Cc;this.TC=new zb(Ja.f(this.$),this.Gp.User.UserID,this.Gp.User.UserName,this.Gp.UserColor,null,Cc,
this.$,this.Gp.IsAnonymous)}get vl(){return this.yfc}set vl(Rb){this.yfc=Rb}dispose(){this.XTb();Va.a.dh(this.TC);this.objectId=this.$=this.Gp=this.vl=null}bua(Rb){this.TC.V2e(Rb.TC)}XTb(){var Rb;this.vl&&this.Gp&&this.Gp.User&&(this.vl.t3c(!1,this.Gp.User.UserID,null),xc.b()&&(null===(Rb=this.vl)||void 0===Rb?void 0:Rb.xie(this.Gp.User.UserID)),this.TC.Vga(!0))}c9b(){bd.a.I8b&&this.vl&&this.Gp&&this.Gp.User&&vb.a.Sya(this.$,this.Gp.User.UserID)&&(this.vl.t3c(!0,this.Gp.User.UserID,this.Gp.UserColor),
this.TC.xzb())}iQ(Rb){var Gb;bd.a.RBa&&(xc.b()?this.vl&&(null===(Gb=this.Gp)||void 0===Gb?0:Gb.User)&&vb.a.Sya(this.$,this.Gp.User.UserID)&&this.vl.Bod(vb.a.xKf(this.Gp)):(this.TC.gna=Rb,this.TC.UBa(Rb,!0)))}s9b(Rb,Gb){this.TC.AWg(null,0===Gb?55:56,Rb)}}Object(x.a)(bb,"FloatingObjectPresenceHighlight",null,[490,4]);var La=a(156),pb=a(748),fa=a(57),kb=a(71),db=a(13),gb=a(325),Kb=a(151);class ub extends pb.a{constructor(Rb,Gb,Cc,cb){super(Gb,Ja.f(Gb),!0,!1,cb,Rb.User.UserID);this.vH=[];this.sIc=this.j9b=
!1;this.j7=()=>{Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:7486785_FixPresenterPresenceHighlightJSCrash")&&!this.vH||this.Gp.User.UserID!==this.tSb()||(n.ULS.sendTraceTag(521143967,0,50,`PresenceHighlight:onPresenterDetailsSaved called for User:
        ${this.Gp.User.UserID}, Logging presenter information: ${this.tSb()}, meetingId: ${this.$.ua.MeetingId}`),this.vH.forEach(pc=>{this.Gqf(pc)}),this.vH=[])};ub.Jhb||(ub.Jhb={});this.Gp=Rb;this.TC=new zb(this.da,this.Gp.User.UserID,this.Gp.User.UserName,this.Gp.UserColor,this,Cc,this.$,this.Gp.IsAnonymous);this.gXd=Kb.f(this.$);this.npj=Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:6191577_PresenterPresenceOnTop");this.aWd=Kb.a(this.$);this.iZf=this.gXd||this.aWd;this.j7=this.j7.bind(this);this.iZf&&
this.wxj()}dispose(){var Rb;Va.a.dh(this.TC);super.dispose();const Gb=ub.Jhb;for(const cb in Gb){var Cc=cb;const pc=Gb[cb];pc&&!pc.children.length&&(Db.DOMElementExtensions.an(pc),ub.Jhb[Cc]=null)}null===(Rb=ub.excelLiveManager)||void 0===Rb?void 0:Rb.svb(this.j7);this.vH=null}bua(Rb){this.TC.V2e(Rb.TC)}iQ(Rb){var Gb;!bd.a.RBa||null!==(Gb=this.Gp)&&void 0!==Gb&&Gb.User&&!vb.a.Sya(this.$,this.Gp.User.UserID)||(this.sIc||(this.TC.gna=Rb,this.TC.UBa(Rb,!0)),this.j9b=Rb&&this.sIc)}s9b(Rb,Gb){this.TC.AWg(Rb,
0===Gb?55:56);this.j9b=!1}c9b(Rb){var Gb;!bd.a.I8b||null!==(Gb=this.Gp)&&void 0!==Gb&&Gb.User&&!vb.a.Sya(this.$,this.Gp.User.UserID)||(this.TC.UBa(!0,!0),this.Nw([Rb]))}XTb(Rb){this.Vga();this.Mq(Rb)}vmf(Rb,Gb,Cc){Cc.className=fa.z;Cc.style.borderColor=this.Gp.UserColor;this.aWd&&Cc.classList.add(fa.K);const cb=document.createElement("div");55!==Rb&&56!==Rb&&(cb.style.backgroundColor=this.Gp.UserColor);Cc.appendChild(cb);cb.className=[fa.B,fa.A][Rb-55];Rb=zc.a.wj(ub.Jhb,Gb.toString());if(!Rb){const pc=
this.da.sl(Gb).domElement;Rb=document.createElement("div");pc.insertBefore(Rb,pc.firstChild);ub.Jhb[Gb.toString()]=Rb}Rb.appendChild(Cc);this.iZf&&this.Qgi(cb)}WTb(){}DPg(Rb,Gb,Cc,cb,pc){this.N2c&&Db.DOMElementExtensions.setVisible(Gb.rl,pc);pc=this.NFh(cb,Rb,Gb);gb.c(Cc,this.da.rtl,db.HelperMethods.Ki(pc.x));Cc.width=db.HelperMethods.Ki(pc.width);Cc.top=db.HelperMethods.Ki(pc.y);Cc.height=db.HelperMethods.Ki(pc.height);Gb=Gb.rl;Cc=Gb.parentNode;56===Rb?ub.yge(Cc,Gb,!1):55===Rb&&(Rb=this.VU(56),cb.equals(Rb.GKc)?
ub.yge(Cc,Gb,!1):ub.yge(Cc,Gb,!0));this.w8j()}LZc(){return!1}NFh(Rb,Gb,Cc){let cb=Rb.y+this.$Ja(Cc,!1);Cc=Rb.x+this.$Ja(Cc,!0)+Ib.a.LJd(Cc.rl.parentNode.parentNode,this.da.rtl);let pc=Rb.width;Rb=Rb.height+1;1>Cc&&-1<=Cc&&55===Gb&&(pc-=1-Cc,Cc=1);1>cb&&-1<=cb&&55===Gb&&(Rb-=1-cb,cb=1);pc=Math.max(0,pc-1);Rb=Math.max(0,Rb-2);return new kb.a(Cc,cb,pc,Rb)}w8j(){this.TC.xzb();this.sIc=!1;this.j9b&&this.iQ(!0);this.j9b=!1}Vga(){this.sIc||(this.TC.Vga(!0),this.j9b=!1)}static yge(Rb,Gb,Cc){Cc?Gb!==Rb.firstChild&&
(Rb.removeChild(Gb),Rb.insertBefore(Gb,Rb.firstChild)):Gb!==Rb.lastChild&&(Rb.removeChild(Gb),Rb.appendChild(Gb))}Qgi(Rb){var Gb;(null===(Gb=ub.excelLiveManager)||void 0===Gb?0:Gb.t5a.WD)?this.Gp.User.UserID===this.tSb()&&(n.ULS.sendTraceTag(521143968,0,50,`PresenceHighlight:Distinct presenter presence called for User:${this.Gp.User.UserID}, Logging presenter information: ${this.tSb()}, meetingId: ${this.$.ua.MeetingId}`),this.Gqf(Rb)):(n.ULS.sendTraceTag(509749071,0,50,`PresenceHighlight:PresenterCid is not yet saved for User:${this.Gp.User.UserID}`),
this.vH.push(Rb))}Gqf(Rb){this.aWd&&this.gkk(Rb);this.gXd&&(n.ULS.sendTraceTag(509749070,0,50,`PresenceHighlight:distinctPresenterPresenceInternal called for User:${this.Gp.User.UserID}`),this.u8i(Rb));this.gXd&&this.npj&&this.Y9k(Rb)}wxj(){ub.excelLiveManager?ub.excelLiveManager.Meb(this.j7):J.Tb.Aa()?void W.a.sj(J.Tb).then(Rb=>{ub.excelLiveManager=Rb;ub.excelLiveManager.Meb(this.j7)}):this.$.la.fi(473,Rb=>{ub.excelLiveManager=Rb;ub.excelLiveManager.Meb(this.j7)})}u8i(Rb){La.c(()=>{Rb.style.backgroundColor=
this.Gp.UserColor;Rb.classList.add(fa.M);n.ULS.sendTraceTag(520648066,0,50,`PresenceHighlight:Highlighting presence for User: ${this.Gp.User.UserID}, Logging presenter information: ${this.tSb()}, meetingId: ${this.$.ua.MeetingId}`)},this.$.ya)}gkk(Rb){La.c(()=>{Rb.parentElement.classList.remove(fa.K)},this.$.ya)}Y9k(Rb){this.TC.fAe(ub.excelLiveManager.t5a.WD);La.c(()=>{Rb.parentElement.classList.add(fa.L)},this.$.ya)}tSb(){return ub.excelLiveManager.t5a.WD}}ub.Jhb=null;Object(x.a)(ub,"PresenceHighlight",
pb.a,[]);class lb extends ac{constructor(Rb,Gb,Cc,cb){super();this.FR=new zc.a(!0);this.countFloatingObjects=this.Qyd=this.Pyd=0;this.QC=()=>{this.ppe()};this.MNa=()=>{this.ppe()};this.HJ=new hb(Rb);this.vqe(Rb);this.VC=Cc;this.uqe([]);this.$=Gb;this.zoom=cb;this.$.sa.pn(this.MNa);Ja.f(this.$).d$(this.QC)}get Ji(){return this.HJ.Ji}set Ji(Rb){this.HJ.Ji=Rb;this.ppe()}W8b(){var Rb=1===this.Ji.PresenceType?56:55;for(let Gb=0;Gb<this.pG.length;Gb++)this.pG[Gb].c9b(Rb);for(Rb=0;Rb<this.FR.count;Rb++)this.FR.sn(Rb).c9b()}VTb(){var Rb=
1===this.Ji.PresenceType?56:55;for(let Gb=0;Gb<this.pG.length;Gb++)this.pG[Gb].XTb([Rb]);for(Rb=0;Rb<this.FR.count;Rb++)this.FR.sn(Rb).XTb()}dispose(){this.$&&(this.$.sa&&this.$.sa.Gn(this.MNa),Ja.f(this.$).h2(this.QC));this.yqf();Va.a.gj(this.pG);Va.a.gj([this.HJ]);this.HJ=this.$=null;this.uqe(null);this.FR=null;super.dispose()}yqf(){if(this.FR){for(let Rb=0;Rb<this.FR.count;Rb++)this.FR.sn(Rb).dispose();this.FR.clear()}}chb(Rb){1===this.Ji.Version?this.oWh(Rb):this.pWh(Rb)}oWh(Rb){if(Rb.Ji.SelectedRange&&
this.Ji.SelectedRange){const Gb=this.Ji.SelectedRange.length,Cc=Rb.Ji.SelectedRange.length;for(let cb=0;cb<Gb;cb++)for(let pc=0;pc<Cc;pc++)if(ea(this.Ji.SelectedRange[cb],Rb.Ji.SelectedRange[pc])){this.pG[cb].bua(Rb.Vlb(pc));return}}}pWh(Rb){var Gb;let Cc=0,cb=0;if(this.Ji&&this.Ji.Object&&(null===(Gb=Rb.Ji)||void 0===Gb?0:Gb.Object)){Gb=this.Ji.Object.length;var pc=Rb.Ji.Object.length;for(var Ic=0;Ic<Gb;Ic++)if(this.Ji.Object[Ic]&&this.zOd(this.Ji.Object[Ic])){Cc++;for(var rd=0;rd<pc;rd++)if(Rb.Ji.Object[rd]&&
this.zOd(Rb.Ji.Object[rd])&&(cb++,this.Brd(this.Ji.Object[Ic],Rb.Ji.Object[rd]))){var Rd=this.Vlb(Cc),va=Rb.Vlb(cb);if(Rd&&va){Rd.bua(va);return}}}else if(this.Ji.Object[Ic]&&Rb.Ji.Object[Ic]&&(0===this.Ji.Object[Ic].ObjectType||2===this.Ji.Object[Ic].ObjectType))for(rd=0;rd<pc;rd++)if(Rb.Ji.Object[rd]&&(0===Rb.Ji.Object[Ic].ObjectType||2===Rb.Ji.Object[Ic].ObjectType)&&this.Ji.Object[Ic].ObjectId===Rb.Ji.Object[rd].ObjectId&&(Rd=this.QLd(this.Ji.Object[Ic].ObjectId),va=Rb.QLd(this.Ji.Object[Ic].ObjectId),
Rd&&va)){Rd.bua(va);return}}if(Rb.Ji.SelectedRange&&this.Ji.SelectedRange)for(Gb=this.Ji.SelectedRange.length,pc=Rb.Ji.SelectedRange.length,Ic=0;Ic<Gb;Ic++)for(rd=0;rd<pc;rd++)if(ea(this.Ji.SelectedRange[Ic],Rb.Ji.SelectedRange[rd])&&(Rd=this.Vlb(Cc+Ic),va=Rb.Vlb(cb+rd),Rd&&va)){Rd.bua(va);return}}Brd(Rb,Gb){return!!Rb&&!!Gb&&Gb.ObjectType===Rb.ObjectType&&(1===Rb.ObjectType||3===Rb.ObjectType)&&!Rb.ObjectId.localeCompare(Gb.ObjectId)}Vlb(Rb){return 0<=Rb&&this.pG.length>Rb?this.pG[Rb]:null}lWg(Rb){for(let Gb=
0,Cc=this.pG.length;Gb<Cc;Gb++)this.pG[Gb].iQ(Rb)}QLd(Rb){return Rb&&this.FR.lh(Rb)?this.FR.getItem(Rb):null}mWg(Rb,Gb){Gb=void 0===Gb?null:Gb;if(Rb)(Rb=this.FR.getItem(Gb))&&Rb.iQ(!0);else for(Rb=0;Rb<this.FR.count;Rb++)(Gb=this.FR.sn(Rb))&&Gb.iQ(!1)}K6g(Rb){ac.L9k(this,Rb)}Nzd(Rb,Gb){if(Rb<Gb)return this.pG[Rb];if(!this.Gp||!this.$||!this.VC)return null;Rb=new ub(this.Gp,this.$,this.VC,this.zoom);this.pG.push(Rb);return Rb}pEk(){const Rb=this.pG.length;var Gb=this.Ji.SelectedRange?this.Ji.SelectedRange.length:
0,Cc=this.$.sa.ma;for(let cb=0;cb<Gb;cb++){let pc=this.Nzd(cb,Rb);pc&&this.Ji.SelectedRange[cb]&&(this.Ji.SelectedRange[cb].NamedObjectName?pc.Mq([56,55]):(pc.s9b(this.Ji.SelectedRange[cb],this.Ji.PresenceType),lb.eAe(this.Ji.PresenceType,pc,this.Ji.SelectedRange[cb],Cc,this.Gp,this.VC)))}Cc=!!this.HJ&&!!this.HJ.oee&&this.HJ.oee.PresenceType!==this.HJ.Ji.PresenceType;for(Gb=Cc?0:Gb;Gb<Rb;Gb++)this.pG[Gb].Mq([1===this.HJ.oee.PresenceType?56:55])}zOd(Rb){return(null===Rb||void 0===Rb?0:Rb.ObjectId)&&
(1===this.lJf(Rb.ObjectType)||2===this.lJf(Rb.ObjectType))&&(Rb=this.$.$h.fNd(Rb.ObjectId))?fb.y(Rb):null}qEk(){const Rb=this.pG.length,Gb=this.$.sa.ma,Cc=this.Ji.SelectedRange?this.Ji.SelectedRange.length:0;var cb=this.Ji.Object?this.Ji.Object.length:0;for(var pc=0;pc<Rb;pc++)this.pG[pc].Mq([56,55]);this.sXh();this.Qyd=this.Pyd=pc=0;for(var Ic=0;Ic<cb;Ic++){var rd=this.Ji.Object[Ic],Rd=this.zOd(rd);if(Rd){let va=this.Nzd(pc,Rb);1===rd.ObjectType?this.Pyd++:3===rd.ObjectType&&this.Qyd++;pc++;va.s9b(Rd,
rd.ObjectPresenceType);lb.eAe(rd.ObjectPresenceType,va,Rd,Gb,this.Gp,this.VC)}}for(cb=0;cb<Cc;cb++)this.Ji&&this.Ji.SelectedRange&&(Ic=this.Ji.SelectedRange[cb],Ic.NamedObjectName||(rd=!!Gb&&Ic.SheetName===Gb.name,Rd=!!aa(Ic,this.$,1),rd&&Rd||(rd=this.Nzd(pc+cb,Rb),rd.s9b(Ic,this.Ji.PresenceType),lb.eAe(this.Ji.PresenceType,rd,Ic,Gb,this.Gp,this.VC))));0<(this.countFloatingObjects=this.XNg())&&n.ULS.sendTraceTag(537154370,0,50,'{{"SetAllFloatingObjectPresenceHighlights":"Success"}')}sXh(){this.XNg();
this.yqf()}XNg(){let Rb=0;if(this.Ji&&this.Ji.Object)for(let Gb=0;Gb<this.Ji.Object.length;Gb++)this.$7k(this.Ji.Object[Gb])&&Rb++;return Rb}m8h(Rb,Gb){if(this.FR.lh(Gb))return Gb=this.FR.getItem(Gb),Gb.vl=Rb,Gb;if(!this.Gp||!this.$||!this.VC)return null;const Cc=new bb(this.Gp,this.$,this.VC);Cc.vl=Rb;this.FR.add(Gb,Cc);return Cc}$7k(Rb){let Gb=!1;if(Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:8497049_HideHangingTooltipOnFloatingObjectSelection")?(null===Rb||void 0===Rb?0:Rb.ObjectId)&&-1!==Rb.ObjectType:
(null===Rb||void 0===Rb?0:Rb.ObjectId)&&(0===Rb.ObjectType||2===Rb.ObjectType||5===Rb.ObjectType))try{const Cc=this.fMi(Rb);if(Cc){const cb=this.m8h(Cc,Rb.ObjectId);cb.s9b(Cc,Rb.ObjectPresenceType);xc.b()&&5!==Rb.ObjectType&&cb.c9b();xc.b()&&0===Rb.ObjectType&&cb.iQ(!0);Gb=!0}}catch(Cc){throw n.ULS.sendTraceTag(537154369,0,10,`{"UpdatedFloatingObjectPresence":"Fail","Exception":"${Cc.stack}"}`),Cc;}return Gb}fMi(Rb){if(!Rb)return null;let Gb=null;-1!=Rb.ObjectType&&(Gb=oc.a(this.$).ZJa(Rb.ObjectId));
return Gb}ppe(){try{1===this.Ji.Version?(this.pEk(),n.ULS.sendTraceTag(537154368,0,50,'{{"SetGridHighlightPass":"V1"}')):(this.qEk(),n.ULS.sendTraceTag(537154339,0,50,`{"FloatingObjects":"${this.countFloatingObjects}","PivotTables":"${this.Pyd}","QueryTables":"${this.Qyd}"}`))}catch(Rb){throw n.ULS.sendTraceTag(537154338,0,10,`{"SetGridHighlight Exception":"${Rb.stack}"}`),Rb;}}lJf(Rb){switch(Rb){case 0:return 0;case 1:return 1;case 3:return 2;case 2:return 9;default:return-1}}static eAe(Rb,Gb,Cc,
cb,pc,Ic){const rd=1===Rb?56:55;cb&&Cc&&cb.name===Cc.SheetName?(Gb.tt(fb.H(Cc),[rd]),Gb.c9b(rd),n.ULS.shipAssertTag(537154337,0,Gb.TC.gI===pc.User.UserID,"UserID and UnitID should match"),Ic.b8b(Gb.TC.gI,1===Rb)):Gb.XTb([rd])}}Object(x.a)(lb,"UserGridPresence",ac,[]);var Ba=a(62),ra=a(45),wb=a(978);class mc{constructor(Rb,Gb){this.H_f=this.XYd=this.B1f=!1;this.cQd=this.qzc=this.$Sb=this.Xkb=0;this.T3f=!0;this.GO=Rb;this.$=Gb}u8k(){this.Xkb||(this.Xkb=Aa.a.Dj(),this.GMa())}x8k(){this.$Sb||(this.$Sb=
Aa.a.Dj(),this.GMa())}t8k(){this.qzc=Aa.a.Dj();this.V9f()}w8k(Rb){this.cQd=Aa.a.Dj();Rb&&(this.H_f=!0);this.V9f()}dispose(){this.GO=this.$=null}static bNi(){return mc.aQd}GMa(){this.Xkb&&this.$Sb?this.OE():window.setTimeout(()=>{this.OE()},mc.aQd)}V9f(){this.qzc&&this.cQd?this.OE(!0):window.setTimeout(()=>{this.OE(!0)},mc.aQd)}OE(Rb){Rb=void 0===Rb?!1:Rb;var Gb;if(Rb?!this.XYd:!this.B1f)if(this.$Sb||this.Xkb)if(null!==(Gb=this.$)&&void 0!==Gb&&Gb.ea){Gb=this.$.ea.Q_a(this.GO);var Cc=this.$.ea.Wt;
for(var cb of Cc)this.GO!==cb.User.UserID&&(null===Gb||void 0===Gb?void 0:Gb.UserEmail)===(null===cb||void 0===cb?void 0:cb.UserEmail)&&(this.T3f=!1);cb={};cb.UserSessionId=this.$.ua.UserSessionId;cb.ClientID=this.GO;cb.IsUniqueUser=this.T3f;cb.IsUserRemovalLog=Rb;cb.IsInactive=this.H_f;Rb||(cb.GridPresenceTime=this.$Sb,cb.GalleryPresenceTime=this.Xkb);cb.GridPresenceRemovalTime=this.cQd;cb.GalleryPresenceRemovalTime=this.qzc;n.ULS.sendTraceTag(508863559,0,50,`Grid Gallery presence telemetry: ${JSON.stringify(cb)}`);
Rb?this.XYd=!0:this.B1f=!0}else n.ULS.sendTraceTag(508838665,0,50,"Grid Gallery presence telemetry: EwaControl or SessionStateManager is null")}PNk(){return this.Xkb&&!this.qzc}}mc.aQd=12E4;Object(x.a)(mc,"GridGalleryPresenceTelemetry",null,[4]);var xb=a(92);class Ec{constructor(Rb){this.$Pd=null;this.$=Rb;this.S5={};this.XKb=new Set}dispose(){for(const Rb in this.S5)this.S5[Rb].dispose(),delete this.S5[Rb];this.S5=null;this.XKb.clear();this.$=this.XKb=null}b6g(){var Rb=this.$.ea.Wt;for(var Gb of Rb)Rb=
Gb.User.UserID,Rb===this.$.ea.clientId||this.XKb.has(Rb)||this.CNd(Rb).u8k();for(const Cc in this.S5)this.$.ea.Q_a(Cc)||(Gb=this.CNd(Cc),Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:7941503_LogRemovalPostPresence")&&Gb.PNk()&&(Gb.t8k(),this.PLg()))}d6g(Rb,Gb,Cc){Gb=void 0===Gb?!1:Gb;Cc=void 0===Cc?!1:Cc;Rb===this.$.ea.clientId||this.XKb.has(Rb)||(Rb=this.CNd(Rb),Gb?(Rb.w8k(Cc),this.PLg()):Rb.x8k())}CNd(Rb){if(!this.S5[Rb]){const Gb=new mc(Rb,this.$);this.S5[Rb]=Gb}return this.S5[Rb]}f1i(){for(const Rb in this.S5)this.S5[Rb].XYd&&
(this.S5[Rb].dispose(),delete this.S5[Rb],this.XKb.add(Rb)),this.$Pd=null}PLg(){this.$Pd||xb.a.isEmpty(this.S5)||(this.$Pd=y.Task.delay(mc.bNi()).continueWith(()=>{this.f1i()}))}}Object(x.a)(Ec,"GridGalleryPresenceTelemetryHelper",null,[4]);var ed;let jd=ed=class extends D.a{constructor(Rb,Gb,Cc,cb,pc){super();this.Ex={};this.tqa=new Map;this.Psc=this.Qsc=0;this.B1d=this.BAd=this.YHa=null;this.Z8f=3E4;this.YQd=!1;this.Are=!0;this.Mde=this.DSc=null;this.vie=this.xse=this.bTg=this.x$e=!1;this.Jjg=()=>
{var Ic=this.u7;for(const rd in Ic)Ic=rd,this.T2e(Ic)?(this.ZLc(Ic,!0),vb.a.PXb(this.$)||(delete this.A5a[Ic],delete this.u7[Ic])):(Ic=this.bTg?`PresenceView.OnEcsUserListChanged: Pending User Still Not Updated {"User":${Ic}, "Active Status":${this.yv(Ic)}}`:`PresenceView.OnEcsUserListChanged: pending userId=[${Ic}] still not updated`,n.ULS.sendTraceTag(537154377,0,50,Ic));this.B8b&&this.Y_a.b6g()};this.zae=(Ic,rd)=>{Ic={};Ic.UpdatedCount=rd.b_?Object.keys(rd.b_).length:0;Ic.DisconnectedCount=rd.Nma?
rd.Nma.length:0;Ic.Location="canvas";oa.b(this.$).Aj(Ea.a.Ude,Ic);Ic=null;this.$.Eh&&(Ic=this.$.Eh.em("ModelUpdate","PresenceRendering"),Ic.start());var Rd={};if(rd.b_){if(Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")){const hd=(new Date).getTime();$a.TaskExtensions.Xa(Object(Jb.d)(W.a.resolve(J.Te,{va:1}),J.Fe.Aa()?"PresenceView.onSelectionPresenceChanged":null),qd=>{qd.result.jBj(hd)},this.$.ya,3)}this.$Pb||(this.i3d(!0),this.$Pb=!0);const Nc=rd.b_;for(var va in Nc){var Bb=
Nc[va];const hd=va;this.jTd[hd]=sa.a.ih.ri;if(!Kb.c(this.$)||null==Bb.NavigationState)if(this.Tgf(hd,new Date),this.WFh(Bb),hd!==this.YHa){var Ac=this.Ex[hd];Ac||(this.T2e(hd)?this.ZLc(hd,!0):(hd in this.u7?n.ULS.sendTraceTag(537154376,0,50,`PresenceView.OnSelectionPresenceChanged: userId=[${hd}] already pending update`):(this.A5a[hd]=sa.a.ih.ri,Rd[hd]=1),this.u7[hd]=!0,Ac=this.zSi(hd),this.Ex[hd]=this.Kmf(Ac)),Ac=this.Ex[hd],this.B8b&&this.Y_a.d6g(hd));Ac&&(vb.a.PXb(this.$)&&this.Ppe(Ac),Ac.Ji=Bb,
Bb.SelectedRange&&1<Bb.SelectedRange.length?this.Qsc++:this.Psc++,this.EEg(hd),this.chb(Ac))}}if(Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")&&this.$.ea&&this.$.ea.l0a){const hd=(new Date).getTime();$a.TaskExtensions.Xa(Object(Jb.d)(W.a.resolve(J.Te,{va:1}),J.Fe.Aa()?"PresenceView.onSelectionPresenceChanged":null),qd=>{qd.result.kBj(hd)},this.$.ya,3)}}if(rd.Nma)for(let Nc=0,hd=rd.Nma.length;Nc<hd;Nc++)va=rd.Nma[Nc],this.lCd[va]=sa.a.ih.ri,this.qEg(va,!0);if(rd.Nma&&
0<rd.Nma.length||0<wb.a(Rd).length||0<wb.a(this.u7).length)va=[],va.push(...wb.a(Rd)),va.push(...wb.a(this.u7)),(Rd=this.$.la.kh(292))&&Rd.Nzb(va,rd.Nma);Ic&&Ic.stop();this.YQd=!1;Ic=this.Ex;for(const Nc in Ic)if(0===Object(wa.a)(ac,Ic[Nc]).Ji.CollabMode){this.YQd=!0;break}this.raiseEvent("pcek",rd)};this.JRa=(Ic,rd)=>{rd&&this.$.ix&&(rd.CIb.HasAnyNonOcsCoauthor=this.YQd)};this.A1b=()=>{this.vNg()};this.P1=()=>{n.ULS.sendTraceTag(508389009,0,50,"PresenceView.onSheetRenamed: Presence refreshed upon sheet rename");
this.vNg()};this.Jj=()=>{this.CDc()};this.pCj=()=>{this.B1d&&na.a(sa.a.ih,this.B1d)<this.Z8f||(this.B1d=sa.a.ih.ri,this.M2d(),this.Wyj(),this.Gzj(),this.$Pb||this.i3d(!1))};this.MNa=()=>{this.CDc();const Ic=this.Ex;for(const rd in Ic)this.chb(Ic[rd])};this.ej=()=>{this.M2d();this.$Pb||this.i3d(!1);this.$Pb=!1};this.Jog=()=>{const Ic=this.Ex;for(const rd in Ic)Ic[rd].dispose();this.Ex={};this.tqa=new Map;this.uff();this.A5a={};this.Khd={};this.yH.length=0;this.j_c()};this.Y0b=(Ic,rd)=>{this.Hue(rd.vm)};
this.lCd={};this.jTd={};this.A5a={};this.Khd={};this.$=Rb;this.zoom=pc;this.g4a=cb;this.XD=Gb;this.GXe=Cc;bd.a.I8b=!0;bd.a.RBa=!0;this.bTg=Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:8430878_shouldLogActiveStatusForPendingUser");this.vie=Ua.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.RemoveOnSheetChangedEventForPresence",!1);this.Tmb();this.VC=new Hc.a(Rb);this.$.sa&&(this.vie||this.$.sa.pn(this.MNa),this.$.sa.gua(this.P1));this.XD.Yod(this.Y0b);Rb.pa&&this.$.pa.qIb(this.JRa);this.yH=
[];this.XD.UKb();J.Ue.Aa()||Rb.la.Hh(25,this);this.$Pb=!1;this.$.gq(this.ej);this.$rd=Ka.a.instance.LO(this.pCj,this.Z8f/2,nb.a.Q9j,!0,!1);this.Kaj();this.LLh=Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:7736608_AvoidLoggingForInactiveUser");this.B8b=Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:7958832_LogGridGalleryPresenceTelemetryNew");this.x$e=Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:8398612_avoidShiftingTooltipAtFreezePaneEnd");this.xse=Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:8593246_shouldStoreCurrentUserEmailInPresenceView");
this.B8b&&(this.Y_a=this.C6h(),this.Y_a.b6g())}BVa(Rb){this.addHandler("pcek",Rb)}$Oa(Rb){this.removeHandler("pcek",Rb)}get hW(){return this.GXe}get Sja(){return this.Ex}isAnonymousUser(Rb){var Gb,Cc;return null===(Cc=null===(Gb=this.Sja[Rb])||void 0===Gb?void 0:Gb.Ji)||void 0===Cc?void 0:Cc.IsAnonymous}GEg(Rb){this.Sja[Rb]&&this.qEg(Rb,!1)}Hue(Rb){this.YHa&&this.YHa!==Rb.clientId&&(this.Are=!1);!Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:5657706_CorrectPresenceBootTelemetry")||this.$.ea.l0a&&
ra.a.instance.DBk||(this.Are=!1);this.hW.K0h(Rb);this.YHa=Rb.clientId}qOi(Rb,Gb){const Cc=[],cb=[],pc=this.Sja;for(const Ic in pc){const rd=pc[Ic];if(Gb){const Rd=fb.l(Rb,this.$);this.rNf(Rd,Cc,cb,rd)}else this.qNf(Rb,Cc,cb,rd)}return{dfj:Cc,iji:cb}}kpf(Rb,Gb,Cc,cb,pc){(pc=this.Sja[pc])&&(Gb?this.rNf(Rb,Cc,cb,pc):this.qNf(Rb,Cc,cb,pc))}L_i(){const Rb=[],Gb=this.Sja;for(const pc in Gb){var Cc=Gb[pc],cb=Cc.Ji.SelectedRange;if(cb)for(const Ic of cb){cb=fb.H(Ic);const rd=Ja.f(this.$).ha.qa.saa;if(this.$.sa.ma.sheetName===
Ic.SheetName&&cb.right===rd.right&&cb.top===rd.top){Cc=Cc.Gp;Cc=new E.a(Cc.User.UserID,Cc.User.UserName,Cc.UserColor,new ua.a(1),null,Cc.UserEmail,void 0,void 0,void 0,void 0,Cc.IsReadOnly,Cc.JoinCoauthTime);Rb.push(Cc);break}}}return Rb}W8b(){bd.a.I8b=!0;bd.a.RBa=!0;const Rb=this.Ex;for(const Gb in Rb)Rb[Gb].W8b()}VTb(){bd.a.I8b=!1;bd.a.RBa=!1;const Rb=this.Ex;for(const Gb in Rb)Rb[Gb].VTb()}dispose(){this.zac();this.$&&(this.$.sa&&(this.vie||this.$.sa.Gn(this.MNa),this.$.sa.VAa(this.P1)),this.$.pa&&
this.$.pa.u5b(this.JRa),this.$.Yu(this.ej));this.XD&&this.XD.YEg(this.Y0b);this.$rd&&(this.$rd.dispose(),this.$rd=null);if(this.Ex){const Rb=this.Ex;for(const Gb in Rb)Rb[Gb].dispose()}this.B8b&&this.Y_a&&(this.Y_a.dispose(),this.Y_a=null);Va.a.gj([this.hW,this.VC]);this.uff();this.tqa=this.Ex=this.$=this.GXe=null;this.yH.length=0;super.dispose()}get u7(){return this.Khd}C6h(){return new Ec(this.$)}zac(){this.hW&&(this.hW.$Oa(this.zae),this.hW.pmk(this.Jjg),this.hW.Xnk(this.Jog),this.hW.vx(this.Jj));
this.g4a.AFg(this.A1b)}Kmf(Rb){return new lb(Rb,this.$,this.VC,this.zoom)}T2e(Rb){const Gb=this.$.ea.Q_a(Rb);if(Gb)if(Rb in this.Ex)vb.a.PXb(this.$)&&(delete this.A5a[Rb],delete this.u7[Rb],this.Ex[Rb].vqe(Gb),this.Ppe(this.Ex[Rb])),this.Ex[Rb].K6g(Gb);else{const Cc=this.Kmf(Gb);this.Ex[Rb]=Cc;this.chb(Cc)}return!!Gb}rNf(Rb,Gb,Cc,cb){if(Rb)for(const pc of Rb){if(pc){if((Rb=aa(pc,this.$,1))&&ed.uPd(Rb.Wq,Gb,Cc,cb))break;if((Rb=aa(pc,this.$,2))&&ed.uPd(Rb.Wq,Gb,Cc,cb))break}if(cb.Ji.SelectedRange)for(const Ic of cb.Ji.SelectedRange)if(Ic&&
pc&&ea(pc,Ic)){(1===cb.Ji.PresenceType?Cc:Gb).push(cb.HJ.rbc.User);return}}}qNf(Rb,Gb,Cc,cb){Rb&&ed.uPd(this.kMi(Rb),Gb,Cc,cb)}Kaj(){this.DSc=la.a.gw(Ca.a.instance.fj("Common.App.CoauthTelemetry.IPresenceBootTelemetry"))}vNg(){const Rb=new ia.a({},null),Gb=this.Sja;for(const Cc in Gb){const cb=Cc,pc=Gb[Cc].Ji;pc.SelectedRange=pc.SelectedRangeRaw;Rb.b_[cb]=pc}this.zae(this,Rb)}WFh(Rb){Rb.SelectedRange&&(Rb.SelectedRangeRaw=this.Tbi(Rb.SelectedRange),Rb.SelectedRange=this.g4a.F2h(Rb.SelectedRange))}Tbi(Rb){const Gb=
Array(Rb.length);for(let pc=0;pc<Rb.length;pc++){var Cc=pc,cb=Rb[pc];const Ic={};Ic.SheetName=cb.SheetName;Ic.FirstColumn=cb.FirstColumn;Ic.FirstRow=cb.FirstRow;Ic.LastRow=cb.LastRow;Ic.LastColumn=cb.LastColumn;Ic.NamedObjectName=cb.NamedObjectName;Gb[Cc]=Ic}return Gb}kMi(Rb){if(Rb)switch(Rb.type){case 0:return(Rb=this.$.$h.KQi(Rb.id))?Rb.Wq:null;case 2:return Rb.Wq}return null}Tmb(){this.hW.BVa(this.zae);this.hW.bEh(this.Jog);this.hW.bCh(this.Jjg);this.hW.Zw(this.Jj);this.g4a.y4e(this.A1b)}y9f(Rb,
Gb,Cc,cb){const pc={};pc.a=this.$.ua.UserSessionId;pc.b=Rb;pc.c=Cc?"PendingUserRemoved":"Non-PendingUserRemoved";pc.d=cb?"Disconnected":"Inactivity";pc.e=Gb;Ba.b().Ll(22,pc,!0)}qEg(Rb,Gb){if(Rb in this.Ex){this.EEg(Rb);const Cc=this.Ex[Rb];vb.a.PXb(this.$)&&this.clk(Cc);Cc.dispose();delete this.Ex[Rb];n.ULS.sendTraceTag(537154375,0,50,`PresenceView.RemovePresenceForUser: userId=[${Rb}] removed due to inactivity`);this.y9f(Rb,sa.a.ih.ri,!1,Gb)}Rb in this.u7&&(this.ZLc(Rb,!1),delete this.A5a[Rb],delete this.u7[Rb],
n.ULS.sendTraceTag(537154374,0,50,`PresenceView.RemovePresenceForUser: Pending userId=[${Rb}] removed due to inactivity`),this.y9f(Rb,sa.a.ih.ri,!0,Gb));this.B8b&&this.Y_a.d6g(Rb,!0,!Gb)}EEg(Rb){for(let Gb=this.yH.length-1;0<=Gb;Gb--)if(this.yH[Gb].User.UserID===Rb){this.yH.splice(Gb,1);for(const Cc of this.Ex[Rb].pG)this.VC.FBa(Cc.TC.gI,!1);this.j_c()}}Gzj(){if(this.Psc||this.Qsc)this.$.si(-70383382,-1,0,null),n.ULS.sendTraceTag(537154373,0,50,`PresenceView.LogDiscontinuousCountPresenceData: Discontinuous Presence Received with count= [${this.Qsc}], Continuous Presence Received with count= [${this.Psc}]`);
this.Qsc=this.Psc=0}uff(){this.M2d();this.Khd=this.A5a=null}M2d(){const Rb=this.u7;for(const Gb in Rb)this.ZLc(Gb,!1)}Wyj(){var Rb=this.lCd;for(const Gb in Rb)this.f9f(Gb,!0,Rb[Gb]);Rb=this.jTd;for(const Gb in Rb)this.f9f(Gb,!1,Rb[Gb]);this.lCd={};this.jTd={}}yv(Rb){var Gb;return 1===(null===(Gb=this.U0(Rb))||void 0===Gb?void 0:Gb.status)}U0(Rb){var Gb;return(null===(Gb=this.XD)||void 0===Gb?0:Gb.vm)?this.XD.vm.U0(Rb):null}uIf(Rb){var Gb,Cc;return null===(Cc=null===(Gb=this.U0(Rb))||void 0===Gb?void 0:
Gb.e3a)||void 0===Cc?void 0:Cc.getTime()}Sya(Rb){var Gb,Cc,cb,pc,Ic;const rd=null===(Cc=null===(Gb=this.Ex[Rb])||void 0===Gb?void 0:Gb.Gp)||void 0===Cc?void 0:Cc.UserEmail;Gb=F.AFrameworkApplication.fa.Ya("UserPrincipalName");this.xse?(this.BAd||(this.BAd=null!==(pc=null===(cb=this.$.ea.Q_a(this.YHa))||void 0===cb?void 0:cb.UserEmail)&&void 0!==pc?pc:Gb),cb=this.BAd):cb=null===(Ic=this.$.ea.Q_a(this.YHa))||void 0===Ic?void 0:Ic.UserEmail;Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:8505063_shouldCompareUserEmailSources")&&
n.ULS.sendTraceTag(507844560,0,50,`PresenceView.isRepresentativeUserInstance: ${JSON.stringify({currentUserEmailUnavailable:!cb,areEqual:(null===cb||void 0===cb?void 0:cb.toLowerCase())===(null===Gb||void 0===Gb?void 0:Gb.toLowerCase())})}`);if(!rd||Rb in this.u7)return!0;Ic=this.xse?rd.toLowerCase()!==(null===cb||void 0===cb?void 0:cb.toLowerCase())&&this.tqa.get(rd)===Rb:rd!==cb&&this.tqa.get(rd)===Rb;n.ULS.sendTraceTag(508376470,0,50,`PresenceView.isRepresentativeUserInstance: currentUserId=[${this.YHa}], userId=[${Rb}], isRepresentativeUserInstance=[${Ic}]`);
return Ic}Ppe(Rb){var Gb,Cc;const cb=null===(Gb=Rb.Gp)||void 0===Gb?void 0:Gb.UserEmail;Rb=null===(Cc=Rb.Gp)||void 0===Cc?void 0:Cc.User.UserID;cb&&!(Rb in this.u7)&&(Cc=this.tqa.get(cb),!Cc||this.uIf(Rb)>this.uIf(Cc))&&(this.tqa.set(cb,Rb),Cc&&this.Ex[Cc].VTb())}clk(Rb){var Gb,Cc;const cb=null===(Gb=Rb.Gp)||void 0===Gb?void 0:Gb.UserEmail;Rb=null===(Cc=Rb.Gp)||void 0===Cc?void 0:Cc.User.UserID;if(cb&&!(Rb in this.u7)&&this.tqa.get(cb)===Rb){this.tqa.delete(cb);for(const pc in this.Ex)Cc=this.Ex[pc],
pc!==Rb&&Cc.Gp.UserEmail===cb&&this.Ppe(Cc);this.aRk(cb)}}aRk(Rb){this.tqa.has(Rb)&&this.Ex[this.tqa.get(Rb)].W8b()}ZLc(Rb,Gb){var Cc=this.LLh?this.yv(Rb):!0;if(this.$.ix&&this.$.ea.ki&&Cc){Cc={};Cc.a=this.$.ua.UserSessionId;Cc.b=Rb;Cc.c=Gb;Cc.e=!1;Cc.d=-1;Cc.f=sa.a.ih.ri;this.$.ea&&(Cc.e=this.$.ea.IU);if(Rb=this.A5a[Rb])Cc.d=na.a(sa.a.ih,Rb);Ba.b().Ll(20,Cc,!0)}}i3d(Rb){if(this.$.ix){const Gb={e:-1,f:-1,c:!1,d:!1};Gb.b=Rb;Gb.a=this.$.ua.UserSessionId;this.$.ea&&(Gb.c=this.$.ea.l0a,Gb.d=this.$.ea.IU,
Gb.e=this.$.ea.Wt.length,this.$.ea.D$g&&(Gb.f=na.a(sa.a.ih,this.$.ea.lfl)));Ba.b().Ll(21,Gb,!0)}}f9f(Rb,Gb,Cc){if(this.$.ix){const cb={};cb.a=this.$.ua.UserSessionId;cb.b=Rb;cb.c=Gb;cb.d=Cc;Ba.b().Ll(19,cb,!0)}}CDc(){const Rb=[],Gb=this.Ex;for(const Cc in Gb){const cb=Gb[Cc];if(this.hW.VMg(cb.Ji)){this.C3e(Rb,cb);Array.remove(this.yH,cb.HJ.rbc);if(1===this.hW.Ji.PresenceType){const pc={};pc.a=1===cb.Ji.PresenceType?"Editing":"Non-Editing";pc.b=this.$.ua.UserSessionId;pc.c=sa.a.ih.ri;Ba.b().Ll(18,
pc)}for(const pc of cb.pG)this.VC.FBa(pc.TC.gI,!0)}else for(const pc of cb.pG)this.VC.FBa(pc.TC.gI,!1)}this.yH.length=0;this.yH=Rb;this.j_c()}C3e(Rb,Gb){const Cc=Gb.HJ.rbc;if(0===Gb.Ji.PresenceType){Gb=Rb.length;let cb;for(cb=0;cb<Gb&&0===this.Ex[Rb[cb].User.UserID].Ji.PresenceType;cb++);Rb.splice(cb,0,Cc)}else Rb.push(Cc)}chb(Rb){this.hW.VMg(Rb.Ji)&&(this.C3e(this.yH,Rb),this.j_c());const Gb=Rb.HJ.rbc.User.UserID,Cc=this.Ex;for(const pc in Cc){var cb=Cc[pc];pc!==Gb&&Rb.chb(cb)}}j_c(){0<this.yH.length&&
this.CRk()}CRk(){for(let Cc=0,cb=this.yH.length;Cc<cb;Cc++){var Rb=this.Ex[this.yH[Cc].User.UserID];if(Rb)if(this.hW.oAg(Rb.Ji)){Rb.lWg(!0);var Gb=Ja.f(this.$).fh;for(const pc of Rb.pG)Rb=pc.TC.range,this.VC.FBa(pc.TC.gI,this.x$e?!this.Isj(Gb,Rb):!0)}else(Gb=this.hW.fIf(Rb.Ji))&&Rb.mWg(!0,Gb)}}zSi(Rb){const Gb={User:{}};Gb.User.UserID=Rb;Gb.User.UserName=ab.a.instance.sh(87);Gb.UserColor="#AAAAAA";return Gb}Tgf(Rb,Gb){this.Are&&this.DSc&&(Rb&&Gb?this.Mde?this.Mde.kli(Rb,Gb,this.YHa):this.DSc.continueWith(()=>
{this.Mde=this.DSc.result;this.Tgf(Rb,Gb)}):n.ULS.sendTraceTag(537154372,0,15,`userId: [${Rb}], endTime: [${Gb}]`))}static uPd(Rb,Gb,Cc,cb){if(!cb||!cb.Ji||!cb.Ji.Object)return!1;for(const pc of cb.Ji.Object)if(Rb&&pc&&pc.ObjectId&&!pc.ObjectId.localeCompare(Rb))return(1===pc.ObjectPresenceType?Cc:Gb).push(cb.HJ.rbc.User),!0;return!1}Isj(Rb,Gb){return Rb&&Gb.left&&Gb.right?Rb.Ym-1===Gb.right:!1}};jd=ed=Object(U.__decorate)([Object(W.d)(J.Ue),Object(U.__param)(0,Object(J.Nb)()),Object(U.__param)(1,
Object(J.jf)()),Object(U.__param)(2,Object(J.Bf)()),Object(U.__param)(3,Object(J.Yd)()),Object(U.__param)(4,Object(J.ah)())],jd);Object(x.a)(jd,"PresenceView",D.a,[437,438]);var Xd=a(756),Td=a(1512);class gc extends Sys.EventArgs{constructor(Rb){super();this.vm=Rb}}Object(x.a)(gc,"ConnectionCompletedEventArgs",Sys.EventArgs,[]);var nc=a(60),dc=a(1371);class Gc extends D.a{constructor(){super();this.Bme="RealtimeChannelRefreshed";this.eT=new L.a}TV(Rb){const Gb=this.eT.task.isCompleted;this.eT.setResult(Rb);
Gb&&this.ldk()}kIb(Rb){this.addHandler(this.Bme,Rb)}n5b(Rb){this.removeHandler(this.Bme,Rb)}ldk(){this.raiseEvent(this.Bme)}}Object(x.a)(Gc,"RtcTaskProvider",D.a,[461]);let vd=class extends D.a{constructor(Rb){super();this.Qic=this.HG=this.eT=this.gsc=null;this.EOe=!1;this.cYc=null;this.Ise=this.E8b=!1;this.K1=(Gb,Cc)=>{if(2===Cc.newState){if(this.vm){if(Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")){const cb=(new Date).getTime();Ua.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.UsePromisesInsteadOfTasks",
!1)?void W.a.resolve(J.Te,{va:1}).then(pc=>pc.J9f(cb)):$a.TaskExtensions.Xa(Object(Jb.d)(W.a.resolve(J.Te,{va:1}),J.Fe.Aa()?"RealTimeChannelController.onConnectionStateChanged":null),pc=>{pc.result.J9f(cb)},this.$.ya,3)}this.raiseEvent("connectionCompleted",new gc(this.vm),Cc)}else n.ULS.sendTraceTag(537167630,0,15,"RealTimeChannelController.OnConnectionStateChanged: new state is connected and this.RealTimeChannel is null");this.gsc=Cc}else if(2===Cc.oldState||0===Cc.newState)this.gsc=null,this.raiseEvent("connectionLostEventKey")};
this.SNa=()=>{if(this.vm){const Gb=Object(wa.a)(433,this.vm);Gb&&(n.ULS.sendTraceTag(537167629,0,50,"RealTimeChannelController.OnWorkbookClosed: disconnecting from RTC for clientID {0}",this.$.workbookContext.ClientId),Gb.disconnect(),Gb.R6a(this.K1),this.Ise&&Gb.dispose())}this.eT=this.HG=this.Qic=null};this.$=Rb;this.$.gq(this.SNa);this.$.ea.Upd(this.SNa);this.E8b=Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:7654759_PassSessionExpirationManagerToRTC");this.Ise=Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:8332501_UseStaticRtcEventHubAndDetachEventHandlerOnDispose_Latest");
this.E8b&&(this.cYc=Xd.a.create());J.a.Aa()?void W.a.sj(J.a).then(Gb=>{this.E8b&&(this.cYc.instance=Gb);Gb.Epd(this.SNa)}):Rb.la.fi(38,Gb=>{this.E8b&&(this.cYc.instance=Gb);Gb.Epd(this.SNa)})}Yod(Rb){this.addHandler("connectionCompleted",Rb)}YEg(Rb){this.removeHandler("connectionCompleted",Rb)}hEh(Rb){this.addHandler("rtcInitialized",Rb)}IFg(Rb){this.removeHandler("rtcInitialized",Rb)}MBh(Rb){this.addHandler("connectionLostEventKey",Rb)}bmk(Rb){this.removeHandler("connectionLostEventKey",Rb)}get vm(){return this.Qic}get yVd(){return this.EOe}get oKg(){return this.HG?
this.HG.eT.task:this.kOd().task}dispose(){this.vm&&this.vm.R6a(this.K1);this.$&&this.$.Yu(this.SNa);this.eT=this.HG=this.Qic=this.$=null;super.dispose()}dmf(Rb){this.XCg();$a.TaskExtensions.Xa(this.HG?this.oKg:this.kOd().task,Gb=>{Rb(Gb.result)},this.ya)}G0h(Rb,Gb){this.EOe=Gb;this.oWj(Rb)}UKb(){this.vm&&(this.raiseEvent("rtcInitialized"),2===this.vm.connectionState&&this.gsc&&this.raiseEvent("connectionCompleted",new gc(this.vm),this.gsc))}iyj(){n.ULS.sendTraceTag(537167633,0,50,"RealTimeChannelController.OnLoadRealTimeChannelSlice");
const Rb=(new Date).getTime();Ua.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.UsePromisesInsteadOfTasks",!1)?void W.a.resolve(J.Te,{va:1}).then(cb=>cb.M9f(Rb)):$a.TaskExtensions.Xa(Object(Jb.d)(W.a.resolve(J.Te,{va:1}),J.Fe.Aa()?"RealTimeChannelController.loadRtcSliceWithDependenciesTask":null),cb=>{cb.result.M9f(Rb)},this.$.ya,3);var Gb=[];Gb.push(nc.a.current.Pu(67));Gb.push(nc.a.current.Pu(68));Gb=nc.a.Fqb(Gb,this.$.ya);const Cc=nc.a.loadScript(9,0,1);return y.Task.yQ(Gb,Cc)}oWj(Rb){const Gb=
this.iyj();$a.TaskExtensions.Xa(Gb,()=>{n.ULS.sendTraceTag(537167632,0,50,`RealTimeChannelController.OnLoadRealTimeChannelSlice Before RealtimeChannel create. RealtimeChannel = null: ${void 0===Td.RealtimeChannel||null===Td.RealtimeChannel}`);if(Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")){const cb=(new Date).getTime();$a.TaskExtensions.Xa(Object(Jb.d)(W.a.resolve(J.Te,{va:1}),J.Fe.Aa()?"RealTimeChannelController.onLoadRealTimeChannelSlice":null),pc=>{pc.result.GBj(cb)},
this.$.ya,3)}this.Qic=Td.RealtimeChannel.createInstance(Rb,this.$.ua.UserSessionId,F.AFrameworkApplication.pKg,F.AFrameworkApplication.rj,this.E8b?this.cYc:null,2,Ba.b().INf(),this.$.workbookContext.RtcEndpointUrl,void 0,this.Ise?dc.a.getInstance():new dc.a,void 0,void 0,this.$.workbookContext.RtcBootToken);n.ULS.sendTraceTag(571770432,0,50,"RealTimeChannelController.OnLoadRealTimeChannelSlice RealtimeChannel created with clientID {0}",Rb);Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:8030692_IsEditorsTableNotificationEnabled")&&
(Ca.a.instance.register(Td.RealtimeChannel,"AppRealtimeChannel.RealtimeChannel").as("Common.IRealtimeChannelBasic").as("AppRealtimeChannel.IRealtimeChannel").yi().Ei(()=>this.vm),Ca.a.instance.resolve("Common.IRealtimeChannelBasic"));this.XCg();this.HG&&this.HG.TV(this.vm);this.eT&&this.kOd().setResult(this.vm);if(Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")){const cb=(new Date).getTime();Ua.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.UsePromisesInsteadOfTasks",
!1)?void W.a.resolve(J.Te,{va:1}).then(pc=>pc.L9f(this.yVd,cb)):$a.TaskExtensions.Xa(Object(Jb.d)(W.a.resolve(J.Te,{va:1}),J.Fe.Aa()?"RealTimeChannelController.onLoadRealTimeChannelSlice":null),pc=>{pc.result.L9f(this.yVd,cb)},this.$.ya,3)}this.raiseEvent("rtcInitialized");n.ULS.sendTraceTag(571770403,0,50,"RealTimeChannelController.OnLoadRealTimeChannelSlice raise RealTimeChannelInitializedEventKey");const Cc=Object(wa.a)(433,this.vm);Cc&&(n.ULS.sendTraceTag(571770402,0,50,"RealTimeChannelController.OnLoadRealTimeChannelSlice attach changed handler"),
Cc.mGa(this.K1),Cc.connect())},this.ya,3)}kOd(){return this.eT||(this.eT=new L.a)}XCg(){Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:8080948_UseRtcTaskProvider")&&!this.HG&&(this.HG=new Gc,Ca.a.instance.register(Gc,"AppRealtimeChannel.RtcTaskProvider").as("Common.Interface.IRtcBasicProvider").yi().Ei(()=>this.HG),Ca.a.instance.resolve("Common.Interface.IRtcBasicProvider"))}};vd=Object(U.__decorate)([Object(W.d)(J.jf),Object(U.__param)(0,Object(J.Nb)())],vd);Object(x.a)(vd,"RealTimeChannelController",
D.a,[434,435]);var zd=a(1297),Yb=a(255),Pb=a(243),$c=a(25);class wd extends D.a{constructor(Rb){super();this.statusBarManager=null;this.$=Rb;this.$.la.fi(29,Gb=>{this.statusBarManager=Gb;Gb.hO(this)})}oy(Rb){this.addHandler("OSC",Rb)}cy(Rb){this.removeHandler("OSC",Rb)}$v(){this.raiseEvent("OSC")}Ay(Rb,Gb){if("QueryOcsConnectionStatus"===Rb)Rb=this.$.ea.Epb?ab.a.instance.ia(924):ab.a.instance.ia(925),$c.a.Mo(this.$)?(Gb.LabelText=Rb,Gb.Visible=!0):Gb.Value=Rb;else return!1;return!0}rr(){return!0}dispose(){this.statusBarManager&&
(this.statusBarManager.tN(this),this.statusBarManager=null);this.$=null;super.dispose()}}Object(x.a)(wd,"OcsStatusBarManager",D.a,[4,155,156]);var Bd;let tc=Bd=class extends D.a{constructor(Rb,Gb){super();this.o0g=this.p0g=this.vm=null;this.QHb=this.rAe=this.VRc=this.U8f=!1;this.aw=()=>{this.$&&this.goe(0,!1)};this.Cn=()=>{this.p0g(!1)};this.Rl=()=>{this.o0g(!1)};this.hPc=()=>{this.ha.$e.Lh?this.goe(1,!1):this.noe(0,!1)};this.eAa=(Cc,cb)=>{this.raiseEvent(Bd.Nde,cb)};this.Jj=()=>{this.noe(Ja.f(this.$).isEditing?
1:0,!1)};this.ij=(Cc,cb)=>{Yb.a(cb)&&(this.nFa={})};this.A1b=()=>{this.eoe()};this.zsg=(Cc,cb)=>{if(cb&&cb.methodName in Bd.ZRc){Cc=!1;switch(Bd.ZRc[cb.methodName]){case 0:cb=cb.parameters.cell;break;case 1:cb=cb.parameters.parameters.Location;break;case 2:cb=fb.x(this.ha.qa.activeRange,this.$);Cc=!0;break;default:return}cb.LastColumn=cb.FirstColumn;cb.LastRow=cb.FirstRow;cb.NamedObjectName=null;this.Ji.SelectedRange=[cb];this.Ji.PresenceType=0;if(Cc){cb=[];for(var pc of this.$.$h.MQi())Cc={},Cc.ObjectType=
this.qKa(pc.type),Cc.ObjectPresenceType=1,Cc.ObjectId=pc.Wq,cb.push(Cc);this.Ji.Object=cb}else pc=aa(cb,this.$,1),cb=null,pc&&(cb={},cb.ObjectType=this.qKa(pc.type),cb.ObjectPresenceType=0,cb.ObjectId=pc.Wq),this.Ji.Object=[cb];this.raiseEvent(Bd.Hqa);this.sendPresenceToService(!1)}};this.Wy=(Cc,cb)=>{cb.context.methodName in Bd.ZRc&&(this.Ji.Object=[null],this.zwb(!1))};this.xp=(Cc,cb)=>{cb.context.methodName in Bd.ZRc&&(this.Ji.Object=[null],this.zwb(!1))};this.Cj=(Cc,cb)=>{cb.q1||(this.nFa={},
this.$.ix?this.Tmb():this.zac())};this.ej=()=>{this.VRc&&this.Q8f();this.$Mg()};this.a4f=()=>{this.eoe();this.fgg.$v()};this.P1=()=>{n.ULS.sendTraceTag(508389008,0,50,"SelectionPresenceManager.onSheetRenamed: Presence sent upon sheet rename");this.eoe()};this.$=Rb;this.ha=Ja.f(this.$).ha;this.g4a=Gb;this.$.mr(this.Cj);this.$.gq(this.ej);this.nFa={};this.Ocb=new E.a(null,null,null,null);this.HPa={};this.HPa.b=0;this.HPa.c=0;this.fgg=new wd(this.$);this.NAf=600;this.mJa={};this.rAe=Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:8320375_sendUpdatedSelectionInEditingNotification");
this.p0g=Pb.b(Cc=>{this.rAe?this.zwb(!1):(this.Ji.PresenceType=1,this.raiseEvent(Bd.Hqa),this.sendPresenceToService(Cc))},40,this.$.ya,"SelectionPresenceManager.SendPresenceToService",!0);this.o0g=Pb.b(Cc=>{this.zwb(Cc);this.$Mg()},40,this.$.ya,"SelectionPresenceManager.SendCurrentPresence",!0);this.U8f=Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:7808895_LogFloatingObjectSelection");(this.VRc=Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:7941790_LogFloatingObjectSelectionsPeriodically"))&&this.NAf&&
this.Xzj(this.NAf);this.QHb=Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:8497049_HideHangingTooltipOnFloatingObjectSelection")}BVa(Rb){this.addHandler(Bd.Nde,Rb)}$Oa(Rb){this.removeHandler(Bd.Nde,Rb)}bCh(Rb){this.$.ea.Gea(Rb)}pmk(Rb){this.$.ea.R7(Rb)}Zw(Rb){this.addHandler(Bd.Hqa,Rb)}vx(Rb){this.removeHandler(Bd.Hqa,Rb)}bEh(Rb){this.addHandler(Bd.Ode,Rb)}Xnk(Rb){this.removeHandler(Bd.Ode,Rb)}get Ji(){return this.nFa}get K_(){return!this.$.ea||this.$.ea.K_}dispose(){this.$&&(this.zac(),this.$.Wr(this.Cj),
this.$.Yu(this.ej));this.vm&&this.vm.rvb(this.eAa);Va.a.dh(this.fgg);this.$=this.vm=null;super.dispose()}K0h(Rb){this.vm?this.vm.rvb(this.eAa):this.Tmb();(this.vm=Rb)?(this.vm.jIb(this.eAa),this.zwb(!0)):this.zac()}Tmb(){this.ha.Zw(this.Jj);Ja.f(this.$).lO(this.aw);var Rb=Ja.f(this.$).Fh;Rb.Jx(this.Rl);Rb.Iv(this.Cn);this.$.ea.$q(this.ij);this.$.ea.p4e(this.a4f);this.g4a.y4e(this.A1b);this.$.sa&&this.$.sa.gua(this.P1);Rb=this.$.pa.ta;Rb.cqd(this.zsg);Rb.yI(this.xp);Rb.xX(this.Wy);J.ec.Aa()?void W.a.sj(J.ec).then(Gb=>
{Gb.h4e(this.hPc);Gb.g4e(this.Rl)}):this.$.la.fi(16,Gb=>{Gb.h4e(this.hPc);Gb.g4e(this.Rl)})}zac(){this.ha.vx(this.Jj);Ja.f(this.$).$P(this.aw);const Rb=Ja.f(this.$).Fh;Rb.Lw(this.Rl);Rb.Cv(this.Cn);this.$.ea.Uq(this.ij);this.$.ea.qFg(this.a4f);this.g4a.AFg(this.A1b);this.$.pa.ta.Fje(this.zsg);this.$.pa.ta.iL(this.xp);this.$.pa.ta.wZ(this.Wy);this.$.sa&&this.$.sa.VAa(this.P1);J.ec.Aa()?void W.a.sj(J.ec).then(Gb=>{Gb.jFg(this.hPc);Gb.iFg(this.Rl)}):this.$.la.fi(16,Gb=>{Gb.jFg(this.hPc);Gb.iFg(this.Rl)});
this.raiseEvent(Bd.Ode)}VMg(Rb){return this.oAg(Rb)||!!this.fIf(Rb)}oAg(Rb){if(2===this.Ji.Version&&this.Ji.Object&&2===Rb.Version&&Rb.Object&&0<this.Ji.Object.length&&0<Rb.Object.length){var Gb=this.Ji.Object.length,Cc=Rb.Object.length;for(var cb=0;cb<Gb;cb++)for(var pc=0;pc<Cc;pc++)if(this.Brd(this.Ji.Object[cb],Rb.Object[pc]))return!0}if(this.Ji.SelectedRange&&Rb.SelectedRange)for(Gb=this.Ji.SelectedRange.length,Cc=Rb.SelectedRange.length,cb=0;cb<Gb;cb++)for(pc=0;pc<Cc;pc++)if(Bd.O0k(this.Ji.SelectedRange[cb],
Rb.SelectedRange[pc]))return!0;return!1}fIf(Rb){if(2===this.Ji.Version&&this.Ji.Object&&2===Rb.Version&&Rb.Object&&0<this.Ji.Object.length&&0<Rb.Object.length){const Gb=this.Ji.Object.length,Cc=Rb.Object.length;for(let cb=0;cb<Gb;cb++)for(let pc=0;pc<Cc;pc++)if(Bd.pMj(this.Ji.Object[cb],Rb.Object[pc]))return this.Ji.Object[cb].ObjectId}return null}Brd(Rb,Gb){return!!Rb&&!!Gb&&Rb.ObjectType===Gb.ObjectType&&(1===Rb.ObjectType||3===Rb.ObjectType)&&!!Rb.ObjectId&&!!Gb.ObjectId&&!Rb.ObjectId.localeCompare(Gb.ObjectId)}eoe(){this.zwb(!1)}zwb(Rb){this.ha.$e.Lh?
this.goe(0,Rb):this.noe(Ja.f(this.$).Fh.isEditing?1:0,Rb)}goe(Rb,Gb){var Cc={};this.$.dr(Cc);const cb=this.ha.$e.Lh;if(cb){const pc=cb.floatingObject;Cc.FirstColumn=-1;Cc.FirstRow=-1;Cc.LastColumn=-1;Cc.LastRow=-1;Cc.NamedObjectName=pc?pc.rn():null;this.Ji.SelectedRange=[Cc];this.Ji.PresenceType=0;Cc=null;if(null===pc||void 0===pc?0:pc.id)Cc={ObjectType:this.nTi(pc.type),ObjectPresenceType:Rb,DialogType:0,ObjectId:cb.Wq};this.Ji.Object=[Cc];this.VRc&&this.mJa&&0<=(null===pc||void 0===pc?void 0:pc.type)&&
(Rb=zd.a[pc.type],this.mJa[Rb]=void 0===this.mJa[Rb]?1:this.mJa[Rb]+1);this.U8f&&0<=(null===pc||void 0===pc?void 0:pc.type)&&n.ULS.sendTraceTag(508913565,0,50,`FloatingObjectPresence {"SelectedFloatingObjectType":"${pc.type}",
              "SelectedFloatingObjectName":"${zd.a[pc.type]}"}`)}this.raiseEvent(Bd.Hqa);this.sendPresenceToService(Gb)}noe(Rb,Gb){if((this.rAe||!Ja.f(this.$).isEditing)&&!Ja.f(this.$).lq){const cb=this.$.Eh.em("ModelUpdate","SendRangePresence");cb.start();var Cc=fb.l(this.ha.qa.selectedRanges,this.$);this.Ji.SelectedRange=this.g4a.E2h(Cc);this.Ji.Object=[];for(const pc of Cc)if(Cc=aa(pc,this.$,1)){const Ic={};Ic.ObjectType=this.qKa(Cc.type);Ic.ObjectPresenceType=0;Ic.ObjectId=Cc.Wq;this.Ji.Object.push(Ic)}this.Ji.PresenceType=
Rb;this.raiseEvent(Bd.Hqa);this.Ji.SelectedRange||this.Ji.Object?this.sendPresenceToService(Gb):n.ULS.sendTraceTag(537154371,0,50,`SelectionPresenceManager.SendRangePresence: skip sending range presence since selected range/object are both null.  UserId: [${this.vm.clientId}]`);cb.stop()}}sendPresenceToService(Rb){if(this.$.ea.qwc||!this.$.ea.fsc||Rb)if(this.K_||++this.HPa.b,this.vm){this.Ji.Version=2;this.Ji.ClientType=1;this.Ji.ChatThreadId=this.Ocb.Ivd;this.Ji.ChatThreadDiscoveryUri=this.Ocb.Hvd;
this.Ji.InChat=this.Ocb.tUb;this.Ji.Cid=this.Ocb.email;this.Ji.SupportsChat=!!this.Ocb.capabilities&&this.Ocb.capabilities.Amb(4);this.Ji.CollabMode=this.$.ea.Epb?2:0;this.Ji.OcsCapable=this.$.ea.ocsCapable;this.Ji.IsAnonymous=F.AFrameworkApplication.userNameUnknown||F.AFrameworkApplication.limitedEdit;this.vm.nAk(this.Ji);if(Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")&&this.$.ea&&this.$.ea.l0a){const Gb=(new Date).getTime();$a.TaskExtensions.Xa(Object(Jb.d)(W.a.resolve(J.Te,
{va:1}),J.Fe.Aa()?"SelectionPresenceManager.sendPresenceToService":null),Cc=>{Cc.result.lBj(Gb)},this.$.ya,3)}this.K_||++this.HPa.c}}$Mg(){this.$.ix&&(this.HPa.a=this.$.ua.UserSessionId,Ba.b().Ll(26,this.HPa,!0));this.HPa.b=0;this.HPa.c=0}nTi(Rb){switch(Rb){case 0:return 0;case 2:return 2;case 5:return 5;case 1:return this.QHb?6:-1;case 8:return this.QHb?7:-1;case 9:return this.QHb?8:-1;case 3:return this.QHb?9:-1;default:return-1}}qKa(Rb){switch(Rb){case 0:return 0;case 1:return 1;case 2:return 3;
case 9:return 2;default:return-1}}static get ZRc(){return Bd.XUe||(Bd.XUe={["ApplyFilter"]:1,["ApplyPivot"]:0,["ApplyPivotSort"]:0,["ApplyPivotSortByValue"]:1,["ApplyWellKnownPivotFilter"]:0,["RemovePivotFilter"]:0,["SetCustomFilter"]:1,["SetTop10Filter"]:1,["TogglePivotDrill"]:0,["RefreshAll"]:2})}static pMj(Rb,Gb){return!!Rb&&!!Rb.ObjectId&&!!Gb&&!!Gb.ObjectId&&(0===Rb.ObjectType||2===Rb.ObjectType)&&Rb.ObjectType===Gb.ObjectType&&!Rb.ObjectId.localeCompare(Gb.ObjectId)}static O0k(Rb,Gb){return!Rb.NamedObjectName&&
ea(Rb,Gb,!0)}Q8f(){this.mJa&&0<Object.keys(this.mJa).length&&n.ULS.sendTraceTag(508822753,0,20,`PresenceFloatingObjectSelections: ${JSON.stringify(this.mJa)}`);this.mJa={}}Xzj(Rb){const Gb=()=>{this.Q8f();Ka.a.instance.create(Gb,1E3*Rb,"FloatingObjectPresence.logFOSelectionsAtSpecifiedInterval",void 0,!0)};Gb.call(this)}};tc.Nde="presenceChanged";tc.Ode="presenceDisabled";tc.Hqa="selectionChanged";tc.XUe=null;tc=Bd=Object(U.__decorate)([Object(W.d)(J.Bf),Object(U.__param)(0,Object(J.Nb)()),Object(U.__param)(1,
Object(J.Yd)())],tc);Object(x.a)(tc,"SelectionPresenceManager",D.a,[431,4,432]);var Zc=a(650);const Ab=()=>Ca.a.instance.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder");var rb=a(1138);const Fb=()=>Ca.a.instance.fj("Common.ICoauthoringTelemeryInfoProvider"),jc=()=>Ca.a.instance.fj("Common.IPeopleInfoProvider");class Oc{constructor(Rb,Gb){this.pFa=null;this.kZ=()=>{Oc.P8e(this.pFa.EJa())&&(this.pFa.Eje(this.kZ),this.Oqh.IsRealCoauthSession=!0)};this.hFb=Rb;this.Oqh=Gb}init(){this.hFb.continueWith(()=>
{this.pFa=this.hFb.result;this.pFa.Qeb(this.kZ)})}static P8e(Rb){let Gb=null;for(const Cc of Rb)if(Cc)if(Rb=Cc.isAnonymous||!Cc.email?Cc.clientId:Cc.email.toUpperCase(),!Gb)Gb=Rb;else if(Gb!==Rb)return!0;return!1}}Object(x.a)(Oc,"CoauthTelemetry",null,[505]);var cd;(function(Rb){Rb[Rb.mll=0]="badStatePreventedTelemetry";Rb[Rb.notImplemented=1]="notImplemented";Rb[Rb.yul=2]="renderHandled";Rb[Rb.zul=3]="renderHandledWithVeto"})(cd||(cd={}));Object(x.b)("CoauthorGalleryTelemetryEndResult",cd);var Ed=
a(107),Sd=a(357);class $d{constructor(Rb,Gb,Cc,cb,pc,Ic,rd,Rd,va){this.KUe=this.XIe=this.GG=null;this.TQc=()=>{this.kZ()};this.s$d=()=>{const Bb=this.sI.EE("AppInitStatus_interactivityReady");n.ULS.shipAssertTag(42259235,325,!!this.Ikc);const Ac=this.Ikc-Bb,Nc={};Nc.InteractiveTime=Bb;Nc.ReactRenderComplete=this.Ikc;Nc.HadTabSwitch=this.oSa();Nc.IsModernGallery=this.P_e;n.ULS.sendTraceTag(594883104,325,20,xb.a.toJSON(Nc));this.P_e?(n.ULS.sendTraceTag(42062997,325,15,Ac.toString()),this.kkc.lF(this.IBe(Ac)?
3:2)):n.ULS.sendTraceTag(594883103,325,15,Ac.toString())};this.iab=Rb;this.kkc=new L.a;this.Ga=Cc;this.B9c=Gb;this.BDa=cb;this.sI=pc;this.Mhd=Ic;this.lFa=rd;this.Chh=Rd;this.dNe=this.aNe=!1;this.Ikc=0;this.VIe=1;this.oSa=va;this.P_e=this.Ga.ka("PeoplesWellExtraButtonInfoIsEnabled");this.ADa=Object(wa.a)(String,F.AFrameworkApplication.ii.Application)||""}get lYg(){return this.kkc.task}init(){y.Task.WAA.call(null,this.lFa,this.B9c,this.Mhd).continueWith(()=>{this.GG=this.lFa.result;this.XIe=this.B9c.result;
this.KUe=this.Mhd.result;y.Task.WAA.call(null,this.B9c.result.$wd,this.Mhd.result.O1c).continueWith(()=>{this.VIe=this.XIe.$wd.result;this.Ikc=this.KUe.O1c.result;this.GG.Qeb(this.TQc);this.GG.EJa().length&&this.kZ()})})}kZ(){this.Chh(this.GG.EJa())?(this.GG.Eje(this.TQc),this.cSj(this.aNe)):this.kkc.lF(1);this.aNe=!0}cSj(Rb){this.dNe?this.lYg.continueWith(()=>{n.ULS.sendTraceTag(42062996,325,15,"We already attempted to log a render of coauthor gallery: {0}",cd[this.lYg.result])}):(this.dNe=!0,this.xak(0===
this.VIe&&!Rb))}xak(Rb){Rb?this.BDa.Fm(4,this.s$d):this.kkc.lF(1)}IBe(Rb){const Gb=Rb>this.Ga.Lj("CoauthorGalleryTimeToRenderDurationMs",1E4);var Cc="Word"===this.ADa;const cb="PowerPoint"===this.ADa;if(this.oSa())return n.ULS.sendTraceTag(50455714,325,50,Gb.toString()),!1;Cc&&Ed.Health.instance.recordKpiUsage("CoauthGalleryExperienceDegraded",Sd.b.FailureBased,"wordcollabrel",null);Gb&&(Cc&&Ed.Health.instance.recordKpiFailure("CoauthGalleryExperienceDegraded","CoauthorGalleryTimeToRenderDurationIsTooLong",
!1,!0,null),Cc=F.AFrameworkApplication.fa.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.PPTClientCoauthorGalleryRenderLatencyQoSError"),cb&&Cc&&Rb<this.Ga.Lj("CoauthorGalleryTimeToRenderCutoffThresholdMs",3E4)&&Ed.Health.instance.recordQosError("CoauthorGalleryTimeToRenderDurationIsTooLong",["CoauthGalleryExperienceDegraded"],!1,!0,!0,!1,null),n.ULS.sendTraceTag(42062998,325,15,Rb.toString()));return Gb}}Object(x.a)($d,"CoauthorGalleryTelemetry",null,[489]);class be{constructor(Rb){this.GG=
null;this.Sdc={};this.uic={};this.pDb=null;this.kZ=()=>{this.O6g()};this.F_h=(Gb,Cc)=>Gb.bza>Cc.bza?1:Gb.bza<Cc.bza?-1:0;this.lFa=Rb}$Bc(Rb){const Gb=new L.a;this.init().continueWith(()=>{Rb in this.Sdc?Gb.lF(this.Sdc[Rb]):this.uic[Rb]=Gb});return Gb.task}init(){if(this.pDb)return this.pDb.task;this.pDb=new L.a;this.lFa.continueWith(()=>{this.GG=this.lFa.result;this.GG.Qeb(this.kZ);this.O6g();this.pDb.setResult(null)});return this.pDb.task}O6g(){const Rb=this.GG.EJa();Rb.sort(this.F_h);this.Sdc={};
for(let Gb=0;Gb<Rb.length&&Rb[Gb]&&Rb[Gb].bza;Gb++)this.qzh(this.Sdc,Rb[Gb].clientId,Gb)}qzh(Rb,Gb,Cc){Rb[Gb]=Cc;Gb in this.uic&&(this.uic[Gb].lF(Cc),delete this.uic[Gb])}}Object(x.a)(be,"CoauthorPositionFinder",null,[488]);var Fe=a(768),Pe=a(648),hc=a(854),Lb=a(189);class kc{constructor(){this.Gta=null;this.dBb=Array(32)}xor(Rb){if(!Rb)throw Error.argumentNull("Guid argument cannot be null");const Gb=new kc,Cc=new Sys.StringBuilder;for(let cb=0;cb<Rb.dBb.length;cb++){const pc=this.dBb[cb]^Rb.dBb[cb];
Gb.dBb[cb]=pc;Cc.append(pc.toString(16));7!==cb&&11!==cb&&15!==cb&&19!==cb||Cc.append("-")}Gb.Gta=Lb.a.zma(Cc.toString());return Gb}toString(){return this.Gta.toString()}equals(Rb){if(!Rb)throw Error.argumentNull("Guid argument cannot be null");return this.Gta.equals(Rb.Gta)}static fromString(Rb){if(!Rb)throw Error.argumentNull("String input cannot be null");const Gb=new kc;Gb.Gta=Lb.a.zma(Rb);const Cc=Gb.Gta.toString();let cb=0;for(let Ic=0;Ic<Cc.length;Ic++){var pc=Rb.charAt(Ic);if(kc.emj(pc))pc=
kc.B7i(pc,Rb.charCodeAt(Ic)),Gb.dBb[cb++]=pc;else if(!kc.vlj(pc))throw Error.argument("String contains characters not valid in Guids");}return Gb}static emj(Rb){return"0"<=Rb&&"9">=Rb||"A"<=Rb&&"F">=Rb||"a"<=Rb&&"f">=Rb}static vlj(Rb){return"{"===Rb||"}"===Rb||"-"===Rb}static B7i(Rb,Gb){if("0"<=Rb&&"9">=Rb)return Gb-48;if("A"<=Rb&&"F">=Rb)return Gb-65+10;if("a"<=Rb&&"f">=Rb)return Gb-97+10;throw Error.argument("Char is not valid hex digit");}}Object(x.a)(kc,"Guid",null,[]);var dd=a(284);class yb{constructor(Rb,
Gb,Cc,cb){this.pFa=null;this.$Je=this.RSe=!1;this.hRe=0;this.kZ=()=>{this.eZh(this.pFa.EJa())};this.hFb=Rb;this.nld=Gb;this.Ga=Cc;this.Ccb=cb;this.mhh=F.AFrameworkApplication.userNameUnknown||F.AFrameworkApplication.limitedEdit;this.ORe=new Fe.a(Pe.a.zm())}get DAd(){return this.Ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1)}init(){this.hFb.continueWith(()=>{this.pFa=this.hFb.result;this.pFa.Qeb(this.kZ)})}eZh(Rb){var Gb=0;const Cc=new hc.a(Pe.a.zm());for(const cb of Rb)if(cb&&
cb.isAnonymous){dd.a.DA("70eb6120;2gfeb930");if(Cc.lh(cb.userName))Cc.na(cb.userName).add(cb.clientId);else{let pc;Cc.add(cb.userName,(pc=new t.a,pc.add(cb.clientId),pc))}cb.clientId!==this.Ccb?(Gb++,2<=Gb&&!this.RSe&&this.LAj()):!this.$Je&&this.DAd&&"Guest"===cb.userName&&(n.ULS.sendTraceTag(509726851,302,50,"User was assigned 'Guest' name"),this.$Je=!0)}if(this.DAd&&this.hRe!==Gb){n.ULS.sendTraceTag(512553562,302,50,"Total guests updated to: {0}",Gb+(this.mhh?1:0));this.hRe=Gb;for(const cb of Cc.keys)2<=
Cc.na(cb).count&&(Rb=this.tKi(Cc.na(cb)),this.ORe.contains(Rb)||(Gb={},Gb.guestsWithSameName=Cc.na(cb).count,Gb.identifier=Rb,n.ULS.sendTraceTag(526394833,302,50,"Duplicate guest friendly name detected: {0}",Gb),this.ORe.add(Rb)))}}LAj(){n.ULS.sendTraceTag(525112603,302,50,"Multiple guests simultaneously coauthoring");this.RSe=!0;this.DAd&&this.nld&&this.nld.continueWith(()=>{window.setTimeout(()=>{this.nld.result.logActivity("MultipleGuestsCoauthoring",null)},15E3)})}tKi(Rb){if(!Rb||1>=Rb.count)return"";
let Gb=kc.fromString(Rb.na(0));for(let Cc=1;Cc<Rb.count;Cc++)Gb=Gb.xor(kc.fromString(Rb.na(Cc)));return Gb.toString()}}Object(x.a)(yb,"GuestCoauthTelemetry",null,[]);var Ta=a(598);class Hb{constructor(){this.id=null;this.d=this.tp=this.mp=this.st=this.et=0;this.ct=null;this.vc=!1}}Object(x.a)(Hb,"PL",null,[]);var uc=a(47);class Sc{constructor(){this.ct=this.vt=this.d=0}static FNg(Rb,Gb,Cc){const cb=new Sc;cb.d=Rb;cb.vt=Gb;cb.ct=Cc;return uc.c(cb)}}Object(x.a)(Sc,"VD",null,[]);class bc{constructor(Rb,
Gb,Cc,cb,pc,Ic,rd,Rd,va){this.jt=0;this.SXe=!1;this._id=Rb;this.QYe=Gb;this.XN=Cc;this.wgd=cb;this.Eld=pc;this.cVa=Ic;this.MSa=rd;this.Rih=Rd;this.oSa=va;this.ADa=Object(wa.a)(String,F.AFrameworkApplication.ii.Application)||""}veto(Rb){y.Task.WAA(this.QYe,this.wgd,this.Eld).continueWith(()=>{if(this.wgd.result<=this.Eld.result)Rb.lF(!1);else{this.jt=this.QYe.result;var Gb=this.XN-this.jt,Cc=new Hb;Cc.id=this._id;Cc.et=this.XN;Cc.st=this.jt;Cc.d=this.XN-this.jt;Cc.mp=this.wgd.result;Cc.tp=this.Eld.result;
Cc.ct=this.nHi(this.Rih);Cc.vc=this.oSa();var cb=uc.c(Cc),pc="Word"===this.ADa,Ic="PowerPoint"===this.ADa;n.ULS.sendTraceTag(42078597,302,15,cb);if(pc){const rd=new Map;rd.set("data",cb);Ed.Health.instance.recordKpiUsage("PresenceExperienceDegraded",Sd.b.FailureBased,"wordcollabrel",rd)}Gb>this.cVa.value&&!this.SXe&&!Cc.vc&&(this.SXe=!0,Rb.lF(!0),Cc={Zxa:!0,extendedProperties:new Map},Cc.extendedProperties.set("data",cb),pc&&Ed.Health.instance.recordKpiFailure("PresenceExperienceDegraded","PresenceRenderDurationIsTooLong",
!1,!0,Cc),Gb<this.MSa.value&&(n.ULS.sendTraceTag(42078598,302,15,Sc.FNg(Gb,this.cVa.value,this.MSa.value)),Gb=F.AFrameworkApplication.fa.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.PPTClientThumbnailPresenceRenderLatencyQoSError"),Ic&&Gb&&(Cc.Zxa=!1,Ed.Health.instance.recordQosError("PresenceRenderDurationIsTooLong",["PresenceExperienceDegraded"],!1,!0,!0,!1,Cc))));Rb.task.isCompleted||Rb.lF(!1)}})}nHi(Rb){switch(Rb){case 2:return"NonWac";case 0:return"Unknown";case 1:return"Wac";
default:return"Unknown"}}}Object(x.a)(bc,"PresenceLatencyActivityLogger",null,[]);class vc{constructor(Rb,Gb,Cc){this.tIe=this.UIe=this.Jdc=this.Rdc=this.nab=0;this._id=Rb;this.cVa=Gb;this.MSa=Cc;this.ADa=Object(wa.a)(String,F.AFrameworkApplication.ii.Application)||""}get T5e(){return this.nab}set T5e(Rb){this.nab=Rb;this.Jvd()}get Dgf(){return this.Rdc}set Dgf(Rb){this.Rdc=Rb;this.Jvd()}get Cdf(){return this.Jdc}set Cdf(Rb){this.Jdc=Rb;this.Jvd()}get Egf(){return 0!==this.UIe}get Ddf(){return 0!==
this.tIe}Jvd(){!this.Egf&&this.nab&&this.Rdc&&(this.UIe=this.veto(this.Rdc,"CoauthGalleryLightupDurationTooLong"));!this.Ddf&&this.nab&&this.Jdc&&(this.tIe=this.veto(this.Jdc,"CanvasPresenceLightupDurationTooLong"))}veto(Rb,Gb){const Cc=Rb-this.nab;var cb=new Hb;cb.id=this._id;cb.et=Rb;cb.st=this.nab;cb.d=Cc;var pc=uc.c(cb);Rb="Word"===this.ADa;cb="CanvasPresenceLightupDurationTooLong"===Gb?"PresenceExperienceDegraded":"CoauthGalleryExperienceDegraded";"CanvasPresenceLightupDurationTooLong"===Gb?
n.ULS.sendTraceTag(572289499,302,15,pc):n.ULS.sendTraceTag(571524118,302,15,pc);if(Rb){var Ic=new Map;Ic.set("data",pc);Ed.Health.instance.recordKpiUsage(cb,Sd.b.FailureBased,"wordcollabrel",Ic)}return Cc>this.cVa.value?(Ic=Object.assign({},{Zxa:!0,extendedProperties:new Map}),Ic.extendedProperties.set("data",pc),pc=Cc<this.MSa.value,Ic.extendedProperties.set("cash",pc?"true":"false"),Rb&&Ed.Health.instance.recordKpiFailure(cb,Gb,!1,!0,Ic),n.ULS.sendTraceTag(572289500,302,15,Sc.FNg(Cc,this.cVa.value,
this.MSa.value)),pc?2:1):3}}Object(x.a)(vc,"PresenceLightupLatencyLogger",null,[]);class Xc{constructor(Rb,Gb,Cc,cb,pc,Ic,rd,Rd,va,Bb){Rd=void 0===Rd?null:Rd;va=void 0===va?null:va;Bb=void 0===Bb?null:Bb;this.BVe={};this.A9c={};this.fQe=new t.a;this.qdc=this.qDb=this.GG=this.qjc=null;this.PYe=this.OYe=0;this.hZj=(Ac,Nc)=>{if(!this.NHe&&2===Nc.newState){var hd=this.eIf();hd.continueWith(()=>{var qd=hd.result;qd=Date.now()-qd;const je={};je.clientId=this.Tdg;je.bootTime=qd;this.NHe=!0;this.qjc.$ia(15,
je)})}};this.uPj=(Ac,Nc)=>{if(15===Nc.type){Ac=Date.now();Nc=Nc.Lja;var hd=Nc.bootTime;this.MMd(Nc.clientId).T5e=Ac-hd}};this.TQc=()=>{this.kZ()};this.cVa=new Ta.a(()=>Rd.lP("PresenceBootLatencyThreshold",1E4));this.MSa=new Ta.a(()=>Rd.lP("PresenceBootLatencyCutoffThreshold",6E4));this.vvh=new Ta.a(()=>Rd.lP("PresenceLightupLatencyThreshold",2E3));this.Wjh=new Ta.a(()=>Rd.lP("PresenceLightupLatencyCutoffThreshold",1E4));this.BDa=cb;this.Rqh=pc;this.WIe=Rb;this.aXe=Gb;this.lFa=Cc;this.sI=Ic;this.Ccb=
va;this.oSa=rd;this.gNe=Bb;this.NHe=!1;this.init()}kli(Rb,Gb,Cc){Cc=void 0===Cc?null:Cc;var cb=void 0===cb?0:cb;Cc&&(n.ULS.shipAssertTag(42274970,302,!this.Ccb||this.Ccb===Cc,"_myClientId is already set and you are trying to update it to something different"),this.Ccb=Cc);const pc=new L.a;this.init().continueWith(()=>{this.$Xj(Rb);this.lli(pc,Rb,Gb,cb)})}get Tdg(){return this.Ccb||"{"+F.AFrameworkApplication.userSessionId+"}"}init(){if(this.qDb)return this.qDb.task;this.qDb=new L.a;this.oSa()&&n.ULS.sendTraceTag(50951700,
302,15,"TabSwitched Session");this.WIe.continueWith(()=>{const Rb=this.WIe.result,Gb=Rb.$wd,Cc=Rb.rHj;Cc.continueWith(()=>{Gb.continueWith(()=>{this.gNe&&this.gNe.addQosPillar("RealTimeCoauth");this.hVk(Gb.result,Cc.result);this.qDb.setResult(null)})})});this.aXe.continueWith(()=>{this.qjc=this.aXe.result;this.qjc.mGa(this.hZj);this.qjc.Peb(this.uPj)});this.lFa.continueWith(()=>{this.GG=this.lFa.result;this.GG.Qeb(this.TQc);0<this.GG.EJa().length&&this.kZ()});return this.qDb.task}eIf(){this.qdc||
(this.qdc=new L.a,this.BDa.Fm(4,()=>{this.qdc.lF(this.sI.EE("AppInitStatus_interactivityReady"))}));return this.qdc.task}kZ(){const Rb=Date.now();var Gb=this.GG.EJa();const Cc=new t.a;for(const cb of Gb)this.fQe.contains(cb.clientId)||(this.fQe.add(cb.clientId),Cc.add(cb.clientId));if(0<Cc.count)for(const cb of Cc)Gb=this.MMd(cb),Gb.Egf||(Gb.Dgf=Rb)}$Xj(Rb){Rb=this.MMd(Rb);Rb.Ddf||(Rb.Cdf=Date.now())}MMd(Rb){return Rb in this.A9c?this.A9c[Rb]:this.A9c[Rb]=new vc(Rb,this.vvh,this.Wjh)}hVk(Rb,Gb){Gb=
void 0===Gb?0:Gb;this.OYe=Rb;this.PYe=Gb?Gb:(new Date).getTime()}lli(Rb,Gb,Cc,cb){Cc=Cc?Cc.getTime():(new Date).getTime();Gb in this.BVe?Rb.FJ():(cb=new bc(Gb,this.yXi(),Cc,this.$Bc(this.Tdg),this.$Bc(Gb),this.cVa,this.MSa,cb,this.oSa),this.BVe[Gb]=cb,cb.veto(Rb))}yXi(){return 1===this.OYe?y.Task.Ua(this.PYe):this.eIf()}$Bc(Rb){return this.Rqh.$Bc(Rb)}}Object(x.a)(Xc,"PresenceBootTelemetry",null,[487]);var ad=a(145),Id=a(282);class ue{get name(){return"Common.App.CoauthTelemetry"}$n(Rb){Rb.register(Oc,
"Common.App.CoauthTelemetry.CoauthTelemetry").as("Common.App.CoauthTelemetry.ICoauthTelemetry").yi().Ei(()=>new Oc(la.a.gw(jc()),F.AFrameworkApplication.xl));Rb.register($d,"Common.App.CoauthTelemetry.CoauthorGalleryTelemetry").as("Common.ICoauthorGalleryTelemetry").yi().Ei(()=>new $d(F.AFrameworkApplication.yh,la.a.gw(Fb()),F.AFrameworkApplication.fa,ad.a.get_instance(),Ya.a.instance,la.a.gw(Ca.a.instance.fj("Common.IPeoplesWell")),la.a.gw(jc()),Oc.P8e,()=>this.Paf()));Rb.register(Xc,"Common.App.CoauthTelemetry.PresenceBootTelemetry").as("Common.App.CoauthTelemetry.IPresenceBootTelemetry").yi().Ei(()=>
new Xc(la.a.gw(Fb()),la.a.gw(Object(rb.a)()),la.a.gw(jc()),ad.a.get_instance(),Ab(),Ya.a.instance,()=>this.Paf(),F.AFrameworkApplication.fa,null,Ed.Health.instance));Rb.register(be,"Common.App.CoauthTelemetry.CoauthorPositionFinder").as("Common.App.CoauthTelemetry.ICoauthorPositionFinder").yi().Ei(()=>new be(la.a.gw(jc())));Rb.register(yb,"Common.App.CoauthTelemetry.GuestCoauthTelemetry").yi().Ei(()=>new yb(la.a.gw(jc()),la.a.gw(Object(Zc.a)()),F.AFrameworkApplication.fa,"{"+F.AFrameworkApplication.userSessionId+
"}"))}init(){F.AFrameworkApplication.fa.Yx(()=>{Ca.a.instance.resolve("Common.App.CoauthTelemetry.CoauthTelemetry").init();Ca.a.instance.resolve("Common.App.CoauthTelemetry.GuestCoauthTelemetry").init();F.AFrameworkApplication.fa.ka("CoauthorGalleryTelemetryIsEnabled")&&Ca.a.instance.resolve("Common.ICoauthorGalleryTelemetry").init();F.AFrameworkApplication.fa.ka("CashTelemetryIsEnabled")&&(Ca.a.instance.resolve("Common.App.CoauthTelemetry.IPresenceBootTelemetry"),Ab())})}dispose(){}Paf(){return Sa.a.t4&&
Ya.a.instance.I$(da.a.nbc)?0<Ya.a.instance.EE(da.a.nbc)[da.a.I9g]:!1}static main(){Id.a.instance.Do(new ue)}}Object(x.a)(ue,"CoauthTelemetryPackage",null,[11,12]);var Vd=a(9),Kd=a(77),Yd=a(334);class Bc{constructor(Rb){this.eh=new w.a;this.disposed=!1;this.g2b=()=>{n.ULS.sendTraceTag(537154381,0,50,"PeopleInfoProvider.OnUserListUpdated fired");this.eh.raiseEvent("UU",this)};this.$=Rb;this.$.ea.Gea(this.g2b)}dispose(){this.disposed||(this.$&&this.$.ea&&this.$.ea.R7(this.g2b),Va.a.gj([this.eh]),this.$=
this.eh=null,this.disposed=!0)}Qeb(Rb){this.eh.addHandler("UU",Rb)}Eje(Rb){this.eh.removeHandler("UU",Rb)}EJa(){const Rb=[];for(const Gb of this.$.ea.Wt)Rb.push(vb.a.xKf(Gb));n.ULS.sendTraceTag(537154383,0,50,`PeopleInfoProvider.GetAllUsers: Count: [${Rb.length}]`);return Rb}}Object(x.a)(Bc,"PeopleInfoProvider",null,[456,4]);var Mc=a(428);class Fd extends Mc.a{constructor(Rb){super();this.manager=null;this.$=Rb;this.gm()}create(){this.manager?this.Bk(this.manager):$a.TaskExtensions.Xa(Object(Jb.d)(W.a.resolve(J.Yd,
{va:this.xh}),J.Fe.Aa()?"SelectionPresenceManagerFactory.create":null),Rb=>{this.Bk(this.manager||(this.manager=new tc(this.$,Rb.result)))},this.ya,3)}}Object(x.a)(Fd,"SelectionPresenceManagerFactory",Mc.a,[]);var Md=a(1298),oe=a(7),ye=a(218);class te extends Pa.a{constructor(Rb,Gb,Cc){super();this.M5a=this.Pde=null;this.E1b=(cb,pc)=>{if(pc.b_){cb=[];const Rd=[];var Ic=Ja.f(this.$).ha;const va=!(2===Ic.Ck||128===Ic.Ck);Ic=va?fb.l(Ic.qa.selectedRanges,this.$):Ic.$e.Lh.floatingObject;const Bb=pc.b_;
for(const Ac in Bb)this.presenceView.kpf(Ic,va,cb,Rd,Ac);if(!Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:8436691_shouldNarratorAnnouceJustIntersectingUserPresenceChange")||this.B6i(Bb,pc.Nma,cb,Rd)){for(const Ac of this.Dva)cb.includes(Ac)||Rd.includes(Ac)||this.presenceView.kpf(Ic,va,cb,Rd,Ac.UserID);pc=Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:8417154_shouldAnnounceWhenLastIntersectingUserChangedLocation")?0===cb.length&&1<=this.Dva.length:!1;this.Dva=[];this.Dva.push(...cb);this.Dva.push(...Rd);
this.Pde&&(Va.a.dh(this.M5a),this.Pde=this.M5a=null);var rd=te.kbf(cb,Rd,pc);this.M5a=new ye.a;this.Pde=$a.TaskExtensions.Xa(y.Task.delay(1),()=>{this.ariaLiveNotifier.HOa(rd,oe.a.KGa)},this.M5a.token,3)}}};this.$=Gb;this.ariaLiveNotifier=Rb;this.presenceView=Cc;this.Dva=[];Cc.BVa(this.E1b);this.$.la.Hh(231,this)}gIf(Rb,Gb){this.Dva=[];const {dfj:Cc,iji:cb}=this.presenceView.qOi(Rb,Gb);this.Dva.push(...Cc);this.Dva.push(...cb);return te.kbf(Cc,cb,!1)}dispose(){this.presenceView.$Oa(this.E1b);this.M5a&&
(Va.a.dh(this.M5a),this.M5a=null);super.dispose()}static kbf(Rb,Gb,Cc){return Rb.length||Gb.length||Cc?Gb.length?1===Gb.length?String.format(ab.a.instance.sh(83),Gb[0].UserName):String.format(ab.a.instance.sh(84),Gb.length):1===Rb.length?String.format(ab.a.instance.sh(85),Rb[0].UserName):String.format(ab.a.instance.sh(86),Rb.length):""}B6i(Rb,Gb,Cc,cb){if(0<(null===Cc||void 0===Cc?void 0:Cc.length)||0<(null===cb||void 0===cb?void 0:cb.length))return!0;for(const pc of this.Dva)if(Cc=pc.UserID,Rb&&
Rb[Cc]||(null===Gb||void 0===Gb?0:Gb.includes(Cc)))return!0;return!1}}Object(x.a)(te,"PresenceReadoutHandlerService",Pa.a,[460]);const ze=(Rb,Gb,Cc,cb,pc,Ic)=>{Ic=Rb.$a(1,void 0===Ic?null:Ic);return ka.h(Rb,"CheckWorkbookFileNameUpdate",Ic,Gb,Cc,cb,pc,0)};class He{constructor(Rb){this.$=Rb}Dug(Rb){var Gb=this.$.pa.ta,Cc=Rb.$ai,cb=Rb.HOc;Rb=Rb.oQ;const pc=Gb.$a(1,null);pc.Id=Cc;pc.OnBehalfOfOcs=cb;return ka.h(Gb,"CheckPersistedContentUpdate",pc,Rb,null,null,null,516)}Y5e(Rb,Gb){if(!Gb)return Rb;if(!Rb)return n.ULS.shipAssertTag(537154133,
0,!1,"CheckPersistedActionAggregationPerformer.AggregateActionParameters: Received null newActionParameters"),Gb;Rb.HOc=Gb.HOc&&Rb.HOc;return Rb}}Object(x.a)(He,"CheckPersistedActionAggregationPerformer",null,[457,458]);class ne{}Object(x.a)(ne,"RevisionGeneratedNotification",null,[]);class of{}Object(x.a)(of,"StateDownloadedNotification",null,[]);var lf=a(231);class jf extends Pa.a{constructor(Rb){super();this.mergeSuspensionManager=this.tk=null;this.KLa=!1;this.nce=null;this.M0c=this.L0c=this.N0c=
this.Hj=!1;this.b2b=(Gb,Cc)=>{this.KLa!==Cc.KLa&&(this.nce=(this.KLa=Cc.KLa)?null:sa.a.ih.ri)};this.Cj=()=>{this.$.ix&&this.FWk()};this.ij=(Gb,Cc)=>{Cc.ki||this.Nx(Gb,Cc)};this.Nx=()=>{if(0<this.lPa.length||0<this.hra.count)n.ULS.sendTraceTag(537154128,13,15,`Dropping ${this.lPa.length} revisionGeneratedNotifications and ${this.hra.count} stateDownloadedNotifications.`),this.lPa=[],this.hra=new lf.a;this.nJb.cancel();this.O4g();this.oze();this.i6k()};this.lpg=(Gb,Cc)=>{this.DWk();this.EWk();Gb=new ne;
Gb.Xluid=Cc.Wq;Gb.NotificationReceivedOn=sa.a.ih.ri.toISOString();Gb.CurrentPresenceUserCount=this.$.ea.Wt.length;Gb.OurCollabModeIsUsingOcs=this.$.ea.Epb;Gb.SenderCollabMode=Cc.OAk;Gb.SenderClientType=Cc.NAk;Gb.SessionSiteIdentifier=Cc.bja;Gb.CommandTimeInMs=Cc.IZh;n.ULS.sendTraceTag(537154127,13,50,`ContentLatencyTracker.OnRemoteRevisionGenerated: RevisionGeneratedNotification: ${JSON.stringify(Gb)}`);this.lPa.push(Gb)};this.vp=()=>{this.ckf(this.$.ea.Ek,"OnBlockCacheConsistent")};this.ppg=(Gb,
Cc)=>{(Gb=Object(wa.a)(180,Cc.fk))&&this.ckf(Gb.sO,"OnRenderedContent")};this.Dal=()=>{if(!this.$.ea.ki)n.ULS.sendTraceTag(537154122,13,15,"ContentLatencyTracker.UploadLatencyTelemetryPeriodically: session isn't active");else if(this.lPa.length||this.hra.count){var Gb=null;0<this.lPa.length&&(Gb=this.lPa,this.lPa=[]);var Cc=null;if(0<this.hra.count){Cc=Array(this.hra.count);var cb=0;for(var pc of this.hra.values)Cc[cb++]=pc;this.hra=new lf.a}n.ULS.sendTraceTag(537154120,13,100,`ContentLatencyTracker.UploadLatencyTelemetryPeriodically: Uploading ${Gb?
Gb.length:0} revisionGeneratedNotifications and ${Cc?Cc.length:0} stateDownloadedNotifications.`);cb=this.$.pa.ta;pc=this.b1j;const Ic=cb.$a(1,null);Ic.GenerateNotifications=Gb;Ic.DownloadNotifications=Cc;ka.h(cb,"UploadLatencyTelemetry",Ic,pc,null,null,null,128)}};this.b1j=Gb=>{Gb.Result&&0<Gb.Result&&this.b5d()};this.$=Rb;this.za=Ja.f(this.$).za;this.viewport=Ja.f(this.$).view;this.contentRefreshManager=this.$.la.kh(292);this.km=this.$.km;this.lPa=[];this.hra=new lf.a;this.nJb=Ka.a.instance.LO(this.Dal,
3E4,nb.a.s1h,!1,!1);this.$.mr(this.Cj);this.$.ea.$q(this.ij);this.$.ea.Upd(this.Nx);Ua.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ConvertDocumentVisibilityObserverService",!1)?void W.a.resolve(J.Cb).then(Gb=>{this.tk=Gb}):this.$.la.fi(291,Gb=>{this.tk=Gb});this.$.la.fi(343,Gb=>{this.Hj||(this.mergeSuspensionManager=Gb,this.mergeSuspensionManager.enc(this.b2b),this.mergeSuspensionManager.U3b())});n.ULS.sendTraceTag(537154131,13,50,"ContentLatencyTracker initialized");this.Cj(this.$,
null)}dispose(){this.Hj=!0;this.nJb&&(this.nJb.dispose(),this.nJb=null);this.contentRefreshManager&&(this.O4g(),this.contentRefreshManager=null);this.za&&(this.oze(),this.za=null);this.viewport&&(this.oze(),this.viewport=null);this.km&&(this.km=null);this.$&&(this.$.Wr(this.Cj),this.$.ea.Uq(this.ij),this.$.ea.QFg(this.Nx),this.$=null);this.mergeSuspensionManager&&(this.mergeSuspensionManager.qVc(this.b2b),this.mergeSuspensionManager=null);super.dispose()}FWk(){this.N0c||(this.contentRefreshManager.nEh(this.lpg),
this.N0c=!0,this.nJb.MA())}O4g(){this.N0c&&(this.contentRefreshManager.fok(this.lpg),this.N0c=!1)}DWk(){this.L0c||(this.za.ny(this.vp),this.L0c=!0)}oze(){this.L0c&&(this.za.ux(this.vp),this.L0c=!1)}EWk(){this.M0c||(this.viewport.oEh(this.ppg),this.M0c=!0)}i6k(){this.M0c&&(this.viewport.iok(this.ppg),this.M0c=!1)}ckf(Rb,Gb){if(Rb!==X.a.Dk&&!this.hra.lh(Rb)){var Cc=sa.a.ih.ri.toISOString();Cc=Object(Q.a)(new of,{StateId:Rb,DownloadedOn:Cc,IsHidden:this.tk?this.tk.un:"visible"!==window.document.visibilityState,
DocumentLastUnhidden:this.tk&&this.tk.JKc?this.tk.JKc.toISOString():null,LastLostRtcConnection:this.contentRefreshManager&&this.contentRefreshManager.U5f?this.contentRefreshManager.U5f.toISOString():null,LastOffline:this.km&&this.km.rMa?this.km.rMa.toISOString():null});this.mergeSuspensionManager&&(Cc.IsPendingMergeBlockedByClient=this.KLa,this.nce&&(Cc.PendingMergeBlockedByClientLastEnded=this.nce.toISOString()));n.ULS.sendTraceTag(537154124,13,50,`ContentLatencyTracker.CreateAndAddstateDownloadedNotifications: ${Gb} - StateDownloadedNotification: ${JSON.stringify(Cc)}`);
this.hra.add(Rb,Cc)}}b5d(){F.AFrameworkApplication.xl&&F.AFrameworkApplication.xl.b5d()}}Object(x.a)(jf,"ContentLatencyTracker",Pa.a,[]);var Cf=a(1076),Gf=a(1075);class Af extends Sys.EventArgs{constructor(Rb,Gb,Cc,cb,pc){super();this.Wq=Rb;this.OAk=Gb;this.NAk=Cc;this.bja=cb;this.IZh=pc}}Object(x.a)(Af,"RevisionGeneratedEventArgs",Sys.EventArgs,[]);class Lf{constructor(Rb,Gb,Cc,cb){this.E4c=this.ESc=this.KRc=this.EEc=0;this.gPe=this.$Wf=!1;this.clientId=Rb;this.Kai=Gb;this.$=cb;this.eCj=Aa.a.Dj()+
Cc}get m0f(){return this.gPe}w9k(){this.ESc||(this.ESc=Aa.a.Dj(),this.GMa())}t9k(){this.EEc||(this.EEc=Aa.a.Dj(),this.GMa())}v9k(){this.KRc||(this.KRc=Aa.a.Dj(),this.GMa())}x9k(Rb){this.E4c||(this.E4c=Aa.a.Dj(),this.$Wf=Rb,this.GMa())}GMa(Rb){Rb=void 0===Rb?0:Rb;this.m0f||(Rb&&Rb>this.eCj?this.OE(!0):this.ESc&&this.KRc&&this.EEc&&this.E4c&&this.OE(!1))}dispose(){this.$=null}OE(Rb){const Gb={};Gb.CoAuthorsCount=this.$.ea.Wt.length;Gb.HostNotificationTime=this.EEc;Gb.PeerNotificationTime=this.KRc;Gb.PresenceNotificationTime=
this.ESc;Gb.UserFetchTime=this.E4c;Gb.IsAlreadyFetchedFromServer=this.$Wf;Gb.IsTimeout=Rb;Gb.ClientId=this.clientId;Gb.CurrentUserClientId=this.Kai;Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:6875242_useStringLiteralToPrintJsonObjectInLogs")?n.ULS.sendTraceTag(541388879,0,50,`Host Notification Latency Entry: ${JSON.stringify(Gb)}`):n.ULS.sendTraceTag(541388879,0,50,"Host Notification Latency Entry: {0}",Gb);this.gPe=!0}}Object(x.a)(Lf,"HostNotificationLatencyEntry",null,[4]);class Ef{constructor(Rb,
Gb,Cc){this.$ai=Rb;this.HOc=Gb;this.oQ=Cc}}Object(x.a)(Ef,"PersistedContentUpdateActionParameters",null,[]);class Hf{constructor(Rb,Gb,Cc){this.t9c={};this.u9c={};this.oQ=Cc;this.Wnc(Rb,this.t9c);this.Wnc(Gb,this.u9c)}get Dwd(){return wb.a(this.t9c)}get Ewd(){return wb.a(this.u9c)}get OZf(){return!this.Dwd.length&&!this.Ewd.length}i5k(Rb){this.Wnc(Rb.Dwd,this.t9c);this.Wnc(Rb.Ewd,this.u9c)}Wnc(Rb,Gb){if(Rb)for(const Cc of Rb)Gb[Cc]=!0}}Object(x.a)(Hf,"UpdatePresenceUsersActionParameters",null,[]);
class $b extends D.a{constructor(Rb,Gb,Cc,cb){super();this.vm=null;this.I7d=!1;this.NQe=this.currentUserId=this.nSd=null;this.aHc=!1;this.bae=(pc,Ic)=>{if(Ic.b_){pc=Ic.b_;for(const rd in pc)(pc=rd)&&pc!==this.currentUserId&&!this.ghb.has(pc)&&this.PBc(pc).w9k()}};this.VE=()=>{this.KBg()};this.Epa=(pc,Ic)=>{this.I7d=!0;const rd=Object(wa.a)(Object,Ic.Lja);if(1===Ic.type)if(pc=Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:8030692_IsEditorsTableNotificationEnabled"),null===rd||void 0===rd?0:rd[X.a.Q8i]){if(!pc||
!Object(wa.a)(String,rd[X.a.VSf]))return;var Rd=this.ajf(Object(wa.a)(String,rd[X.a.VSf]));Object(wa.a)(String,rd[X.a.WSf])===X.a.O8i?(Rd=[Rd],Rd[0]===this.currentUserId||this.ghb.has(Rd[0])||this.PBc(Rd[0]).t9k(),this.yTg(Rd)&&this.Nzb(Rd,null)):Object(wa.a)(String,rd[X.a.WSf])===X.a.P8i&&Rd!==this.currentUserId&&this.Nzb(null,null)}else{Ic=Array.isArray(Ic.Lja)?Ic.Lja:null;!Ic&&rd&&(Ic=Array.isArray(rd[X.a.ksf])?rd[X.a.ksf]:null);if(Ic&&pc)for(Rd of Ic)Rd===this.currentUserId||this.ghb.has(Rd)||
this.PBc(Rd).v9k();Ic&&!this.yTg(Ic)||this.Nzb(Ic,null);return}if(rd)if(0===Ic.type){let va;(()=>{let Bb=this.cJb(rd);({uBg:va}=Bb);return Bb})().returnValue?(this.Q4a(rd),X.a.Ek in rd&&(this.$.ea.P8(rd[X.a.Ek],"ContentRefreshManager.OnUpdateNotificationReceived"),this.g5g())):n.ULS.sendTraceTag(22905367,0,50,`RTC ContentUpdate session identifier mismatch. Received: ${va}. Expected: ${this.$.ea.bja}. Ignoring this update.`)}else{if(3===Ic.type){if(!(X.a.fKg in rd)){n.ULS.sendTraceTag(537154117,13,
10,"RTC WetContentUpdate does not specify a type. Ignoring this update.");return}Ic=rd[X.a.fKg];Ic===X.a.uvk?this.O4i(rd):Ic!==X.a.svk&&Ic!==X.a.wvk&&Ic!==X.a.xvk&&Ic!==X.a.vvk&&Ic!==X.a.tvk&&n.ULS.sendTraceTag(537154081,13,50,`RTC WetContentUpdate of unknown type ${Ic}. Ignoring this update.`);return}if(4===Ic.type){if(this.cJb(rd).returnValue)return;this.$.ea.xVd()&&this.cWh();if(this.plk)return;Rd=!1;X.a.Mug in rd&&(Rd=rd[X.a.Mug]);if(this.$.ea.Epb&&Rd)return;pc=rd[X.a.Z5j];this.$.ea.ki&&pc&&this.Y5j.Hug(new Ef(pc,
Rd,this.POj))}else if(8===Ic.type)return}2===Ic.type?rd&&this.cJb(rd).returnValue||(n.ULS.sendTraceTag(537154079,0,50,"RTC : FileNameUpdate received. Now invoking CheckWorkbookFileNameUpdate web method"),ze(this.$.pa.ta,null,null,null,null)):12!==Ic.type||rd&&this.cJb(rd).returnValue||this.raiseEvent("LabelUpdateEventKey")};this.POj=pc=>{var Ic=pc.Errors;ja.a.Lx(Ic)?(Ic=ja.a.WS(Ic,[1552731907],"ContentRefreshManager"),ja.a.tua(Ic)||this.$.ea.sx(Ic)):(Ic=pc.StateId+1,pc.Result&&this.$.ea.Ek<Ic&&this.$.ea.P8(X.a.Dk,
"ContentRefreshManager.OnCheckForUpdateSuccess"))};this.xp=()=>{this.lvk&&this.I7d&&this.$.ea.qwc&&this.g5g()};this.Oig=()=>{this.I7d=!1;this.$.ea.Lqa=500;this.NQe=sa.a.ih.ri};this.Y0b=(pc,Ic)=>{this.Hue(Ic.vm)};this.$=Rb;this.XD=Gb;this.$.pa.yI(this.xp);this.XD.Yod(this.Y0b);this.XD.MBh(this.Oig);this.Y5j=Cc;this.W9k=cb;this.u0a={};this.ghb=new Set;this.aHc=Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:8030692_IsEditorsTableNotificationEnabled");this.XD.UKb();this.aHc&&(this.currentUserId=this.$.workbookContext.ClientId,
this.KBg(),this.$.ea.Gea(this.VE));this.plk=Ua.EwaSettings.isChangeGateEnabled("OfficeVSO:7792548_RemoveWebRequestsForPersistedContentUpdates")}nEh(Rb){this.addHandler("ekcrmrrg",Rb)}fok(Rb){this.removeHandler("ekcrmrrg",Rb)}Jeb(Rb){this.addHandler("ekcrmmcu",Rb)}nvb(Rb){this.removeHandler("ekcrmmcu",Rb)}bDh(Rb){this.addHandler("LabelUpdateEventKey",Rb)}knk(Rb){this.removeHandler("LabelUpdateEventKey",Rb)}get U5f(){return this.NQe}get lvk(){return!!this.vm&&2===this.vm.connectionState}Nzb(Rb,Gb){this.$.ea.ki&&
(n.ULS.sendTraceTag(39150978,0,50,`ContentRefreshManager.UpdatePresenceUsers: clientIdsToAdd=[${Rb?Rb.join(","):"null"}] clientIdsToRemove=[${Gb?Gb.join(","):"null"}]`),this.W9k.Hug(new Hf(Rb,Gb,null)))}dispose(){this.vm&&(this.vm.r5b(this.Epa),this.vm.rvb(this.bae));this.$&&(this.$.pa.iL(this.xp),this.$.ea.R7(this.VE));this.XD&&(this.XD.YEg(this.Y0b),this.XD.bmk(this.Oig));this.$=this.vm=this.ghb=this.u0a=null;super.dispose()}Hue(Rb){this.vm&&(this.vm.r5b(this.Epa),this.vm.rvb(this.bae));this.vm=
Object(wa.a)(433,Rb);this.vm.Peb(this.Epa);this.aHc&&this.vm.jIb(this.bae);this.currentUserId=this.vm.clientId}KBg(){const Rb=!this.vm;var Gb=this.$.ea.Wt;for(const Cc of Gb)(Gb=Cc.User.UserID)&&Gb!==this.currentUserId&&!this.ghb.has(Gb)&&this.PBc(Gb).x9k(Rb)}O4i(Rb){if(X.a.eKg in Rb&&X.a.dKg in Rb&&X.a.cKg in Rb){var Gb=Rb[X.a.cKg];1!==Gb||X.a.bja in Rb&&X.a.HWc in Rb||n.ULS.sendTraceTag(537154076,13,10,`RTC WetContentUpdate was sent from ECS and is missing some expected fields. Has SessionSiteIdentifier: ${X.a.bja in
Rb}, Has UserOperationTimeInMs: ${X.a.HWc in Rb}.`);var Cc;(()=>{let cb=this.cJb(Rb);({uBg:Cc}=cb);return cb})().returnValue||(Gb=new Af(Rb[X.a.eKg],Rb[X.a.dKg],Gb,Cc,X.a.HWc in Rb?Rb[X.a.HWc]:0),this.raiseEvent("ekcrmrrg",Gb,this))}else n.ULS.sendTraceTag(537154077,13,10,"RTC WetContentUpdate is missing some critical fields. Ignoring this update.")}cJb(Rb){Rb=X.a.bja in Rb?Rb[X.a.bja]:null;return{returnValue:this.$.ea.bja===Rb,uBg:Rb}}g5g(){this.$.ea.Lqa=Math.max($b.RLh,this.$.ea.Lqa)}yTg(Rb){for(const Gb of Rb)if(!this.$.ea.Q_a(Gb))return!0;
return!1}cWh(){this.$.si(1562177611,-1,0,null)}Q4a(Rb){X.a.Kcg in Rb&&X.a.Lcg in Rb&&X.a.Ocg in Rb&&(Rb=Object(Q.a)(new Cf.a,{Pending:Rb[X.a.Lcg],Current:Rb[X.a.Kcg],SuspensionStartTimestamp:Rb[X.a.Ocg]}),this.raiseEvent("ekcrmmcu",new Gf.a(Rb),this))}PBc(Rb){Rb=this.ajf(Rb);if(!this.u0a[Rb]){const Gb=new Lf(Rb,this.currentUserId,4E4,this.$);this.u0a[Rb]=Gb}this.QLg();return Object(wa.a)(Lf,this.u0a[Rb])}ajf(Rb){if(!Rb)return Rb;let Gb=Rb.toLocaleLowerCase();Gb.startsWith("{")||(Gb="{"+Rb+"}");return Gb}QLg(){this.nSd||
xb.a.isEmpty(this.u0a)||!this.aHc||(this.nSd=y.Task.delay(2E4).continueWith(()=>{this.N8i()}))}N8i(){const Rb=[],Gb=Aa.a.Dj(),Cc=this.u0a;for(const pc in Cc){var cb=pc;const Ic=Object(wa.a)(Lf,Cc[pc]);Ic.GMa(Gb);Ic.m0f&&(Ic.dispose(),Rb.push(cb))}for(const pc of Rb)delete this.u0a[pc],this.ghb.add(pc);this.nSd=null;this.QLg()}}$b.RLh=3E4;Object(x.a)($b,"ContentRefreshManager",D.a,[459]);var Wb=a(224),Dc=a(76);class Jf{constructor(Rb){this.$=Rb}Dug(Rb){return this.$.ea.ki?$a.TaskExtensions.ts($a.TaskExtensions.ts(y.Task.delay(0),
()=>{var Gb=this.$.pa.ta,Cc=Rb.Dwd,cb=Rb.Ewd,pc=Rb.oQ;const Ic=Gb.$a(1,null);Ic.clientIdsToAdd=Cc;Ic.clientIdsToRemove=cb;return ka.h(Gb,"UpdatePresenceUsers",Ic,pc,null,null,null,0)},Wb.a.none,0,Dc.a.current),()=>y.Task.delay(5E3),Wb.a.none,0,Dc.a.current):y.Task.Ua(!0)}Y5e(Rb,Gb){if(!Gb)return Rb;if(!Rb)return n.ULS.shipAssertTag(537154073,0,!1,"UpdatePresenceUsersActionAggregationPerformer.AggregateActionParameters: Received null newActionParameter"),Gb;if(Gb.OZf)return Gb;if(Rb.OZf)return Rb;
Gb.i5k(Rb);return Gb}}Object(x.a)(Jf,"UpdatePresenceUsersActionAggregationPerformer",null,[457,458]);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.CoauthTelemetry");ue.main();Type.registerNamespace("Common.App.CollabControls");Type.registerNamespace("Common.App.Presence");Type.registerNamespace("RealtimePresenceUI");(()=>{Vd.a.gh(Rb=>{const Gb=Rb.la;J.Bf.Aa()||Gb.Hh(158,new Fd(Rb));if(J.Ue.Aa())void W.a.resolve(J.u,{va:1});else{const Cc=J.Bf.Aa()?Object(Jb.d)(W.a.resolve(J.Bf,
{va:1})):Kd.GetServiceTaskFactory.create(Rb.la,158,Gb.ya,1),cb=Object(Jb.d)(W.a.resolve(J.Yd,{va:1}),J.Fe.Aa()?"PresenceBootstrapper.main - NamedSheetViewConversionManagerService":null),pc=Object(Jb.d)(W.a.resolve(J.jf,{va:4}),J.Fe.Aa()?"PresenceBootstrapper.main - RealTimeChannelControllerService":null),Ic=Object(Jb.d)(W.a.resolve(J.ah),J.Fe.Aa()?"PresenceBootstrapper.main - ZoomService":null);$a.TaskExtensions.Xa($a.TaskExtensions.Vo([Cc,cb,pc,Ic],Gb.ya),()=>{const rd=new L.a,Rd=pc.result;Rd.dmf(Object(M.a)(rd,
rd.setResult,"setResult"));const va=new jd(Rb,Rd,Cc.result,cb.result,Ic.result);Yd.a.getInstance(Rb.la).add(va);$a.TaskExtensions.Xa(Object(Jb.d)(W.a.resolve(J.Se,{va:1}),J.Fe.Aa()?"PresenceBootstrapper.main - PresenceConverterService":null),Bb=>{const Ac=new L.a;Ac.setResult(va);new B(Object(Q.a)(new E.a,{clientId:Rb.workbookContext.ClientId}),rd.task,Ac.task,Bb.result,K.TaskManager.instance,F.AFrameworkApplication.fa.ka("AwayStatusOneMinuteTimeoutIsEnabled")?6E4:F.AFrameworkApplication.fa.Lj("AwayCoauthorThresholdMs",
9E5),Object(M.a)(F.AFrameworkApplication.yh,F.AFrameworkApplication.yh.gl,"processAction"),ba.instance)},Gb.ya)},Gb.ya,3)}Ca.a.instance.register(224,"Microsoft.Office.Excel.WebUI.Client.ISessionStateManager").as("Common.ICoauthoringTelemeryInfoProvider").yi().Ei(()=>Rb.ea);Ca.a.instance.resolve("Common.ICoauthoringTelemeryInfoProvider");Ca.a.instance.register(Bc,"Microsoft.Office.Excel.WebUI.Client.Presence.PeopleInfoProvider").as("Common.IPeopleInfoProvider").yi().Ei(()=>new Bc(Rb));Ca.a.instance.resolve("Common.IPeopleInfoProvider")})})();
(()=>{Vd.a.gh(Rb=>{J.Ee.Aa()||Md.a.Ba(Rb)})})();Vd.a.gh(Rb=>{const Gb=Rb.la,Cc=Ua.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FixMigrate2AriaLiveNotifier",!1)?Object(Jb.d)(W.a.resolve(J.l,{va:1}),J.Fe.Aa()?"PresenceReadoutHandlerBootstrapper.createPresenceReadoutHandlerService":null):Kd.GetServiceTaskFactory.Tj(Rb.la,211,212,1);J.Ue.Aa()?void W.a.sj(J.Ue).then(cb=>{$a.TaskExtensions.Xa(Cc,pc=>{Gb.kh(231)||new te(pc.result,Rb,cb)},Gb.ya,3)}):Gb.fi(25,cb=>{$a.TaskExtensions.Xa(Cc,pc=>
{Gb.kh(231)||new te(pc.result,Rb,cb)},Gb.ya,3)})});(()=>{Vd.a.gh(Rb=>{const Gb=W.a.resolve(J.Qf,{va:0}),Cc=W.a.resolve(J.jf,{va:4});void Promise.all([Gb,Cc]).then(cb=>{var [pc,Ic]=cb;cb=Ua.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ConvertDocumentVisibilityObserverService",!1)?W.a.nh(J.Cb):Rb.la.kh(291);var rd=new He(Rb);cb=pc.Vjf(rd,rd,cb,"persisted");rd=new Jf(Rb);rd=pc.Vjf(rd,rd,null,"updatePresence");Rb.la.Hh(292,new $b(Rb,Ic,cb,rd));Yd.a.getInstance(Rb.la).add(new jf(Rb));Yd.a.getInstance(Rb.la).add(cb)})})})();
String(c);String(b);String(xa);String(Oa);String(h);String(r);String(f);String(l);String(m);window.___1710758652209_closurehack=c;window.___1710758652209_closurehack=b;window.___1710758652209_closurehack=xa;window.___1710758652209_closurehack=Oa;window.___1710758652209_closurehack=h;window.___1710758652209_closurehack=r;window.___1710758652209_closurehack=f;window.___1710758652209_closurehack=l;window.___1710758652209_closurehack=m},989:function(A,u,a){a.r(u);a.d(u,"RtcUtils",function(){return r});
A=a(0);var c=a(15),b=a(47),h=a(1016);class r{static Lvd(f,l){l=void 0===l?h.a.m5d:l;let m;try{m=b.c(f)}catch(x){throw f=String.format("Failed to JSON-serialize payload : {0}",x),c.ULS.sendTraceTag(508396173,500,10,f),Error.argument("payload",f);}if(m.length>l)throw f=String.format("Payload exceeds maximum length: {0} > {1}.",m.length,l),c.ULS.sendTraceTag(508396171,500,10,f),Error.argument("payload",f);return m}static deserialize(f,l,m){if(!f)return null;if(Object.getType(f)!==String){var x=String.format("Failed to deserialize [{0}] - object is not of type [String] and is instead of type [{1}]. ExtraInfo: [{2}].",
l,Object.getType(f).getName(),m);c.ULS.sendTraceTag(508396170,500,10,x);return null}x=null;try{x=b.a(f)}catch(n){f=String.format("Failed to deserialize [{0}]. Exception deserializing the object : [{1}]. ExtraInfo: [{2}].",l,n,m),c.ULS.sendTraceTag(508396168,500,10,f)}return x}static Yrb(f){if(!f)return"";if("string"===typeof f)return f.toString();try{return b.c(f)}catch(l){return f.toString()}}static Yti(f){let l,m,x;l=0;x=m=null;if(!f)return{nTf:l,pTf:m,exception:x};try{const n=f.source;n&&Object.getType(n)===
String&&(x=n);const t=f.context;t&&(f=t,l=f.status?f.status:0,m=f.statusText?f.statusText:null)}catch(n){}return{nTf:l,pTf:m,exception:x}}}Object(A.a)(r,"RtcUtils",null,[])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaTS.cl.js.map/5b4aba38c7fe6dded74fdc737ff97048/EwaTS.cl.js.map