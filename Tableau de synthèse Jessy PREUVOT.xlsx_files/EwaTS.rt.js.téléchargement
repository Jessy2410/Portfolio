'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[66],{1567:function(A,u,a){a.r(u);A=a(0);var c=a(42),b=a(1138),h=a(15);class r extends Sys.EventArgs{constructor(){super()}}Object(A.a)(r,"RtcHostNotificationEventArgs",Sys.EventArgs,[]);var f;(function(ea){ea[ea.Dtl=0]="notYetStarted";ea[ea.gul=1]="polling";ea[ea.nvl=2]="subscribed";ea[ea.aNh=3]="blocked";ea[ea.$tl=4]="permanentlyStopped"})(f||(f={}));Object(A.b)("RtcHostNotificationSubscriptionState",f);var l=a(125);
class m extends Sys.EventArgs{constructor(ea,aa,ca,xa){super();this.ree=ea;this.newState=aa;this.r$j=ca;this.s$j=xa}}Object(A.a)(m,"StateChangedEventArgs",Sys.EventArgs,[]);var x=a(113);class n{constructor(ea){this.hh=new x.a;this.SYe=new Date;this.IJe=ea;this.mad=0}get currentState(){return this.IJe}get Puf(){return this.mad}event(ea,aa=null){this.currentState!==ea&&(this.kxi(this.currentState,ea,this.Puf,aa),this.mad=0,this.SYe=new Date);this.IJe=ea;this.mad=this.Puf+1}kxi(ea,aa,ca,xa){ea=new m(ea,
aa,ca,this.SYe,xa);this.hh.raiseEvent("c",ea)}cnc(ea){this.hh.addHandler("c",ea)}VFg(ea){this.hh.removeHandler("c",ea)}}Object(A.a)(n,"StateMachine",null,[295]);var t=a(1078);class w{constructor(ea,aa,ca,xa,Oa,ua,Ia,Sa,Ya){this.mv=!1;this.aGb=this.Vcb=this.A_=this.jta=null;this.poe=()=>{this.jta=null;if(this.M2f){h.ULS.sendTraceTag(573100181,502,50,"HostNotifications: Send event when connected.  Current state: {0}",f[this.pyb]);let da=null;this.wjd&&this.wjd.length&&(da={},da.etts=this.wjd);this.Vcb.$ia(14,
da,!0);this.ULg(this.jsh)}else this.GFa.event(3)};this.B1k=()=>{this.A_=null;2===this.pyb&&(this.GFa.event(1),h.ULS.shipAssertTag(573100185,502,!!this.jta,"Missing task to ensure that we re-subscribe."))};this.T1=()=>{this.T1i()};this.Epa=(da,Ea)=>{if(13===Ea.type&&(da=Ea.Lja,h.ULS.sendTraceTag(573100183,502,50,"HostNotifications: Subscription status: {0}",{["SerializableHostNotificationSubscription"]:da,["DurationBeforeExpirationToResubscribeInSec"]:this.pjc}),Ea=da.cts,!this.R3k(Ea))){if(da.sb){var oa=
2;this.vxk(da.cts)}else oa=1,this.vGb=w.Q6c,this.A_&&(this.vk.Px(this.A_),this.A_=null);this.GFa.event(oa);this.jta?this.vk.zca(this.jta,1E3*Ea):this.ULg(Ea)}};this.L_j=(da,Ea)=>{da=Ea.newState;const oa=Ea.ree,za={};za.NewState=f[da];za.PreviousState=f[oa];za.PreviousStateHits=Ea.r$j;za.PreviousStateTransitionTime=Ea.s$j.toISOString();za.IsSubscribed=this.uba;this.vGb!==w.Q6c&&(za.SubscriptionExpiringTime=this.vGb.toISOString());h.ULS.sendTraceTag(572346515,502,4===da?15:50,"HostNotificationChanged: {0}",
za);this.hh.raiseEvent("HN",new r(oa,da))};this.vGb=w.Q6c;this.hh=new x.a;this.GFa=new n(0);this.GFa.cnc(this.L_j);this.jsh=ea;this.pjc=aa;this.ish=ca;this.wjd=xa;this.vk=Oa;this.kX=ua;Ia.execute(da=>{this.mv||(this.Vcb=da,this.Vcb.Peb(this.Epa),this.start())});Sa.execute(da=>{this.mv||(this.aGb=da,Object(t.a)()?da.Gpd():da.hua(this.T1))});this.TZe=Ya}get pyb(){return this.GFa.currentState}get M2f(){return!this.kX||this.kX.l4f}get uba(){return 2===this.pyb&&this.TZe()<this.vGb}start(){0!==this.pyb?
h.ULS.sendTraceTag(573100178,502,15,"HostNotifications: Tried starting poll when in state {0}",f[this.pyb]):(this.GFa.event(1),this.poe(null))}ULg(ea){this.jta=l.a.FMb(1E3*ea,this.poe,this.pjc,192,"RtcHostNotificationSubscribe");this.vk.jm(this.jta)}vxk(ea){ea=1E3*(ea+this.ish);const aa=this.TZe().getTime()+ea;this.vGb=new Date(aa);ea-=this.pjc;this.A_?this.vk.zca(this.A_,ea):(this.A_=l.a.FMb(ea,this.B1k,this.pjc/2,194,"RtcHostNotificationTransitionToPolling"),this.vk.jm(this.A_))}T1i(){3===this.pyb&&
this.M2f&&(this.GFa.event(this.uba?2:1),this.poe(null))}R3k(ea){if(!isNaN(ea)&&isFinite(ea)&&0<ea)return!1;this.DYg(!1);return!0}DYg(ea){this.jta&&(this.vk.Px(this.jta),this.jta=null);this.A_&&(this.vk.Px(this.A_),this.A_=null);this.Vcb&&(this.Vcb.r5b(this.Epa),this.Vcb=null);this.aGb&&(Object(t.a)()?this.aGb.GFg():this.aGb.qvb(this.T1),this.aGb=null);ea||this.GFa.event(4)}dispose(){this.mv||(this.mv=!0,this.DYg(!0),this.A_&&(this.vk.Px(this.A_),this.A_=null))}}w.Q6c=new Date(0);Object(A.a)(w,"RtcHostNotificationSubscriptionManager",
null,[283,4]);var v=a(6),k=a(282),y=a(604);class C{constructor(){this.FG=this.mv=!1}get name(){return"RtcHostNotificationSubscription"}$n(ea){ea.register(w,"Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").as("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager").yi().Ei(()=>{const aa=v.AFrameworkApplication.fa;return new w(aa.Lj("RtcHostNotificationRetryIntervalIdeallyInSeconds",1800),aa.Lj("RtcHostNotificationRetryIntervalBufferInSeconds",
120),aa.Lj("RtcHostNotificationSubscriptionLostBufferInSeconds",60),this.HVi(aa),v.AFrameworkApplication.Lp,y.SessionStatusManager.instance,Object(b.a)(),c.a.instance.fj("Common.ISessionExpirationManager"),()=>new Date)})}init(){v.AFrameworkApplication.fa.Yx(()=>{!this.mv&&v.AFrameworkApplication.fa.ka("RtcHostNotificationEnabled")&&(this.FG=!0,c.a.instance.resolve("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager"))})}dispose(){this.mv||(this.mv=!0,this.FG&&c.a.instance.resolve("Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").dispose())}HVi(ea){return ea.Nv("RtcEventTypesToSubscribe")?
ea.Ez("RtcEventTypesToSubscribe"):null}static main(){k.a.instance.Do(new C)}}Object(A.a)(C,"RtcHostNotificationSubscriptionPackage",null,[11,12]);var B=a(1189),E=a(710),K=a(1320),F=a(136),W=a(26);class J{constructor(ea,aa){this.q7f=(ca,xa,Oa,ua,Ia)=>{if(!Ia||3===Oa)return 2;if(1===Oa)return this.ieb(this.qcb.Wcf(Ia.upn||Ia.aadObjectId||Ia.smtp));if(!this.kmi(Ia))return 8;switch(Ia.action){case 0:return this.ieb(this.qcb.oxh(Ia));case 1:return this.ieb(this.qcb.nxh(Ia));case 2:return this.ieb(this.qcb.pxh(Ia));
case 3:return this.ieb(this.qcb.Y1j(Ia));case 4:return this.ieb(this.qcb.Yjk(Ia));default:return 2}};this.$f=ea;this.qcb=aa}ho(){this.$f.Uh(W.a.p7f,F.a.frame,this.q7f)}R2c(){this.$f.ZD(W.a.p7f,F.a.frame,this.q7f)}kmi(ea){const aa=ea.upn||ea.aadObjectId||ea.smtp;return ea.targetElement&&(4===ea.action||aa&&""!==aa)?!0:!1}ieb(ea){return ea?32:8}}Object(A.a)(J,"LivePersonaCardActor",null,[]);var L=a(153),M=a(183);class Q{}Object(A.a)(Q,"BootstrapperConfig",null,[]);class H{}Object(A.a)(H,"LivePersonaCardInitializerResult",
null,[]);class ba{}ba.taf=null;Object(A.a)(ba,"LivePersonaCardModule",null,[]);var U=a(653);class D{constructor(ea,aa,ca,xa=null){this.EXj=()=>{const Oa=ba.taf;if(Oa){const ua=this.JFi();try{Oa.initializeLivePersonaCardAsync(ua).then(()=>{this.kt.setResult(Object.assign(new H,{isInitialized:!0,isEnabled:!0}))}).catch(Ia=>{const Sa=Object(L.a)(String,Ia);Sa?this.kt.setException(Error.create(Sa)):this.kt.setException(Error.create(JSON.stringify(Ia)))})}catch(Ia){this.kt.setException(Ia)}}else this.kt.setResult(Object.assign(new H,
{isInitialized:!1,isEnabled:!0,failureMessage:"LivePersonaCardBootstrapper package is not loaded."}))};this.logMessage=(Oa,ua,Ia)=>{Oa=JSON.stringify({["Log Type"]:Oa,["Log Result Type"]:ua,["Message"]:Ia});h.ULS.sendTraceTag(50431106,3006,50,Oa)};this.getAuthToken=(Oa,ua)=>{v.AFrameworkApplication.fa.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.LokiFutureObject")?this.XCb.continueWith(Ia=>{Ia.mo||Ia.Hm?ua("LokiTokenManagerTask is either canceled or faulted.",v.AFrameworkApplication.userSessionId):
this.XCb.result.RMd().then(Sa=>{Sa.isSuccess&&Sa.token&&Sa.token.length?Oa(Sa.token,v.AFrameworkApplication.userSessionId):ua(Sa.errorMessage,v.AFrameworkApplication.userSessionId)}).catch(Sa=>h.ULS.sendTraceTag(539617039,3006,10,"Unexpected exception received from GetLokiToken: {0}",JSON.stringify(Sa)))}):this.iph.RMd().then(Ia=>{Ia.isSuccess&&Ia.token&&Ia.token.length?Oa(Ia.token,v.AFrameworkApplication.userSessionId):ua(Ia.errorMessage,v.AFrameworkApplication.userSessionId)}).catch(Ia=>h.ULS.sendTraceTag(50431107,
3006,10,"Unexpected exception received from GetLokiToken: {0}",JSON.stringify(Ia)))};this.kt=new M.a;this.oqh=ea;this.iph=aa;this.Ga=ca;this.XCb=xa}init(){this.j0f()?this.oqh.byj().continueWith(this.EXj):this.kt.setResult(Object.assign(new H,{isInitialized:!1,isEnabled:!1,failureMessage:"LivePersonaCard is not enabled."}));return this.kt.task}JFi(){const ea=U.a.UU(v.AFrameworkApplication.lcid);return Object.assign(new Q,{culture:ea?ea.name.toLocaleLowerCase():"en-us",clientType:this.Ga.Ya("LivePersonaCardClientType"),
clientContextType:"Generic",clientCorrelationId:v.AFrameworkApplication.userSessionId,complianceEnvironment:this.XHi(),logMessage:this.logMessage,getAuthToken:this.getAuthToken})}j0f(){if(!this.Ga.ka("LivePersonaCardIsEnabled")||!this.xHh())return!1;const ea=this.Ga.Ya("SovereignEnvironmentName");return ea&&""!==ea?ea.toLocaleLowerCase()==="USGov".toLocaleLowerCase()||ea.toLocaleLowerCase()==="Blackforest".toLocaleLowerCase()?!0:!1:!0}xHh(){return this.Ga.ka("CoauthorGalleryLivePersonaCardIsEnabled")||
!!v.AFrameworkApplication.ra&&v.AFrameworkApplication.ra.$g.t8a}XHi(){return this.Ga.Ya("LivePersonaCardComplianceEnvironment")}}Object(A.a)(D,"LivePersonaCardInitializer",null,[]);class I{}Object(A.a)(I,"Behavior",null,[]);class X{}Object(A.a)(X,"Identifiers",null,[]);class Y{}Object(A.a)(Y,"LivePersonaCardParameters",null,[]);class ja{}Object(A.a)(ja,"PersonaInfo",null,[]);class Ua{constructor(ea){this.hnh=ea}Wcf(ea){return this.hnh.j0f()&&ea&&""!==ea?!!window.self.LPC:!1}oxh(ea){return this.sac("addedPersonaToPageV2",
ea,0)}nxh(ea){return this.sac("addedPersonaToPageV2",ea,1)}pxh(ea){return this.sac("addedPersonaToPageV2",ea,2)}Y1j(ea){return this.sac("openCard",ea)}Yjk(ea){return this.sac("removedPersonaFromPage",ea)}rTh(ea){return!!ea.targetElement&&(this.Wcf(ea.upn||ea.aadObjectId||ea.smtp)||4===ea.action)}sac(ea,aa,ca=3){if(!this.rTh(aa))return!1;ca=4!==aa.action?this.p7h(aa,ca):null;const xa=window.self.LPC;if(xa&&xa[ea]){if(ca)xa[ea](aa.targetElement,ca);else xa[ea](aa.targetElement);return!0}return!1}p7h(ea,
aa=3){const ca=Object.assign(new X,{PersonaType:"User",Upn:ea.upn,AadObjectId:ea.aadObjectId,Smtp:ea.smtp});return Object.assign(new Y,{personaInfo:Object.assign(new ja,{identifiers:ca,displayName:ea.name,personaCoinColor:ea.color}),behavior:Object.assign(new I,{cardPlacementMode:"AnchorSideWithBeak",onCardOpen:()=>{h.ULS.sendTraceTag(595067869,3006,100,"LivePersonaCard opened");if(ea.onCardOpen)ea.onCardOpen()},onCardClose:ea.onCardClose,disableClick:2===aa||3===aa,disableHover:0===aa||3===aa}),
clientScenario:ea.clientScenario})}}Object(A.a)(Ua,"LivePersonaCardManager",null,[]);class ka{constructor(ea){this.Fsh=ea}byj(){const ea=v.AFrameworkApplication.vJ("midgardbootstrapper.js",5);return this.Fsh.B2d(ea).continueWith(()=>{ba.taf=window.self.MidgardBootstrapper})}}Object(A.a)(ka,"LivePersonaCardPackageLoader",null,[693]);var fb=a(605);class ha{constructor(){this.Wh=null;this.XK=()=>{let ea;ea=v.AFrameworkApplication.fa.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.LokiFutureObject")?
new D(new ka(Object(K.a)()),null,v.AFrameworkApplication.fa,fb.a.gw(Object(E.a)())):new D(new ka(Object(K.a)()),Object(B.a)(),v.AFrameworkApplication.fa);ea.init().continueWith(aa=>{aa.Hm&&aa.exception?h.ULS.sendTraceTag(50431108,3006,15,"Failed to initialize LivePersonaCard, exception: [{0}]",aa.exception.message):((aa=aa.result)||h.ULS.sendTraceTag(595067868,3006,15,"LivePersonaCardInitializer did not return a result"),aa.isInitialized?h.ULS.sendTraceTag(50431109,3006,100,"Successfully initialized LivePersonaCard"):
h.ULS.sendTraceTag(595067867,3006,aa.isEnabled?15:100,"Failed to initialize LivePersonaCard, failure message: [{0}]",aa.failureMessage))});(new J(v.AFrameworkApplication.yh,new Ua(ea))).ho()}}get name(){return"Common.App.LivePersonaCard"}init(){v.AFrameworkApplication.fa&&v.AFrameworkApplication.fa.Yx(this.XK)}dispose(){}$n(ea){this.Wh=ea}static main(){k.a.instance.Do(new ha)}}Object(A.a)(ha,"LivePersonaCardPackage",null,[11,12]);Type.registerNamespace("Common.App.RtcHostNotificationSubscription");
C.main();Type.registerNamespace("Common.App.LivePersonaCard.Contracts");Type.registerNamespace("Common.App.LivePersonaCard");ha.main();Type.registerNamespace("AppRealtimeChannel")}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaTS.rt.js.map/f6c1ef0d0326f8342076d25cff9b1f0d/EwaTS.rt.js.map