'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[3],{1023:function(A,u,a){a.r(u);a.d(u,"RelativeAndAbsoluteReferencesManager",function(){return K});A=a(0);var c=a(2),b=a(15);class h{}Object(A.a)(h,"Reference",null,[]);class r extends h{constructor(){super();this.column=this.row=null}}Object(A.a)(r,"CellReference",h,[]);class f{constructor(){this.end=this.start=0;this.JA=null}xIh(F,W){for(let J=0;J<this.JA.length;J++){const L=this.coc(F,this.JA[J]);W+=L;J<this.JA.length-
1&&(W+=":")}return W}}Object(A.a)(f,"IReferenceSequence",null,[]);var l=a(27),m=a(1001);class x extends f{constructor(){super();this.NLa=!1}IBc(){const {RelativeAndAbsoluteReferencesManager:F}=a(1023),W=this.JA[0];return F.Seg(W.row.kind===m.a.abs,W.column.kind===m.a.abs)}coc(F,W){W=l.Range.vi(W.row.index+1,W.column.index+1);return this.NLa?W.LAc(1===F||3===F,1===F||2===F):W.Fga(1===F||3===F,1===F||2===F,!0,!0)}}Object(A.a)(x,"CellReferenceSequence",f,[]);class n extends h{constructor(){super();this.secondColumn=
this.firstColumn=null}}Object(A.a)(n,"ColumnReference",h,[]);class t extends f{constructor(){super()}IBc(){const F=this.JA[0];return a(1023).RelativeAndAbsoluteReferencesManager.Ycg(F.firstColumn,F.secondColumn).kind===m.a.abs?2:3}coc(F,W){return l.Range.fY(W.firstColumn.index+1,W.secondColumn.index+1).Fga(1===F||3===F,!0,1===F||3===F,!0)}}Object(A.a)(t,"ColumnReferenceSequence",f,[]);class w extends h{constructor(){super();this.right=this.left=this.bottom=this.top=null}}Object(A.a)(w,"RangeReference",
h,[]);class v extends f{constructor(){super()}IBc(){const {RelativeAndAbsoluteReferencesManager:F}=a(1023),W=this.JA[0];return F.Seg(W.top.kind===m.a.abs,W.left.kind===m.a.abs)}coc(F,W){W=new l.Range(W.top.index+1,W.left.index+1,W.bottom.index+1,W.right.index+1,!1,!1);const J=1===F||3===F;F=1===F||2===F;return W.Fga(J,F,J,F)}}Object(A.a)(v,"RangeReferenceSequence",f,[]);class k extends h{constructor(){super();this.secondRow=this.firstRow=null}}Object(A.a)(k,"RowReference",h,[]);class y extends f{constructor(){super()}IBc(){const F=
this.JA[0];return a(1023).RelativeAndAbsoluteReferencesManager.Ycg(F.firstRow,F.secondRow).kind===m.a.abs?0:1}coc(F,W){return l.Range.QU(W.firstRow.index+1,W.secondRow.index+1).Fga(!0,1===F||2===F,!0,1===F||2===F)}}Object(A.a)(y,"RowReferenceSequence",f,[]);var C=a(1204),B=a(1085),E=a(161);class K{constructor(F){this.Sj=F}vib(F,W,J){let L,M;L=W;M=J;if(!F||!E.f(F))return{returnValue:F,m7d:L,l7d:M};var Q=this.Sj.vGd(F);if(!Q)return b.ULS.sendTraceTag(524039641,0,15,"RelativeAndAbsoluteReferencesManager.CycleThroughRelativeAndAbsoluteReferences: Couldn't extract references (might be invalid formula)"),
{returnValue:null,m7d:L,l7d:M};Q=this.nWi(Q,F,W,J);let H=0,ba="",U=0,D=0;for(;D<Q.length;D++)if(this.irf(Q[D],W,J)){H=Q[D].IBc();L=Q[D].start;break}for(;D<Q.length&&this.irf(Q[D],W,J);D++)ba+=F.substring(U,Q[D].start),ba=Q[D].xIh(H,ba),U=Q[D].end;U&&(M=ba.length);ba+=F.substring(U,F.length);return{returnValue:ba,m7d:L,l7d:M}}nWi(F,W,J,L){const M=[];for(let U=0;U<F.length;U++){var Q=F[U];if(Q.kind===C.a.range)if(Q=Q.ref,Q.type===B.a.cell){var H=Q;Q=Object(c.a)(new x,{start:Q.span.start,end:Q.span.end,
JA:[Object(c.a)(new r,{column:H.col,row:H.row})],NLa:this.Sj.$Wa(Q.span.end,W)});M.push(Q)}else if(Q.type===B.a.range)this.jrf(Q.topLeftSpan,J,L)&&this.jrf(Q.bottomRightSpan,J,L)?(H=new w,Q.top.index<=Q.bottom.index?(H.top=Q.top,H.bottom=Q.bottom):(H.bottom=Q.top,H.top=Q.bottom),Q.left.index<=Q.right.index?(H.left=Q.left,H.right=Q.right):(H.right=Q.left,H.left=Q.right),Q=Object(c.a)(new v,{start:Q.topLeftSpan.start,end:Q.bottomRightSpan.end,JA:[H]}),M.push(Q)):(H=Object(c.a)(new x,{start:Q.topLeftSpan.start,
end:Q.topLeftSpan.end,JA:[Object(c.a)(new r,{column:Q.left,row:Q.top})],NLa:this.Sj.$Wa(Q.topLeftSpan.end,W)}),Q=Object(c.a)(new x,{start:Q.bottomRightSpan.start,end:Q.bottomRightSpan.end,JA:[Object(c.a)(new r,{column:Q.right,row:Q.bottom})],NLa:this.Sj.$Wa(Q.topLeftSpan.end,W)}),M.push(H),M.push(Q));else if(Q.type===B.a.column){H=Q;for(Q=Object(c.a)(new t,{start:Q.span.start,end:Q.span.end,JA:[Object(c.a)(new n,{firstColumn:H.startIndex,secondColumn:H.endIndex})]});Q.end<W.length-1&&":"===W.charAt(Q.end)&&
U<F.length-1;)if(H=F[U+1].ref,H.type===B.a.column&&H.span.start===Q.end+1){var ba=H;Q.JA.push(Object(c.a)(new n,{firstColumn:ba.startIndex,secondColumn:ba.endIndex}));Q.end=H.span.end;U++}else break;M.push(Q)}else if(Q.type===B.a.row){H=Q;for(Q=Object(c.a)(new y,{start:Q.span.start,end:Q.span.end,JA:[Object(c.a)(new k,{firstRow:H.startIndex,secondRow:H.endIndex})]});Q.end<W.length-1&&":"===W.charAt(Q.end)&&U<F.length-1;)if(H=F[U+1].ref,H.type===B.a.row&&H.span.start===Q.end+1)ba=H,Q.JA.push(Object(c.a)(new k,
{firstRow:ba.startIndex,secondRow:ba.endIndex})),Q.end=H.span.end,U++;else break;M.push(Q)}}return M}irf(F,W,J){return!(F.start>J||W>F.end)}jrf(F,W,J){return!(F.start>J||W>F.end)}static Ycg(F,W){return F.index<=W.index?F:W}static Seg(F,W){return W||F?W&&F?2:!W&&F?3:0:1}}Object(A.a)(K,"RelativeAndAbsoluteReferencesManager",null,[766])},1044:function(A,u,a){a.d(u,"h",function(){return l});a.d(u,"g",function(){return x});a.d(u,"f",function(){return n});a.d(u,"b",function(){return t});a.d(u,"c",function(){return w});
a.d(u,"e",function(){return v});a.d(u,"d",function(){return k});a.d(u,"a",function(){return C});A=a(0);var c=a(13),b=a(489),h=a(15),r=a(1384),f=a(28);const l=(K,F,W,J)=>{const L={["flowId"]:K.flowId,["originFormulaFlowId"]:K.lZ.flowId,["formulaAnonymized"]:K.anonymizedFormula,["originalFormulaAnonymized"]:K.lZ.anonymizedFormula,["range"]:K.range,["failureReason"]:F,["isTableSuggestion"]:Object(r.b)(K)};h.ULS.sendTraceTag(221794372,306,20,`FormulaByExample suggestion display failure reported. Failure data ${JSON.stringify(L)}`);
W&&W.Zv(K.flowId,J,{reason:F})};var m;(function(K){K.EXAMPLE="EXAMPLE";K.MODIFIEDEXAMPLE="MODIFIEDEXAMPLE";K.RESTOFRANGE="RESTOFRANGE";K.MODIFIEDRESTOFRANGE="MODIFIEDRESTOFRANGE"})(m||(m={}));Object(A.b)("suggestionCellType",m);const x=(K,F,W,J,L,M,Q,H,ba,U)=>{K={["failureReason"]:K,["flowId"]:M.flowId,["cellType"]:Q,["caller"]:L,["formulaAnonymized"]:M.anonymizedFormula,["originalCellText"]:f.a.L_(F),["evalFormulaText"]:f.a.L_(W),["cellFormatIndex"]:J,["isOriginalValueMatchCellValue"]:H,["isTableSuggestion"]:Object(r.b)(M),
["originalNumFmt"]:ba?{["Start"]:f.a.L_(ba.Start),["Separator"]:f.a.L_(ba.Separator),["End"]:f.a.L_(ba.End)}:null,["evalNumFmt"]:U?{["Start"]:f.a.L_(U.Start),["Separator"]:f.a.L_(U.Separator),["End"]:f.a.L_(U.End)}:null};h.ULS.sendTraceTag(84165388,0,20,`FormulaByExample CloneEval mismatch failure reported. Failure data ${JSON.stringify(K)}`)},n=(K,F,W)=>{try{const J=B(K,F,W);window.performance.mark(J)}catch(J){h.ULS.sendTraceTag(529109767,0,10,`FormulaByExampleTelemetryGenerator.markPerformancePoint: Error thrown : ${J.message}`)}},
t=K=>{for(const F in y)try{window.performance.clearMarks(B(F,K,!1)),window.performance.clearMarks(B(F,K,!0))}catch(W){h.ULS.sendTraceTag(527005662,0,10,`FormulaByExampleTelemetryGenerator.clearPerformanceFlowMarks: Error thrown : ${W.message}`)}},w=K=>E(`FBE_flowCurrentDuration_${K}`,B(y.EditCommit,K,!1)),v=(K,F)=>{try{return{["EditCommitToSignal"]:E(`FBE_EditCommitToSignal_${F}_${K}`,B(y.EditCommit,F,!1),B(y.SignalSent,F,!1)),["WorkflowAndNetworkTime"]:K?0:E(`FBE_WorkflowAndNetworkTime_${F}_${K}`,
B(y.SignalSent,F,!1),B(y.AnnotationReceived,F,!1)),["Calculation"]:E(`FBE_Calculation_${F}_${K}`,B(y.CalculationStart,F,K),B(y.CalculationEnd,F,K)),["ModelUpdate"]:E(`FBE_ModelUpdate_${F}_${K}`,B(y.CalculationEnd,F,K),B(y.ModelUpdated,F,K)),["PreviewRender"]:E(`FBE_PreviewRendered_${F}_${K}`,B(y.ModelUpdated,F,K),B(y.PreviewRendered,F,K)),["Total"]:E(`FBE_Total_${F}_${K}`,B(y.EditCommit,F,!1),B(y.PreviewRendered,F,K))}}catch(W){h.ULS.sendTraceTag(529109766,0,50,`FormulaByExampleTelemetryGenerator.getPreviewShownDurations: Error thrown : ${W.message}`)}},
k=(K,F)=>{try{return{["UserInPreviewDuration"]:E(`FBE_InputToPreviewRemovedWithCSE_${F}_${K}`,B(y.PreviewRendered,F,K),B(y.UserInputArrived,F,K)),["InputToPreviewRemovedWithCSE"]:E(`FBE_InputToPreviewRemovedWithCSE_${F}_${K}`,B(y.UserInputArrived,F,K),B(y.PreviewRemovedWithCSE,F,K))}}catch(W){h.ULS.sendTraceTag(529109765,0,10,`FormulaByExampleTelemetryGenerator.getPreviewRemovedDurations: Error thrown : ${W.message}`)}};var y;(function(K){K.EditCommit="EDITCOMMIT";K.SignalSent="SIGNALSENT";K.AnnotationReceived=
"ANNOTATIONRECEIVED";K.CalculationStart="CALCULATIONSTART";K.CalculationEnd="CALCULATIONED";K.ModelUpdated="MODELUPDATED";K.PreviewRendered="PREVIEWRENDERED";K.UserInputArrived="USERINPUTARRIVED";K.PreviewRemovedWithCSE="PREVIEWREMOVEDWITHCSE"})(y||(y={}));Object(A.b)("FormulaByExampleFlowMarks",y);const C=K=>c.HelperMethods.Htd&&b.a.xWa&&K.CLa(),B=(K,F,W)=>`${K}_${F+(W?"_cached":"")}`,E=(K,F,W)=>{const J=window.performance.measure(K,F,W);if(J)return F=J.duration,performance.clearMeasures(K),F;h.ULS.sendTraceTag(526984791,
0,15,`FormulaByExampleTelemetryGenerator.measureTime: could not find performance entry for measure: ${K}, startMark: ${F}, endMark: ${W}`);return-1}},1069:function(A,u,a){a.d(u,"b",function(){return-1});a.d(u,"a",function(){return E});A=a(0);var c=a(15),b;(function(J){J[J.UserEditedInTable=0]="UserEditedInTable";J[J.FormulaByExampleNoTrigger=1]="FormulaByExampleNoTrigger";J[J.FlowInterrupted=2]="FlowInterrupted";J[J.FormulaByExampleFullTrigger=3]="FormulaByExampleFullTrigger";J[J.HadCachedSuggestion=
4]="HadCachedSuggestion";J[J.NoCachedSuggestion=5]="NoCachedSuggestion";J[J.PreCalcPreviewRejected=6]="PreCalcPreviewRejected";J[J.WaitingForCalcResult=7]="WaitingForCalcResult";J[J.PostCalcPreviewRejected=8]="PostCalcPreviewRejected";J[J.SuggestionDidntMatch=9]="SuggestionDidntMatch";J[J.SuggestionMatched=10]="SuggestionMatched";J[J.PreviewShouldBeShown=11]="PreviewShouldBeShown";J[J.SignalSent=12]="SignalSent";J[J.NoSignalSent=13]="NoSignalSent";J[J.AnnotationReceived=14]="AnnotationReceived";J[J.NoFormulaFound=
15]="NoFormulaFound";J[J.FormulaFound=16]="FormulaFound";J[J.WorkbookClosed=17]="WorkbookClosed";J[J.UnexpectedTransition=18]="UnexpectedTransition"})(b||(b={}));Object(A.b)("FormulaByExampleFlowState",b);const h=new Map([[b.UserEditedInTable,[b.FormulaByExampleNoTrigger,b.FormulaByExampleFullTrigger]],[b.FormulaByExampleFullTrigger,[b.FlowInterrupted,b.NoCachedSuggestion,b.HadCachedSuggestion]],[b.NoCachedSuggestion,[b.NoSignalSent,b.SignalSent]],[b.HadCachedSuggestion,[b.PreCalcPreviewRejected,
b.WaitingForCalcResult]],[b.PreCalcPreviewRejected,[b.NoSignalSent,b.SignalSent]],[b.WaitingForCalcResult,[b.NoSignalSent,b.SignalSent]]]),r=new Set([b.FormulaByExampleNoTrigger,b.FlowInterrupted,b.NoSignalSent,b.SignalSent]),f=new Map([[b.PreCalcPreviewRejected,[b.SuggestionDidntMatch,b.SuggestionMatched]]]),l=new Set([b.SuggestionDidntMatch,b.SuggestionMatched]),m=new Map([[b.WaitingForCalcResult,[b.PostCalcPreviewRejected,b.SuggestionDidntMatch,b.SuggestionMatched]],[b.SuggestionDidntMatch,[b.PostCalcPreviewRejected,
b.PreviewShouldBeShown]],[b.SuggestionMatched,[b.PostCalcPreviewRejected,b.PreviewShouldBeShown]]]),x=new Set([b.PostCalcPreviewRejected,b.PreviewShouldBeShown]),n=new Map([[b.SignalSent,[b.AnnotationReceived]],[b.AnnotationReceived,[b.NoFormulaFound,b.FormulaFound]],[b.FormulaFound,[b.PreCalcPreviewRejected,b.WaitingForCalcResult]]]),t=new Set([b.NoFormulaFound,b.FormulaFound]),w=new Set([b.NoFormulaFound,b.PreCalcPreviewRejected,b.WaitingForCalcResult]);var v;(function(J){J[J.Initial=0]="Initial";
J[J.Pending=1]="Pending";J[J.Resolved=2]="Resolved"})(v||(v={}));Object(A.b)("SignalState",v);var k=a(1);class y{constructor(J,L,M){this.currentState=J;this.mVk=L;this.cwi=M}LIa(J){const L=this.mVk.get(this.currentState);return L&&L.includes(J)?(this.currentState=J,!0):!1}get isActive(){return!this.cwi.has(this.currentState)}NOd(){return b[this.currentState]}}Object(A.a)(y,"FormulaByExampleStateMachine",null,[]);class C{constructor(J,L,M,Q,H,ba){this.nSj=ba;this.hRc=new y(0,h,r);this.kga={flowId:J,
sZh:L,rowNumber:M,ZZ:Q,YNc:null,TAf:!1,Qoe:!1,N8a:0,jV:H,UAf:{},Tdf:new Set}}get N8a(){return this.kga.N8a}set flowId(J){this.kga.flowId=J}MOc(J){this.kga.Tdf.add(J)}LIa(J,L){17===J?this.zla():(this.Qwc(J,L),this.xGh())}zla(){this.nSj(this.kga)}Qwc(J,L){var M,Q;this.hRc.LIa(J)?this.CXj(J):(null===(M=this.Bgb)||void 0===M?0:M.LIa(J))?this.jOj(J):(null===(Q=this.w_c)||void 0===Q?0:Q.LIa(J))?this.v_j(J,L):this.EVj(J,L);(J=this.YIf(J))&&this.H2e(J,L)}CXj(J){switch(J){case 2:this.kga.TAf=!0;break;case 6:this.Bgb=
new y(J,f,l);break;case 7:this.Bgb=new y(J,m,x);break;case 12:this.kga.N8a=1,this.w_c=new y(J,n,k.EwaSettings.isChangeGateEnabled("OfficeVSO:6169955_ShowFormulaByExampleSuggestionsUponArrivalFromServer")?w:t)}}jOj(J){switch(J){case 9:this.kga.Qoe=!1;break;case 10:this.kga.Qoe=!0}}v_j(J,L){switch(J){case 14:this.kga.N8a=2;break;case 16:this.kga.YNc=L?L.YNc:null;break;case 7:this.Bgb=new y(J,m,x)}}EVj(J,L){this.H2e(this.YIf(18),{reason:`${`Tried to change state from ${this.eBk()} to ${b[J]}`}.${this.OKf(L)}`});
this.zla()}xGh(){var J,L;this.hRc.isActive||(null===(J=this.Bgb)||void 0===J?0:J.isActive)||(null===(L=this.w_c)||void 0===L?0:L.isActive)||this.zla()}H2e(J,L){if(L=this.OKf(L))J.explanation||(J.explanation=""),J.explanation+=L;L=Object.assign({},J);J=J.name;L=(delete L.name,L);this.kga.UAf[J]=L}OKf(J){return null!=J&&null!=J.reason?" "+J.reason:""}eBk(){var J,L;const M=`OriginStateMachine: ${this.hRc.isActive?this.hRc.NOd():"NotActive"}`,Q=`CalcStateMachine: ${(null===(J=this.Bgb)||void 0===J?0:
J.isActive)?this.Bgb.NOd():"NotActive"}`;J=`SignalStateMachine: ${(null===(L=this.w_c)||void 0===L?0:L.isActive)?this.w_c.NOd():"NotActive"}`;return`[${M}, ${Q}, ${J}]`}YIf(J){switch(J){case 1:return this.K4("FBEFullTrigger",!1);case 3:return this.K4("FBEFullTrigger",!0);case 5:return this.K4("CachedSuggestion",!1);case 4:return this.K4("CachedSuggestion",!0);case 6:return this.K4("PreviewShouldBeShown",!1,"Before calling calc evaluation");case 8:return this.K4("PreviewShouldBeShown",!1,"After returning from Calc");
case 9:return this.K4("SetCellMatchedSuggestion",!1);case 10:return this.K4("SetCellMatchedSuggestion",!0);case 11:return this.K4("PreviewShouldBeShown",!0);case 8:return this.K4("PreviewShouldBeShown",!1,"After returning from Calc");case 15:return this.K4("FormulaFound",!1);case 16:return this.K4("FormulaFound",!0);case 18:return this.K4("UnexpectedTransition",!0)}return null}K4(J,L,M){return M?{name:J,value:L,explanation:M}:{name:J,value:L}}}Object(A.a)(C,"FormulaByExampleFlowDataAggregator",null,
[]);var B=a(960);class E{static getInstance(J){this.instance||(k.EwaSettings.isChangeGateEnabled("OfficeVSO:7041480_FormulaByExampleFlowAggregatorFixed")?this.instance=K.getInstance(J):this.instance=W.getInstance(J));return this.instance}}Object(A.a)(E,"FormulaByExampleFlowsTrackerFactory",null,[]);class K{constructor(J){this.nextId=1;this.fWf=this.hac=0;this.z5=new Map;this.jwe=new Map;this.$gf=new Map;this.ej=()=>{const L=this.ySi();if(0!==L.size){this.Jh.sendBeaconTraceTag(526984790,50,!1,`some pending FBE flows were not resolved by workbook closure. Total flows amount in sessions: ${this.hac}, Unresolved flows amount: ${L.size}, pending flows: ${[...L].join()}, interrupted flows amount ${this.fWf}`);
for(const M of L)this.Zv(M,17)}};this.UWk=L=>{const M=L.flowId;var Q=L.sZh;const H=L.rowNumber,ba=L.ZZ,U=L.YNc,D=L.TAf,I=L.Qoe,X=L.N8a,Y=L.UAf,ja=L.Tdf,Ua=L.jV,ka=this.TJf(Q);L=ka.iza;const fb=L!==U;fb&&(ka.AZg++,ka.iza=U);I&&ka.lsf++;D&&this.fWf++;2===X&&this.hac++;Q={["flowId"]:M,["columnKey"]:Q,["rowNumber"]:H,["triggerCommand"]:B.a.NKd(ba),["flowDataAggergation"]:Y,["editOperationsInColumn"]:ka.csf,["suggestionChangesInColumn"]:ka.AZg,["gotNewSuggestion"]:fb,["matchedSuggestionsInColumn"]:ka.lsf,
["cellCycleColumns"]:Array.from(ja).sort(),["rowsEditedInColumn"]:Array.from(ka.isf).sort(),["isInExplicitTable"]:Ua};c.ULS.sendTraceTag(512365781,0,null!=L||null!=U?20:50,`FormulaByExampleFlowsTracker.summarizeFlowOverallData: Flow Aggregation results: ${JSON.stringify(Q)}`);this.z5.set(M,void 0)};this.Jh=J;J.gq(this.ej);this.roe=new F}static getInstance(J){K.instance||(K.instance=new K(J));return K.instance}pJf(){const J=this.nextId++,L=this.z5.get(-1);L?(L.flowId=J,this.z5.set(J,L),this.z5.delete(-1)):
c.ULS.sendTraceTag(512503829,0,15,`FormulaByExampleFlowsTracker.getNewFlowId: on flowId ${J} called getNewFlowId without having matched anonymousFlow`);return J}GZf(J){const L=this.z5.has(J),M=this.z5.get(J),Q=M&&1===M.N8a;let H;L?M?Q||(H="The flow exists but is not pending for annotation"):H="Flow was resolved already":H="This flow does not exist";H&&c.ULS.sendTraceTag(509650145,306,50,`FormulaByExampleManager.formulaByExampleAnnotationHandler: flow is not pending for annotation. ${H} flowId: ${J}`);
return Q}tqg(J,L,M,Q){this.z5.get(-1)&&(this.Zv(-1,2),this.z5.delete(-1));const H=this.TJf(J);H.csf++;H.isf.add(L);this.z5.set(-1,new C(-1,J,L,Q,M,this.UWk))}Ljg(J,L,M,Q){L=this.Nzc(L,M);this.tqg(L,Q,!0,J)}Mjg(J,L,M,Q,H){L=this.YQb(L,M,H);this.tqg(L,Q,!1,J)}MOc(J,L){const M=this.z5.get(J);M?M.MOc(L):this.hHg("onCellCycleFound",J)}Zv(J,L,M){const Q=this.z5.get(J);Q?Q.LIa(L,M):this.hHg("notifyFlowReachedState",J,L)}Nzc(J,L){let M=this.jwe.get(J);void 0===M&&(M=this.jwe.size,this.jwe.set(J,M));return M+
"_"+L}YQb(J,L,M){return this.SDf(J,M,L)}TDf(J,L){return this.SDf(J,L)}SDf(J,L,M){let Q;const H=this.roe.pYi(L);H?H.find((ba,U)=>{Q=U;return ba.Xi(J)})||(this.roe.h3e(L,J),Q=H.length-1):(Q=0,this.roe.h3e(L,J));return`${L}_${Q}${M?`_${M}`:""}`}ySi(){const J=new Set;for(const L of this.z5){const [M,Q]=L;1===(null===Q||void 0===Q?void 0:Q.N8a)&&J.add(M)}return J}TJf(J){let L=this.$gf.get(J);L||(L={csf:0,lsf:0,AZg:0,iza:null,isf:new Set},this.$gf.set(J,L));return L}hHg(J,L,M){const Q=this.z5.has(L);c.ULS.sendTraceTag(509678805,
0,15,`FormulaByExampleFlowsTracker.${J}:
       on flowId ${L} ${M?` transition to ${b[M]}`:""}, `+"flowIdsToAggregatorsMap didn't find the requested flowAggregatoror. "+`Did flow exist: ${Q}`)}}Object(A.a)(K,"FormulaByExampleFlowsTracker",null,[762]);class F{constructor(){this.h1c=new Map}h3e(J,L){this.h1c.has(J)||this.h1c.set(J,[]);this.h1c.get(J).push(L)}pYi(J){return this.h1c.get(J)}}Object(A.a)(F,"SensedTablesHeatMap",null,[]);class W{constructor(J){this.nextId=1;this.jQb=new Set;this.hac=0;this.ej=()=>{const L=this.jQb.size;0!==L&&
this.Jh.sendBeaconTraceTag(526984790,50,!1,"some pending FBE flows were not resolved by workbook closure. Total flows amount in sessions: {0}, Unresolved flows amount: {1}, pending flows: {2}",this.hac,L,[...this.jQb].join())};this.Jh=J;this.Jh.gq(this.ej)}static getInstance(J){W.instance||(W.instance=new W(J));return W.instance}GZf(J){return this.jQb.has(J)}Ljg(){}Mjg(){}MOc(){}Nzc(){return null}YQb(){return null}TDf(){return null}Zv(J,L){switch(L){case 12:this.ODk(J);break;case 14:this.PDk(J)}}pJf(){return this.nextId++}ODk(J){this.jQb.add(J);
this.hac++}PDk(J){this.jQb.delete(J)}}Object(A.a)(W,"FormulaByExampleFlowsTrackerDeprecated",null,[762])},1106:function(A,u,a){a.d(u,"b",function(){return"<<<FBE_XL_RW>>>"});a.d(u,"a",function(){return c});A=a(0);a=a(1245);class c extends a.a{constructor(b,h,r,f){super(b,h,r,f);this.kind="Range";this.tEa=f.headerRow;this.zx=f.zx;this.XWb=f.XM}get formula(){const b=super.formula;return b?b.replace(RegExp("<<<FBE_XL_RW>>>","g"),`${this.originCell.top}`):null}get SId(){return super.formula}get XWb(){return this.Unh}set XWb(b){this.Unh=
b}get zx(){return this.Zth}set zx(b){this.Zth=b}get headerRow(){return this.tEa}}Object(A.a)(c,"FormulaByExampleRangeSuggestion",a.a,[])},1107:function(A,u,a){a.d(u,"a",function(){return 2})},1178:function(A,u,a){a.d(u,"b",function(){return h});a.d(u,"c",function(){return f});a.d(u,"a",function(){return l});A=a(0);var c;(function(m){m.accept="ACCEPT";m.undo="UNDO";m.decline="DECLINE";m.ignore="IGNORE";m.unseen="UNSEEN"})(c||(c={}));Object(A.b)("PreviewOutcome",c);var b;(b||(b={})).unseen="UNSEEN";
Object(A.b)("EntryState",b);const h=Object.assign({},b,c);class r{constructor(m){this.state=h.unseen;this.hT=0;this.suggestion=m}w$i(){this.hT+=1}}Object(A.a)(r,"SuggestionEntryInternal",null,[]);class f extends Map{Yea(m){const x=this.iKa(m);if(!x)return null;let n=this.get(x);n||(n=[],this.set(x,n));m=new r(m);n.push(m);return m}Iib(m){m=this.eSb(m);return this.xdi(m)}xdi(m){if(m){var x=this.iKa(m.suggestion);x=this.get(x);x.splice(x.indexOf(m));return!0}return!1}q6g(m){const x=this.eSb(m);return this.CAe(x,
m)}CAe(m,x){m&&(m.suggestion=x);return m}}Object(A.a)(f,"SuggestionsCache",Map,[]);class l extends f{WKi(m){var x;return null===(x=super.get(m))||void 0===x?void 0:x[0]}eSb(m){return(m=this.iKa(m))?this.has(m)?this.get(m)[0]:null:null}Yea(m){const x=this.iKa(m);if(!x)return null;m=new r(m);this.set(x,[m]);return m}Iib(m){return(m=this.iKa(m))?this.delete(m):!1}}Object(A.a)(l,"SingularSuggestionsCache",f,[])},1245:function(A,u,a){a.d(u,"a",function(){return h});A=a(0);u=a(1246);var c=a(15),b=a(27);
class h extends u.a{constructor(r,f,l,m){super();this.fbd=null;this.TTe=!1;Object.assign(this,f);this.Jh=r;this.jMe=l;m&&(this.Kcb=m.gRc,this.ikh=m.valueType,this.jkd=m.sheetId,this.TTe=m.Imj);this.lZ={flowId:this.flowId,vE:this.vE,originCell:this.originCell,anonymizedFormula:this.anonymizedFormula}}set Tzi(r){this.fbd=r}set flowId(r){this.jMe=r}get flowId(){return this.jMe}get formula(){var r;if(this.fbd)return this.fbd;void 0===this.qEa&&(this.qEa=null===(r=this.generatedFormula)||void 0===r?void 0:
r.formula)&&"="!==this.qEa.charAt(0)&&(c.ULS.sendTraceTag(509620492,306,50,"FormulaByExampleSuggestion.formula: appending = sign as formula prefix."),this.qEa=`=${this.qEa}`);return this.qEa}set vE(r){this.nad=r}get RFd(){return this.rows}get Hci(){return this.ikh}get anonymizedFormula(){var r;void 0===this.Dfc&&(this.Dfc=null===(r=this.generatedFormula)||void 0===r?void 0:r.anonymizedFormula);return this.Dfc}get sheetId(){return this.jkd}get vE(){void 0===this.nad&&(this.nad=this.RFd.length);return this.nad}set originCell(r){this.Kcb=
r}get originCell(){void 0===this.Kcb&&(c.ULS.sendTraceTag(509620491,306,10,`FormulaByExampleSuggestion.originCell: origin cell is not defined - falling back to first cell of annotation range. flowId: ${this.flowId}`),this.Kcb=b.Range.vi(this.RFd[0],this.column));return this.Kcb}get range(){return new b.Range(this.zx.top,this.Kcb.left,this.zx.bottom,this.Kcb.left,!0,!0)}get YWj(){return this.TTe}hZf(r){return r.Xi(this.range)&&this.RFd.includes(r.top)}}Object(A.a)(h,"FormulaByExampleSuggestionBase",
u.a,[769])},1246:function(A,u,a){a.d(u,"a",function(){return b});A=a(0);u=a(938);var c=a(913);class b extends u.a{constructor(){super();this.rows=null;this.column=0;this.generatedFormula=this.formulas=null;this.resultKind=this.invocationMethod=this.stateID=0;this.errorMessage=this.guid=null;this.H_=Object.assign(new c.a,{T_:b.getTypeName(),B_:b.getBaseTypes()})}static getTypeName(){return"AugLoop_FormulaByExample_FormulaByExampleAnnotation"}static getBaseTypes(){return["AugLoop_Core_Annotation"]}}
Object(A.a)(b,"FormulaByExampleAnnotation",u.a,[])},1247:function(A,u,a){a.d(u,"a",function(){return c});const c=b=>excelOnlineCalc.util.isSuccess(b)},1384:function(A,u,a){a.d(u,"b",function(){return w});a.d(u,"a",function(){return k});A=a(0);var c=a(392);u=a(1178);var b=a(15);class h{constructor(y){this.rH=y;this.Upc=new Map}Yea(y){return this.$Ri(y.sheetId).Yea(y)}wBc(y){const C=this.Upc.get(y.sheetId);return C?C.wBc(y.range):null}pdi(y){const C=this.Upc.get(y.sheetId);return C?C.Iib(y):!1}$Ri(y){let C=
this.Upc.get(y);C||(C=new r(this.rH),this.Upc.set(y,C));return C}}Object(A.a)(h,"FormulaByExampleRangeSuggestionsCache",null,[]);class r extends u.c{constructor(y){super();this.rH=y}Yea(y){const C=this.q6g(y);if(C)return C;this.Iib(y);this.rH.QZ(y.originCell,3);return super.Yea(y)}eSb(y){return this.wBc(y.range)}wBc(y){var C;b.ULS.shipAssertTag(509383498,306,y.o1,"FormulaByExampleRangeSuggestionsCache.getIntersectingSuggestion: lookup range must be of single column width.");return null===(C=this.get(y.left))||
void 0===C?void 0:C.find(B=>B.suggestion.range.Xi(y))}iKa(y){return y.range.left}q6g(y){const C=this.eSb(y);return C&&C.suggestion.SId===y.SId?this.CAe(C,y):null}}Object(A.a)(r,"ColumnBasedRangeSuggestionsCache",u.c,[]);var f=a(1);const l=(y,C,B)=>{var E,K;if(f.EwaSettings.isChangeGateEnabled("OfficeVSO:8180963_FBEFixColumnHeadersMetadata")){if((B=null===(E=y.E8)||void 0===E?void 0:E.HeadersList)&&0<B.length&&(B=B.find(W=>W.Index===C-1)))return y.name+"_"+B.Name;b.ULS.sendTraceTag(537161876,306,20,
`FormulaByExampleSuggestionCache.getUniqueTableColumnIdentifier: invalid inputs. tableRange: ${y.usedRange}, columnNumber: ${C}, `+`areAllTableHeadersAvailable: ${null===(K=y.E8)||void 0===K?void 0:K.IsFullTableHeaders}`);return null}K=B.O_a(y);if(!K)return null;E=y.usedRange;const F=C-E.left;return 0>F||F>=K.length?(b.ULS.sendTraceTag(537161876,306,20,`FormulaByExampleSuggestionCache.getUniqueTableColumnIdentifier: invalid inputs. tableRange: ${E}, columnNumber: ${C}, `+`areAllTableHeadersAvailable: ${B.hJh(y,
K)}`),null):(B=K[F])?y.name+"_"+B:null};class m extends u.a{constructor(y,C){super();this.Jh=y;this.rH=C}Yea(y){var C;let B=!1;const E=super.eSb(y);if(!E||(B=E.suggestion.formula!==y.formula))return B&&b.ULS.sendTraceTag(523842004,306,20,`FormulaByExampleSuggestionsCache.cacheSuggestion: formula changed from last cache entry, overriding cache entry.
           Last example count: ${E.suggestion.vE}, current: ${y.vE}, oldFormula: ${E.suggestion.anonymizedFormula}, newFormula:${y.anonymizedFormula}`),b.ULS.sendTraceTag(537161877,306,20,`FormulaByExampleSuggestionsCache.cacheSuggestion: saving suggestion for table range. tableRange: ${null===(C=y.table)||void 0===C?void 0:C.usedRange}, columnNumber: ${y.column}, examplesCount ${y.vE}, hasPreviousSuggestion: ${this.has(this.iKa(y))}`),(C=super.Yea(y))||b.ULS.sendTraceTag(528889932,306,15,"SuggestionsCache.cacheSuggestion: failed to cache table suggestion due to getTableColumnKey failure."),
this.rH.QZ(y.originCell,3),C;E.suggestion.vE!==y.vE&&(b.ULS.sendTraceTag(523842003,306,50,`FormulaByExampleSuggestionsCache.cacheSuggestion: formula didn't change from the last cache entry, but number of examples changed. Last example ${E.suggestion.vE}, current: ${y.vE}`),this.rH.QZ(y.originCell,4),y.lZ.vE=E.suggestion.lZ.vE);E.suggestion.vE!==y.vE&&(b.ULS.sendTraceTag(523842003,306,50,`FormulaByExampleSuggestionsCache.cacheSuggestion: formula didn't change from the last cache entry, but number of examples changed. Last example ${E.suggestion.vE}, current: ${y.vE}`),
this.rH.QZ(y.originCell,4),y.lZ.vE=E.suggestion.lZ.vE);return this.CAe(E,y)}hYi(y,C){y=l(y,C,this.Jh);return y?this.WKi(y):(b.ULS.sendTraceTag(528889931,306,15,"FormulaByExampleSuggestionsCache.getTableCachedSuggestion: failed to get cached table suggestion due to getTableColumnKey failure."),null)}iKa(y){return l(y.table,y.column,this.Jh)}}Object(A.a)(m,"FormulaByExampleTableSuggestionsCache",u.a,[]);class x extends Sys.EventArgs{constructor(y){super();this.suggestion=y}}Object(A.a)(x,"FormulaByExampleFormulaRejectedEventArgs",
Sys.EventArgs,[]);u=a(40);var n=a(27),t=a(39);const w=y=>"Table"===y.kind;class v extends Map{}Object(A.a)(v,"ForbiddenFormulasMap",Map,[]);class k extends u.a{constructor(y,C,B){super();this.Jh=y;this.rH=C;this.ap=B;this.Bce=!1;this.$5j="formulaByExamplePersistentCache";this.a6j="formulaByExamplePersistentSuggestionsCache";this.ezi="forbiddenFormulas";this.Bui=1;this.Wfe=new h(C);this.j1c=new m(this.Jh,C);f.EwaSettings.isChangeGateEnabled("OfficeVSO:7654591_FormulaByExampleForbiddenFormulas")&&(this.rJa=
new Map,this.RSd=new Map,this.Bce=f.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FBEPersistentCache",!1)&&this.Jh.xjj())&&(this.F$g=this.Jh.W_i(),void this.Gaj());this.tlj=f.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleForbidFormulaForTable",!1)}sBh(y){this.addHandler("fbefr",y)}RZi(y,C){let B;const E=y.gRc;var K=y.zx;if(y.jV){y=this.Jh.Kl(E,!1);if(!y)return b.ULS.sendTraceTag(509649310,306,50,`FormulaByExampleManager.onUserInput: getTableContainingRange returned null. flowId: ${C}, editedCellRange: ${E}`),
null;if(K=this.j1c.hYi(y,E.left))K.suggestion.table=y,B=K}else if(C=new n.Range(K.top,E.left,K.bottom,E.right,!0,!0),C=this.Wfe.wBc(new c.a(C,y.sheetId)))C.suggestion.zx=K,C.suggestion.XWb=y.XM,B=C;return B}Yea(y){return"Table"===y.kind?this.j1c.Yea(y):this.Wfe.Yea(y)}Iib(y){return"Table"===y.kind?this.j1c.Iib(y):this.Wfe.pdi(y)}$Qg(y,C,B){B=void 0===B?!1:B;y.state=C;y.w$i();f.EwaSettings.isChangeGateEnabled("OfficeVSO:7654591_FormulaByExampleForbiddenFormulas")&&this.U0h(y,B)}Clj(y){const C=this.XLd(y);
return this.rJa.has(C)?this.rJa.get(C).has(this.eHf(y)):!1}get bEe(){return Date.now()}eHf(y){return f.EwaSettings.isChangeGateEnabled("OfficeVSO:8666058_FormulaByExampleForbidByAnonymizedFormula")?y.anonymizedFormula:y.formula}Gaj(){const y=this;return Lo(function*(){y.Mkl=new Promise(C=>{y.oyj=C});y.zdi();y.Jh.Rbj(y.a6j,y.ezi,y.Bui);yield y.kyj();y.oyj();y.XAf()})}zdi(){const y=this.Jh.deleteDatabase(this.$5j);t.TaskExtensions.Xa(y,C=>{C.result?b.ULS.sendTraceTag(507872217,306,50,"FormulaByExampleSuggestionCache.deleteV1Database: successfully deleted old database."):
b.ULS.sendTraceTag(507872216,306,15,"FormulaByExampleSuggestionCache.deleteV1Database: call to delete old database had failed.")},this.Jh.ya)}kyj(){const y=this;return Lo(function*(){let C,B;const E=new Promise(K=>{B=K});try{C=y.Jh.LMi(y.F$g)}catch(K){b.ULS.sendTraceTag(508065931,306,50,`FormulaByExampleSuggestionCache.loadSavedCacheState: failed to get forbidden formulas from indexedDB. error: ${K}`)}if(C)return t.TaskExtensions.Xa(C,K=>{K=K.result;try{const F=JSON.parse(K);for(const W of F){const J=
new v;for(const L of W.fzi)12096E5<y.bEe-L.forbiddingDateTime||J.set(L.formula,L.forbiddingDateTime);y.rJa.set(W.target,J)}F&&0<F.length&&b.ULS.sendTraceTag(508065929,306,20,`FormulaByExampleSuggestionCache.loadSavedCacheState: successfully non-empty loaded forbidden formulas save state from indexedDB. forbiddenFormulasByTarget size: ${y.rJa.size}`)}catch(F){b.ULS.sendTraceTag(508065928,306,50,`FormulaByExampleSuggestionCache.loadSavedCacheState: failed to parse forbidden formulas from indexedDB. error: ${F}`)}finally{B()}},
y.Jh.ya),E;b.ULS.sendTraceTag(508065930,306,50,"FormulaByExampleSuggestionCache.loadSavedCacheState: getSavedStateTask is undefined.");B()})}U0h(y,C){switch(y.state){case "DECLINE":case "UNDO":this.vId(y.suggestion);break;case "IGNORE":C=this.XLd(y.suggestion);if(!this.RSd.has(C)){this.RSd.set(C,new Set([y.suggestion.formula]));break}C=this.RSd.get(C);C.has(y.suggestion.formula)?this.vId(y.suggestion):C.add(y.suggestion.formula);break;case "ACCEPT":C&&this.vId(y.suggestion)}}vId(y){let C;const B=
this.XLd(y);this.rJa.has(B)||(C=new v,this.rJa.set(B,C));C=this.rJa.get(B);C.set(this.eHf(y),this.bEe);this.raiseEvent("fbefr",new x(y));this.Bce&&this.XAf()}XAf(){const y=[];for(const C of this.rJa){const [B,E]=C;y.push({["target"]:B,fzi:Array.from(E.entries(),K=>{var [F,W]=K;return{["formula"]:F,["forbiddingDateTime"]:W}})})}try{this.Jh.Iwk({key:this.F$g,value:JSON.stringify(y)}),b.ULS.sendTraceTag(508065927,306,50,"FormulaByExampleSuggestionCache.flushForbiddenFormulasToIndexedDB: successfully flushed forbidden formulas to indexedDB.")}catch(C){b.ULS.sendTraceTag(508065926,
306,50,`FormulaByExampleSuggestionCache.flushForbiddenFormulasToIndexedDB: failed to flush forbidden formulas to indexedDB. error: ${C}`)}}XLd(y){return this.tlj?"Table"===y.kind?y.table.name:this.ap.TDf(y.zx,y.sheetId):this.iYi(y)}iYi(y){return"Table"===y.kind?this.j1c.iKa(y):this.ap.YQb(y.zx,y.zx.left-y.originCell.left,y.sheetId)}}Object(A.a)(k,"FormulaByExampleSuggestionCache",u.a,[764])},1411:function(A,u,a){a.d(u,"b",function(){return J});a.d(u,"a",function(){return L});A=a(0);var c=a(15),b=
a(27),h=a(2),r=a(324),f=a(211);u=a(1035);var l=a(913);class m extends u.a{constructor(){super();this.formulasCount=this.columnNames=this.additionalInputs=this.examples=null;this.invocationMethod=this.stateID=0;this.enableExplanations=this.cultureInfoNames=this.referenceRowValue=this.referenceRowExpression=this.timeoutInSeconds=this.guid=this.conditionalMinBranchExampleCount=this.enableConditional=this.supportedFunctions=null;this.H_=Object.assign(new l.a,{T_:m.getTypeName(),B_:m.getBaseTypes()})}static getTypeName(){return"AugLoop_FormulaByExample_FormulaByExampleSignal"}static getBaseTypes(){return["AugLoop_Signals_Signal"]}}
Object(A.a)(m,"FormulaByExampleSignal",u.a,[]);var x=a(1412),n=a(67),t=a(1044),w=a(1069),v=a(118),k=a(1107),y=a(1106),C=a(1),B=a(960),E=a(557);const K=C.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleRAILThresholdQuantum",35),F=C.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleAsyncSignalGenerationTimeoutDuration",5E3);a=C.EwaSettings.isChangeGateEnabled("OfficeVSO:8501373_CalcTsFuncsFirstSlice")&&C.EwaSettings.isChangeGateEnabled("OfficeVSO:8625930_FBEWithCalcTSFuncsFirstSlice");
const W={TEXTSPLIT:a,TEXTSLICE:!1,FINDN:!1,TEXTAFTER:a,TEXTBEFORE:a},J={IDd:"editRange",ZZ:"triggerCommand",nye:"triggerKind",SAf:"flowId",E_f:"isInExplicitTable",n_g:"tableInnerRange",J0f:"isNewRowPrediction",l_f:"isHeaderLess",vVg:"showNow",Feg:"newColumnHypothesis",ORf:"headerRow"};class L{constructor(M,Q,H,ba){this.QId=ba;this.sL=!1;this.Jh=M;this.formulaByExampleManager=Q;this.uUh=H;this.ap=w.a.getInstance(this.Jh);this.sL=Object(t.a)(this.Jh);this.SFj=C.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleMaximalNumberOfAdditionalInputRows",
30);this.yWg=null!=this.QId;c.ULS.sendTraceTag(528758226,306,50,"FormulaByExampleCommandHandler.ctor: FBE command handler created")}Ri(){return!1}executeCommand(M,Q,H){M=!1;Q=Q.command;switch(Q){case 1928326585:var ba=H&&H[J.nye]?H[J.nye]:0;M=H[J.SAf];if(0===ba)return c.ULS.sendTraceTag(524940245,306,15,"FormulaByExampleManager.executeCommand: triggerFormulaByExample command called for execution with NoTrigger value."),this.ap.Zv(M,1),n.Task.Ua(!0);const U=!H||!H[J.IDd],D=this.HKi(H,U),I=H[J.n_g],
X=H[J.E_f],Y=H[J.ZZ],ja=H[J.J0f],Ua=H[J.l_f],ka=this.AJi(D,I),fb=H[J.vVg],ha=H[J.Feg];H=H[J.ORf];H={gRc:D,jV:X,valueType:ka,zx:I,sheetId:B.a.S0(this.Jh.sZc),XM:ja,ZZ:Y,pte:fb,Imj:ha,headerRow:H};U||2!==ba||this.formulaByExampleManager.c1j(M,H);if(this.yWg&&(ba=this.nFf(D,X))&&this.QId.Aij(ba))return c.ULS.sendTraceTag(508036636,306,50,"FormulaByExampleCommandHandler.executeCommand: column is locked, not triggering FBE (no signal)"),this.Jh.S7(M,"signal lock"),n.Task.Ua(!0);M=this.triggerFormulaByExample(D,
I,U,M,X,Ua,H)}return M?n.Task.Ua(!0):Object(f.a)(Q)}Gi(M,Q){switch(Q.command){case 1928326585:return this.Jh.Q1a();default:return!1}}dj(){return!1}AJi(M,Q){var H;if(C.EwaSettings.isChangeGateEnabled("OfficeVSO:8582031_FormulaByExampleAsYouType")){Q=this.Jh.yva("FormulaByExampleCommandHandler.getDefaultColumnValueType",new b.Range(Q.top,M.left,Q.bottom,M.left,!0,!0));try{for(;Q.$$mn();){const ba=Q.$$cu().cell.vD;if(0!==ba)return ba}}catch(ba){throw Error(`Error while iterating over cells: ${ba}`);
}finally{Q&&Q.dispose()}}return null===(H=this.Jh.zh(M))||void 0===H?void 0:H.cell.vD}HKi(M,Q){c.ULS.sendTraceTag(537161928,306,50,`FormulaByExampleCommandHandler.getEditedRange: flow triggered from: ${Q?"Ribbon":"AutoDetect"}`);return Q?this.Jh.getActiveCell():M[J.IDd]}triggerFormulaByExample(M,Q,H,ba,U,D,I){if(!this.Jh.Djj)return c.ULS.sendTraceTag(537161927,306,10,"FormulaByExampleCommandHandler.TriggerFormulaByExample: augmentationLoopManager instance is null"),this.ap.Zv(ba,13,{reason:"AugmentationLoopManager instance is null"}),
this.Jh.S7(ba,"AL is undefined"),!0;let X=Q;if(C.EwaSettings.isChangeGateEnabled("OfficeVSO:8180963_FBEFixColumnHeadersMetadata")&&(X=Q.Ik(this.Jh.getLoadedRange()),!X))return c.ULS.sendTraceTag(508363683,306,20,"FormulaByExampleCommandHandler.TriggerFormulaByExample: tableRange does not intersect loaded range"),this.ap.Zv(ba,13,{reason:"tableRange does not intersect loaded range"}),this.Jh.S7(ba,"tableRange does not intersect loaded range"),!0;H=this.GMi(M,X,H,ba,U,D,I);void H.then(Y=>{if(Y){if(this.yWg){const ja=
this.nFf(M,U);ja&&this.jLj(ba,ja,Y.examples,Q)}c.ULS.sendTraceTag(537161926,306,50,`FormulaByExampleCommandHandler.TriggerFormulaByExample: calling SubmitOperationSignal for flowId: ${ba}, isInExplicitTable: ${U}.`);this.Jh.tWk(Y);this.ap.Zv(ba,12);this.uUh.QZ(M,1);this.sL&&Object(t.f)("SIGNALSENT",ba)}else this.ap.Zv(ba,13,{reason:"Signal is null"})});return!0}jLj(M,Q,H,ba){const U=[];for(const D of H){H=new b.Range(D.output.row,ba.left,D.output.row,ba.right,!0,!0);if(0<U.length){const I=U[U.length-
1];if(I.bottom+1===H.top){I.Ayf(H);continue}}U.push(H)}this.QId.u_j(M,Q,U);c.ULS.sendTraceTag(508036635,306,50,"FormulaByExampleCommandHandler.notifyLockManagerOnSignalSent: SignalLocksManager has been updated with the signal sent")}nFf(M,Q){return Q?(Q=this.Jh.Kl(M,!1),Q?this.ap.Nzc(Q.name,M.left):(c.ULS.sendTraceTag(508036634,306,15,"FormulaByExampleCommandHandler.getColumnKeyFromEditRange: explicit table is null"),null)):this.ap.YQb(M,M.left,B.a.S0(this.Jh.ma))}GMi(M,Q,H,ba,U,D,I){const X=this;
return Lo(function*(){var Y,ja,Ua=yield X.fGi(Q,M,ba,I);if(!Ua)return null;let ka,fb=void 0,ha=void 0;if(U){const ea=X.Jh.Kl(M,!1);if(!ea)return c.ULS.sendTraceTag(537161925,306,15,"FormulaByExampleCommandHandler.TriggerFormulaByExample: table returned null for given edit range."),X.ap.Zv(ba,13,{reason:"Table returned null for given edit range"}),X.Jh.S7(ba,"table return null for table suggestion"),null;ka=X.CHi(ea);if(C.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleReferenceRowFormula",
!1)){ha=Q.top-1;const aa=null===(ja=null===(Y=ea.E8)||void 0===Y?void 0:Y.HeadersList[M.left-Q.left])||void 0===ja?void 0:ja.Name;aa&&(Y=Object(E.b)(aa),fb=`${ea.name}[[#Headers],[${Y}]]`)}}else X.Jh.R1a()&&(ka=X.BHi(Q,M),C.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleReferenceRowFormula",!1)&&(ha=D?Q.top:Q.top-1,fb=`\$${M.toString().charAt(0)}\$${ha}`));if(!ka)return X.Jh.S7(ba,"no column names found"),null;C.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleReferenceRowFormula",
!1)&&!fb&&(c.ULS.sendTraceTag(508347742,306,15,`FormulaByExampleCommandHandler.TriggerFormulaByExample: failed to generate referenceRowExpression. isHederLessTable: ${D}, isInExplicitTable: ${U}`),ha=fb=void 0);Ua=Object(h.a)(new m,{formulasCount:1,examples:Ua.examples,additionalInputs:Ua.additionalInputs,columnNames:ka,stateID:X.Jh.NC,invocationMethod:H?0:1,guid:ba.toString(),supportedFunctions:W,enableConditional:C.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleConditionals",
!1),referenceRowExpression:fb,referenceRowValue:ha,cultureInfoNames:C.EwaSettings.isChangeGateEnabled("OfficeVSO:8198743_FormulaByExampleTier1Langs")?{userInterfaceCulture:void 0,dataCulture:X.Jh.$.dataCultureTag}:void 0,enableExplanations:C.EwaSettings.isChangeGateEnabled("OfficeVSO:8697329_FormulaByExampleExplanationsAlwaysGenerated")||C.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleExplanations",!1)});c.ULS.sendTraceTag(528758225,306,50,"FormulaByExampleCommandHandler.getFormulaByExampleSignalFromTable: signal generated.");
return Ua})}fGi(M,Q,H,ba){const U=this;return Lo(function*(){return yield U.gGi(M,Q,H,ba)})}CHi(M){var Q;const H=[],ba=M.name;if(C.EwaSettings.isChangeGateEnabled("OfficeVSO:8180963_FBEFixColumnHeadersMetadata")){var U=null===(Q=M.E8)||void 0===Q?void 0:Q.HeadersList;if(!U)return c.ULS.sendTraceTag(508363682,306,15,"FormulaByExampleCommandHandler.getColumnNamesMapFromTable: failed to generate columnNames."),null;for(var D of U)U=D.Index,M=D.Name,M=C.EwaSettings.isChangeGateEnabled("OfficeVSO:8202565_FBEescapeColumnHeaderNames")?
Object(E.b)(M):M,H.push({column:U+1,name:`${ba}[@[${M}]]`})}else{D=B.a.Lga(M);M=this.Jh.O_a(M);if(!D||!M)return c.ULS.sendTraceTag(524940244,306,15,`FormulaByExampleCommandHandler.getColumnNamesMapFromTable: failed to generate columnNames. is tableRange null: ${!D}, is colNamesCurrentTable null: ${!M}`),null;D=D.left;for(U of M)M=C.EwaSettings.isChangeGateEnabled("OfficeVSO:8202565_FBEescapeColumnHeaderNames")?Object(E.b)(U):U,H.push({column:D,name:`${ba}[@[${M}]]`}),D++}return H}BHi(M,Q){const H=
[];Q=new b.Range(Q.top,M.left,Q.top,M.right,!0,!0);M=this.Jh.yva("FormulaByExample.getColumnNamesMapFromInputRange",Q);for(Q=Q.left;M.$$mn();){const ba={column:Q++,name:`${b.Range.rR(M.$$cu().range.left)+y.b}`};H.push(ba)}return H}gGi(M,Q,H,ba){const U=this;return Lo(function*(){const D=Q.left;try{const I=yield U.wMi(M,D,H);return yield U.W$h(M,D,I,ba,H)}catch(I){return c.ULS.sendTraceTag(508909329,306,10,`FormulaByExampleCommandHandler.getByExamplesInputsFromRangeAsync: failed to generate byExampleInputs. ${I}`),
null}})}wMi(M,Q,H){const ba=this;return Lo(function*(){const U=new Set,D=ba.Jh.yva("FormulaByExample.getForbiddenColumnsFromRangeAsync",M),I=X=>{var Y=X.range;const ja=Y.left;ja===Q||U.has(ja)||(Y=new b.Range(Y.top,Q,Y.top,Q,!1,!1),ba.Hjj(X,Y)&&(U.add(ja),ba.ap.MOc(H,ja-(ba.Jh.displayRtl?M.right:M.left))))};try{return yield ba.Q$g(D,I),U}catch(X){throw Error(`getForbiddenColumnsFromRangeAsync failed with reason: ${X}`);}})}W$h(M,Q,H,ba,U){const D=this;return Lo(function*(){const I=[],X=[],Y=M.right,
ja=new Set;let Ua=[],ka=!1,fb=null;const ha=C.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleTrackNonUniformColumns",!1)?new Set:null,ea=D.Jh.yva("FormulaByExample.createValidExamplesFromRangeAsync",M);let aa=!1;const ca=new Map,xa=Oa=>{if(504848446!==ba.ZZ||Oa.range.top!==ba.gRc.top){var ua=Oa.range.left,Ia=ua===Q;Ia&&Oa.text?fb=D.mkf(Oa):Ia||H.has(ua)||(Oa.text&&(ka=!0),Ua.push(D.mkf(Oa)));Oa=D.p8k(Oa,ca);aa||(aa=Oa);ua===Y&&(ka&&(fb?(I.push({output:fb,inputs:Ua}),ja.add(fb.rawValueJson),
null===ha||void 0===ha?void 0:ha.add(fb.numberFormatCategory)):X.length<D.SFj&&X.push({output:null,inputs:Ua})),Ua=[],ka=!1,fb=null)}};try{yield D.Q$g(ea,xa);if(ja.size<k.a)return c.ULS.sendTraceTag(509683013,306,50,"FormulaByExampleCommandHandler.createValidExamplesFromRange: column does not have enough distinct examples with inputs."),D.Jh.S7(U,"not enough examples with non-empty inputs"),null;if(ha){const Oa={["isUniformColumn"]:1===ha.size,["dataTypes"]:Array.from(ha).sort().join(","),["flowId"]:U};
c.ULS.sendTraceTag(507581650,306,20,`Formula By Example Uniform Column Data: ${JSON.stringify(Oa)}`);if(C.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleSuppressNonUniformSignals",!1)&&1<ha.size)return c.ULS.sendTraceTag(507581649,306,50,"FormulaByExampleCommandHandler.createValidExamplesFromRange: column has non uniform data, suppressing signal."),D.Jh.S7(U,"column has non uniform data"),null}if(D.Jh.P1a()){const Oa=ca.get(Q),ua={["isFormulaUser"]:aa,["hasFormulaColumn"]:Array.from(ca.entries()).some(Ia=>
{[,Ia]=Ia;return"HasNonFormulaCell"!==Ia&&1===Ia.size}),["outputColumnDataState"]:Oa&&"HasNonFormulaCell"===Oa?"NonFormulaColumn":1===Oa.size?"FormulaColumn":"MixedFormulasColumn",["flowId"]:U};c.ULS.sendTraceTag(507557075,306,20,`Formula By Example Formula User And Columns Hypothesis Data: ${JSON.stringify(ua)}`)}return{examples:I,additionalInputs:X}}catch(Oa){throw D.Jh.S7(U,"createValidExamplesFromRangeAsync failed, log 4vv2r"),Error(`createValidExamplesFromRangeAsync failed with reason: ${Oa}`);
}})}Q$g(M,Q){return Lo(function*(){const H=performance.now();let ba=H;try{for(;M.$$mn();){if(performance.now()-H>F)throw Error("Timeout");performance.now()-ba>K&&(yield B.a.Wfl(),ba=performance.now());Q(M.$$cu())}}catch(U){throw Error(`Error while iterating over cells: ${U}`);}finally{M&&M.dispose()}})}p8k(M,Q){if(!this.Jh.P1a())return!1;const H=M.range.left;if(!M.text||!M.HC)return Q.set(H,"HasNonFormulaCell"),!1;if("HasNonFormulaCell"===Q.get(H))return!0;Q.has(H)||Q.set(H,new Set);Q.get(H).add(M.formulaBarText);
return!0}Hjj(M,Q){const H=M.uQ,ba=M.range,U=this.Jh.zCe,D=this.Jh.ma;if(!D)return c.ULS.sendTraceTag(509743199,306,50,"FormulaByExampleCommandHandler.isDependingOn: this.ewaControl.activeItem returned null. Expected to be an object of type Sheet."),!1;if(!(C.EwaSettings.isChangeGateEnabled("OfficeVSO:7251463_FBEFixJsCrashOnNullActiveSheet")||D instanceof v.a))return c.ULS.sendTraceTag(509743198,306,50,"FormulaByExampleCommandHandler.isDependingOn: this.ewaControl.activeItem returned object of type other then Sheet. Expected to be an object of type Sheet."),
!1;if(!this.Jh.BHc(M.cell.qo,H))return!1;if(M=this.Jh.extractReferences(H,D.name,U,!0,ba))for(const I of M.Items)if(B.a.xAi(I.Range).equals(Q))return!0;return!1}mkf(M){let Q;if(1===M.Ln.type){Q=parseFloat(M.Ln.value);var H=this.Jh.wna(M.cell.qo);Object(r.c)(H)?H=H.value.isDate?4:H.value.isTime?5:1:(c.ULS.sendTraceTag(522840207,0,10,`FormulaByExampleCommandHandler.createAugLoopCell: CalcManager's getNumberFormat method failed on the given cell, falling back to number format. failureReason: ${H.reason}`),
H=1)}else Q=M.text,H=0;return Object.assign(new x.a,{row:M.range.top,column:M.range.left,displayText:M.text,rawValueJson:JSON.stringify(Q),numberFormatCategory:H.toString()})}}Object(A.a)(L,"FormulaByExampleCommandHandler",null,[34])},1446:function(A,u,a){a.r(u);a.d(u,"FormulaByExampleAutoSuggestActor",function(){return v});A=a(0);var c=a(15),b=a(1010),h=a(83),r=a(1044),f=a(1411),l=a(1107),m=a(1069),x=a(392),n=a(1),t=a(960),w=a(27);class v{constructor(k,y){this.tSc=this.Erd=this.sL=!1;this.cHa=null;
this.pwc=!1;this.Iva=0;this.Kw=null;this.d0b=new Map;this.cZ=(C,B)=>{B.committed?(this.Kw&&(this.Iva++,this.Kw.oRg(this.Iva,this.Iva),this.Kw.Jja(this.Iva,0)),this.Pjg(B.Bq,324156914)):this.YS()};this.k7=(C,B)=>{this.Pjg(B.raa.range,504848446,B.bZd)};this.Pjg=(C,B,E)=>{324156914===B&&this.O1g(C);if(n.EwaSettings.isChangeGateEnabled("OfficeVSO:8680199_ValidatorReportOrderFix")&&!this.qVd(C))this.YS(),this.Jh.S7(this.Iva,"cell is invalid for FormulaByExample trigger - formula cell");else{var {zx:K,
jV:F,XM:W,jha:J,headerRow:L}=this.Lga(C);K&&C.Xi(K)?(this.gFc(C,324156914,K,F),n.EwaSettings.isChangeGateEnabled("OfficeVSO:8680199_ValidatorReportOrderFix")||this.qVd(C)?this.nPc(C,C,K,B,F,W,J,E,L):this.YS()):(this.YS(),this.Jh.S7(this.Iva,K?"edited header cell":"no table found"))}};this.O1g=C=>{if(this.Jh.P1a()){var B=new w.Range(C.top,C.left-1,C.bottom,C.left,!1,!1);(B=this.Jh.jYi(B))&&(B.usedRange.Xi(C)?this.isj(B,C.left,C)&&this.Ebg(B,C.left-B.usedRange.left):this.Ebg(B,C.left-B.usedRange.left))}};
this.Ebg=(C,B)=>{this.d0b.has(C.name)?this.d0b.get(C.name).add(B):this.d0b.set(C.name,new Set([B]))};this.Fpj=C=>{const B=this.Jh.Kl(C,!1);return B&&this.d0b.has(B.name)?this.d0b.get(B.name).has(C.left-B.usedRange.left):!1};this.W$d=(C,B)=>{C=B.destinationRange;if(1804571062===B.command||C.left!==C.right)this.YS();else{var E=new w.Range(C.top,C.right,C.top,C.right,!1,!1),{zx:K,jV:F,XM:W,jha:J,headerRow:L}=this.Lga(E);K?(this.gFc(E,B.command,K,F),this.nPc(E,C,K,B.command,F,W,J,!1,L)):this.YS()}};this.bQc=
(C,B)=>{if((C=B.Wdi)&&1===C.length)if(C=C[0],n.EwaSettings.isChangeGateEnabled("OfficeVSO:8468987_FormulaByExamplePasteColumn"))if(C.o1)if(this.Jh.bG(C))if((B=B.Qo)&&1804571062!==B&&1766348718!==B){C.isSingle&&this.O1g(C);var {zx:E,jV:K,XM:F,jha:W,headerRow:J}=this.Lga(C);if(E){c.ULS.sendTraceTag(507855043,306,50,`FormulaByExampleAutoSuggestActor.onPasteSucceededInner: passed all conditions to trigger FBE event.
        ribbonCommand = ${b.a[B]}
        destinationRange.height = ${C.height}`);var L=C.center;this.gFc(L,B,E,K);this.nPc(L,C,E,B,K,F,W,!1,J)}else this.YS(),c.ULS.sendTraceTag(507855044,306,50,"FormulaByExampleAutoSuggestActor.onPasteSucceededInner: no table contains the range")}else this.YS(),c.ULS.sendTraceTag(507872195,306,50,`FormulaByExampleAutoSuggestActor.onPasteSucceededInner: unsupported paste. ribbonCommand = ${b.a[B]}`);else this.YS(),c.ULS.sendTraceTag(507881249,306,50,"FormulaByExampleAutoSuggestActor.onPasteSucceededInner: destinationRange not fully contained in viewport");
else this.YS(),c.ULS.sendTraceTag(507881250,306,50,`FormulaByExampleAutoSuggestActor.onPasteSucceededInner: not single column. destinationRange.width = ${C.width}`);else if((B=B.Qo)&&1804571062!==B&&1766348718!==B&&C.isSingle){var {zx:M,jV:Q,XM:H,jha:ba,headerRow:U}=this.Lga(C);M?(this.gFc(C,B,M,Q),this.nPc(C,C,M,B,Q,H,ba,!1,U)):this.YS()}else this.YS(),c.ULS.sendTraceTag(508376384,306,50,`FormulaByExampleAutoSuggestActor.onPasteSucceededInner: unsupported paste or not single cell. ribbonCommand = ${b.a[B]} destinationRange.isSingle = ${C.isSingle}`);
else this.YS(),c.ULS.sendTraceTag(508380383,306,50,`FormulaByExampleAutoSuggestActor.onPasteSucceededInner: not single range. destinationRanges?.length = ${null===C||void 0===C?void 0:C.length}`)};this.yCd=()=>{var C=this.ryk(this.BP.originCell,this.BP.zx);if(0===C)this.YS(),this.ap.Zv(m.b,1),this.Jh.S7(this.Iva,"output column doesn't have enough distinct examples");else{var B=this.ap.pJf();this.ap.Zv(B,3);this.BP.I1d&&this.Kw&&this.Kw.oRg(B,this.BP.I1d);c.ULS.sendTraceTag(537161929,306,50,`FormulaByExampleAutoSuggestActor.tryTriggeringFormulaByExample: triggering FormulaByExample for cell edit. Trigger kind: ${C}, FlowId: ${B}`);
this.sL&&Object(r.f)("EDITCOMMIT",B);var E=new h.a(1928326585,1,2,6,null);C={[f.b.IDd]:this.BP.originCell,[f.b.ZZ]:this.BP.ZZ,[f.b.nye]:C,[f.b.SAf]:B,[f.b.n_g]:this.BP.zx,[f.b.E_f]:this.BP.jV,[f.b.J0f]:this.BP.XM,[f.b.l_f]:this.BP.jha,[f.b.vVg]:this.BP.trj,[f.b.Feg]:this.BP.jV&&this.Fpj(this.BP.originCell),[f.b.ORf]:this.BP.headerRow};this.Jh.qh(E,C);this.YS()}};this.a0j=(C,B)=>{C=this.BP.cVh;B=B.Bq.toString();C.has(B)&&(C.delete(B),0===C.size&&this.yCd())};this.Jh=k;this.sL=y;this.YS();this.Jh.uX(this.cZ);
n.EwaSettings.isChangeGateEnabled("OfficeVSO:8582031_FormulaByExampleAsYouType")&&this.Jh.mO(this.k7);this.pwc=n.EwaSettings.isChangeGateEnabled("OfficeVSO:8231994_FBECalcGridUnreliableFix");this.Kw=this.Jh.Kw;this.pwc||this.Jh.bpd(this.a0j);n.EwaSettings.isChangeGateEnabled("OfficeVSO:7395435_FormulaByExampleTriggerOnCSEPaste")&&this.Jh.Wmc(this.W$d);(this.tSc=n.EwaSettings.isChangeGateEnabled("OfficeVSO:8329262_FormulaByExamplePostPaste"))&&this.Jh.Xmc(this.bQc);this.ap=m.a.getInstance(this.Jh);
if(this.Erd=this.Jh.R1a())this.Jh.Laj(),this.yme=n.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleRowsBelowRangeTableToQuery",1)}isj(k,y,C){var B;k=t.a.Lga(k);y=new w.Range(k.top,y,k.bottom,y,!1,!1);y=this.Jh.yva("FormulaByExampleAutoSuggestActor:isTableColumnBlank",y);try{for(;y.$$mn();){const E=y.$$cu();if(!E.range.equals(C)&&(null===(B=E.Ln)||void 0===B?0:B.value))return!1}}finally{y&&y.dispose()}return!0}Lga(k){var y;const C=this.Jh.Kl(k,!1);if(C)return k=null===(y=C.E8)||
void 0===y?void 0:y.HeadersList,{zx:t.a.Lga(C),jV:!0,XM:!1,jha:!k};if(this.Erd){const {a4b:B,XM:E,jha:K,headerRow:F}=this.nUi(k);if(B)return{zx:B,jV:!1,XM:E,jha:K,headerRow:F}}return{zx:null,jV:!1,XM:!1,jha:!1}}nUi(k){var y=new w.Range(k.top-this.yme,k.left,k.bottom,k.right,!0,!0),C=this.Jh.TXk(new x.a(y,t.a.S0(this.Jh.ma)),6);if(!C)return null;const B=new Map;for(var E of C)for(var K of E.table.interpretations)if(2===K.orientation&&.5<K.confidence){y=new w.Range(K.tableLocation.top+K.headerRowCount,
K.tableLocation.left+K.headerColumnCount,Math.max(K.tableLocation.bottom,y.bottom),K.tableLocation.right,!0,!0);k=!K.tableLocation.Xi(k);C=0===K.headerRowCount;if(1===K.headerRowCount)for(K=y.left;K<=y.right;K++){E=new w.Range(y.top-1,K,y.top-1,K,!1,!1);const F=this.Jh.zh(E);F?B.set(F.range.left,F.cell.text):c.ULS.sendTraceTag(507581085,306,15,`FormulaByExampleAutoSuggestActor.getRangeTableInnerRange: formatted cell for header row is null. table inner range: ${y} cell range: ${E}`)}return{a4b:y,XM:k,
jha:C,headerRow:B}}return{a4b:null,XM:!1,jha:!1,headerRow:null}}nPc(k,y,C,B,E,K,F,W,J){this.WPg(k,y,C,B,E,K,F,W,J);k=[];this.pwc&&k.push(324156914);this.tSc&&k.push(237279923,-185374993,-958589048,808159687,42074747,-875588320,264209770);k.includes(B)?(this.R5b(),this.cHa=this.Jh.GNa(()=>{n.EwaSettings.isChangeGateEnabled("OfficeVSO:8235022_FBEVerifyCellNotFormulaAfterConsistent")&&!this.qVd(this.BP.originCell)?(this.YS(),this.ap.Zv(m.b,1),this.Jh.S7(this.Iva,"cell is invalid for FormulaByExample trigger - formula cell")):
this.yCd()})):(this.R5b(),this.yCd())}gFc(k,y,C,B){B?(B=this.Jh.Kl(k,!1),this.ap.Ljg(y,B.name,k.left-(this.Jh.da.rtl?C.right:C.left),k.top-C.top)):this.ap.Mjg(y,C,k.left-(this.Jh.da.rtl?C.right:C.left),k.top-C.top,t.a.S0(this.Jh.sZc))}qVd(k){var y=this.Jh.zh(k);if(!y)return c.ULS.sendTraceTag(524120778,306,15,`FormulaByExampleAutoSuggestActor.isCellValidForTriggeringFormulaByExample: formattedCell is null. investigation hints: is cell null = ${!k}`),this.ap.Zv(m.b,1,{reason:"Didn't trigger since the formattedCell is null."}),
!1;if(n.EwaSettings.isChangeGateEnabled("OfficeVSO:8666049_FBEUseClientGridFormulaMetadata"))return y.cell.HC?(this.ap.Zv(m.b,1,{reason:"Didn't trigger since edited cell content is a formula."}),!1):!0;k=this.Jh.BHc(y.cell.qo,y.uQ);(y=null!==k&&!k)||this.ap.Zv(m.b,1,{reason:`Didn't trigger since edited cell content is a formula or isFormulaCell returned null. isFormulaText is null:${null==k}`});return y}ryk(k,y){k=k.left;y=new w.Range(y.top,k,y.bottom,k,!0,!0);return this.qyk(y)}qyk(k){var y;const C=
new Set;let B=0;k=this.Jh.yva("FormulaByExampleAutoSuggestActor:Table",k);try{for(;k.$$mn();){const E=k.$$cu();if(null===(y=E.Ln)||void 0===y?0:y.value)if(C.add(E.Ln.value),B++,C.size>=l.a)return 2}}finally{k&&k.dispose()}B>=l.a?(c.ULS.sendTraceTag(523368219,306,50,"FormulaByExampleAutoSuggestActor.searchForSufficientExamplesInOutputColumn: Table has sufficient example amount - but not enough distinct examples."),this.ap.Zv(m.b,1,{reason:"Didn't trigger since there aren't enough distinct outputs"})):
this.ap.Zv(m.b,1,{reason:"Didn't trigger since there aren't enough examples"});return 0}R5b(){this.cHa&&(this.cHa(),this.cHa=null,this.Kw&&324156914===this.BP.ZZ&&this.Jh.S7(this.BP.I1d,"consistent block cache callback cancelled"))}YS(){this.WPg(null,null,null,null,null,null,null);(this.tSc||this.pwc)&&this.R5b()}WPg(k,y,C,B,E,K,F,W,J){this.BP={originCell:k,cVh:new Set(null===y||void 0===y?void 0:y.i9e(y.uz).map(L=>L.toString())),ZZ:B,zx:C,jV:E,XM:K,jha:F,trj:W,headerRow:J,I1d:324156914===B?this.Iva:
null}}}Object(A.a)(v,"FormulaByExampleAutoSuggestActor",null,[])},1447:function(A,u,a){u=a(483);a=a(1448);a=a.Qw?a.default:a;"string"===typeof a&&(a=[[A.i,a,""]]);u(a,{insert:"head",eD:!1});A.exports=a.EH||{}},1448:function(A,u,a){u=a(484)(!1);u.push([A.i,'.ewa-ac{position:absolute;z-index:102;margin-top:1px;width:auto}.ewa-ac .ewa-ac-param{white-space:nowrap;margin-bottom:3px;direction:ltr}.ewa-ac .ewa-ac-param function_param_table{position:absolute}.ewa-ac .ewa-ac-param .ewa-function-help-link{text-decoration:underline}.ewa-lb{position:absolute;border:1px solid #a2a6ab;overflow-x:hidden;overflow-y:auto;cursor:default;background-color:#fff;color:#262626;font-size:12px;font-family:"Segoe UI";z-index:102;height:auto;margin:0 8px;touch-action:manipulation;vertical-align:middle}.ewa-lb.ewa-fb-refactor{position:relative;margin:0}.ewa-lb table{left:0;right:0;border-collapse:collapse}.ewa-lb table td{white-space:nowrap}.ewa-lb table td div.clip16x16{margin:0 0 0 2px}.ewa-lb table td.list-item{height:24px;padding:0 8px}.ewa-lb table td.list-item-selected{background-color:#d3f0e0}@media screen and (-ms-high-contrast:active){.ewa-lb table td.list-item-selected{border:2px solid #fff}}.ewa-lb table.list-table-touch td.list-item{height:35px}div#suggested_cells_list_box{margin:0}div#suggested_cells_list_box .list-table .ewa-suggested-cell-name{float:left;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}@font-face{font-family:"Segoe UI Semibold";font-weight:600;src:local("Segoe UI Semibold"),local("Segoe UI")}.ewa-lb table td.columnName-header{color:#666;font-size:12px;font-family:"Segoe UI Semibold";text-align:left;padding:3px 8px;text-overflow:ellipsis}.ewa-tt{background-color:#f7f7f7;border:1px solid #a2a6ab;color:#444;height:auto;vertical-align:middle;width:auto;z-index:102;font-size:8pt;margin:0;padding-bottom:3px;padding-top:2px}.ewa-root-ltr .ewa-tt{text-align:left;padding-left:5px;padding-right:7px}.ewa-root-rtl .ewa-tt{text-align:right;padding-left:7px;padding-right:5px}.ewa-dlg-function-link-container .ewa-fdb-help-link,.ewa-tt-ltr .ewa-fdb-help-link,.ewa-tt-rtl .ewa-fdb-help-link{color:#00f;text-decoration:underline}.ewa-function-link-container .ewa-function-udf-name,.ewa-function-link-container-udf .ewa-function-help-link{display:none}.ewa-root.rtl .ewa-function-link-container{text-align:left}',
""]);A.exports=u},1449:function(A,u,a){u=a(483);a=a(1450);a=a.Qw?a.default:a;"string"===typeof a&&(a=[[A.i,a,""]]);u(a,{insert:"head",eD:!1});A.exports=a.EH||{}},1450:function(A,u,a){u=a(484)(!1);u.push([A.i,".ewa-fb-fluent .ewa-rteLine .formula-highlight-1,.ewa-gridKeyHandler .formula-highlight-1{color:#006cbe}.ewa-fb-fluent .ewa-rteLine .formula-highlight-1::selection{color:#b2e3ff}.ewa-fb-fluent .ewa-rteLine .formula-highlight-2,.ewa-gridKeyHandler .formula-highlight-2{color:#bc2f32}.ewa-fb-fluent .ewa-rteLine .formula-highlight-2::selection{color:#ffcfe1}.ewa-fb-fluent .ewa-rteLine .formula-highlight-3,.ewa-gridKeyHandler .formula-highlight-3{color:#7c53ac}.ewa-fb-fluent .ewa-rteLine .formula-highlight-3::selection{color:#e9d4ff}.ewa-fb-fluent .ewa-rteLine .formula-highlight-4,.ewa-gridKeyHandler .formula-highlight-4{color:#0f700f}.ewa-fb-fluent .ewa-rteLine .formula-highlight-4::selection{color:#98ff87}.ewa-fb-fluent .ewa-rteLine .formula-highlight-5,.ewa-gridKeyHandler .formula-highlight-5{color:#bf0077}.ewa-fb-fluent .ewa-rteLine .formula-highlight-5::selection{color:#fcf}.ewa-fb-fluent .ewa-rteLine .formula-highlight-6,.ewa-gridKeyHandler .formula-highlight-6{color:#b5490f}.ewa-fb-fluent .ewa-rteLine .formula-highlight-6::selection{color:#ffda00}.ewa-fb-fluent .ewa-rteLine .formula-highlight-7,.ewa-gridKeyHandler .formula-highlight-7{color:#00758f}.ewa-fb-fluent .ewa-rteLine .formula-highlight-7::selection{color:#3df5e8}",
""]);A.exports=u},191:function(A,u,a){function c(Ga,Qb){Object(nc.d)(()=>{var wc;const S=Ga.getCellBounds(null===(wc=Ga.zh(null))||void 0===wc?void 0:wc.cell,!0);S&&(wc=S?new Sys.UI.Bounds(S.x+S.width,S.y+S.height,0,0):null)&&Qb.T8b(["DatePickerFloatie"],wc,Nb.a.rh)})}function b(Ga){var Qb=Object($a.f)(Ga);Ga=Object(vb.a)(Ga);var wc=Qb.Bp,S=Qb.cellTextEditBox.Y0f;S=Qb.xA||S&&Ga;Ga=h((S?Ga:wc).Wa.domElement);wc=ac.EwaSettings.isChangeGateEnabled("OfficeVSO:8597123_RemoveIndentationInFormulaBar");wc||
(Ga.left+=12);if(S)S={top:0,left:0,right:innerWidth,bottom:innerHeight};else if(wc&&(Ga.left+=12),S=h(Qb.domElement),ac.EwaSettings.isChangeGateEnabled("OfficeVSO:7845089_fixFormulaAssistancePositoningInFreezePanes")&&Qb.fh.pp&&(Qb=Qb.fh,S.top-=Qb.height,S.left-=Qb.width),{zoom:Qb}=Object(Lb.a)(),1!==Qb)for(const eb of[Ga,S])for(const ec in eb)eb[ec]*=Qb;return{target:Ga,bounds:S}}function h(Ga){const {top:Qb,left:wc,right:S,bottom:eb}=Ga.getBoundingClientRect();return{top:Qb,left:wc,right:S,bottom:eb}}
function r(Ga){var Qb;if(Ga){var wc=new ze(Ga.kind===vc.HighlightKind.CellRef);Ga=null===(Qb=null===Ga||void 0===Ga?void 0:Ga.rangeInfo)||void 0===Qb?void 0:Qb.positionKindInfo;if(!Ga)return wc;wc.foa=Ga.firstRow===vc.PositionKind.Absolute;wc.eoa=Ga.firstColumn===vc.PositionKind.Absolute;wc.kya=Ga.secondRow===vc.PositionKind.Absolute;wc.jya=Ga.secondColumn===vc.PositionKind.Absolute;return wc}}function f(Ga,Qb){return Ga===Qb?{kind:"equal"}:{kind:"different",diff:Hc.a.N6e(Ga,Qb)}}function l(Ga){[Ga.clientResult,
Ga.serverResult].forEach(Qb=>{Object(Id.c)(Qb)||"success"!==Qb.kind||(Qb.value=Hc.a.j4(Qb.value),Qb.unformattedValue=Hc.a.j4(Qb.unformattedValue))})}function m(Ga,Qb,wc){if(Ga.has(Qb))return Ga.get(Qb);wc=wc();Ga.set(Qb,wc);return wc}function x(Ga,Qb,wc,S,eb){if(!S)return eb();if(Ga.has(Qb))return Ga.get(Qb);S=eb();Ga.set(Qb,S);Ga.set(wc,S);return S}function n(Ga){return JSON.stringify({text:Ga.text,index:Ga.index,length:Ga.length})}function t(Ga){return Object(Id.c)(Ga)?"Undefined text":""===Ga?
"Empty text":null}function w(Ga){if("Success"===Ga.kind){var Qb={col:Ga.cell.FirstColumn,row:Ga.cell.FirstRow};a:{var wc=Ga.value;switch(typeof wc){case "number":wc={kind:1,_valueXL:wc};break a;case "string":wc={kind:2,value:wc};break a;case "boolean":wc={kind:4,_valueXL:wc?1:0};break a}wc=void 0}Ga={kind:"Success",value:{cell:Qb,value:wc,formatted:Ga.format}}}else Ga={kind:"Failure",reason:{cell:{col:Ga.cell.FirstColumn,row:Ga.cell.FirstRow,cols:Ga.cell.LastColumn-Ga.cell.FirstColumn+1,rows:Ga.cell.LastRow-
Ga.cell.FirstRow+1},kind:Ga.value.toString(),innerKind:"Unknown"}};return Ga}function v(Ga){const Qb=/^ROW\(\) [-+] ROW\(\w+\)( [-+] \d+)?$/;return/^ROW\(\) [-+] \d+$/.test(Ga)||"ROW()"===Ga||ac.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleReferenceRowFormula",!1)&&Qb.test(Ga)}function k(Ga,Qb,wc){if(Ga===Qb)return wc;if(Qb.textContent!==Qb.parentElement.textContent)for(;null!==Qb.previousSibling;)Qb=Qb.previousSibling,wc+=Qb.textContent.length,"div"===Qb.nodeName.toLowerCase()&&
(wc+=1);return k(Ga,Qb.parentElement,wc)}function y(Ga){return Object(Id.b)(Ga)&&Object(Id.b)(Ga.FormulaInfo)&&Object(Id.b)(Ga.FormulaInfo.Formula)&&(1===Ga.FormulaInfo.FormulaType||2===Ga.FormulaInfo.FormulaType)&&1<Ga.FormulaInfo.Formula.length&&Ga.FormulaInfo.Formula!==Ga.Text}function C(Ga){return{["formula"]:Ga.FormulaInfo.Formula,["formulaTokens"]:Ga.FormulaInfo.Formula,["formulaType"]:Ga.FormulaInfo.FormulaType,["value"]:Ga.Text,["unformattedValue"]:Ga.Value,["valueType"]:Ga.ValueType,["hasError"]:Ga.HasError,
["ifmt"]:Ga.Ifmt,["ifmtStamped"]:Ga.IfmtStamped,["row"]:Ga.Row,["col"]:Ga.Col}}function B(Ga,Qb){return Ga===Qb?{kind:"equal"}:Object(Id.c)(Ga)&&Object(Id.c)(Qb)?{kind:"empty",source:"both"}:Object(Id.c)(Ga)||Object(Id.c)(Qb)?{kind:"empty",source:Object(Id.c)(Ga)?"cse":"immediate"}:{kind:"different",diff:Hc.a.N6e(Ga,Qb)}}function E(Ga){return Lo(function*(){const Qb=yield db.a.resolve(gb.Bc),wc=xc.Range.vi(Ga.row,Ga.col);return Object.assign({},Ga,{formula:Qb.anonymize(Ga.formula,wc),formulaTokens:Hc.a.j4(Ga.formulaTokens),
value:Hc.a.j4(Ga.value),unformattedValue:Hc.a.j4(Ga.unformattedValue)})})}function K(Ga){if(Object(Id.b)(Ga)&&Object(Id.b)(Ga.table)&&Object(Id.b)(Ga.table.interpretations)){var Qb={sheetId:Ga.table.analyzedRange.sheetId,analyzedRange:Object(hb.hb)(Ga.table.analyzedRange.range),interpretations:Ga.table.interpretations.toArray().map(F)};a:{switch(Ga.metadataState){case 2:Ga=vc.RecognizedTablesMetadataState.Valid;break a;case 4:Ga=vc.RecognizedTablesMetadataState.Invalid;break a;case 6:Ga=vc.RecognizedTablesMetadataState.All;
break a}Ga=void 0}Qb={rangeTableInfo:Qb,metadataState:Ga}}else Qb=null;return Qb}function F(Ga){if(Ga){var Qb=Object(hb.hb)(Ga.tableLocation);var wc=Ga.confidence,S=Ga.headerRowCount,eb=Ga.headerColumnCount;a:{switch(Ga.orientation){case 0:Ga=vc.TableOrientation.none;break a;case 1:Ga=vc.TableOrientation.rowMajor;break a;case 2:Ga=vc.TableOrientation.columnMajor;break a}Ga=void 0}Qb={tableLocation:Qb,confidence:wc,headerRowCount:S,headerColumnCount:eb,orientation:Ga}}else Qb=null;return Qb}function W(Ga,
Qb,wc){const S=Ga.NC,eb=Ga.Aba();Ga.GNa(()=>{const ec=Ga.NC-S,Lc=Ga.Aba(),Ad=eb===Lc,pd=[],de=ac.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FbeEcsMismatchesMaxExamplesPerLog",5);let Ge=0;for(const Xf of Qb){if(pd.length>=de)break;var Re=Ga.zh(Xf.range);if(!Re){Ge++;continue}const kg=Xf.text,Yf=Xf.value,eh=Qc[Xf.kind],jg=Re.text,Se=Re.Ln.value;Re=Na[Re.Ln.type];if(kg===jg)var kf=ce.NoMismatch;else kf=/^#+$/.test(jg),kf=/^#+$/.test(kg)||kf?Yf===Se?ce.NoMismatch:ce.HashesValueMismatch:ce.Mismatch;
kf!==ce.NoMismatch&&pd.push({["cseText"]:Hc.a.L_(kg),["cseValue"]:Hc.a.L_(Yf),["cseKind"]:eh,["ecsText"]:Hc.a.L_(jg),["ecsValue"]:Hc.a.L_(Se),["ecsType"]:Re,["isHashesValue"]:kf===ce.HashesValueMismatch,["areValuesEqual"]:Yf===Se})}0<pd.length&&Ca.ULS.sendTraceTag(67707660,0,20,"ECS mismatch detected! "+JSON.stringify({["flowId"]:wc,["stateIdDiff"]:ec,["isSameRequestId"]:Ad,["requestIdBeforeEvent"]:eb,["requestIdAfterEvent"]:Lc,["correctCellsCount"]:Qb.length-pd.length,["cellsWithMismatchCount"]:pd.length,
["mismatches"]:pd}));0<Ge&&Ca.ULS.sendTraceTag(508704130,0,50,"FormulaByExampleEcsMismatchDetection:checkForEcsMismatch: "+Ge+" cells not loaded. flowId: "+wc)})}function J(Ga){return xc.Range.vi(Ga.row+1,Ga.col+1)}function L(Ga,Qb){Ga=1===Ga.Ln.type?parseFloat(Ga.Ln.value):Ga.Ln.value;return vf(Qb)===Ga}function M(Ga){return"Table"===Ga.kind?Ga.formula:Ga.SId}function Q(Ga,Qb,wc){if(Ga===Qb)return!0;if(!Ga||!Qb||Ga.kind!==Qb.kind||Ga.pB!==Qb.pB||Ga.uCe!==Qb.uCe||Ga.source.trigger!==Qb.source.trigger)return!1;
switch(Ga.kind){case "Success":return wc?H(Ga,Qb):Ga.value===Qb.value&&Ga.index===Qb.index&&Ga.length===Qb.length&&Ga.color===Qb.color;case "Loading":return Ga.index===Qb.index&&Ga.length===Qb.length;default:return Ga}}function H(Ga,Qb){return Ga.pB===Qb.pB&&Ga.index===Qb.index&&Ga.length===Qb.length}function ba(Ga,Qb,wc){if(Ga===Qb)return wc;if(Qb.textContent!==Qb.parentElement.textContent)for(;null!==Qb.previousSibling;)Qb=Qb.previousSibling,wc+=Qb.textContent.length,"div"===Qb.nodeName.toLowerCase()&&
(wc+=1);return ba(Ga,Qb.parentElement,wc)}function U(Ga,Qb){return Ga.text===Qb.text&&Ga.index===Qb.index&&Ga.length===Qb.length}a.r(u);var D={};a.r(D);a.d(D,"CellAutoCompleteControl",function(){return ub});var I={};a.r(I);a.d(I,"CellAutoCompleteReadoutHandler",function(){return Ba});var X={};a.r(X);a.d(X,"DatePickerCommandHandler",function(){return mc});var Y={};a.r(Y);a.d(Y,"DatePickerControl",function(){return Yb});var ja={};a.r(ja);var Ua={};a.r(Ua);a.d(Ua,"FormulaAssistanceManager",function(){return Af});
var ka={};a.r(ka);a.d(ka,"FormulaAssistanceReadoutHandler",function(){return Ef});var fb={};a.r(fb);a.d(fb,"FormulaAssistanceValuePreviewCommandHandler",function(){return Hf});var ha={};a.r(ha);a.d(ha,"FormulaAssistanceValuePreviewRequester",function(){return Bb});var ea={};a.r(ea);var aa={};a.r(aa);var ca={};a.r(ca);a.d(ca,"FormulaByExampleCardUIControl",function(){return hd});var xa={};a.r(xa);a.d(xa,"FormulaByExamplePluginTriggersManager",function(){return se});var Oa={};a.r(Oa);a.d(Oa,"FormulaByExamplePluginValidator",
function(){return Ue});a.d(Oa,"FormulaByExamplePluginValidatorProxy",function(){return nf});var ua={};a.r(ua);var Ia={};a.r(Ia);a.d(Ia,"FormulaByExampleSignalLocksManager",function(){return md});var Sa={};a.r(Sa);a.d(Sa,"FormulaColumnPreviewManager",function(){return Te});var Ya={};a.r(Ya);a.d(Ya,"FunctionInfoManager",function(){return pf});var da={};a.r(da);a.d(da,"GotoCtrlClick",function(){return Fa});var Ea={};a.r(Ea);var oa={};a.r(oa);a.d(oa,"KeptTelemetryHandler",function(){return e});var za=
a(135),la=a(0),Ca=a(15),Va=a(94),ia=a(265),wa=a(7),Jb=a(13),$a=a(23),Ka=a(6);class nb extends ia.a{constructor(Ga,Qb){super(document.createElement("div"));this.w1=this.fvc=this.SNb=this.TNb=this.jvc=this.UNb=!1;this.PT=null;this.visible=void 0;this.zoom=null;this.b$d=(wc,S)=>{this.Uy(wc,S)};this.E0a=()=>{this.Zi.Wa.QM=!0};this.LNa=()=>{this.autoComplete(!0)};this.ohg=()=>{this.Zi.Wa.focus()};this.onActiveCellChanged=()=>{$a.f(this.$).inRangePicker||(this.vn=!1)};this.$=Ga;this.zoom=Qb;$a.f(Ga)&&$a.f(Ga).ha&&
$a.f(this.$).ha.add_activeCellChanged(this.onActiveCellChanged)}get zoomManager(){return this.zoom.zoomManager}get iN(){return this.AI.iN}get vn(){return this.AI.vn}set vn(Ga){this.AI.vn=Ga}get Zi(){return this.PT}set Zi(Ga){(this.PT=Ga)&&this.PT.UBe.add(this)}get_visible(){return void 0!==this.visible?this.visible:this.visible=super.get_visible()}set_visible(Ga){if(this.visible===Ga)return Ga;this.visible=Ga;return super.set_visible(Ga)}Uy(){this.mRa(!1);this.AI.Uy()}dispose(){this.$&&$a.f(this.$)&&
$a.f(this.$).ha&&$a.f(this.$).ha.remove_activeCellChanged(this.onActiveCellChanged);this.$=null;super.dispose()}Dq(Ga,Qb,wc){Ga=!1;if((this.WMb||(void 0===wc?0:wc))&&!this.yob()&&this.get_visible()&&this.vn)switch(this.yze(Qb),Qb){case 1872288872:this.vn=!1;Ga=!0;break;case -798660877:this.AI.HH(1);Ga=!0;break;case 137938150:this.AI.HH(-1);Ga=!0;break;case 2091832999:this.AI.HH(this.iN-1);Ga=!0;break;case 742457698:this.AI.HH(-(this.iN-1));Ga=!0;break;case 125627505:Ga=this.autoComplete(!1);break;
case 267796030:Ga=this.autoComplete(!1)}return Ga}mRa(Ga){if(this.vn||Ga){var Qb=$a.f(this.$);Ga=this.PT.Wa.domElement;var wc=this.zoomManager.jo(Ga.offsetHeight),S=this.zoomManager.jo(Ga.offsetTop);Ga=this.zoomManager.jo(Ga.offsetLeft);var eb=Qb.xA,ec=Ka.AFrameworkApplication.ra&&Ka.AFrameworkApplication.ra.$g.fl;Qb=$get(this.$.xi+wa.a.prc,this.$.domElement);ec&&(Qb=document.getElementById("EditorContainer"));var Lc=new Sys.UI.Point(eb?this.AI.OId:0,eb?-5:nb.v1i);wc=Qb.offsetTop+Lc.y+(eb?0:wc+S);
this.$.soa||(S=$get(wa.a.EGa,this.$.domElement),wc+=S&&!ec?S.offsetHeight:0);S=this.domElement;S.style.top=Jb.HelperMethods.Ki(wc);S.style.left=Jb.HelperMethods.Ki(Qb.offsetLeft+Ga+Lc.x)}}c$b(Ga){this.AI&&(Ga&&!this.w1?(this.AI.ula(this.ohg),this.AI.Kmc(this.E0a),this.AI.mIb(this.LNa),this.w1=!0):this.w1&&(this.AI.qqa(this.ohg),this.AI.$Uc(this.E0a),this.AI.p5b(this.LNa),this.w1=!1))}yze(Ga){switch(Ga){case -798660877:case 137938150:case 2091832999:case 742457698:this.UNb=!0;break;case 125627505:this.TNb=
!0;break;case 267796030:this.SNb=!0}}}nb.OId=0;nb.v1i=1;Object(la.a)(nb,"AutoCompleteControl",ia.a,[243]);var sa=a(10);class na extends Sys.EventArgs{constructor(Ga,Qb,wc,S){Qb=void 0===Qb?0:Qb;wc=void 0===wc?"":wc;S=void 0===S?"":S;super();this.length=Ga;this.selectedIndex=Qb;this.dQ=wc;this.description=S}}Object(la.a)(na,"ListEventArgs",Sys.EventArgs,[]);class ab{constructor(Ga,Qb){this.Vhh=Ga;this.Uhh=Qb}get Bua(){return this.Vhh}get wsd(){return this.Uhh}}Object(la.a)(ab,"CellAutoCompleteItem",
null,[261]);var Ja=a(1249),Pa=a(556),hb=a(46),ac=a(1),Hc=a(28);class bd extends Ja.a{constructor(Ga,Qb,wc){super(Ga,Qb);this.vy=null;this.RKc=0;this.Zca=this.mqb=null;this.ANa=(S,eb)=>{if(S=this.vy.items)if(1===S.length&&this.vy.WMb.length<S[0].Bua.length&&this.vy.$Ka&&Hc.a.bI(S[0].Bua,this.vy.WMb)&&(eb.newValue=S[0].Bua),this.Zi&&ac.EwaSettings.Ra(128)){let ec=-1;1<S.length?ec=this.vy.ECc(this.Zi.text,!0):1===S.length&&(this.vy.$Ka||this.vy.vEc)&&(ec=0);if(0<=ec&&S.length>ec&&S[ec].wsd){const Lc=
hb.G(S[ec].wsd);Lc&&$a.f(this.$).oh.VLa(Lc)&&(eb.DXf=!0,eb.Rdf=S[ec].wsd)}}};this.Z1b=()=>{this.vy.$Ka=!1};this.Zi.YHb(this.ANa);this.vy=wc;this.Zca=this.pl.Yk(this.Zi.Wa.domElement);this.Zca.Ba("mousedown",this.Z1b)}get SGc(){return!1}get MLa(){return this.vy.vn}set MLa(Ga){this.vy.vn=Ga}get XEc(){return!1}get key(){return Pa.a.mvd}dispose(){this.Zi.SUc(this.ANa);super.dispose()}$ua(Ga){Ga&&!this.vy.vn||super.$ua(Ga)}Dq(Ga,Qb){this.vy.Zi=this.Zi;this.RKc=Ga.keyCode;if(this.Zi.isEditing){const wc=
this.Zi.text;Hc.a.equals(this.mqb,wc,!1)||(this.mqb=wc)}else this.mqb=null;if(237279923===Qb)return this.vy.vn=!1;ac.EwaSettings.Ra(128)&&17===this.RKc&&this.vy.$Ka&&(this.vy.vEc=!0);return super.Dq(Ga,Qb)}phg(){var Ga;if(!ac.EwaSettings.isChangeGateEnabled("OfficeVSO:5172529_CheckForShuttingDownInAutocompletionTimedCallback")||!Ka.AFrameworkApplication.Xl)if(this.vy.Zi=this.Zi,this.vy.$Ka=!1,this.Zi.isEditing){const Qb=!Hc.a.equals(this.mqb,this.Zi.text,!0),wc=this.Zi.kWd;wc||!Qb&&229!==this.RKc?
wc&&(this.vy.vn&&(this.vy.vn=!1),null===(Ga=this.vy.o3a)||void 0===Ga?void 0:Ga.cancel()):this.vy.VJh(this.RKc)}else this.mqb=null}Cn(){}Rl(){this.MLa=!1;this.vy.set_visible(!1);this.mqb=null;this.vy.$Ka=!1;this.vy.vEc=!1;this.vy.o3a&&this.vy.o3a.cancel()}xyg(Ga,Qb){return this.vy.Dq(Ga,Qb)}}Object(la.a)(bd,"CellAutoCompleteListAutoCompleteBehavior",Ja.a,[]);var zc=a(35),oc=a(1089),Nb=a(65),Aa=a(16),Ub=a(137),Db=a(1109);class Ib extends oc.a{constructor(Ga,Qb){super(Ga,Qb,new Db.a("list-item","list-item-selected",
"list-table","list-table-touch"));this.jDc=!1;this.XFb=this.w5=null;this.ZBf=!1;this.visible=void 0;this.AQa(!0);this.ZBf=ac.EwaSettings.isChangeGateEnabled("OfficeVSO:5893822_FixFormulaBarXOffsetCrash")}get OId(){const Ga=document.getElementById(this.$.xi+wa.a.MId);return!this.ZBf||Ga?Aa.DOMElementExtensions.getBoundingClientRect(Ga).x:0}get hm(){return this.XFb}set hm(Ga){this.XFb=Ga}get vn(){return void 0!==this.visible?this.visible&&0<this.w5.length:(this.visible=Aa.DOMElementExtensions.isVisible(this.$m))&&
0<this.w5.length}set vn(Ga){this.visible!==Ga&&(Aa.DOMElementExtensions.setVisible(this.$m,Ga),Aa.DOMElementExtensions.setVisible(this.Wyb,Ga),this.visible=Ga);const Qb=$a.f(this.$).view;Ga?this.jDc||(Qb.oz(this.vsd.b$d),this.jDc=!0):(this.w5.length=0,this.jDc&&(Qb.dy(this.vsd.b$d),this.jDc=!1))}FNc(){var Ga=460;const Qb=$a.f(this.$);var wc=Qb.domElement,S=this.Wyb.style;const eb=this.$m.offsetTop+this.av.offsetHeight*this.av.sectionRowIndex-this.$m.scrollTop;S.width="auto";S.whiteSpace="nowrap";
S.position="absolute";const ec=wc.offsetLeft+wc.offsetWidth-(this.domElement.offsetLeft+this.$m.offsetLeft+this.$m.offsetWidth+3);wc=this.domElement.offsetLeft-3-(wc.offsetLeft+this.OId);Ga=Math.min(this.Wyb.offsetWidth,Ga,Math.max(ec,wc));Aa.DOMElementExtensions.hI(this.Wyb,Ga);S.whiteSpace="";S.position="absolute";eb+3>this.$m.offsetTop+this.$m.offsetHeight||eb<this.$m.offsetTop||(Ga=this.$m.offsetLeft-3-this.Wyb.offsetWidth,S=this.$m.offsetLeft+this.$m.offsetWidth+3,Aa.DOMElementExtensions.updatePosition(this.Wyb,
wc>ec!==Qb.rtl?Ga:S,eb,!1))}HH(Ga){super.HH(Ga);this.FNc()}Uy(){this.FNc()}JVa(){const Ga=this.sr,Qb=this.$m,wc=3===Nb.a.rh||zc.a.Zx,S=wc?this.XMa:this.iN;this.vn=!0;Qb.style.height="auto";this.vsd.set_visible(!0);this.PHb(Ga,wc);this.w5.length>S&&(Aa.DOMElementExtensions.DW(Qb,Math.floor(Qb.offsetHeight*S/this.w5.length)),Qb.style.overflowY="auto");Aa.DOMElementExtensions.hI(Qb,Ga.offsetWidth+(this.w5.length>S?Ub.a.ey:0))}}Object(la.a)(Ib,"AutoCompleteListBox",oc.a,[]);class yc extends Ib{constructor(Ga,
Qb,wc,S){super(Ga,Qb);this.Bjc=null;this.Bi=wc;this.vy=S;this.w5=[]}get av(){return this.Bjc}set av(Ga){this.R9a(this.av);this.Bjc=Ga;const Qb=this.R9a(this.av);this.hm=Ga?Qb.innerText:null;this.pne(Ga)}get vn(){return super.vn}set vn(Ga){super.vn=Ga;Ga||(this.av=null)}get Wyb(){return null}get vsd(){return this.vy}dispose(){super.dispose();this.Bjc=null}DXk(Ga){this.hCa(!1);const Qb=document.createElement("table");Qb.classList.add(this.nza);Qb.DJh=wa.a.KGa;const wc=document.createElement("tbody");
for(let S=0,eb=this.w5.length;S<eb;S++){const ec=document.createElement("tr"),Lc=document.createElement("td");Lc.classList.add(this.n3a);const Ad=document.createElement("span");Ad.classList.add(yc.nvd);Ad.setAttribute(wa.a.x6e,Ga[this.w5[S]].Bua);Ad.innerText=Ga[this.w5[S]].Bua;Lc.appendChild(Ad);ec.appendChild(Lc);wc.appendChild(ec)}Qb.appendChild(wc);this.Bi.nM(this.$m);this.$m.appendChild(Qb);this.sr=Aa.DOMElementExtensions.tv(this.domElement,this.nza);this.hCa(!0);this.JVa()}Vvi(Ga,Qb){if(Ga&&
Ga.length){var wc=[];if(Qb)for(let S=0,eb=Ga.length;S<eb;S++)Hc.a.bI(Ga[S].Bua,Qb)&&wc.push(S);this.w5=wc;this.DXk(Ga)}else this.vn=!1,this.Bjc=null}FNc(){}SRh(Ga,Qb,wc){let S=Math.min(Ga,Math.max(200,wc));Qb&&Ga<wc&&(S+=Ub.a.ey);Aa.DOMElementExtensions.hI(this.$m,S);Qb&&(S-=Ub.a.ey);return S}JVa(){super.JVa();var Ga=Aa.DOMElementExtensions.tv(this.get_element(),this.nza),Qb=this.w5.length>this.iN,wc=$a.f(this.$);if(wc=wc.zh(wc.ha.qa.activeCell))for(Ga=this.SRh(Ga.offsetWidth,Qb,wc.width),Qb=this.$m.getElementsByClassName(yc.nvd),
wc=0;wc<Qb.length;wc++)Qb[wc].style.maxWidth=Jb.HelperMethods.Ki(Ga);else Ca.ULS.sendTraceTag(537167964,0,15,"CellAutoCompleteListBox.AdjustHeightAndWidth: Can't retrive FormattedCell of the Current Active Cell.")}onItemClick(Ga){if(Ga=super.onItemClick(Ga)){const Qb=$a.f(this.$);Qb.Tz(!1);Qb.focus()}return Ga}}yc.nvd="ewa-suggested-cell-name";Object(la.a)(yc,"CellAutoCompleteListBox",Ib,[]);var xc=a(27),zb=a(73),vb=a(140),bb=a(184),La=a(54),pb=a(41),fa=a(325),kb=a(19),db=a(95),gb=a(5),Kb;let ub=
Kb=class extends nb{constructor(Ga,Qb,wc,S,eb){super(Ga,eb);this.ISa=null;this.lvd=[];this.vEc=this.$Ka=!1;this.yRe=this.ft=null;this.Mrf=()=>{this.B$.Vvi(this.items,this.ISa);this.raiseEvent("ACLBUpdated",new na(this.items.length));this.show()};a(1447);this.Qj=Qb;this.domElement.className="ewa-ac";Qb=document.createElement("div");Qb.classList.add("ewa-lb");Qb.classList.add(kb.a.oH);Qb.id="suggested_cells_list_box";this.domElement.appendChild(Qb);Aa.DOMElementExtensions.setVisible(this.domElement,
!1);fa.d(this.style,this.$.isChromeRtl);this.Qdf=$get("suggested_cells_list_box",this.domElement);this.B$=new yc(this.$,this.Qdf,wc,this);this.c$b(!0);this.$.domElement.appendChild(this.domElement);vb.b(this.$,ec=>{this.pJb(Ga,ec)});this.pJb(Ga,$a.f(Ga).Fh);this.fij=ac.EwaSettings.isChangeGateEnabled("OfficeVSO:8554518_ChangeHandleKeyDownConditionOrder");S.Ba(this)}wpd(Ga){this.addHandler("ACLBUpdated",Ga)}fje(Ga){this.removeHandler("ACLBUpdated",Ga)}Zw(Ga){this.addHandler("ACLBSelectionChanged",
Ga)}vx(Ga){this.removeHandler("ACLBSelectionChanged",Ga)}UCh(Ga){this.addHandler("ACLBMatchedItem",Ga)}ank(Ga){this.removeHandler("ACLBMatchedItem",Ga)}get AI(){return this.B$}get WMb(){return this.ISa}get hm(){return this.B$.hm}get items(){return this.ft}get o3a(){return this.yRe}get activeCell(){return $a.f(this.$).ha.qa.activeCell}NYg(Ga){for(let Qb=0;Qb<Ga.length;Qb++)if(Hc.a.isLetter(Ga.charCodeAt(Qb)))return!0;return!1}yob(){return!this.items}dispose(){if(this.$){this.c$b(!1);const Ga=$a.f(this.$);
Ga&&Ga.view.dy(this.b$d)}Va.a.gj([this.B$,this.o3a]);Va.a.gj(this.lvd);this.lvd=this.Qdf=this.B$=this.Zi=null;super.dispose()}Dq(Ga,Qb){let wc=!1;if(this.zLk())switch(Qb){case -798660877:if(1===this.items.length&&this.hm)break;this.AI.HH(1);this.raiseEvent("ACLBSelectionChanged",new na(this.items.length,this.ECc(this.hm),this.hm));wc=this.autoComplete(!1);break;case 137938150:if(1===this.items.length&&this.hm)break;this.AI.HH(-1);this.raiseEvent("ACLBSelectionChanged",new na(this.items.length,this.ECc(this.hm),
this.hm));wc=this.autoComplete(!1);break;case 2091832999:this.AI.HH(this.iN-1);wc=this.autoComplete(!1);break;case 742457698:this.AI.HH(-(this.iN-1));wc=this.autoComplete(!1);break;case 125627505:this.Zi.Wa.caretPosition=this.Zi.text.length;this.vn=!1;wc=!0;break;case 267796030:this.autoComplete(!0);break;default:wc=super.Dq(Ga,Qb)}return wc}show(){this.items&&this.items.length&&(this.B$.av=this.hm?this.AI.sr.rows[this.ECc(this.hm)]:null,this.vn=0<this.B$.w5.length,this.mRa(!0),this.B$.FNc())}VJh(Ga){const Qb=
!!this.Zi&&!zb.f(this.$.ma);this.vEc=this.$Ka=!1;this.Zi&&!this.Zi.isEditing?this.set_visible(!1):Qb&&!this.mbi(this.activeCell)&&this.VPk(Ga)}mbi(Ga){var Qb;return null===(Qb=db.a.nh(gb.tb))||void 0===Qb?void 0:Qb.SCd(Ga)}autoComplete(Ga){if(!this.Zi||!this.vn)return!1;const Qb=this.ISa;if(this.hm){var wc=Aa.DOMElementExtensions.sga(Aa.DOMElementExtensions.tv(this.B$.av,yc.nvd),wa.a.x6e,"");const S=wc.substring(Qb.length,wc.length);Ga?this.Zi.text=wc:this.Zi.insertTextAt(S,Qb.length,this.Zi.text.length)}wc=
$a.f(this.$);wc.xA&&(wc=wc.Fh,wc.text=this.Zi.text,wc.setCaretPosition(this.Zi.Wa.caretPosition));Ga?this.vn=!1:this.Zi.Wa.selectRange(Qb.length,this.Zi.text.length);return!0}ECc(Ga,Qb){Qb=void 0===Qb?!1:Qb;if(!this.B$.sr)return-1;const wc=this.B$.sr.children[0],S=wc.children.length;let eb;for(let ec=0;ec<S;++ec)if(eb=wc.children[ec],Hc.a.equals(eb.innerText.trim(),Ga,Qb))return ec;return-1}qxh(Ga,Qb,wc,S,eb,ec,Lc){const Ad=wc.originalText.replace(Kb.gfg,String.fromCharCode(32)),pd=new xc.Range(Ga.top-
1,Ga.left,Ga.bottom-1,Ga.right,!1,!1),de=Lc?Lc.Ey(wc.range):null;(!wc.AH||wc.range.left===Ga.left)&&1<Ad.length&&!S.lh(Ad.toUpperCase())&&Hc.a.bI(Ad,Qb)&&!Hc.a.equals(Ad,Qb,!0)&&!Kb.mAf(Qb)&&this.NYg(Ad)&&(!eb&&!de||!eb&&de.equals(Lc.Ey(pd))||eb&&wc.range.Xi(ec)&&wc.range.top!==ec.top)&&(Ga=wc.formulaBarText,Hc.a.equals(Ga,wc.text,!1)||!Ga)&&(Ga={},Ga.FirstRow=wc.range.top-1,Ga.FirstColumn=wc.range.left-1,wc=new ab(Ad,Ga),S.add(Ad.toUpperCase(),wc))}VPk(Ga){this.ft=this.VXi();this.o3a&&this.o3a.cancel();
0<this.Zi.text.length&&0!==Ga?this.items&&((1<this.items.length||this.vn)&&this.tii(),8!==Ga&&127!==Ga&&46!==Ga&&(1===this.items.length?this.Z9i():this.B$.av&&this.autoComplete(!1))):this.vn=!1}tii(){this.vn?this.Mrf():this.yRe=bb.AsyncMethodContext.wC(this.Mrf,500,La.a.FUh,this.o3a)}Z9i(){Ca.ULS.shipAssertTag(537167966,0,!this.yob()&&1===this.items.length,"Invalid Items");const Ga=this.items[0].Bua,Qb=this.Zi.text,wc=Ga.substring(Qb.length,Ga.length);0<wc.length&&(this.Zi.appendText(wc),this.Zi.Wa.selectRange(Qb.length,
this.Zi.text.length),this.raiseEvent("ACLBMatchedItem",new na(this.items.length,0,Ga)),this.$Ka=!0)}VXi(){this.ft=null;const Ga=new pb.a(!1);var Qb=this.activeCell;this.ISa=this.Zi.text.replace(Kb.gfg,String.fromCharCode(32));const wc=this.Qj.Ey(Qb),S=Qb.Xi(wc);if(Kb.mAf(this.ISa)||!this.NYg(this.ISa))return this.items;const eb=new xc.Range(1,Qb.left,Qb.top-1,Qb.left,!1,!1);var ec=new xc.Range(Qb.top+1,Qb.left,sa.a.Rk,Qb.left,!1,!1);let Lc;const Ad=$a.f(this.$);ec=Ad.ot("CellAutoCompleteControl.GetSuggestedCells",
ec);try{const pd=Ad.ot("CellAutoCompleteControl.GetSuggestedCells2",eb);try{for(const de of[pd,ec])for(;de.$$mn();)Lc=de.$$cu(),this.qxh(Qb,this.ISa,Lc,Ga,S,wc,this.Qj)}finally{pd&&pd.dispose()}}finally{ec&&ec.dispose()}this.ft=Array(Ga.values.length);for(Qb=0;Qb<this.items.length;Qb++)this.items[Qb]=Ga.values[Qb];this.items.sort((pd,de)=>pd.Bua.localeCompare(de.Bua));return this.items}pJb(Ga,Qb){Ga&&Qb&&this.lvd.push(new bd(Ga,Qb,this))}zLk(){return this.fij?this.WMb&&!this.yob()&&this.vn?this.get_visible():
!1:this.WMb&&!this.yob()&&this.get_visible()&&this.vn}static get gfg(){return Kb.iTe||(Kb.iTe=new RegExp(String.fromCharCode(160),"g"))}static mAf(Ga){Ga=0<Ga.length?Ga.charCodeAt(0):-1;return 35===Ga||61===Ga||43===Ga||45===Ga||64===Ga}};ub.iTe=null;ub=Kb=Object(za.__decorate)([Object(db.d)(gb.K,{Fk:"transient"}),Object(za.__param)(0,Object(gb.Nb)()),Object(za.__param)(1,Object(gb.vg)()),Object(za.__param)(2,Object(gb.pd)()),Object(za.__param)(3,Object(gb.L)()),Object(za.__param)(4,Object(gb.ah)())],
ub);Object(la.a)(ub,"CellAutoCompleteControl",nb,[242,243,244,4]);var lb=a(12);let Ba=class{constructor(Ga){this.Ofb=null;this.Vog=(Qb,wc)=>{1<wc.length&&(Qb=lb.a.instance.ia(858),this.ariaLiveNotifier.cBg(Qb,wc.length))};this.Wog=(Qb,wc)=>{Ca.ULS.shipAssertTag(537167961,0,0<=wc.selectedIndex&&0<=wc.length&&wc.selectedIndex<wc.length,"Invalid ListEventArgs: SelectedIndex/Length");Ca.ULS.shipAssertTag(537167960,0,!!wc.dQ,"ListEventArgs: SelectedValue should not be null");this.ariaLiveNotifier.Mek(wc.dQ,
wc.selectedIndex+1,wc.length)};this.Xog=(Qb,wc)=>{this.ariaLiveNotifier.mca(wc.dQ)};this.ariaLiveNotifier=Ga}dispose(){this.eze();this.Ofb=null}Ba(Ga){Ga&&(this.Ofb=Ga,Ga.wpd(this.Vog),Ga.Zw(this.Wog),Ga.UCh(this.Xog))}eze(){this.Ofb&&(this.Ofb.fje(this.Vog),this.Ofb.vx(this.Wog),this.Ofb.ank(this.Xog))}};Ba=Object(za.__decorate)([Object(db.d)(gb.L),Object(za.__param)(0,Object(gb.l)())],Ba);Object(la.a)(Ba,"CellAutoCompleteReadoutHandler",null,[756,4]);var ra=a(211),wb=a(67);let mc=class{constructor(Ga){this.vtj=
ac.EwaSettings.isChangeGateEnabled("OfficeVSO:8347550_DatePicker_VerboseLogs");this.tbi=Ga}Ri(){return!1}executeCommand(Ga,Qb){Ga=!1;Qb=Qb.command;switch(Qb){case 1159342996:this.vtj&&Ca.ULS.sendTraceTag(508117152,0,50,"DatePicker Invoked through Ribbon Command"),this.tbi.Q8b(!0),Ga=!0}return Ga?wb.Task.Ua(!0):ra.a(Qb)}Gi(Ga,Qb){switch(Qb.command){case 1159342996:return ac.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DatePicker",!1);default:return!1}}dj(){return!1}};mc=Object(za.__decorate)([Object(db.d)(gb.vb),
Object(za.__param)(0,Object(gb.wb)())],mc);Object(la.a)(mc,"DatePickerCommandHandler",null,[34]);var xb=a(130),Ec=a(599),ed=a(96),jd=a(1036),Xd=a(283),Td=a(628),gc=a(161),nc=a(156),dc=a(2),Gc=a(323),vd=a(243),zd;let Yb=zd=class extends jd.a{constructor(Ga,Qb,wc,S){var eb,ec,Lc;super(Ga,zd.featureName);this.NGc=!1;this.fdl=ac.EwaSettings.isChangeGateEnabled("OfficeVSO:8347550_DatePicker_VerboseLogs");this.Q_k=new Date;this.xmc=Ad=>{this.fdl&&Ca.ULS.sendTraceTag(508101778,0,50,`[DatePicker-Ewa] ${Ad}`)};
this.EYa=()=>{this.NGc&&Object(nc.d)(()=>{this.qK.OI();this.NGc=!1;this.oj.detach("scroll");this.da.view.dy(this.EYa)})};this.onActiveCellChanged=()=>{const Ad=this;return Lo(function*(){ac.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DatePickerFloatie",!1)&&(Ad.EYa(),vd.a(()=>Lo(function*(){!Ad.qK.lWb()&&(yield Object(Td.b)(Ad.grid.zh(null)))&&(Ca.ULS.sendTraceTag(508610529,0,100,"DatePickerControl.onActiveCellChanged: Date Picker Floatie is to be shown"),Ad.FUg())}),100)())})};this.yNa=
(Ad,pd)=>{const de=this;return Lo(function*(){de.EYa();!de.wNb&&(yield Object(Td.a)(pd))&&(Ca.ULS.sendTraceTag(509147206,0,50,"DatePickerControl.onCellEditStarted: Encountered Date in cell, Date Picker service already available, showing date picker"),de.puc.start(),de.Q8b())})};this.xNa=()=>{this.pCd()};this.GA=()=>{var Ad;Object(gc.g)(null===(Ad=this.grid.Fh)||void 0===Ad?void 0:Ad.text)&&this.pCd()};this.pCk=Ad=>{var pd,de=this.da.Fh,Ge=this.da.zh(null);if(Ge){var Re=null===(pd=this.Sj)||void 0===
pd?void 0:pd.config;if(!Re){this.Lle("DatePickerControl.SetCellDate: calc config unavailable",de);return}Ad=excelOnlineCalc.date.dateTime(Ad.getFullYear(),Ad.getMonth()+1,Ad.getDate(),Ad.getHours(),Ad.getMinutes(),Ad.getSeconds(),0,Ad.getMilliseconds(),0);Ad=Re.datepack.toNum(Re,Ad);Re=Re.mathpack.toNumber(Ad);this.wNb=!1;if(this.FWf||this.$.nha){Ad=this.yk.iOd(Ge,{ValidMembers:32,NumberFormat:4});if(!Ad.success&&Ad.kNa){this.Lle(`DatePickerControl.SetCellDate: Conversion to ribbon number format failed, LogData:  ${`
            reason: ${Ad.reason},
            format: ${Ad.kNa}`}`,de);return}Ge=this.yk.tzi(Re.toString(),Ad.kNa,Ge.cell.L4);if(!Ge.success){this.Lle("DatePickerControl.SetCellDate:formatStringValueWithFormatString failed",de);return}de.text=Ge.KM;this.FWf=!1}else de.text=Re.toString();this.NGc?(de=Object(dc.a)(new Gc.a,{Text:de.text}),this.da.setCell(de,this.da.ha.qa.activeRange,0,127,null),this.EYa()):de.endEdit(!0,"DatePickerControl.SetCellDate",0);Ca.ULS.sendTraceTag(509110228,0,50,"DatePickerControl.setCellDate: User selected Date using Date Picker")}this.Nia()};
this.Lle=(Ad,pd)=>{Ca.ULS.sendTraceTag(508956939,0,10,Ad);pd.endEdit(!0,"DatePickerControl.SetCellDate Failed",0);this.Nia()};this.jli=()=>{this.puc&&(this.puc.stop(),Ca.ULS.sendTraceTag(508823174,0,50,`DatePickerControl: Time taken to render DatePicker: ${this.puc.zi}`))};this.Nia=Ad=>{Object(nc.d)(()=>{this.xmc("DatePickerControl: Restoring Focus ");this.wNb=!1;xb.FocusManager.instance().Xr(Ec.AFrame.n0);ed.a.Vvb(Aa.DOMElementExtensions.URb(this.$.Bl),Nb.a.rh,Ad,this.$,this.da)})};this.Uwg=()=>
{this.xmc("DatePickerControl: Preserving Focus ");xb.FocusManager.instance().Xr(Ec.AFrame.b2)};this.$=Ga;this.da=$a.f(this.$);this.Sj=Qb;this.yk=wc;this.qK=S;null===(eb=this.da.Fh)||void 0===eb?void 0:eb.Jx(this.xNa);null===(ec=this.da.Fh)||void 0===ec?void 0:ec.mO(this.yNa);null===(Lc=this.da.Fh)||void 0===Lc?void 0:Lc.AVa(this.GA);this.da.ha.add_activeCellChanged(this.onActiveCellChanged);this.puc=this.$.Eh.em("DialogShown","DatePickerRender")}dispose(){var Ga,Qb,wc;this.xmc("Dismissing DatePickerControl");
this.pCd();this.EYa();null===(Ga=this.da.Fh)||void 0===Ga?void 0:Ga.uN(this.yNa);null===(Qb=this.da.Fh)||void 0===Qb?void 0:Qb.Lw(this.xNa);null===(wc=this.da.Fh)||void 0===wc?void 0:wc.P6a(this.GA);this.da.ha.remove_activeCellChanged(this.onActiveCellChanged);super.dispose()}get hl(){return Xd.a.Hnf}FUg(){c(this.grid,this.qK);this.NGc=!0;this.da.view.oz(this.EYa);this.oj.Ba("scroll",this.EYa)}Q8b(Ga){this.FWf=void 0===Ga?!1:Ga;this.hGg(this.da.ha.qa.activeCell,!0)}pCd(){this.wNb&&(ac.EwaSettings.isChangeGateEnabled("OfficeVSO:8389936_datepicker_architecture_change")?
Object(nc.d)(()=>{appChrome.hideDatePicker();this.wNb=!1}):this.hGg(null,!1))}hGg(Ga,Qb){Ga=void 0===Ga?null:Ga;const wc=()=>{this.Qxb(Ga,eb=>{this.xmc(`DatePickerControl.renderDatePicker: ${Qb?"Showing":"Hiding"}  DatePicker at targetBounds: ${JSON.stringify(eb)}`);appChrome.renderDatePicker(this.domElement,eb.y,eb.x,eb.y+eb.height,eb.x+eb.width,Qb,Qb?this.RGi():this.Q_k,this.pCk,this.Nia,this.Uwg,this.bxb,this.da.rtl)});(this.wNb=Qb)&&this.jli()},S=()=>{Object(nc.d)(()=>{wc()})};ac.EwaSettings.isChangeGateEnabled("OfficeVSO:8389936_datepicker_architecture_change")&&
Object(nc.a)()&&window.requestIdleCallback?window.requestIdleCallback(wc,{timeout:100}):S()}RGi(){var Ga,Qb=new Date,wc=null===(Ga=this.da.zh(null))||void 0===Ga?void 0:Ga.cell;if((null===wc||void 0===wc?0:wc.cellValue)&&this.Sj.sYf(wc.qo)&&1===wc.vD){Ga=this.Sj.config;wc=parseInt(wc.cellValue,10);if(!wc||0>=wc)return Qb;Qb=Ga.mathpack.fromNumber(wc);Qb=Ga.datepack.fromNum(Ga,Qb,0);Qb=new Date(Qb.yr,Qb.mon-1,Qb.dom)}return Qb}Qs(){this.Uwg()}nu(){this.Nia()}};Yb=zd=Object(za.__decorate)([Object(db.d)(gb.wb),
Object(za.__param)(0,Object(gb.Nb)()),Object(za.__param)(1,Object(gb.E)()),Object(za.__param)(2,Object(gb.xc)()),Object(za.__param)(3,Object(gb.eb)())],Yb);Object(la.a)(Yb,"DatePickerControl",jd.a,[4]);var Pb=a(371),$c=a(83);Object(db.b)(gb.Dc)(()=>Lo(function*(){const Ga=yield db.a.resolve(gb.Nb);return(Qb,wc,S)=>{if(wc||(void 0===S?0:S))a:if(wc){if(Qb&&(!Qb||Qb.startsWith("http://")||Qb.startsWith("https://"))){if(ac.EwaSettings.Ra(147)&&(wc=db.a.nh(gb.xf))&&wc.OCa(Qb))break a;Jb.HelperMethods.Cm(Qb,
"_blank",Pb.a)}}else Jb.HelperMethods.n7(Ga.EN,"XLWAEndUser_"+Qb,Ga.wQ);else wc=new $c.a(-859308420,Nb.a.rh,Ga.hi,0,null),Ga.Ma.qh(wc,{[Nb.a.Qi]:wa.a.FK,[Nb.a.Xk]:"HelpID="+Qb})}}));var wd=a(25),Bd=a(149),tc=a(245);class Zc extends Sys.EventArgs{constructor(Ga,Qb){super();this.functionName=Ga;this.xCf=Qb}}Object(la.a)(Zc,"FormulaAssistanceFunctionChangedEventArgs",Sys.EventArgs,[]);class Ab extends Sys.EventArgs{constructor(Ga){super();this.NMg=Ga}}Object(la.a)(Ab,"FormulaAssistanceSelectedParameterChangedEventArgs",
Sys.EventArgs,[]);var rb=a(305);class Fb{constructor(Ga,Qb,wc,S,eb){this.kGc=this.SWa=!1;this.$=Ga;this.formulaAssistanceUIControl=Qb;this.PBf=wc;this.Fne=S;this.rPf=void 0===eb?null:eb;this.kGc=ac.EwaSettings.isChangeGateEnabled("OfficeVSO:6592066_FixAutoCompleteCardFocusBug")}get Zo(){return this.SWa}set Zo(Ga){this.SWa!==Ga&&(Ga?rb.a(this.$).Tq(this):rb.a(this.$).VH(this),this.SWa=Ga)}get hl(){return this.Fne}get hj(){return this.formulaAssistanceUIControl.getRootElement(this.PBf)}Vp(Ga,Qb){Ga=
!1;Qb||($a.f(this.$).Bp.Wa.QM=!0,Ga=this.formulaAssistanceUIControl.focus(this.PBf));return Ga}tq(Ga){const Qb=this.hj;return!(void 0===Qb||null===Qb)&&Aa.DOMElementExtensions.eo(Qb,Ga)}Qs(){this.rPf&&this.rPf();const Ga=$a.f(this.$).Bp.Wa;this.selection=Ga.selection;Ga.removeSelection()}nu(){$a.f(this.$).Bp.Wa.selection=this.selection}dispose(){rb.a(this.$).VH(this)}}Object(la.a)(Fb,"FormulaAssistanceFocusManager",null,[47,4]);var jc=a(17),Oc=a(98),cd=a(158),Ed=a(306),Sd=a(169);class $d{constructor(Ga){this.V$=
Ga;this.e6=this.Qre=this.Wv=!1;this.onKeyDown=Qb=>this.e6||"Space"!==Qb.code&&" "!==Qb.key||!Qb.altKey||!Qb.ctrlKey?!1:(this.Pwc(),Qb.stopPropagation(),Qb.preventDefault(),!0);this.X2a=Qb=>{if(!this.e6)return!1;if(Qb.eventName===jc.a.Ui){const wc=Qb.La.ctrlKey?1:Qb.La.shiftKey?50:10;switch(Qb.La.keyCode){case Oc.a.G$a:this.Qha(0,-wc);break;case Oc.a.bDa:this.Qha(0,wc);break;case Oc.a.yRa:this.Qha(-wc,0);break;case Oc.a.aAb:this.Qha(wc,0);break;case Oc.a.d_:case Oc.a.yu:this.Qre=!0;break;default:return!1}}Qb.eventName===
jc.a.rk&&this.Qre&&this.ega(!0);Qb.La.preventDefault();return!0};this.$2b=Qb=>{if(!this.e6)return!1;Qb.La.preventDefault();this.ega();return!0};this.onBlur=()=>{if(!this.e6)return!1;this.ega();return!0};this.PD=cd.a.instance;this.Sce=Ed.a.instance}Ba(Ga){(this.root=Ga)&&!this.Wv&&(this.root.addEventListener("keydown",this.onKeyDown,!0),this.Wv=!0)}detach(){this.root&&this.Wv&&(this.root.addEventListener("keydown",this.onKeyDown,!0),this.Wv=!1)}Pwc(){this.root&&(this.V$.arg("move",!0),this.root.focus(),
this.e6=!0,this.Qre=!1,this.ZE(),this.n6d||this.Jzd(),this.root.appendChild(this.n6d))}ega(Ga){this.e6&&(this.e6=!1,this.V$.wRj(void 0===Ga?!1:Ga),this.tie(),this.Rhe())}ZE(){this.PD.capture(this.X2a,null);this.Sce.YD(jc.a.qj,this.root,this.$2b,!0);this.root.addEventListener("blur",this.onBlur)}Rhe(){this.PD.releaseCapture();this.Sce.hE(jc.a.qj,this.root,this.$2b,!0);this.root.removeEventListener("blur",this.onBlur)}tie(){var Ga;null===(Ga=this.n6d)||void 0===Ga?void 0:Ga.remove()}Qha(Ga,Qb){const wc=
this.V$.getPosition();wc.x+=Ga;wc.y+=Qb;this.V$.setPosition(wc)}Jzd(){this.n6d=Sd.a(24,24,"ShapeQuadArrow_24x24x32","WACMoveArrowIcon",!0,"")}}Object(la.a)($d,"FormulaAssistanceMoveAdapter",null,[]);var be=a(386);class Fe{constructor(Ga){this.V$=Ga;this.startOffset={x:0,y:0};this.$Xg=!0;this.Wv=!1}joa(){return this.Wv&&!!this.handle}F4a(Ga){const Qb=this.V$.getPosition();this.$Xg=Qb.renderDown;this.startOffset.x=Qb.x-Ga.clientPoint.x;this.startOffset.y=Qb.y-Ga.clientPoint.y;this.V$.arg("drag");return!0}Xza(Ga){this.V$.setPosition({x:Ga.clientPoint.x+
this.startOffset.x,y:Ga.clientPoint.y+this.startOffset.y,renderDown:this.$Xg});return!0}Wza(){}Vza(){}Ba(Ga,Qb){this.handle=Qb;this.root=Ga;this.handle&&(this.handle.style.cursor="move",be.a.instance.rca(this.handle,this,!1),this.Wv=!0)}detach(){this.Wv&&this.handle&&(this.handle.style.cursor="",be.a.instance.Hja(this.handle,this),this.Wv=!1)}}Object(la.a)(Fe,"FormulaAssistanceDragAdapter",null,[801]);class Pe{get getPosition(){return this.fmh}get setPosition(){return this.VXe}constructor(Ga){this.formulaAssistanceTelemetryManager=
Ga;this.Wv=!1;this.qoc=ac.EwaSettings.isChangeGateEnabled("OfficeVSO:7376612_argumentAssistanceOrderedActionsTelemetry");this.kbc={[hc.Drag]:0,[hc.Move]:0};this.rdg=new $d(this);this.yrf=new Fe(this)}Ba(Ga,Qb,wc,S){this.fmh=wc;this.VXe=S;this.rdg.Ba(Ga);this.yrf.Ba(Ga,Qb);this.Wv=!0}detach(){this.Wv&&(this.yrf.detach(),this.rdg.detach(),this.Wv=!1)}clear(){var Ga;null===(Ga=this.VXe)||void 0===Ga?void 0:Ga.call(this,null);this.detach();this.Ike()}arg(Ga,Qb){this.kbc[Ga]++;if(void 0===Qb?0:Qb)this.jee=
document.activeElement}wRj(Ga){this.jee&&((void 0===Ga||Ga)&&this.jee.focus(),this.jee=null)}Ike(){const Ga=this.formulaAssistanceTelemetryManager.Gla,Qb=this.kbc[hc.Drag],wc=this.kbc[hc.Move];0<Qb&&(this.formulaAssistanceTelemetryManager.qla("d"),this.qoc||(Ga.argumentAssistanceDragTotalCounter+=Qb),this.kbc[hc.Drag]=0);0<wc&&(this.formulaAssistanceTelemetryManager.qla("m"),this.qoc||(Ga.argumentAssistanceMoveTotalCounter+=wc),this.kbc[hc.Move]=0)}}Object(la.a)(Pe,"FormulaAssistanceDragControl",
null,[]);var hc;(function(Ga){Ga.Drag="drag";Ga.Move="move"})(hc||(hc={}));Object(la.b)("FormulaAssistanceDragMode",hc);var Lb=a(114),kc;(function(Ga){Ga[Ga.ArgumentAssistanceCard=0]="ArgumentAssistanceCard";Ga[Ga.AutoCompleteMenu=1]="AutoCompleteMenu";Ga[Ga.ValuePreview=2]="ValuePreview"})(kc||(kc={}));class dd extends ia.a{constructor(Ga,Qb,wc){super(dd.BJd());this.$=Ga;this.formulaAssistanceUIControl=Qb;this.formulaAssistanceTelemetryManager=wc;this.isExpanded=!0;this.cLc=this.PF=null;this.gvc=
this.CF=!1;this.jji=0;this.Grd=!1;this.setPosition=S=>{this.formulaAssistanceUIControl.setFixedPosition(S);this.formulaAssistanceUIControl.updatePosition(kc.ArgumentAssistanceCard)};this.getPosition=()=>this.formulaAssistanceUIControl.getPosition();this.Jj=()=>{this.visible=!1};this.onIsExpandedChange=S=>{this.S8k(S);S?this.formulaAssistanceTelemetryManager.qla("e"):this.formulaAssistanceTelemetryManager.qla("c")};this.onDismissClick=()=>{this.dismiss();this.grid.Bp.Wa.focus()};this.coe=S=>{var eb=
this.$;S=S.functionName;const ec={};ec[wa.a.cP]="ArgumentAssistanceCard";const Lc={};Lc.FunctionName=S;ec[wa.a.Yxc]=Lc;eb.si(802602464,0,8,ec);this.formulaAssistanceTelemetryManager.qla("gf")};this.Uy=()=>{this.formulaAssistanceUIControl.updatePosition(kc.ArgumentAssistanceCard)};this.Rl=()=>{this.V$.clear();this.V1k();this.Grd=!1};this.IEk();this.PF=new Fb(this.$,this.formulaAssistanceUIControl,kc.ArgumentAssistanceCard,Xd.a.OBf);this.grid=Object($a.f)(Ga);this.grid.view.oz(this.Uy);this.grid.ha.Zw(this.Jj);
this.V$=new Pe(this.formulaAssistanceTelemetryManager);this.grid.cellTextEditBox.Jx(this.Rl)}vCh(Ga){this.addHandler("FAFunctionNameUpdated",Ga)}Gmk(Ga){this.removeHandler("FAFunctionNameUpdated",Ga)}BEh(Ga){this.addHandler("FAParameterSelectionChangedOld",Ga)}uok(Ga){this.removeHandler("FAParameterSelectionChangedOld",Ga)}AEh(Ga){this.addHandler("FAParameterSelectionChanged",Ga)}tok(Ga){this.removeHandler("FAParameterSelectionChanged",Ga)}get visible(){return this.CF}set visible(Ga){Ga||this.dismiss();
this.CF=Ga}dismiss(){this.CF=!1;this.formulaAssistanceUIControl&&(this.V$.detach(),this.formulaAssistanceUIControl.dismiss(this.domElement),this.cLc=null,this.PF.Zo=!1)}show(Ga){this.CF=this.Grd=!0;Ga=this.C9j(Ga);this.formulaAssistanceUIControl&&(this.formulaAssistanceTelemetryManager.tQa(["argumentAssistanceRender"]),this.formulaAssistanceUIControl.renderArgumentAssistanceCard(this.domElement,Ga,()=>b(this.$)),this.frk(),this.N5j(Ga),this.V$.Ba(this.formulaAssistanceUIControl.getCalloutElement(kc.ArgumentAssistanceCard),
this.formulaAssistanceUIControl.getDraggableElement(kc.ArgumentAssistanceCard),this.getPosition,this.setPosition),this.PF.Zo=!0,this.formulaAssistanceTelemetryManager.k5(["argumentAssistanceRender"]),this.formulaAssistanceTelemetryManager.QOb("argumentAssistanceOverall"))}Dq(Ga,Qb){if(1872288872===Qb){if(this.visible)return this.gvc=!0;this.gvc&&(this.formulaAssistanceTelemetryManager.qla("2ndEsc"),this.gvc=!1)}else this.gvc=!1;return!1}c0a(Ga){return this.visible&&1872288872===Ga?(this.formulaAssistanceTelemetryManager.qla("esc"),
this.dismiss(),!0):!1}dispose(){this.$&&this.grid&&(this.grid.ha&&this.grid.ha.vx(this.Jj),this.grid.view.dy(this.Uy),this.grid.cellTextEditBox.Lw(this.Rl));Va.a.dh(this.PF);this.$=null}C9j(Ga){const Qb={isExpanded:!1,callbacks:null,functionRenderingInfo:null};Qb.functionRenderingInfo=Ga;Qb.isExpanded=this.isExpanded;this.jjk(Qb);return Qb}jjk(Ga){Ga.callbacks={onIsExpandedChange:null,onHelpLink:null,onFeedback:null,onDismissClick:null};Ga.callbacks.onHelpLink=this.DNi(Ga.functionRenderingInfo);Ga.callbacks.onIsExpandedChange=
this.onIsExpandedChange;Ga.callbacks.onFeedback=this.coe;ac.EwaSettings.isChangeGateEnabled("OfficeVSO:8745608_FormulaAssistanceDismiss")&&(Ga.callbacks.onDismissClick=this.onDismissClick)}DNi(Ga){return()=>{void db.a.resolve(gb.Dc).then(Qb=>Qb(Ga.helpID,Ga.isUDF));this.formulaAssistanceTelemetryManager.qla("lm")}}IEk(){const Ga=Bd.a.get(wa.a.R8e);Ga?this.isExpanded="false"!==Ga:(this.isExpanded=dd.cci,this.formulaAssistanceTelemetryManager.XBk());this.formulaAssistanceTelemetryManager.YBk(this.isExpanded)}N5j(Ga){var Qb=
Ga.functionRenderingInfo.functionName;this.cLc&&Hc.a.equals(this.cLc,Qb,!0)?(Qb=tc.a.map(Ga.functionRenderingInfo.signatures,wc=>{let S="";0<=wc.signatureParams.activeParam&&wc.signatureParams.activeParam<wc.signatureParams.params.length&&(S=wc.signatureParams.params[wc.signatureParams.activeParam]);return S}),this.raiseEvent("FAParameterSelectionChanged",new Ab(Qb))):(this.cLc=Qb,Ga=tc.a.map(Ga.functionRenderingInfo.signatures,wc=>wc.signatureParams.params.join(", ")),this.raiseEvent("FAFunctionNameUpdated",
new Zc(Qb,Ga)))}S8k(Ga){this.isExpanded=Ga;try{Bd.a.yG(wa.a.R8e,Ga.toString(),Ec.AFrame.QCa)}catch(Qb){Ca.ULS.sendTraceTag(512267714,0,15,`Failed setting ArgumentAssistanceCardCollapseState cookie with error message: ${Qb.message}`)}}static BJd(){return document.createElement("div")}frk(){const Ga=this.getPosition().renderDown?"rd":"ru";this.formulaAssistanceTelemetryManager.qla(Ga)}V1k(){this.Grd&&2===++this.jji&&this.$.si(953250532,-1,0,null)}}dd.cci=!0;Object(la.a)(dd,"FormulaArgumentAssistanceControl",
ia.a,[772]);var yb=a(945),Ta=a(215);const Hb=[Object(Ta.d)("featureNameField","FormulaSmartSuggestions"),Object(Ta.d)("ver","1.0.0")],uc={eventName:"Office.Excel.FormulaSmartSuggestions.Seen",eventFlags:yb.a,dataFields:[...Hb,Object(Ta.a)("isFeatureSeen",!0)]},Sc={eventName:"Office.Excel.FormulaSmartSuggestions.Tried",eventFlags:yb.a,dataFields:[...Hb,Object(Ta.a)("isFeatureTried",!0)]},bc={eventName:"Office.Excel.FormulaSmartSuggestions.Succeeded",eventFlags:yb.a,dataFields:[...Hb,Object(Ta.a)("isFeatureSucceeded",
!0)]};var vc=a(649),Xc;(function(Ga){Ga[Ga.Dismissed=0]="Dismissed";Ga[Ga.Smart=1]="Smart";Ga[Ga.Simple=2]="Simple";Ga[Ga.Mixed=3]="Mixed"})(Xc||(Xc={}));Object(la.b)("UIState",Xc);class ad extends ia.a{constructor(Ga,Qb,wc){super(ad.BJd());this.$=Ga;this.formulaAssistanceUIControl=Qb;this.formulaAssistanceTelemetryManager=wc;this.hMa=wd.a.cIc();this.PF=this.clearContentNotifier=this.Zi=this.da=null;this.hvc=this.ivc=this.fvc=this.SNb=this.TNb=this.jvc=this.UNb=!1;this.kR=null;this.g8=0;this.nue=
this.K_c=this.Y8a=this.Dgc=this.CF=!1;this.xac=Xc.Dismissed;this.onRestoreFocus=()=>{};this.dismiss=()=>{this.CF=!1;this.Eob&&this.Y8a&&this.S1a&&(this.hvc=!0);this.ezj();this.lha&&this.Zi.isEditing&&this.GUc();this.formulaAssistanceUIControl&&(this.formulaAssistanceUIControl.dismiss(this.domElement),this.PF.Zo=!1,this.xac=Xc.Dismissed)};this.N1i=()=>{this.raiseEvent("FAFocusOnSmartSuggestionsCard",null)};this.gsb=()=>{var S;const eb=this.da.ha.qa.selectedRanges,ec=null===(S=this.formulaAssistanceTelemetryManager.AP)||
void 0===S?void 0:S.Bq;eb.some(Lc=>Lc.contains(ec))&&this.formulaAssistanceTelemetryManager.L1d++};this.fAa=(S,eb)=>{0==eb.tx&&(170==eb.Ul.operation.operationName&&this.formulaAssistanceTelemetryManager.vLc++,this.$.userOperationManager.uu(this.fAa),this.cJc&&this.clearContentNotifier&&this.clearContentNotifier.RUc(this.gsb))};this.gae=(S,eb)=>{0==eb.tx&&(12==eb.Ul.operation.operationName&&this.$.userOperationManager.mw(this.fAa),this.$.userOperationManager.uu(this.gae))};this.UQj=()=>{this.dismiss();
this.da.Bp.Wa.focus()};this.coe=()=>{const S={};S[wa.a.cP]=this.Psg?"SmartSuggestionsCard":this.oue?"FunctionAndSmartSuggestionsCard":"SimpleAutoCompleteCard";this.$.si(802602464,0,8,S)};this.Rl=()=>{this.S1a&&this.wGh()};this.EPj=(S,eb)=>{this.Ozb(eb);this.jvc=!0};this.Jj=()=>{this.visible=!1};this.DPj=S=>{this.fvc=!0;this.yxd(S)};this.wq=()=>{this.dismiss()};this.Uy=()=>{this.formulaAssistanceUIControl.updatePosition(kc.AutoCompleteMenu)};this.da=$a.f(this.$);this.PF=new Fb(this.$,this.formulaAssistanceUIControl,
kc.AutoCompleteMenu,Xd.a.RBf,this.N1i);this.da.view.oz(this.Uy);this.da.ha.Zw(this.Jj);this.$.sa.pn(this.wq);this.S1a=ac.EwaSettings.isChangeGateEnabled("OfficeVSO:5523443_FormulaSuggestionsCardUserInteractionTelemetry");this.Eob=ac.EwaSettings.isChangeGateEnabled("OfficeVSO:6650011_LogSuggestionsDismissal");this.cJc=ac.EwaSettings.isChangeGateEnabled("OfficeVSO:7629619_RefiningKeptTelemetry");!this.hMa&&this.cJc&&this.$.la.fi(313,S=>{this.clearContentNotifier=S});this.S1a&&this.da.cellTextEditBox.Jx(this.Rl)}tCh(Ga){this.addHandler("FACardOpened",
Ga)}Emk(Ga){this.removeHandler("FACardOpened",Ga)}pCh(Ga){this.addHandler("FAFocusOnSmartSuggestionsCard",Ga)}Amk(Ga){this.removeHandler("FAFocusOnSmartSuggestionsCard",Ga)}sCh(Ga){this.addHandler("FormulaAutoCompleteShown",Ga)}Dmk(Ga){this.removeHandler("FormulaAutoCompleteShown",Ga)}CEh(Ga){this.addHandler("SelectedRowChanged",Ga)}vok(Ga){this.removeHandler("SelectedRowChanged",Ga)}wpd(Ga){this.addHandler("ListBoxUpdated",Ga)}fje(Ga){this.removeHandler("ListBoxUpdated",Ga)}dispose(){this.$&&(this.$.userOperationManager.uu(this.fAa),
this.$.userOperationManager.uu(this.gae),this.da&&(this.da.ha&&this.da.ha.vx(this.Jj),this.da.cellTextEditBox&&this.S1a&&this.da.cellTextEditBox.Lw(this.Rl),this.da.view.dy(this.Uy)),this.$.sa&&this.$.sa.Gn(this.wq));this.cJc&&this.clearContentNotifier&&this.clearContentNotifier.RUc(this.gsb);Va.a.dh(this.PF);this.$=null}JBh(Ga){this.addHandler("CVIC",Ga)}Zlk(Ga){this.removeHandler("CVIC",Ga)}get visible(){return this.CF}set visible(Ga){Ga||this.dismiss();this.CF=Ga}get lha(){return this.Dgc}get oue(){var Ga,
Qb;return(null===(Qb=null===(Ga=this.kR)||void 0===Ga?void 0:Ga.items[0])||void 0===Qb?void 0:Qb.type)===vc.SuggestionKind.Smart}get Psg(){return 1===this.kR.items.length&&this.oue}Dq(Ga,Qb){if(!this.visible)return!1;this.yze(Qb);let wc;return(wc=this.j4i(Qb)).FDc?wc.result:this.ALk(Qb)}c0a(Ga){if(!this.visible)return!1;let Qb=!1;switch(Ga){case 1872288872:this.lha&&this.GUc();this.Eob&&this.oue&&(this.formulaAssistanceTelemetryManager.k5(["autoCompleteSmartSuggestionActiveDismissing"]),this.ivc=
!0);this.visible=!1;Qb=!0;break;case -798660877:this.Ozb(this.FSb(this.g8+1));Qb=!0;break;case 137938150:this.Ozb(this.FSb(this.g8-1));Qb=!0;break;case 2091832999:this.Ozb(this.FSb(this.g8+8));Qb=!0;break;case 742457698:this.Ozb(this.FSb(this.g8-8));Qb=!0;break;case 125627505:case 267796030:this.yxd(this.kR.items[this.g8]),Qb=!0}return Qb}show(Ga){this.Zi=this.da.Bp;this.CF=!0;this.g8=0;this.kR=Ga;0<this.kR.items.length&&(this.render(),this.Ozb(this.FSb(this.g8)),this.Eob?this.S1a&&(this.kR.items[0].type===
vc.SuggestionKind.Smart?(this.Y8a||this.formulaAssistanceTelemetryManager.tQa(["autoCompleteSmartSuggestionActiveDismissing","autoCompleteSmartSuggestionAccepted"]),this.Y8a=!0):this.Y8a&&(this.hvc=!0)):this.kR.items[0].type===vc.SuggestionKind.Smart&&this.S1a&&(this.Y8a=!0));this.formulaAssistanceTelemetryManager.sqk(Ga.items)}GUc(){this.Dgc=!1;this.Zi.tCd()}ALk(Ga){return[1872288872,-798660877,137938150,2091832999,742457698,125627505,267796030].includes(Ga)}j4i(Ga){return this.lha?125627505===Ga||
267796030===Ga?(this.yxd(this.kR.items[this.g8]),{FDc:!0,result:!1}):!this.Psg||-798660877!==Ga&&137938150!==Ga?{FDc:!1}:{FDc:!0,result:!1}:{FDc:!1}}render(){this.formulaAssistanceTelemetryManager.tQa(["autoCompleteRender"]);this.formulaAssistanceUIControl&&(this.formulaAssistanceUIControl.renderAutoCompleteMenu(this.domElement,this.CMi(),()=>b(this.$)),this.Eck(),this.PF.Zo=!0,this.ali())}ali(){this.formulaAssistanceTelemetryManager.k5(["autoCompleteRender"]);this.formulaAssistanceTelemetryManager.QOb("autoCompleteOverall");
const Ga=this.kR.items.some(wc=>wc.type===vc.SuggestionKind.Smart),Qb=this.kR.items.some(wc=>wc.type===vc.SuggestionKind.Simple);Ga&&Qb?this.formulaAssistanceTelemetryManager.QOb("autoCompleteOverallSimpleAndSmart"):Ga?this.formulaAssistanceTelemetryManager.QOb("autoCompleteOverallSmartOnly"):Qb&&this.formulaAssistanceTelemetryManager.QOb("autoCompleteOverallSimpleOnly")}Eck(){const Ga=this.xac;this.xac=this.CZi(this.kR.items);Ga!==Xc.Dismissed&&Ga!==Xc.Smart||this.xac!==Xc.Simple&&this.xac!==Xc.Mixed||
this.raiseEvent("FormulaAutoCompleteShown")}tdk(){var Ga;if(0!==this.kR.items.length){var Qb=0<=this.g8?this.g8:0,wc=this.kR.items[Qb];wc={dQ:wc.label,description:null!==(Ga=wc.detail)&&void 0!==Ga?Ga:"",selectedIndex:Qb+1,length:this.kR.items.length};this.raiseEvent("SelectedRowChanged",wc)}}yxd(Ga){if(this.Zi&&this.visible){var Qb=Ga.textEdit;this.Nej(this.Zi.text,Qb);this.Zi.Wa.caretPosition=Qb.range.start.character+Qb.newText.length;ac.EwaSettings.Yij()&&this.Zi.doe();this.lha&&(this.Dgc=!1,this.S1a&&
(this.Eob&&this.formulaAssistanceTelemetryManager.k5(["autoCompleteSmartSuggestionAccepted"]),this.nue=this.K_c=!0),this.hMa||this.VPg(),this.da.BIa.HBk(),this.Zi.endEdit(!0,"FormulaAutoCompleteControl.CommitAutoCompletion",0),this.hMa&&this.VPg());this.visible=!1;this.raiseEvent("CVIC",{shouldRequestAutocompleteOnCommit:Ga.shouldRequestAutocompleteOnCommit});this.formulaAssistanceTelemetryManager.rqk(Ga.kind)}}VPg(){const Ga={Bq:this.da.ha.qa.activeCell,cellText:this.da.Fh.text,committed:!0,rIa:null};
this.hMa?this.formulaAssistanceTelemetryManager.ZEk(Ga):(this.formulaAssistanceTelemetryManager.AP=Ga,this.formulaAssistanceTelemetryManager.K1d=this.$.sa.ma.sheetId,this.formulaAssistanceTelemetryManager.uLc=this.$.ea.Ek,this.$.userOperationManager.mw(this.gae),this.cJc&&this.clearContentNotifier&&this.clearContentNotifier.Vod(this.gsb))}wGh(){this.Eob&&this.hvc&&!this.ivc&&!this.K_c&&(this.formulaAssistanceTelemetryManager.Eua.dismissSmartSuggestionImplicitlyCounter++,this.hvc=!1);this.Y8a&&(this.formulaAssistanceTelemetryManager.PU.smartSuggestionShownCounter++,
this.Y8a=!1,Object(yb.c)(uc));this.K_c&&(this.formulaAssistanceTelemetryManager.PU.smartSuggestionSelectedCounter++,this.K_c=!1,Object(yb.c)(Sc));this.nue&&(this.formulaAssistanceTelemetryManager.PU.smartSuggestionCommittedCounter++,this.nue=!1)}CMi(){const Ga={completionItems:this.kR.items,activeItemIndex:this.g8,callbacks:null};this.uik(Ga);return Ga}uik(Ga){Ga.callbacks={onCompletionItemSelected:null,onCompletionItemCommitted:null,onFeedback:null,onDismiss:null,onRestoreFocus:null};Ga.callbacks.onCompletionItemSelected=
this.EPj;Ga.callbacks.onCompletionItemCommitted=this.DPj;Ga.callbacks.onFeedback=this.coe;Ga.callbacks.onDismiss=this.UQj;Ga.callbacks.onRestoreFocus=this.onRestoreFocus}j$j(Ga){this.Dgc=!0;const Qb=Ga.textEdit.newText;this.Zi.w8(Qb.substring(this.Zi.text.length-Ga.textEdit.range.start.character,Qb.length))}Ozb(Ga){const Qb=this.g8;this.g8=Ga;const wc=this.kR.items[Ga];this.lha&&this.GUc();Qb!==Ga&&this.render();wc.type!==vc.SuggestionKind.Smart||this.da.Bp.text.includes("\n")||this.j$j(wc);this.tdk()}FSb(Ga){return 0>
Ga?0:Math.min(Ga,this.kR.items.length-1)}Nej(Ga,Qb){this.Zi.text=Ga.substring(0,Qb.range.start.character)+Qb.newText+Ga.substring(Qb.range.end.character,Ga.length);this.da.xA&&(this.da.Fh.text=this.Zi.text)}ezj(){this.UNb&&(this.formulaAssistanceTelemetryManager.Eua.selectByArrowKeyCounter++,this.UNb=!1);this.jvc&&(this.formulaAssistanceTelemetryManager.Eua.selectByMouseHoverCounter++,this.jvc=!1);this.TNb&&(this.formulaAssistanceTelemetryManager.Eua.commitByTabKeyCounter++,this.TNb=!1);this.SNb&&
(this.formulaAssistanceTelemetryManager.Eua.commitByEnterKeyCounter++,this.SNb=!1);this.fvc&&(this.formulaAssistanceTelemetryManager.Eua.commitByMouseClickCounter++,this.fvc=!1);this.Eob&&this.ivc&&(this.formulaAssistanceTelemetryManager.Eua.dismissSmartSuggestionExplicitlyCounter++,this.ivc=!1)}yze(Ga){switch(Ga){case -798660877:case 137938150:case 2091832999:case 742457698:this.UNb=!0;break;case 125627505:this.TNb=!0;break;case 267796030:this.SNb=!0}}static BJd(){return document.createElement("div")}CZi(Ga){return Ga.reduce((Qb,
wc)=>Qb|=wc.type===vc.SuggestionKind.Simple?Xc.Simple:Xc.Smart,Xc.Dismissed)}}Object(la.a)(ad,"FormulaAutoCompleteControl",ia.a,[770,4,771]);var Id=a(307),ue=a(358),Vd=a(254);class Kd{constructor(Ga,Qb){var wc,S;this.Lu=Ga;this.$=Qb;this.e1c=new Map;this.uyb=null;this.e1b=()=>{this.eyc.resolve(this.Lu.Qx);this.O3g()};this.Ykg=()=>{this.eyc.reject(null);this.O3g()};this.Rl=()=>{this.Lu.eWc();this.V0d=null;this.e1c.clear();this.E0e()};this.BUj=(eb,ec)=>{if(ec!==this.s6f)Ca.ULS.sendTraceTag(509678923,
0,15,"onGetTableColHeadersSuccess called with a tableName different than the one saved for last request"),this.GQa.reject();else if(Object(Vd.a)(eb))this.GQa.reject();else{var Lc=eb.Result;Object(Id.b)(Lc)&&0!==Lc.length?(this.e1c.set(ec,Lc),void this.GQa.resolve(eb.Result)):this.GQa.reject()}};this.AUj=()=>{this.GQa.reject()};null===(S=null===(wc=$a.f(this.$))||void 0===wc?void 0:wc.cellTextEditBox)||void 0===S?void 0:S.Jx(this.Rl);this.oSk=ac.EwaSettings.isChangeGateEnabled("OfficeVSO:6476169_skipGetFieldInfoListContextIfContextLoaded")}getRichValueFieldListContext(Ga,
Qb,wc,S){const eb={bma:Ga,nrf:Qb};var ec;if(ec=Object(Id.b)(this.V0d))ec=this.V0d,ec=!(eb.bma.firstRow===ec.bma.firstRow&&eb.bma.firstColumn===ec.bma.firstColumn&&eb.bma.lastRow===ec.bma.lastRow&&eb.bma.lastColumn===ec.bma.lastColumn&&eb.bma.sheetName===ec.bma.sheetName&&eb.nrf===ec.nrf);ec&&this.Lu.eWc();this.V0d=eb;this.oSk&&this.Lu.CWd||this.Lu.Blb(Object(hb.ib)(Ga),wc,S,Qb);this.eyc=new Id.a;this.Lu.CWd?this.eyc.resolve(this.Lu.Qx):this.Jhk();return this.eyc.promise}getTableColHeaders(Ga){if(this.uyb&&
3>=this.uyb.status&&Ga===this.s6f)return this.GQa.promise;this.GQa=new Id.a;if(this.e1c.has(Ga))this.GQa.resolve(this.e1c.get(Ga));else{this.E0e();this.s6f=Ga;const Qb=this.$.$h.getItemByName(Ga).Wq;this.uyb=Object(ue.u)(this.$.pa.ta,Qb,wc=>this.BUj(wc,Ga),this.AUj,null,null)}return this.GQa.promise}dispose(){var Ga,Qb;null===(Qb=null===(Ga=$a.f(this.$))||void 0===Ga?void 0:Ga.cellTextEditBox)||void 0===Qb?void 0:Qb.Lw(this.Rl)}Jhk(){this.Lu.gpd(this.e1b);this.Lu.xCh(this.Ykg)}O3g(){this.Lu.Rie(this.e1b);
this.Lu.Imk(this.Ykg)}E0e(){Object(Id.b)(this.uyb)&&(Ka.AFrameworkApplication.rj.fE(this.uyb.uD),this.uyb=null)}}Object(la.a)(Kd,"ServerDataProvider",null,[]);var Yd=a(85),Bc=a(1045);a(192);class Mc{constructor(Ga){this.Oci={};this.$=Ga}get Nci(){const Ga=[];if(!this.$.$h||!this.$.$h.items)return Ga;let Qb=0;for(const wc of this.$.$h.items)if(wc&&(3===wc.type&&wc.usedRange||2===wc.type)){const S={tooltip:wc.sheetName+Yd.a.exclamation+wc.usedRange.toString(),name:wc.name,namedRange:this.H2h(wc.usedRange),
sheetName:wc.sheetName,type:this.u2h(wc.type)};Ga.push(S);this.Oci[wc.name.toUpperCase()]=S;++Qb;if(!ac.EwaSettings.isChangeGateEnabled("OfficeVSO:7395300_FixTableAutoCompleteMissingInfo")&&Qb===Bc.a.qcg){Ca.ULS.sendTraceTag(537162076,0,15,`Maximum number of defined names reached for formula assistance: ${Bc.a.qcg}`);break}}return Ga}H2h(Ga){if(null!=Ga&&void 0!=Ga)return{top:Ga.top,left:Ga.left,bottom:Ga.bottom,right:Ga.right,maxRows:Ga.maxRows,maxColumns:Ga.maxColumns,sheetName:void 0}}u2h(Ga){switch(Ga){case 2:return vc.DefinedNameInfoType.Table;
case 3:return vc.DefinedNameInfoType.NamedRange;default:return vc.DefinedNameInfoType.Invalid}}}Object(la.a)(Mc,"DefinedNameInfoManager",null,[]);var Fd=a(153),Md=a(365),oe=a(716),ye=a(392);const te={index:0,length:0};class ze{constructor(Ga){this.jya=this.kya=this.eoa=this.foa=!1;this.r2a=Ga}}Object(la.a)(ze,"MarqueeRangeData",null,[]);class He{constructor(Ga,Qb,wc,S){this.WYk=Ga;this.c0g=Qb;this.ZIc=void 0===S?!1:S;wc?(this.r2a=wc.r2a,this.foa=wc.foa,this.eoa=wc.eoa,this.kya=wc.kya,this.jya=wc.jya):
Ca.ULS.shipAssertTag(510255180,0,!1,"MarqueeMetadata.Ctor: rangeData is null")}}Object(la.a)(He,"MarqueeMetadata",null,[]);a(1449);const ne=wd.a.Jz()?"rgba(0, 108, 190, {0});rgba(188, 47, 50, {0});rgba(124, 83, 172, {0});rgba(15, 112, 15, {0});rgba(191, 0, 119, {0});rgba(181, 73, 15, {0});rgba(0, 117, 143, {0})".split(";"):"rgba(95, 140, 237, {0});rgba(235, 94, 96, {0});rgba(141, 97, 194, {0});rgba(45, 150, 57, {0});rgba(191, 76, 145, {0});rgba(227, 130, 34, {0});rgba(55, 127, 158, {0})".split(";"),
of=ne.map(Ga=>String.format(Ga,1));class lf{constructor(Ga,Qb,wc,S){this.$=Ga;this.pluginScheduler=Qb;this.formulaAssistanceManager=wc;this.formulaAssistanceTelemetryManager=S;this.I0a=this.UZg=!1;this.XS=null;this.xNa=()=>{this.I0a=!1;this.XS=null};this.da=$a.f(Ga);this.da.Fh.Jx(this.xNa);this.B3g=ac.EwaSettings.isChangeGateEnabled("OfficeVSO:7686593_checkPotentialFormulaBeforeX10HighlightingEnabled")}$Z(Ga,Qb,wc){var S;Ga.Wa.addEventLogRecord("FormulaHighlightsControl.TryUpdateFormulaHighlights");
if(this.UZg||Ga.lha)return!1;const eb=isNullOrUndefined(Qb)?Ga.text:Qb;if(this.B3g){if(!gc.f(eb))return this.dAe(Object(Id.b)(Qb))}else if(1>=eb.length)return this.dAe(Object(Id.b)(Qb));wc=this.QZi(Ga,Qb,wc);wc=null===(S=this.bMd(eb,wc))||void 0===S?void 0:S.formulaHighlights;if(!wc)return Ca.ULS.sendTraceTag(512349465,0,50,"FormulaHighlightsControl.tryUpdateFormulaHighlights: formulaHighlights is null (might be an invalid formula)"),this.dAe(Object(Id.b)(Qb));const {D1c:ec,pAg:Lc,nAg:Ad,HEj:pd}=
this.JHf(wc,eb);this.rHk(Ga,ec,!!Qb);Qb=Ga.Wa.text;if(!Hc.a.equals(Qb,eb,!1))return Ca.ULS.shipAssertTag(38114182,0,!1,`FormulaHighlightsControl.tryUpdateFormulaHighlights: The text we created is different from the original text. Setting the original text back. currentTextLength [${Qb.length}], updatedTextLength [${eb.length}]`),Qb=Ga.Wa.caretPosition,Ga.Wa.text=eb,Ga.Wa.caretPosition=Qb,!0;this.highlightRanges(Lc,Ad,3,pd);return this.I0a=!0}wdg(Ga,Qb,wc){if(!Ga||!Qb||!wc)return Ca.ULS.shipAssertTag(512349463,
0,!!Ga,"FormulaHighlightsControl.MoveMarqueeRange: cellContentEditor is null"),Ca.ULS.shipAssertTag(512349462,0,!!Qb,"FormulaHighlightsControl.MoveMarqueeRange: highlightState is null"),Ca.ULS.shipAssertTag(512349461,0,!!wc,"FormulaHighlightsControl.MoveMarqueeRange: newRange is null"),!1;const S=Object(Fd.a)(He,Qb.metadata);if(!S)return Ca.ULS.shipAssertTag(512349460,0,!1,"FormulaHighlightsControl.MoveMarqueeRange: marqueeMetadata is null"),!1;var eb=S.WYk,ec=S.c0g;let Lc=this.da.oh.LYf(wc)?wc.LAc(S.eoa,
S.foa):wc.Fga(S.eoa,S.foa,S.jya,S.kya);if(!Lc)return Ca.ULS.shipAssertTag(512349459,0,!1,"FormulaHighlightsControl.MoveMarqueeRange: newText is null"),!1;const Ad=ec.indexOf("!");-1!==Ad&&(Lc=ec.substring(0,Ad+1)+Lc);if(!Ga.Wa.changeTextInExistingTextPart(eb,ec,Lc))return Ca.ULS.shipAssertTag(38926105,0,!1,"FormulaHighlightsControl.MoveMarqueeRange: failed to change the text part"),!1;S.c0g=Lc;eb=!0;ec=this.da.fh.Lbc;for(const pd of ec)(ec=$a.f(this.$).Gh.VU(3,pd,Qb.jma))?(ec.range=wc,ec.metadata=
S):(Ca.ULS.shipAssertTag(512349458,0,!1,"FormulaHighlightsControl.MoveMarqueeRange: highlightStateInPane is null"),eb=!1);this.da.Gh.update(!1,!1);this.da.xA&&(this.da.cellTextEditBox.Wa.text=Ga.text);this.da.cellTextEditBox.T3b(new Md.a({WGc:!0}));return eb}Enj(Ga){if(3!==Ga.zw)return Ca.ULS.shipAssertTag(512349457,0,!1,"FormulaHighlightsControl.IsMarqueeHighlightDraggable: not HighlightDivIndex.Marquee."),!1;Ga=Object(Fd.a)(He,Ga.metadata);return Ga?Ga.r2a&&!Ga.ZIc:(Ca.ULS.shipAssertTag(512349456,
0,!1,"FormulaHighlightsControl.IsMarqueeHighlightDraggable: marqueeMetadata is null."),!1)}tyb(Ga,Qb){Ca.ULS.sendTraceTag(512349455,0,50,"FormulaHighlightsControl.suspendResumeFormulaHighlights: "+(Qb?"suspending":"resuming")+" formula highlights");Qb&&this.I0a&&(this.I0a=!1,this.highlightRanges(null,null),Ga.Wa.uXh());this.UZg=Qb}dispose(){this.da&&this.da.Fh&&this.da.Fh.Lw(this.xNa)}GSf(Ga){this.formulaAssistanceTelemetryManager.tQa(["highlightPreviewRanges"]);var Qb=this.bMd(Ga,te);if(isNullOrUndefined(Qb))this.kGc&&
this.highlightRanges(null,null);else{var wc=this.FNd(),S=[],eb=new pb.a(!1),ec=[];Qb=Qb.formulaHighlights;for(const Lc of Qb)if(Qb=Lc.kind,Qb===vc.HighlightKind.CellRef||Qb===vc.HighlightKind.NamedRange||Qb===vc.HighlightKind.StructRef)Qb=hb.C(Lc.rangeInfo.range),Object(Id.b)(Qb)&&(S.push(new ye.a(Qb,wc)),this.kAc(Qb,eb,1),ec.push(new He(Lc.span.start,Ga.substring(Lc.span.start,Lc.span.end),r(Lc),!0)));this.highlightRanges(S,eb,3,ec);this.formulaAssistanceTelemetryManager.k5(["highlightPreviewRanges"],
!0)}}IYi(Ga,Qb){Qb=void 0===Qb?[]:Qb;var wc;const S=null===(wc=this.bMd(Ga,te))||void 0===wc?void 0:wc.formulaHighlights.filter(Ad=>!Qb.includes(Ad.kind));if(!S)return null;const {D1c:eb,pAg:ec,nAg:Lc}=this.JHf(S,Ga);return{D1c:eb,highlightRanges:Ad=>Ad?this.highlightRanges(ec,Lc,28):this.vXh()}}vXh(){this.highlightRanges(null,null,28)}L8k(Ga,Qb){Ga&&this.formulaAssistanceTelemetryManager.TId.formulaHighlightsCounter++;Qb&&this.formulaAssistanceTelemetryManager.TId.parenthesesCouplingCounter++}dAe(Ga){this.B3g&&
!this.I0a||this.highlightRanges(null,null);return this.I0a&&(this.I0a=!1,Ga)?!0:!1}QZi(Ga,Qb,wc){let S=wc;Object(Id.b)(Qb)?Object(Id.b)(wc)||(S={index:Qb.length,length:0}):S=Ga.Wa.selection;return S}bMd(Ga,Qb){if(this.$pj({content:Ga,selection:Qb}))return this.XS.result;this.formulaAssistanceTelemetryManager.tQa(["formulaHighlightsRequest"]);const wc=this.pluginScheduler.syncRequester().formulaHighlighting({content:Ga,caretPosition:Qb.index,selectionLength:Qb.length},this.formulaAssistanceManager.I5a,
null);this.XS={content:Ga,selection:Qb,result:wc};this.formulaAssistanceTelemetryManager.k5(["formulaHighlightsRequest"]);return wc}kAc(Ga,Qb,wc){let S=Qb.getItem(Ga.toString());S||(S=ne[Qb.count%ne.length],Qb.add(Ga.toString(),S));return String.format(S,wc)}RHb(Ga,Qb,wc,S,eb,ec){eb=void 0===eb?null:eb;ec=void 0===ec?null:ec;Ca.ULS.shipAssertTag(512349453,0,wc<=S,"FormulaHighlightsControl.AddTextPart: startIndex cannot be larger than endIndex");wc<S&&(Qb=Qb.substring(wc,S),wc=wd.a.Jz()&&eb?(of.indexOf(eb)+
1).toString():null,Ga.push(Object(dc.a)(new oe.a,{text:Qb,color:eb,backgroundColor:ec,highlightClass:wc})))}highlightRanges(Ga,Qb,wc,S){wc=void 0===wc?3:wc;S=void 0===S?null:S;Ca.ULS.shipAssertTag(508350945,0,3===wc||null===S,"FormulaHighlightsControl.HighlightRanges: marqueeMetadatas param was passed although the divIndex isn't maquee");const eb=3===wc&&Object(Id.b)(S);Ga&&Ga.length?(Ca.ULS.sendTraceTag(512349452,0,50,"FormulaHighlightsControl.HighlightRanges: number of ranges to highlight: "+Ga.length),
Ga.reverse(),eb&&S.reverse(),this.da.Gh.fQ(Ga,[wc],!0,(ec,Lc)=>{if(ec&&ec.range&&Lc){Ca.ULS.shipAssertTag(512349448,0,Qb.lh(ec.range.toString()),`FormulaHighlightsControl.HighlightRanges: The range '${ec.range.toString()}' doesn't exist in the range to color dictionary`);var Ad=this.kAc(ec.range,Qb,.1),pd=this.kAc(ec.range,Qb,1);this.$.frame&&this.$.frame.OM&&this.$.frame.OM.BY||(Lc.style.background=Ad);Lc.style.borderColor=pd;eb&&(Lc.setAttribute(wa.a.CUb,ec.jma.toString()),ec.metadata=S[ec.jma])}else Ca.ULS.shipAssertTag(512349451,
0,!!ec,"FormulaHighlightsControl.HighlightRanges: state is null"),Ca.ULS.shipAssertTag(512349450,0,!!ec.range,"FormulaHighlightsControl.HighlightRanges: state.Range is null"),Ca.ULS.shipAssertTag(512349449,0,!!Lc,"FormulaHighlightsControl.HighlightRanges: div is null")})):0!==this.da.Gh.dKd([wc]).length&&(Ga=this.$.Eh.Li("UserAction","HideRangesHighlightsStopwatch"),this.da.Gh.Mq([wc]),this.da.Gh.Uwb(new ye.a(null,this.FNd()),[wc]),Ga.stop())}rHk(Ga,Qb,wc){const S=Ga.Wa;S.QM=!0;var eb=S.selection;
const ec=eb.index;eb=ec+eb.length;S.setTextFromTextParts(Qb);Qb=S.text.length;S.selectRange(Math.min(ec,Qb),Math.min(eb,Qb));wc&&Ga.T3b(new Md.a);S.QM=!1}cSi(){return this.da.NB&&this.da.NB.HV?this.da.NB.HV:this.$.ma}FNd(){return this.cSi().sheetId}JHf(Ga,Qb){const wc=[],S=new pb.a(!1),eb=[],ec=[],Lc=[];let Ad=!1;var pd=!1;let de=0;const Ge=this.FNd();for(const Re of Ga){this.RHb(eb,Qb,de,Re.span.start);switch(Re.kind){case vc.HighlightKind.CellRef:case vc.HighlightKind.StructRef:case vc.HighlightKind.NamedRange:Ga=
hb.C(Re.rangeInfo.range);if(isNullOrUndefined(Ga)){Ca.ULS.sendTraceTag(512349464,0,10,`FormulaHighlightsControl.tryUpdateFormulaHighlights: Received formula highlight with undefined range, HighlightKind:${Re.kind.toString()}`);this.RHb(eb,Qb,Re.span.start,Re.span.end);break}pd=this.kAc(Ga,S,1);this.RHb(eb,Qb,Re.span.start,Re.span.end,pd,null);wc.push(new ye.a(Ga,Ge));ec.push({Start:Re.span.start,End:Re.span.end});pd=eb.length-1;Lc.push(new He(pd,eb[pd].text,r(Re)));pd=!0;break;case vc.HighlightKind.Parentheses:this.RHb(eb,
Qb,Re.span.start,Re.span.end,null,"rgb(229, 229, 229)"),Ad=!0}de=Re.span.end}this.RHb(eb,Qb,de,Qb.length);this.L8k(pd,Ad);return{D1c:eb,pAg:wc,nAg:S,HEj:Lc}}$pj(Ga){return Object(Id.b)(this.XS)&&this.XS.content===Ga.content&&this.XS.selection.index===Ga.selection.index&&this.XS.selection.length===Ga.selection.length}}Object(la.a)(lf,"FormulaHighlightsControl",null,[765,4]);var jf=a(91),Cf=a(77),Gf=a(773);Object(db.b)(gb.Ec,{Fk:"singleton"})(Ga=>Lo(function*(){var Qb,wc=yield db.a.resolve(gb.Nb,Ga);
const S=yield db.a.resolve(gb.vg,Ga),eb=yield db.a.resolve(gb.Qf,Ga);var ec=null!==(Qb=null===Ga||void 0===Ga?void 0:Ga.va)&&void 0!==Qb?Qb:0;ec=yield Object(jf.e)(Cf.GetServiceTaskFactory.create(wc.la,449,wc.ya,ec));const Lc=yield db.a.resolve(Gf.g,Ga),Ad=yield db.a.resolve(gb.E,Ga);Qb=yield db.a.resolve(gb.Fc,Ga);const pd=yield db.a.resolve(Gf.e,Ga),de=yield db.a.resolve(gb.Wc,Ga);wc=new Af(wc,de,Ad,Lc,ec,pd,eb.nzd(wc,S));Qb.I9e(wc.BQb);Qb.J9e(wc.oga);Qb.K9e(wc.oga);return wc}));class Af{constructor(Ga,
Qb,wc,S,eb,ec,Lc){this.$=Ga;this.RF=Qb;this.Sj=wc;this.pluginScheduler=S;this.formulaAssistanceUIControl=eb;this.formulaAssistanceTelemetryManager=ec;this.Lu=Lc;this.lVd=this.isCellContentOnlyEqualDuringEdit=!1;this.VYb=null;this.dLc=-1;this.Npa=0;this.ej=(Ad,pd)=>{pd.dm||pd.bWb||this.pluginScheduler.notifier().notifyWorkbookClosing()};this.onActiveCellChanged=(Ad,pd)=>{this.da.isEditing||this.da.lq||this.rfg(null===pd||void 0===pd?void 0:pd.cell)};this.onFunctionInfoLoaded=()=>{this.X6g();this.$Aa()};
this.nhg=(Ad,pd)=>{var de=this.Zi;Ad=de.text;de=de.Wa.caretPosition;0<this.Npa&&this.formulaAssistanceTelemetryManager.Eua.commitWhileRequestPending++;this.formulaAssistanceTelemetryManager.tQa(["argumentAssistanceComputation","argumentAssistanceOverall"]);pd.shouldRequestAutocompleteOnCommit?this.bNg(Ad,de):this.trk(Ad,de)};this.Rl=()=>{this.isCellContentOnlyEqualDuringEdit&&(this.formulaAssistanceTelemetryManager.PU.isCellContentOnlyEqualDuringEditCounter++,this.isCellContentOnlyEqualDuringEdit=
!1);this.lVd&&(this.formulaAssistanceTelemetryManager.PU.isCellContentFormulaCounter++,this.lVd=!1);ac.EwaSettings.isChangeGateEnabled("OfficeVSO:6103891_dismissControlOnEditEnded")&&this.oCd()};this.ANa=(Ad,pd)=>{Object(nc.d)(()=>{this.Cvk(pd.newValue)})};this.vp=()=>{this.F5g()};this.F5g=()=>{const Ad=this.Mci.Nci;this.pluginScheduler.notifier().setDefinedNamesInfo(Ad);Ca.ULS.sendTraceTag(512278605,0,50,`FormulaAssistanceManager.updateDefinedNamesList updated defined names info with ${null===Ad||
void 0===Ad?void 0:Ad.length} names}`)};this.Igg=(Ad,pd)=>{this.pluginScheduler.notifier().setActiveCellFormat(pd)};this.RF=Qb;this.formulaAssistanceUIControl=eb;this.pluginScheduler=S;this.da=$a.f(this.$);this.Mci=new Mc(Ga);this.da.za.ny(this.vp);this.F5g();this.wbb=new dd(this.$,this.formulaAssistanceUIControl,this.formulaAssistanceTelemetryManager);this.Bka=new ad(this.$,this.formulaAssistanceUIControl,this.formulaAssistanceTelemetryManager);this.iTk=wd.a.oob(Ga);this.ihj=ac.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.AuthoringPerCharExp",
!1);this.Erj=ac.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.x10AutocompleteWrapperPluginIsEnabled",!1);this.zbb=new lf(this.$,this.pluginScheduler,this,this.formulaAssistanceTelemetryManager);gb.Ec.Aa()||Ga.la.Hh(464,this);this.Sj=wc;this.ddj();this.da.cellTextEditBox.Jx(this.Rl);this.RF.Jmc(this.onFunctionInfoLoaded);this.RF.qoa?this.X6g():this.RF.Gjb({})}get oga(){return this.Bka}get BQb(){return this.wbb}get ED(){return this.zbb}get I5a(){return this.Zi.ypj?vc.PluginGroup.Python:
vc.PluginGroup.Excel}get Zi(){return this.da.Bp}get oh(){return this.da.oh}dispose(){var Ga;if(this.$){const Qb=this.da;Qb&&(Qb.ha&&Qb.ha.RAa(this.onActiveCellChanged),Qb.za&&Qb.za.ux(this.vp));this.$.Yu(this.ej)}null===(Ga=this.Sj)||void 0===Ga?void 0:Ga.tlk(this.Igg);this.da.cellTextEditBox.Lw(this.Rl);this.Bka.Zlk(this.nhg);this.RF&&this.RF.Vie(this.onFunctionInfoLoaded);this.Zi&&this.Zi.SUc(this.ANa);Va.a.dh(this.wbb);Va.a.dh(this.Bka);this.Bka=this.wbb=this.RF=this.$=null}Zrk(){this.dLc=-1;this.VYb=
null}oCd(){this.Bka.visible=!1;this.wbb.visible=!1}Dq(){this.$Aa();return!1}$Aa(){if(!this.Zi.tZ)if(this.formulaAssistanceTelemetryManager.Hsd.formulaAssistanceRequestAttemptedCounter++,this.rMk()){var Ga=this.Zi,Qb=Ga.text;Ga=Ga.Wa.caretPosition;Qb.startsWith("=")&&(this.lVd=!0,1===Qb.length&&(this.isCellContentOnlyEqualDuringEdit=!0));this.formulaAssistanceTelemetryManager.tQa("argumentAssistanceComputation autoCompleteComputation autoCompleteComputationNoResult argumentAssistanceOverall autoCompleteOverall autoCompleteOverallSmartOnly autoCompleteOverallSimpleOnly autoCompleteOverallSimpleAndSmart".split(" "));
this.bNg(Qb,Ga);this.ihj&&this.Grk(Qb,Ga)}else this.formulaAssistanceTelemetryManager.Hsd.formulaAssistanceRequestOptimizedCounter++}bNg(Ga,Qb){const wc=this.pluginScheduler.batchRequester().functionSuggestionAndArgumentAssistance({functionSuggestion:{content:Ga,caretPosition:Qb},argumentAssistance:{content:Ga,caretPosition:Qb},inCellSuggestion:{content:Ga,caretPosition:Qb}},this.I5a,null);this.Npa+=1;this.VYb=Ga;this.dLc=Qb;wc.then(S=>{--this.Npa;"Done"===S.kind&&(this.MOf(S.payload.argumentAssistance),
this.S2i(S.payload.functionSuggestion,Ga));return null})}Grk(Ga,Qb){Qb={content:Ga,caretPosition:Qb,enableAutocompleteWrapperPlugin:this.Erj&&!this.iTk};Qb=this.pluginScheduler.requester().runPerCharacterExperiment(Qb,this.I5a,null);this.Npa+=1;Qb.then(wc=>{--this.Npa;if("Done"===wc.kind)for(const S of wc.payload.results)S.kind===vc.PerCharacterExperimentResultKind.AutocompleteWrapperPluginResult&&this.da.BIa.TPg(S.value,Ga);return null})}trk(Ga,Qb){const wc={content:Ga,caretPosition:Qb};this.VYb=
Ga;this.dLc=Qb;Ga=this.pluginScheduler.requester().argumentAssistance(wc,this.I5a,null);this.Npa+=1;Ga.then(S=>{--this.Npa;"Done"===S.kind&&this.MOf(S.payload)})}rMk(){var Ga=this.Zi;const Qb=Ga.text;Ga=Ga.Wa.caretPosition;return this.Bka.visible&&Hc.a.equals(Qb,this.VYb,!0)&&!gc.e(Qb)&&Ga===this.dLc?!1:!0}Ivk(){void this.pluginScheduler.requester().runExperiment({},this.I5a,null)}MOf(Ga){Ga&&this.Zi.isEditing?(this.formulaAssistanceTelemetryManager.k5(["argumentAssistanceComputation"]),this.wbb.show(Ga)):
this.wbb.dismiss()}S2i(Ga,Qb){Ga&&0<Ga.items.length&&this.Zi.isEditing&&this.Zi.text===this.VYb?this.oh.EY(this.da.ha.qa.activeCell)?(this.formulaAssistanceTelemetryManager.PU.smartSuggestionWouldSuggestInsidePivotCounter++,this.Bka.dismiss()):(this.formulaAssistanceTelemetryManager.k5(["autoCompleteComputation"]),this.Bka.show(Ga)):this.Bka.dismiss();this.da.BIa.TPg(Ga,Qb);Ga&&0!==Ga.items.length||this.formulaAssistanceTelemetryManager.k5(["autoCompleteComputationNoResult"])}Cvk(Ga){Ga={content:Ga,
isCellContentOnlyEqualDuringEdit:this.isCellContentOnlyEqualDuringEdit};void this.pluginScheduler.requester().runAuthoringExperiment(Ga,this.I5a,null)}rfg(Ga){var Qb;const wc=this.da.ha.qa.activeCell;if(wc){var S=this.Sj.Fsc(wc,!1);if(S){var eb=this.$.sa,ec=S.sheet.index;0>=eb.count||0>ec||ec>=eb.count?Ca.ULS.sendTraceTag(512278608,0,50,`FormulaAssistanceManager.NotifyActiveCellChanged invalid sheet index. ewaSheetsCount = ${eb.count}, currentSheetIndex = ${ec}.`):(ec=eb=null,void 0!==this.Sj&&null!==
this.Sj&&(Ga=null!==(Qb=null===Ga||void 0===Ga?void 0:Ga.cell)&&void 0!==Qb?Qb:this.da.za.Rx(wc))&&(Qb=this.Sj.GJf(Ga.qo),void 0!==Qb&&null!==Qb&&(eb=Qb.FormatString,ec=Qb.Builtin)),this.pluginScheduler.notifier().setActiveCell({colIndex:S.range.col,rowIndex:S.range.row,sheetIndex:this.$.sa.getItem(S.sheet.index).sheetId,docName:S.sheet.document.name,docPath:S.sheet.document.path,formatString:eb,builtIn:ec}),Ca.ULS.sendTraceTag(512278607,0,50,`FormulaAssistanceManager.NotifyActiveCellChanged sent notification to the scheduler. col: ${S.range.col}, row: ${S.range.row}`))}else Ca.ULS.sendTraceTag(537162002,
0,50,"FormulaAssistanceManager.NotifyActiveCellChanged ISheetGridCell location is null")}else Ca.ULS.sendTraceTag(512278609,0,50,"FormulaAssistanceManager.NotifyActiveCellChanged activeCell range is null")}X6g(){const Ga=this.RF.wCf;this.pluginScheduler.notifier().setFunctionsInfo(Ga);Ca.ULS.sendTraceTag(512278606,0,50,`FormulaAssistanceManager.updateSchedulerFunctionList update functions info with ${null===Ga||void 0===Ga?void 0:Ga.length} functions}`)}ddj(){this.da.ha.kGa(this.onActiveCellChanged);
this.Sj.WAh(this.Igg);const Ga=this.da.zh(null);this.rfg(Ga);this.Zi.YHb(this.ANa);this.Ivk();this.Bka.JBh(this.nhg);this.pluginScheduler.setServerDataProvider(new Kd(this.Lu,this.$));this.$Aa();this.$.gq(this.ej)}}Object(la.a)(Af,"FormulaAssistanceManager",null,[755,4]);var Lf;let Ef=Lf=class{constructor(Ga,Qb){this.ariaLiveNotifier=Ga;this.$=Qb;this.MZa=this.sJa=this.Mwa=null;this.Yog=(wc,S)=>{this.Lek(S.functionName,S.xCf)};this.$og=(wc,S)=>{this.Iek(S.xCf,S.NMg,S.Vtl)};this.Zog=(wc,S)=>{wc=[];
for(var eb of S.NMg)void 0!==eb&&null!==eb&&(S=eb.trim())&&wc.push(S);if(wc.length){eb="";for(S=0;S<wc.length;S++){const ec=this.Vtd(wc[S]),Lc=Lf.kde(S,wc.length);eb+=ec+Lc;Lc&&(eb+=this.ariaLiveNotifier.D3a)}this.ariaLiveNotifier.readText(eb)}};this.apg=(wc,S)=>{this.ariaLiveNotifier.Nek(S.dQ,S.description,S.selectedIndex.toString(),S.length.toString())};this.Uog=(wc,S)=>{this.ariaLiveNotifier.cBg(S.description,S.length)};this.Lkg=()=>{this.ariaLiveNotifier.HOa(lb.a.instance.ia(884),wa.a.KGa)};this.Bkg=
()=>{this.ariaLiveNotifier.readText(lb.a.instance.ia(885))};this.Hkg=()=>{this.ariaLiveNotifier.readText(lb.a.instance.ia(886))}}dispose(){this.eze();this.MZa=this.sJa=this.Mwa=null}I9e(Ga){Ga&&(this.Mwa=Ga,this.Mwa.vCh(this.Yog),this.Mwa.BEh(this.$og),this.Mwa.AEh(this.Zog))}J9e(Ga){Ga&&(this.sJa=Ga,this.sJa.tCh(this.Lkg),this.sJa.pCh(this.Bkg),this.sJa.sCh(this.Hkg))}K9e(Ga){Ga&&(this.MZa=Ga,this.MZa.CEh(this.apg),this.MZa.wpd(this.Uog))}eze(){var Ga,Qb,wc;this.Mwa&&(this.Mwa.Gmk(this.Yog),this.Mwa.uok(this.$og),
this.Mwa.tok(this.Zog));this.MZa&&(this.MZa.vok(this.apg),this.MZa.fje(this.Uog));null===(Ga=this.sJa)||void 0===Ga?void 0:Ga.Emk(this.Lkg);null===(Qb=this.sJa)||void 0===Qb?void 0:Qb.Amk(this.Bkg);null===(wc=this.sJa)||void 0===wc?void 0:wc.Dmk(this.Hkg)}Lek(Ga,Qb){if(Qb){let wc="";for(let S=0;S<Qb.length;S++)wc+=Ga+this.ariaLiveNotifier.D3a+this.Vtd(Qb[S])+Lf.kde(S,Qb.length);wc+=lb.a.instance.ia(883)+this.ariaLiveNotifier.D3a;this.ariaLiveNotifier.readText(wc)}}Iek(Ga,Qb,wc){if(Ga){let eb="",ec=
0;if(Qb){for(let Lc=0;Lc<Qb.length;Lc++){if(wc>=Ga[Lc].split(this.$.listSeparator).length){ec++;continue}var S=Qb[Lc].trim();if(!S)return;S=this.Vtd(S);const Ad=Lf.kde(Lc-ec,Qb.length-ec);eb+=S+Ad;Ad&&(eb+=this.ariaLiveNotifier.D3a)}this.ariaLiveNotifier.readText(eb)}}}Vtd(Ga){if(!Ga)return"";var Qb=Ga.split(this.$.listSeparator);Ga="";for(const wc of Qb){if(Lf.ekj(wc))Ga+=wc;else{const S=(Qb=Lf.Eoj(wc))?wc.replace("[","").replace("]",""):wc;Ga+=String.format(Qb?lb.a.instance.sh(59):lb.a.instance.sh(58),
S)}Ga+=this.ariaLiveNotifier.D3a}return Ga}static kde(Ga,Qb){return Ga>=Qb||1===Qb?(Ca.ULS.shipAssertTag(537161997,0,Ga<Qb,"FormulaAssistanceControl.PositionInList: requested item index >= list length."),""):String.format(lb.a.instance.sh(55),Ga+1,Qb)+"\r\n"}static ekj(Ga){return Hc.a.contains(Ga,Bc.a.osf,!0)}static Eoj(Ga){return Ga.trimStart().startsWith(Bc.a.P2j)||Ga.trimEnd().endsWith(Bc.a.O2j)}};Ef=Lf=Object(za.__decorate)([Object(db.d)(gb.Fc),Object(za.__param)(0,Object(gb.l)()),Object(za.__param)(1,
Object(gb.Nb)())],Ef);Object(la.a)(Ef,"FormulaAssistanceReadoutHandler",null,[745,4]);let Hf=class{constructor(Ga){this.formulaAssistanceValuePreview=Ga}Ri(){return!1}executeCommand(Ga,Qb){Ga=!1;Qb=Qb.command;switch(Qb){case -46938080:this.formulaAssistanceValuePreview.trigger(),Ga=!0}return Ga?wb.Task.Ua(!0):ra.a(Qb)}Gi(Ga,Qb){return-46938080===Qb.command}dj(){return!1}};Hf=Object(za.__decorate)([Object(db.d)(gb.Gc),Object(za.__param)(0,Object(Gf.f)())],Hf);Object(la.a)(Hf,"FormulaAssistanceValuePreviewCommandHandler",
null,[34]);var $b=a(124),Wb=a(36),Dc=a(64);class Jf{constructor(Ga,Qb){this.$=Ga;this.da=Qb;this.isEnabled=ac.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ValuePreviewValidation",!1);this.ZVb=ac.EwaSettings.isChangeGateEnabled("OfficeVSO:8501487_ValuePreviewDetectVolatile")}get Bzi(){Object(Id.c)(this.sMe)&&(this.sMe=db.a.resolve(gb.Bc,{va:1}));return this.sMe}XVh(Ga,Qb,wc,S,eb){const ec=this;return Lo(function*(){if(ec.isEnabled&&("Success"===Qb.kind||"Failure"===Qb.kind)){var Lc=Qb.evaluatedFormula;
if(!Object(Id.c)(Lc)&&""!==Lc){var Ad={};Ad.locale=ec.IIf();var pd=ec.da.ha.qa.activeCell;Object(Id.b)(pd)?Ad.anonymizationOrigin="activeCell":(Ad.anonymizationOrigin="A1",pd=xc.Range.vi(0,0));try{const de=yield ec.Bzi;Ad.formula=de.anonymize(Ga.text,pd);Ad.subFormula=de.anonymize(Lc,pd)}catch(de){Ad.formula="FAIL",Ad.subFormula="FAIL"}Ad.clientResult=ec.TR(Qb);try{const de=ec.MOd(),Ge=yield S(Ga.text,Lc,eb),Re=ec.MOd();Ad.serverResult=ec.TR(Ge);Ad.diagnostics=ec.H_h(Ad.clientResult,Ad.serverResult);
Ad.stateId={beforeX10:wc,beforeServer:de,server:Ge.stateId,afterServer:Re}}catch(de){Ad.diagnostics={kind:"error",message:de}}ec.ZVb&&"Success"===Qb.kind&&(Ad.isVolatile=Qb.isVolatile);l(Ad);Ca.ULS.sendTraceTag(508831819,1,20,`ValuePreviewResultValidator.checkClientResultVsServer, result: ${JSON.stringify(Ad)}`)}}})}MOd(){return{latest:this.$.ea.Ek,successful:this.$.ea.NC}}IIf(){const Ga={ui:this.$.fda,data:this.$.dataCultureTag},Qb=db.a.nh(gb.Cd);Object(Id.b)(Qb)&&(Ga.calcLcid=Qb.zk.Lcid);return Ga}TR(Ga){switch(Ga.kind){case "Failure":return{kind:"failure",
reason:Ga.reason};case "Success":return{kind:"success",value:Ga.value,unformattedValue:Ga.unformattedValue,operKind:Ga.operKind};default:return{kind:"unexpected"}}}H_h(Ga,Qb){return"unexpected"===Ga.kind||"unexpected"===Qb.kind?{kind:"unexpected"}:"success"===Ga.kind&&"success"===Qb.kind?this.M_h(Ga,Qb):"failure"===Ga.kind&&"failure"===Qb.kind?{kind:"equal"}:{kind:"failure",source:"failure"===Ga.kind?"client":"server"}}M_h(Ga,Qb){const wc=f(Ga.value,Qb.value);if("equal"===wc.kind)return wc;const S=
Ga.unformattedValue,eb=Qb.unformattedValue,ec=f(S,eb);return 2===Ga.operKind&&2===Qb.operKind&&2===Math.abs(S.length-eb.length)&&(Ga=S.length>eb.length?"client":"server",S.trim()===eb.trim())?{kind:"padded",source:Ga}:{kind:"different",diff:wc.diff,unformatted:ec}}}Object(la.a)(Jf,"ResultValidator",null,[]);var Rb=a(197),Gb=a(322),Cc=a(32);class cb{constructor(Ga){this.Xcg=Ga;this.v7=Object.assign({},Ic);this.AOb=[];this.gNc=-1;(this.Wcg=ac.EwaSettings.isChangeGateEnabled("OfficeVSO:5999949_formulaTelemetryMetriThresholds"))&&
Ga&&(this.v7.countAboveThresholds={},Ga.forEach(Qb=>this.v7.countAboveThresholds[Qb]=0))}static get Xwe(){return Cc.a.ih.$j.m}g9a(){this.gNc=cb.Xwe}Wfa(Ga,Qb){Qb=void 0===Qb?null:Qb;if(-1!==this.gNc||Object(Id.b)(Qb))Ga?(this.MHb(cb.Xwe-(Qb||this.gNc)),this.gNc=-1):this.v7.failedCount++}Jzf(){this.v7.excludingFirstAction=cb.Izf(this.AOb);this.AOb.push(this.v7.firstAction);this.v7.includingFirstAction=cb.Izf(this.AOb)}MHb(Ga){this.v7.count?1E3>this.v7.count&&this.AOb.push(Ga):this.v7.firstAction=Ga;
this.Wcg&&this.Xcg&&this.Xcg.forEach(Qb=>{Ga>Qb&&this.v7.countAboveThresholds[Qb]++});this.v7.count++}static Izf(Ga){const Qb=Object.assign({},pc);0<Ga.length&&(Gb.b(Ga),Qb.median=Ga[Math.floor(.5*Ga.length)],Qb.P75=Ga[Math.floor(.75*Ga.length)],Qb.P95=Ga[Math.floor(.95*Ga.length)],Qb.max=Ga[Ga.length-1],Qb.average=Ga.reduce((wc,S)=>wc+S)/Ga.length);return Qb}}Object(la.a)(cb,"PerformanceMeasurement",null,[]);const pc={average:0,max:0,median:0,P75:0,P95:0},Ic={count:0,countAboveThresholds:void 0,
failedCount:0,firstAction:0,includingFirstAction:Object.assign({},pc),excludingFirstAction:Object.assign({},pc)};class rd{constructor(Ga){this.$=Ga;this.WHa=this.iNb=null;this.usage={};this.oWc={};this.performance={};this.details={};this.QRc=-1;this.ej=(Qb,wc)=>{wc.dm||wc.bWb||this.$.sendBeaconTraceTag(388818255,50,!1,this.nxe())};this.editBox=Object($a.f)(this.$).Fh;Ga.gq(this.ej)}static getInstance(Ga){return rd.instance||(rd.instance=new rd(Ga))}set trigger(Ga){this.iNb=Ga;this.QRc=cb.Xwe}set YIg(Ga){this.WHa=
Ga}F5b(Ga){Object(Id.c)(this.details.color)&&(this.details.color={});Object(Id.c)(this.details.color[Ga])&&(this.details.color[Ga]=0);this.details.color[Ga]++}setResult(Ga,Qb){if(Object(Id.c)(this.iNb))Ca.ULS.sendTraceTag(512258439,0,15,"ValuePreviewTelemetry.setResult - currentTrigger undefined");else if("Failure"!==Ga.kind||Ga.timeout){var wc=Qb===this.editBox?"cellEditor":"formulaBar",S=this.iNb;Qb=this.WHa;var eb=this.QRc;Object(Id.c)(this.usage[wc])&&(this.usage[wc]={});Object(Id.c)(this.usage[wc][S])&&
(this.usage[wc][S]={success:0,error:0,loading:0,timeout:0});wc=this.usage[wc][S];switch(Ga.kind){case "Success":8===Ga.operKind?wc.error++:(this.sgk(Ga.value),wc.success++);this.iNb=this.WHa=null;this.QRc=-1;this.k5(Qb,eb);break;case "Loading":wc.loading++;break;case "Failure":this.iNb=this.WHa=null,this.QRc=-1,Ga.timeout&&wc.timeout++}}}sgk(Ga){if(!Object(Id.c)(this.WHa)){Object(Id.c)(this.oWc[this.WHa])&&(this.oWc[this.WHa]=[]);var Qb=this.oWc[this.WHa];1E3>Qb.length&&Qb.push(Ga.length)}}k5(Ga,
Qb){if(-1!==Qb){Ga=null!==Ga&&void 0!==Ga?Ga:"cache";this.WJf(`${Ga}_request`).Wfa(!0,Qb);var wc=this.WJf(`${Ga}_overall`);window.requestAnimationFrame(()=>{wc.Wfa(!0,Qb)})}}WJf(Ga){return this.performance[Ga]=this.performance[Ga]||new cb(Rd)}nxe(){const Ga={};Object.keys(this.performance).forEach(Qb=>{this.performance[Qb].Jzf();var wc=this.performance[Qb];Ga[Qb]={metrics:wc.v7,durations:wc.AOb}});return`{"usage":${JSON.stringify(this.usage)},"resultLengths":${JSON.stringify(this.oWc)},"performance":${JSON.stringify(Ga)},"details":${JSON.stringify(this.details)}}`}}
Object(la.a)(rd,"ValuePreviewTelemetry",null,[]);const Rd=[50,80,100,130,150,170,200],va=(Ga,Qb)=>{Qb=void 0===Qb?!1:Qb;const wc=rd.instance;if(Object(Id.c)(Ga))return Qb&&wc.F5b("none"),null;if("string"==typeof Ga){Ga=Rb.a.PNc[Ga.toLowerCase()];if(Object(Id.c)(Ga))return Qb&&wc.F5b("badString"),null;Qb&&wc.F5b("string");return Ga}if("number"==typeof Ga)return Qb&&wc.F5b("number"),null;Qb&&wc.F5b("other");return null};class Bb{constructor(Ga,Qb){this.$=Ga;this.pluginScheduler=Qb;this.XS=new Ac(n);
this.WZc=!0;this.Fkj=ac.EwaSettings.isChangeGateEnabled("OfficeVSO:8544629_ValuePreviewFailureCaching");this.ZVb=ac.EwaSettings.isChangeGateEnabled("OfficeVSO:8501487_ValuePreviewDetectVolatile");this.MJc=ac.EwaSettings.isChangeGateEnabled("OfficeVSO:8561808_ValuePreviewSnapshotActiveCell");this.Ouf=(wc,S,eb)=>{const ec=this;return Lo(function*(){return new Promise((Lc,Ad)=>{const pd={Formula:S,IsWholeFormula:wc===S,ActiveCell:ec.JWi(eb)};var de=ec.$.pa.ta;Lc=ec.QZj(Lc);Ad=ec.PZj(Ad);const Ge=de.$a(1,
null);Ge.evaluationParameters=pd;Dc.h(de,"EvaluatePartialFormula",Ge,Lc,Ad,null,null,128)})})};this.QZj=wc=>S=>{if(Object(Id.c)(S.Result))wc({kind:"Failure",reason:"No result",stateId:S.StateId});else{var eb=S.Result,ec=t(eb.Value);Object(Id.b)(ec)?wc({kind:"Failure",reason:ec,stateId:S.StateId}):wc({kind:"Success",value:eb.Value,unformattedValue:eb.UnformattedValue,operKind:eb.OperKind,color:eb.Color,stateId:S.StateId})}};this.PZj=wc=>S=>{S=$b.a.gk(S.data);S=Wb.a.Yh(S);wc(`Request failed, Errors: ${S}`)};
this.da=Object($a.f)(this.$);this.formulaAssistanceManager=gb.Ec.Aa()?db.a.nh(gb.Ec):Ga.la.kh(464);this.$Ig=new Jf(this.$,this.da);this.fD=rd.getInstance(Ga)}clearCache(){this.XS.clear()}Wke(Ga,Qb,wc){wc=void 0===wc?!1:wc;const S=this;return Lo(function*(){S.WZc=wc;const eb=S.request(Ga);let ec;const Lc=new Promise(Ad=>{ec=window.setTimeout(()=>{Ad({kind:"Failure",timeout:!0})},Qb)});return Promise.race([eb,Lc]).finally(()=>{window.clearTimeout(ec)})})}request(Ga){const Qb=this;return Lo(function*(){return m(Qb.XS,
Ga,()=>Lo(function*(){var wc;let S=null;var eb=null;Qb.MJc&&(S=Object(hb.q)(Qb.da.ha.qa.activeCell,Qb.$),eb={sheetName:null===(wc=Qb.$.ma)||void 0===wc?void 0:wc.sheetId,namedObjectName:null,firstRow:S.FirstRow,firstColumn:S.FirstColumn});eb=Qb.MJc?Object.assign({},Ga,{activeCell:eb}):Ga;wc=Qb.$Ig.MOd();eb=yield Qb.pluginScheduler.requester().valuePreview(eb,Qb.formulaAssistanceManager?Qb.formulaAssistanceManager.I5a:vc.PluginGroup.Excel,null);if("Done"!==eb.kind)return"Superseded"===eb.kind&&Qb.XS.delete(Ga),
null;eb=eb.payload;if(Object(Id.c)(eb))return{kind:"Failure"};Qb.WZc&&(Qb.fD.YIg="client",void Qb.$Ig.XVh(Ga,eb,wc,Qb.Ouf,S));switch(eb.kind){case "Failure":return Qb.Fkj&&Qb.XS.delete(Ga),{kind:"Failure"};case "Success":return Qb.ZVb&&eb.isVolatile&&Qb.XS.delete(Ga),Qb.Bcl(eb);case "Unavailable":return void Qb.jCj(Ga.text,eb),Qb.XS.delete(Ga),Qb.Brk({text:Ga.text,index:eb.index,length:eb.length},Ga,Ga.text,eb.evaluatedFormula,S,!eb.isVolatile)}}))})}Bcl(Ga){Ga=Object.assign({},Ga,{color:va(Ga.color,
this.WZc)});const Qb=t(Ga.value);return Object(Id.b)(Qb)?(Ca.ULS.sendTraceTag(509871621,1,15,`FormulaAssistanceValuePreviewRequester.validateClientSuccessResult: formula failure:${Qb}, kind:${Ga.kind}`),{kind:"Failure"}):Ga}Brk(Ga,Qb,wc,S,eb,ec){const Lc=this;return Lo(function*(){return x(Lc.XS,Ga,Qb,ec,()=>(new Promise((Ad,pd)=>Lo(function*(){try{const de=yield Lc.Ouf(wc,S,eb);Lc.WZc&&(Lc.fD.YIg="server");"Success"===de.kind?Ad({kind:"Success",value:de.value,index:Ga.index,length:Ga.length,color:de.color,
operKind:de.operKind}):(Ca.ULS.sendTraceTag(508831818,1,50,`FormulaAssistanceValuePreviewRequester.requestFromServer: evaluatePartialFormula failed, ${de.reason}`),Ad({kind:"Failure"}))}catch(de){Ca.ULS.sendTraceTag(520495426,1,15,`FormulaAssistanceValuePreviewRequester.requestFromServer: evaluatePartialFormula rejected, ${de}`),pd(de)}}))).catch(()=>{Lc.XS.delete(Ga);Lc.XS.delete(Qb);return{kind:"Failure"}}))})}jCj(Ga,Qb){return Lo(function*(){var wc=yield db.a.resolve(gb.Bc,{va:1});const S=xc.Range.vi(0,
0),eb=wc.anonymize(Ga,S);wc=wc.anonymize(Qb.evaluatedFormula,S);Ca.ULS.sendTraceTag(507799744,1,50,`FormulaAssistanceValuePreviewRequester.logUnavailableResult: ${JSON.stringify({formula:eb,evaluatedFormula:wc,reason:Qb.reason})}`)})}JWi(Ga){const Qb=Object(hb.q)(this.da.ha.qa.activeCell,this.$);if(this.MJc&&Object(Id.b)(Ga)){const wc=Object(hb.e)(Ga,Qb);0<wc.length&&Ca.ULS.sendTraceTag(507777487,1,20,`FormulaAssistanceValuePreviewRequester.getSheetCell: cell diffs: ${wc.join(",")}`)}return this.MJc?
Ga:Qb}}Object(la.a)(Bb,"FormulaAssistanceValuePreviewRequester",null,[]);class Ac{constructor(Ga){this.U1c=Ga;this.map=new Map}has(Ga){Ga=this.U1c(Ga);return this.map.has(Ga)}get(Ga){Ga=this.U1c(Ga);return this.map.get(Ga)}set(Ga,Qb){Ga=this.U1c(Ga);this.map.set(Ga,Qb);return this}delete(Ga){Ga=this.U1c(Ga);return this.map.delete(Ga)}clear(){this.map.clear()}}Object(la.a)(Ac,"RequestMap",null,[]);Object(db.b)(gb.Hc,{Fk:"singleton"})(Ga=>Lo(function*(){const Qb=yield db.a.resolve(gb.Nb,Ga),wc=yield db.a.resolve(Gf.g,
Ga);return new Bb(Qb,wc)}));Object(db.b)(gb.Ic)(Ga=>Lo(function*(){yield db.a.resolve(gb.Ub,Ga);return excelOnlineCalc.FormulaAuthoringHelperSingletonGlobal.instance()}));var Nc;let hd=Nc=class extends jd.a{constructor(Ga){super(Ga,Nc.featureName)}get hl(){return Xd.a.PId}show(Ga,Qb,wc,S,eb,ec,Lc,Ad){ec=void 0===ec?null:ec;return this.Qxb(void 0===Lc?null:Lc,pd=>{appChrome.renderFormulaSuggestionCard(Ga,Qb,this.domElement,pd.y,pd.x,pd.y+pd.height,pd.x+pd.width,wc,S,eb,ec,this.bxb,Ad?{explanationKey:Ad.explanationKey,
replacements:Ad.explanationReplacements,notifyExplanationSuccessful:Ad.G9d}:void 0)})}Bte(Ga,Qb,wc,S,eb,ec,Lc,Ad,pd,de,Ge){return this.Qxb(Ge,Re=>{appChrome.renderRowNumberingSuggestionCard(Ga,Qb,this.domElement,Re.y,Re.x,Re.y+Re.height,Re.x+Re.width,wc,S,eb,ec,Lc,Ad,pd,de,this.bxb)})}QZ(Ga,Qb,wc){ac.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FBEPluginDebugUI",!1)&&(this.T4&&Ga.equals(this.z1d)||(this.T4&&document.body.removeChild(this.T4),this.z1d=Ga,Ga=this.grid.zh(Ga),Ga=this.grid.getCellBounds(Ga.cell,
!0),this.T4=document.createElement("div"),this.T4.setAttribute("style",`position:fixed;
        left: ${Ga.x+Ga.width}px;
        top: ${Ga.y+Ga.height/2}px`),document.body.appendChild(this.T4)),Ga=new $c.a(-847286761,0,this.$.hi,0,null),this.$.Ma.qh(Ga,{["CalloutName"]:15,["Target"]:this.T4,["NewState"]:Qb,["Reason"]:wc}))}};hd=Nc=Object(za.__decorate)([Object(db.d)(gb.Kc),Object(za.__param)(0,Object(gb.Nb)())],hd);Object(la.a)(hd,"FormulaByExampleCardUIControl",jd.a,[744]);class qd{constructor(Ga,Qb,wc){this.pluginScheduler=Ga;this.Kw=Qb;this.eab=wc;this.lBd=ac.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FBEPluginDebugUI",
!1)}Ark(Ga,Qb){const wc=this;return Lo(function*(){var S,eb,ec,Lc;let Ad=null;wc.Kw.Jja(Qb,0);var pd={context:Object(hb.hb)(Ga)};wc.lBd&&wc.eab.EQk(Ga);pd=yield wc.pluginScheduler.requester().columnFormulaSuggestion(pd,vc.PluginGroup.Excel,Qb.toString());"Done"===pd.kind&&(null===(S=pd.payload)||void 0===S?0:S.suggestions)&&pd.payload.suggestions[0]&&(S=pd.payload.suggestions[0],pd=S.metadata,"ColumnFormulaSuggestion"===S.kind?(wc.Kw.Jja(Qb,5,{formula:pd.rawFormula,mna:pd.anonymizedFormula,hT:null!==
(eb=pd.seenCount)&&void 0!==eb?eb:null,Taa:null!==(ec=pd.isCacheHit)&&void 0!==ec?ec:null,Uoa:null!==(Lc=pd.latestOutcome)&&void 0!==Lc?Lc:null}),Ad=wc.FMi(S),wc.lBd&&wc.eab.IVg(Ga,`formula found: "${S.metadata.rawFormula||S.formula}"`)):("no formula found"===S.reason?wc.Kw.Jja(Qb,1,{errorMessage:null,hT:pd.seenCount,Taa:pd.isCacheHit,Uoa:pd.latestOutcome}):wc.Kw.Jja(Qb,1,{errorMessage:S.reason,hT:null,Taa:null,Uoa:null}),wc.lBd&&wc.eab.IVg(Ga,S.reason)));wc.Kw.zjb(Qb);return Ad})}Ffg(Ga,Qb){const wc=
this;return Lo(function*(){yield wc.pluginScheduler.eventEmitter().FBEOutcomeUpdate({flowId:Ga,suggestionOutcome:{outcome:Qb}});return!0})}FMi(Ga){if(!Ga||!Ga.evalResults)return null;const Qb=Ga.evalResults.map(wc=>{if("FormulaSuggestionEvalFailureResult"===wc.kind)return{kind:"Failure",cell:Object(hb.eb)(wc.cell),value:wc.error};let S;switch(wc.value.kind){case "number":S=wc.value.num;break;case "string":S=wc.value.text;break;case "boolean":S=wc.value.flag}return{kind:"Success",cell:Object(hb.eb)(wc.cell),
value:S,format:wc.formatted}});return{flowId:Number(Ga.suggestionID),columnRange:Object(hb.eb)(Ga.columnRange),tableName:Ga.tableName,tableColumnName:Ga.tableColumnName,suggestions:[{formula:Ga.formula,mna:Ga.metadata.formulaAnonymized,cells:Qb,tableName:Ga.tableName}]}}}Object(la.a)(qd,"FormulaByExamplePluginCommunicator",null,[760]);var je=a(284);class Ie{constructor(Ga,Qb){this.da=Ga;this.Sj=Qb;this.jsf=new Set;this.cZ=(wc,S)=>{if(wc=this.da.oh.Kl(S.Bq,!1))if(S=this.GZi(wc,S.Bq.left))this.jsf.has(S)?
(this.ywh(),this.da.Fh.i2(this.cZ)):this.jsf.add(S)};this.ywh=()=>{je.a.vV("XLS-FormulaByExample-Treatment;XLS-FormulaByExample-Control")};this.GZi=(wc,S)=>{const eb=this.Sj.O_a(wc);if(!eb)return null;const ec=wc.usedRange,Lc=S-ec.left;return 0>Lc||Lc>=eb.length?(Ca.ULS.sendTraceTag(537161876,306,10,`FormulaByExampleSuggestionCache.getUniqueTableColumnIdentifier: invalid inputs. tableRange: ${ec}, columnNumber: ${S}, `+`areAllTableHeadersAvailable: ${this.Sj.d6e(wc,eb)}`),null):(S=eb[Lc])?wc.name+
"_"+S:null};this.da.Fh.uX(this.cZ)}}Object(la.a)(Ie,"FormulaByExampleScorecardTriggerReporter",null,[]);var Oe;(function(Ga){Ga.PreviewAlreadyShowing="PreviewAlreadyShowing";Ga.StrictDataMismatch="StrictDataMismatch";Ga.LackingPrefetchedResults="LackingPrefetchedResults";Ga.RangeNotLoaded="RangeNotLoaded";Ga.InvalidCalcResults="InvalidCalcResults";Ga.ErrorsInEvaluation="ErrorsInEvaluation";Ga.InternalPreviewError="InternalPreviewError";Ga.WorkbookModelUpdateFailed="WorkbookModelUpdateFailed";Ga.Unknown=
"Unknown"})(Oe||(Oe={}));Object(la.b)("FormulaPreviewErrorKind",Oe);var Vb=a(119);class fd{constructor(Ga,Qb,wc,S){this.$=Ga;this.da=Qb;this.GKb=wc;this.RId=S;this.V8b=!1;this.XE=null;this.LXc=()=>{Ca.ULS.sendTraceTag(537161889,306,50,"FormulaByExampleManager.SendByExampleFeedback: opening send feedback dialog after click on card.");const eb={};eb[wa.a.cP]="FormulaByExampleCard";this.$.si(802602464,0,8,eb)};this.Q1b=eb=>{this.V8b=!0;Ca.ULS.sendTraceTag(537161888,306,50,`FormulaByExampleManager.OnShowFormula: user clicked ShowFormula button in the card for flow ${eb}`)};
this.hTb=()=>{};this.gia=(eb,ec)=>{0===ec.tx&&576!==ec.Ul.operation.operationName&&(this.XE&&this.XE.Naa(`UserOperation: ${Vb.a(ec.Ul.operation.operationName)}`),this.$.userOperationManager.uu(this.gia))}}sRk(Ga,Qb,wc){const S=this;return Lo(function*(){try{const eb=Object(hb.F)(Qb.columnRange),ec=wc.cells.map(w),Lc=yield S.RId.uRk(wc.formula,eb,de=>{S.hTb(de,Ga,Qb,wc)},{stateId:0,results:ec});if(!Lc.success)return{B7:"UNSEEN",fqc:`FormulaByExampleUIManager.showFormulaPreview failed: ${Lc.error}`,
u7a:null};S.XE=Lc.XE;const Ad=S.$.isFeedbackEnabled?S.LXc:null;let pd=null;ac.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExample.ShowRowNumberingCard",!1)&&v(wc.mna)?(pd={isAcceptAsValues:!1,maxTooltipOpenDurationMS:0,isFurtherExplanationHyperlinkClicked:!1,disableApplyAsValue:1E4<wc.cells.length},S.GKb.Bte(wc.formula,eb.toString(),()=>{S.XE.Ita("CardUI")},()=>{pd.isAcceptAsValues=!0;S.XE.Ita("CardUI")},pd.disableApplyAsValue,()=>S.XE.fIa("CardUI"),de=>{pd.maxTooltipOpenDurationMS=
Math.max(pd.maxTooltipOpenDurationMS,de)},()=>{pd.isFurtherExplanationHyperlinkClicked=!0},Ad,()=>S.Q1b(Qb.flowId),Ga)):S.GKb.show(wc.formula,eb.toString(),()=>S.XE.Ita("CardUI"),()=>S.XE.fIa("CardUI"),Ad,()=>S.Q1b(Qb.flowId),Ga,void 0);S.$.userOperationManager.mw(S.gia);return S.XE.d6b.then(de=>{S.GKb.hide();S.$.userOperationManager.uu(S.gia);return Object.assign({},de,{u7a:pd})})}catch(eb){return{B7:"UNSEEN",fqc:`FormulaByExampleUIManager.showSuggestionPreview failed: ${eb}`,u7a:null}}})}EQk(Ga){this.GKb.QZ(Ga,
7)}IVg(Ga,Qb){this.GKb.QZ(Ga,8,Qb)}}Object(la.a)(fd,"FormulaByExampleUIManager",null,[]);var Qd=a(190),me=a(216);Object(db.b)(gb.Lc)(Ga=>Lo(function*(){const Qb=yield db.a.resolve(gb.Nb,Ga),wc=yield db.a.resolve(gb.Pc,Ga),S=yield db.a.resolve(gb.E,Ga),eb=yield db.a.resolve(gb.Kc,Ga),ec=$a.f(Qb);let Lc=null;if(yield wd.a.R1a(Qb))Lc=(yield db.a.resolve(gb.ug,Ga)).Caa();const Ad=yield db.a.resolve(Gf.g,Ga),pd=yield db.a.resolve(gb.Mc);return new se(Qb,ec,new Ie(ec,S),eb,Lc,wc,Ad,pd)}));class se{constructor(Ga,
Qb,wc,S,eb,ec,Lc,Ad){this.$=Ga;this.da=Qb;this.SG=S;this.A9a=eb;this.RId=ec;this.cHa=null;this.requestId=1;this.S6j=ac.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExamplePluginCommunication",!1);this.SWk=ac.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExamplePluginEvaluationEnabled",!1);this.RWk=ac.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExamplePluginSuggestionShowing",!1);this.cZ=(pd,de)=>{const Ge=de.Bq;if(de.committed){var Re=
this.requestId++;this.R5b();this.cHa=this.da.za.GNa(()=>{void this.Rce.Ark(Ge,Re).then(kf=>void this.WXj(kf,Ge))})}};this.m$d=pd=>{void this.Rce.Ffg(pd.flowId,"UNDO")};(this.Qzi=wd.a.CLa(this.$))&&this.S6j&&(this.yme=ac.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleRowsBelowRangeTableToQuery",1),this.eab=new fd(this.$,this.da,this.SG,this.RId),this.Rce=new qd(Lc,Ad.xNf("Plugin"),this.eab),this.da.Fh.uX(this.cZ))}WXj(Ga,Qb){const wc=this;return Lo(function*(){var S;if(wc.SWk&&
Ga&&Ga.suggestions&&0<Ga.suggestions.length){const ec=Ga.suggestions[0];if(wc.vPi(Qb)&&wc.RWk){var eb=yield wc.eab.sRk(Qb,Ga,ec);"UNSEEN"!==eb.B7&&("ACCEPT"===eb.B7&&((null===(S=eb.u7a)||void 0===S?0:S.isAcceptAsValues)?wc.VIh(wc.IKd(Qb),ec.cells,Ga.tableName):wc.FIh(wc.IKd(Qb),ec.formula,Qb),wc.U4a=(Lc,Ad)=>{0===Ad.tx&&(170===Ad.Ul.operation.operationName&&wc.m$d(Ga),wc.$.userOperationManager.uu(wc.U4a),wc.U4a=null)},wc.$.userOperationManager.mw(wc.U4a)),yield wc.Rce.Ffg(Ga.flowId,eb.B7))}}})}FIh(Ga,
Qb,wc){Qb=Object(dc.a)(new Gc.a,{Text:Qb});this.da.setCell(Qb,wc,1,127,null,0,{range:Ga,origin:wc},2)}VIh(Ga,Qb,wc){Ga={FirstRow:Ga.top-1,FirstColumn:Ga.left-1,LastRow:Ga.bottom-1,LastColumn:Ga.right-1,SheetName:this.$.sa.ma.name,NamedObjectName:wc};Qb=Qb.map(S=>[S.value.toString()]);this.B6c(Ga,Qb)}B6c(Ga,Qb){const wc=new me.a(163,0,(S,eb,ec)=>{const Lc=this.$.pa.ta,Ad=Lc.$a(0);Ad.rangeToSet=Ga;Ad.rangeValues=Qb;return Dc.h(Lc,"SetRange",Ad,(pd,de,Ge)=>{S(pd,de,Ge)},(pd,de,Ge)=>{eb(pd,de,Ge)},ec,
this.$.pa.ta.Vh(),0)},65);this.$.userOperationManager.enqueueOperation(wc,null)}vPi(Ga){Ga=this.IKd(Ga);return null===Ga||void 0===Ga?void 0:Ga.Ik(this.da.Dp)}IKd(Ga){const Qb=this.Lga(Ga);return Qb?new xc.Range(Qb.zx.top,Ga.left,Qb.zx.bottom,Ga.right,!0,!0):null}Lga(Ga){const Qb=this.da.oh.Kl(Ga,!1);if(Qb)return{zx:Object(Qd.a)(Qb),jV:!0,XM:!1};if(this.A9a){const {a4b:wc,XM:S}=this.WNi(Ga);if(wc)return{zx:wc,jV:!1,XM:S}}return null}WNi(Ga){const Qb=new xc.Range(Ga.top-this.yme,Ga.left,Ga.bottom,
Ga.right,!0,!0),wc=this.A9a.sKa(new ye.a(Qb,Object(zb.d)(this.$.ma)),6);if(!wc)return null;for(const S of wc)for(const eb of S.table.interpretations)if(2===eb.orientation&&.5<eb.confidence)return{a4b:this.X6h(eb,Qb),XM:!eb.tableLocation.Xi(Ga)};return{a4b:null,XM:!1}}X6h(Ga,Qb){return new xc.Range(Ga.tableLocation.top+Ga.headerRowCount,Ga.tableLocation.left+Ga.headerColumnCount,Math.max(Ga.tableLocation.bottom,Qb.bottom),Ga.tableLocation.right,!0,!0)}R5b(){var Ga;null===(Ga=this.cHa)||void 0===Ga?
void 0:Ga.call(this);this.cHa=null}}Object(la.a)(se,"FormulaByExamplePluginTriggersManager",null,[]);const Ne={k2:null,Lia:null,formula:null,mna:null,errorMessage:null,Taa:null,hT:null,Uoa:null};let Ue=class{constructor(){this.Z2b=new Map;this.jZb=new Map;this.SHd=new Map}xNf(Ga){return new nf(this,Ga)}Jja(Ga,Qb,wc,S){Qb=Qb?this.Z2b:this.jZb;if(!Qb.has(Ga))if(0===wc)Qb.set(Ga,Object.assign({},Ne));else return;const eb=Qb.get(Ga);switch(wc){case 0:eb.k2=performance.now();break;case 2:Qb.set(Ga,Object.assign({},
eb,S));break;case 3:case 1:case 5:eb.Lia=performance.now();Qb.set(Ga,Object.assign({},eb,S));break;case 4:eb.Taa||(eb.Lia=performance.now(),Qb.set(Ga,Object.assign({},eb,S)))}}zjb(Ga){if("BothComplete"===this.FCc(Ga))this.V8f(Ga);else{const Qb=window.setTimeout(()=>{"BothComplete"!==this.FCc(Ga)&&(this.Z2b.has(Ga)||this.jZb.has(Ga))&&this.V8f(Ga)},15E3);this.SHd.set(Ga,Qb)}}V8f(Ga){var Qb=this.Z2b.get(Ga);const wc=this.jZb.get(Ga);var S=(null===wc||void 0===wc?void 0:wc.errorMessage)||(null===Qb||
void 0===Qb?void 0:Qb.Taa)===(null===wc||void 0===wc?void 0:wc.Taa)&&(null===Qb||void 0===Qb?void 0:Qb.hT)===(null===wc||void 0===wc?void 0:wc.hT)&&(null===Qb||void 0===Qb?void 0:Qb.Uoa)===(null===wc||void 0===wc?void 0:wc.Uoa);S="BothComplete"===this.FCc(Ga)&&S&&(null===Qb||void 0===Qb?void 0:Qb.formula)===(null===wc||void 0===wc?void 0:wc.formula)&&(null===Qb||void 0===Qb?void 0:Qb.errorMessage)===(null===wc||void 0===wc?void 0:wc.errorMessage);const eb="AwaitTask failed - no annotation found"===
(null===Qb||void 0===Qb?void 0:Qb.errorMessage)&&(null===wc||void 0===wc?void 0:wc.k2)&&!(null===wc||void 0===wc?0:wc.Lia);S||eb?Ca.ULS.sendTraceTag(84165970,306,20,`FBE plugin validator compared successfully: ${JSON.stringify({["flowID"]:Ga,["pluginStartTime"]:Qb.k2,["pluginEndTime"]:Qb.Lia,["legacyStartTime"]:wc.k2,["legacyEndTime"]:wc.Lia,["pluginRequestDuration"]:Qb.Lia-Qb.k2,["legacyRequestDuration"]:wc.Lia-wc.k2,["firstStartReported"]:Qb.k2<wc.k2?"Plugin":"Legacy",["error"]:Qb.errorMessage,
["formula"]:Qb.mna,["isCacheHit"]:Qb.Taa,["seenCount"]:Qb.hT,["latestOutcome"]:Qb.Uoa})}`):this.tnj(null===wc||void 0===wc?void 0:wc.errorMessage)&&(Qb={["flowId"]:Ga,["pluginStartTime"]:null===Qb||void 0===Qb?void 0:Qb.k2,["pluginEndTime"]:null===Qb||void 0===Qb?void 0:Qb.Lia,["legacyStartTime"]:null===wc||void 0===wc?void 0:wc.k2,["legacyEndTime"]:null===wc||void 0===wc?void 0:wc.Lia,["successfulFlows"]:this.FCc(Ga),["pluginError"]:null===Qb||void 0===Qb?void 0:Qb.errorMessage,["legacyError"]:null===
wc||void 0===wc?void 0:wc.errorMessage,["pluginFormula"]:null===Qb||void 0===Qb?void 0:Qb.mna,["legacyFormula"]:null===wc||void 0===wc?void 0:wc.mna,["pluginCacheHit"]:null===Qb||void 0===Qb?void 0:Qb.Taa,["legacyCacheHit"]:null===wc||void 0===wc?void 0:wc.Taa,["pluginSeenCount"]:null===Qb||void 0===Qb?void 0:Qb.hT,["legacySeenCount"]:null===wc||void 0===wc?void 0:wc.hT,["pluginLatestOutcome"]:null===Qb||void 0===Qb?void 0:Qb.Uoa,["legacyLatestOutcome"]:null===wc||void 0===wc?void 0:wc.Uoa},Ca.ULS.sendTraceTag(84165957,
306,20,`FBE plugin validator comparison failure: ${JSON.stringify(Qb)}`));this.Z2b.delete(Ga);this.jZb.delete(Ga);if(Qb=this.SHd.get(Ga))clearTimeout(Qb),this.SHd.delete(Ga)}FCc(Ga){var Qb=this.jZb.get(Ga),wc=this.Z2b.get(Ga);Ga=null===wc||void 0===wc?void 0:wc.k2;wc=null===wc||void 0===wc?void 0:wc.Lia;const S=null===Qb||void 0===Qb?void 0:Qb.k2,eb=null===Qb||void 0===Qb?void 0:Qb.Lia;Qb=ac.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExamplePluginCacheEnabled",!1)?null!==(null===
Qb||void 0===Qb?void 0:Qb.Taa)||null!==(null===Qb||void 0===Qb?void 0:Qb.errorMessage):!0;return Ga&&wc&&S&&eb&&Qb?"BothComplete":Ga&&wc?"PluginComplete":S&&eb&&Qb?"LegacyComplete":"NoneComplete"}tnj(Ga){return"signal lock"!==Ga&&"AL is undefined"!==Ga&&"tableRange does not intersect loaded range"!==Ga&&"table return null for table suggestion"!==Ga&&"column has non uniform data"!==Ga&&"consistent block cache callback cancelled"!==Ga}};Ue=Object(za.__decorate)([Object(db.d)(gb.Mc)],Ue);Object(la.a)(Ue,
"FormulaByExamplePluginValidator",null,[]);class nf{constructor(Ga,Qb){this.M8g=Ga;this.QIc="Plugin"===Qb;this.QIc||(this.S6f=new Map)}Jja(Ga,Qb,wc){(Ga=this.wNf(Ga))&&this.M8g.Jja(Ga,this.QIc,Qb,wc)}zjb(Ga){(Ga=this.wNf(Ga))&&this.M8g.zjb(Ga)}oRg(Ga,Qb){this.QIc||this.S6f.set(Ga,Qb)}wNf(Ga){return this.QIc?Ga:this.S6f.get(Ga)}}Object(la.a)(nf,"FormulaByExamplePluginValidatorProxy",null,[]);var tb=a(960);Object(db.b)(gb.Nc,{Fk:"singleton"})(Ga=>Lo(function*(){const Qb=yield db.a.resolve(gb.Nb,Ga),
wc=yield wd.a.R1a(Qb),[S,eb,ec,Lc,Ad]=yield Promise.all([db.a.resolve(gb.E,Ga),db.a.resolve(gb.p,Ga),wc?db.a.resolve(gb.ug,Ga):Promise.resolve(null),db.a.resolve(gb.xc,Ga),ac.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FBEPersistentCache",!1)?db.a.resolve(gb.vd):Promise.resolve(null)]);let pd,de,Ge;pd=yield db.a.resolve(gb.Lc,Ga);de=yield db.a.resolve(gb.Mc,Ga);Ge=ac.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExamplePluginCacheEnabled",!1)?yield db.a.resolve(Gf.g,
Ga):null;return new tb.a(Qb,S,eb,ec,Lc,pd,wc,Ad,de,Ge)}));class lc extends Map{constructor(Ga){super();this.Iba=Ga}set(Ga,Qb){if(!this.has(Ga)&&this.size>=this.Iba){const [wc]=this.entries().next().value;this.delete(wc)}return super.set(Ga,Qb)}has(Ga){if(super.has(Ga)){const Qb=this.get(Ga);this.delete(Ga);super.set(Ga,Qb);return!0}return!1}}Object(la.a)(lc,"LimitedSizeHotMap",Map,[]);const Tc=Ga=>`${Ga.top}_${Ga.left}`;let md=class{constructor(Ga){this.Jh=Ga;this.y5a=new Map;this.Atb=new Map;this.OGj=
ac.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleMinRowsForLocks",3);this.UFj=ac.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleMaxLocksPerSession",3);this.bQa=new lc(this.UFj);this.apc=!1;this.u_j=(Qb,wc,S)=>{if(S.reduce((Lc,Ad)=>Lc+Ad.bottom-Ad.top+1,0)<this.OGj)Ca.ULS.sendTraceTag(508036641,0,50,"FormulaByExampleSignalLocksManager.onSignalSent: not enough rows to lock by");else{this.bQa.has(wc)&&this.bQa.delete(wc);for(const Lc of S){var eb=this.Jh.yva("FormulaByExampleSignalLocksManager.onSignalSent",
Lc);const Ad={f8f:Lc,I2d:new Map};try{for(;eb.$$mn();){const pd=eb.$$cu(),de=pd.Ln.value;Ad.I2d.set(Tc(pd.range),de)}}finally{eb&&eb.dispose()}if(ec)ec.g8f.push(Ad);else{eb=S[0].clone();S.reduce((pd,de)=>{pd.union(de);return pd},eb);var ec={sheetId:tb.a.S0(this.Jh.ma),columnId:wc,KTk:eb,g8f:[Ad]}}}this.y5a.set(Qb,ec);this.Atb.set(Qb,window.setTimeout(()=>{this.y5a.has(Qb)&&(this.y5a.delete(Qb),this.Atb.delete(Qb),Ca.ULS.sendTraceTag(508036640,0,50,`FormulaByExampleSignalLocksManager.onSignalSent: pending lock timed out, deleting lock for column ${ec.columnId}`))},
2E4))}};this.HSj=Qb=>{const wc=this.Atb.get(Qb);wc&&(window.clearTimeout(wc),this.Atb.delete(Qb));this.y5a.has(Qb)&&(Ca.ULS.sendTraceTag(508036639,0,50,`FormulaByExampleSignalLocksManager.onFormulaFound: pending lock found and deleted for column ${this.y5a.get(Qb).columnId}`),this.y5a.delete(Qb))};this.ISj=Qb=>{const wc=this.Atb.get(Qb);wc&&(window.clearTimeout(wc),this.Atb.delete(Qb));if(Qb=this.y5a.get(Qb))this.bQa.set(Qb.columnId,Qb),Ca.ULS.sendTraceTag(508036638,0,50,`FormulaByExampleSignalLocksManager.onFormulaNotFound: pending lock found, column locked: ${Qb.columnId}`),
this.V8g()};this.onBlockCacheItemChanged=(Qb,wc)=>{wc=wc.mj.block;Qb=wc.yj;wc=this.yPi(Qb,tb.a.S0(wc.ma));for(const S of wc){wc=S.g8f;for(const eb of wc)if(eb.f8f.Xi(Qb)){wc=eb.f8f.clone().Ik(Qb);wc=this.Jh.yva("FormulaByExampleSignalLocksManager.onBlockCacheItemChanged",wc);try{for(;wc.$$mn();){const ec=wc.$$cu(),Lc=ec.Ln.value,Ad=Tc(ec.range);eb.I2d.has(Ad)&&eb.I2d.get(Ad)!==Lc&&(this.bQa.delete(S.columnId),Ca.ULS.sendTraceTag(508036637,0,50,`FormulaByExampleSignalLocksManager.onBlockCacheItemChanged: existing lock's rows content changed, column unlocked: ${S.columnId}, columnChanged: ${ec.range.left}`),
this.V8g())}}finally{wc&&wc.dispose()}}}}}Aij(Ga){return this.bQa.has(Ga)}V8g(){!this.apc&&0<this.bQa.size?(this.Jh.nz(this.onBlockCacheItemChanged),this.Jh.Eeb(this.onBlockCacheItemChanged),this.apc=!0):this.apc&&0===this.bQa.size&&(this.Jh.Zy(this.onBlockCacheItemChanged),this.Jh.a5b(this.onBlockCacheItemChanged),this.apc=!1)}yPi(Ga,Qb){const wc=[];for(const S of this.bQa.values())S.sheetId===Qb&&S.KTk.Xi(Ga)&&wc.push(S);return wc}};md=Object(za.__decorate)([Object(db.d)(gb.Oc),Object(za.__param)(0,
Object(gb.Nc)())],md);Object(la.a)(md,"FormulaByExampleSignalLocksManager",null,[740]);var sd=a(1247),Zd=a(324),Ae=a(1108),Ee=a(141),Ze=a(619);Object(db.b)(gb.Pc,{Fk:"singleton"})(Ga=>Lo(function*(){const [Qb,wc,S]=yield Promise.all([db.a.resolve(gb.Nb,Ga),db.a.resolve(gb.xc,Ga),db.a.resolve(gb.E,Ga)]),eb=$a.f(Qb);return new Te(eb,eb.qN,S,wc)}));class Te{constructor(Ga,Qb,wc,S){this.da=Ga;this.qN=Qb;this.Sj=wc;this.yk=S;this.jIa=[];this.Rib=[]}uRk(Ga,Qb,wc,S){var eb=!0,ec=!0;eb=void 0===eb?!1:eb;
ec=void 0===ec?!1:ec;const Lc=this;return Lo(function*(){if(Lc.qN.isActive)return We("PreviewAlreadyShowing");let Ad;if(S)Ad=S;else{const pd=yield Lc.Nuf(Qb,Ga,ec,void 0);if(!pd.success)return pd.error;Ad=pd.results}if(eb&&!Lc.d9g(Ad))return We("StrictDataMismatch");if(!Lc.gAe(Ad))return We("WorkbookModelUpdateFailed");try{const pd=yield Lc.qN.w8(Qb,de=>{Lc.hTb(de,Ga,Qb,eb,ec,pd,wc)},{PreviewCellsRange:{FirstRow:Qb.top,FirstColumn:Qb.left,LastRow:Qb.bottom,LastColumn:Qb.right},RetainCellTextOnPreview:!0});
void pd.d6b.then(de=>{"ACCEPT"===de.B7&&Lc.gAe(Ad,!0)});return{success:!0,XE:pd}}catch(pd){return We("InternalPreviewError",pd)}})}Nuf(Ga,Qb,wc,S){const eb=this;return Lo(function*(){const ec=Ga.Ik(eb.da.Dp);if(!ec)return{success:!1,error:We("RangeNotLoaded")};const Lc=new xc.Range(ec.top,ec.left,ec.top,ec.left,!0,!0),Ad=yield eb.Sj.q5(null,ec,Lc,Qb,!0);if(!eb.CHc(Ad))return{success:!1,error:We("InvalidCalcResults")};const pd=eb.Duf(Ad);return 0===pd.size||1===pd.size&&pd.has("Unavailable")?{success:!0,
results:Ad}:wc?eb.lni(pd,Qb,S,ec,Lc):{success:!1,error:We("ErrorsInEvaluation",pd)}})}lni(Ga,Qb,wc,S,eb){const ec=this;return Lo(function*(){if(!(1===Ga.size&&Ga.has("PreviousFailure")||2===Ga.size&&Ga.has("PreviousFailure")&&Ga.has("Unavailable")))return{success:!1,error:We("ErrorsInEvaluation",Ga)};var Lc=ec.Lch(wc);Lc=yield ec.Sj.q5(Lc,S,eb,Qb,!0);if(!ec.CHc(Lc))return{success:!1,error:We("InvalidCalcResults")};const Ad=ec.Duf(Lc);return 0===Ad.size||1===Ad.size&&Ad.has("Unavailable")?{success:!0,
results:Lc}:{success:!1,error:We("ErrorsInEvaluation",Ad)}})}hTb(Ga,Qb,wc,S,eb,ec,Lc){const Ad=Ga.mj.block,pd=wc.Ik(Ad.yj);pd&&(this.jIa.push(Ad),this.Rib.push(pd),this.cAh(pd),void ec.d6b.then(()=>{this.xEg(pd)}),this.Sj.Dmc(()=>{const de=this;return Lo(function*(){const Ge=yield de.iOj(Qb,S,eb);null===Lc||void 0===Lc?void 0:Lc(Ga,Ge)})}))}cAh(Ga){this.kef(Ga,!0)}xEg(Ga){this.kef(Ga,!1)}kef(Ga,Qb){for(let S=Ga.top;S<=Ga.bottom;S++)for(let eb=Ga.left;eb<=Ga.right;eb++){var wc=xc.Range.vi(S,eb);if(wc=
this.da.zh(wc))wc.cell.Dte=Qb&&!wc.cell.KV}}iOj(Ga,Qb,wc){const S=this;return Lo(function*(){if(!S.jIa.length)return null;const eb=S.Rib.reduce((Lc,Ad)=>{Lc.union(Ad);return Lc}),ec=yield S.Nuf(eb,Ga,wc,S.jIa.map(Lc=>Lc.yj));if(!ec.success)return S.jIa=[],S.Rib=[],We("ErrorsInEvaluation",ec.error);if(Qb&&!S.d9g(ec.results))return S.jIa=[],S.Rib=[],We("StrictDataMismatch");if(!S.gAe(ec.results))return S.jIa=[],S.Rib=[],We("WorkbookModelUpdateFailed");S.xEg(eb);for(const Lc of S.jIa)S.qN.m_b(Lc);S.jIa=
[];S.Rib=[];return null})}gAe(Ga,Qb){Qb=void 0===Qb?!1:Qb;var wc;for(const Lc of Ga.results){if(!Object(sd.a)(Lc)){if("Unavailable"===Lc.reason.kind)continue;return!1}if(Ga=this.da.zh(qf(Lc.value.cell)))if(Qb)Ga.cell.text=Ga.cell.KV,(null===(wc=Ga.cell.w3b)||void 0===wc?0:wc.HorizontalAlignment)&&Ga.cell.PZ(Ga.cell.w3b.HorizontalAlignment,!0,!0);else{var S=Lc.value.formatted,eb=bf(Lc.value.value.kind);S=this.yk.gaa(S,eb,Ae.a,Ga);if(Object(Zd.c)(S)){eb=Ga.cell;eb.KV=S.value.text;eb.y3b=S.value.numFmt;
var ec=Lc.value.value;eb.aJg=(1===ec.kind?ec._valueXL:8===ec.kind?sa.a.hPb[ec.type-1]:ec.value)===(1===Ga.Ln.type?parseFloat(Ga.Ln.value):Ga.Ln.value);ec=new Ze.a;ec.HorizontalAlignment=0===Ga.cell.horizontalAlignment?S.value.horizontalAlignment:null;eb.w3b=ec}else return!1}}return!0}d9g(Ga){const Qb=new Set;Ga=Ga.results;for(const S of Ga.entries()){const [eb,ec]=S;if(!Object(sd.a)(ec)){var wc=qf(ec.reason.cell);if(this.da.kj.Coa(wc)){Ga.splice(eb,1);Qb.add("Contains hidden rows");continue}if(!this.da.bG(wc)){Ga.splice(eb,
1);Qb.add("Contains unavailable cells outside of view");continue}return{success:!1,vUc:["Unexpected unavailable cell"]}}wc=ec.value;const Lc=this.da.zh(qf(wc.cell));if(!Lc)continue;const Ad=Lc.Ln.type;if(0!==Ad)if(2===Ad){if(2!==wc.value.kind||wc.value.value!==Lc.Ln.value)return{success:!1,vUc:["String value mismatch"]}}else{if(1===Ad&&(1!==wc.value.kind||wc.value._valueXL!==parseFloat(Lc.Ln.value)))return{success:!1,vUc:["Number value mismatch"]};if(4===Ad&&(8!==wc.value.kind||wc.value.type!==parseFloat(Lc.Ln.value)))return{success:!1,
vUc:["Error value mismatch"]}}}return{success:!0,vUc:Array.from(Qb)}}Lch(Ga){const Qb=[];for(const wc of Ga){Ga=new Ee.a("FormulaColumnPreviewManager.GenerateConstantCellsCloneWrites",this.da,wc);try{for(;Ga.moveNext();){const S=Ga.get_current();Qb.push({row:S.cell.xH,column:S.cell.IK,Ln:S.Ln,formulaBarText:S.Ln.value,text:S.cell.text,qo:S.cell.qo})}}finally{Ga&&Ga.dispose()}}return Qb}Duf(Ga){const Qb=new Set;Ga=Ga.results;for(const wc of Ga)Object(sd.a)(wc)||Qb.add(wc.reason.kind);return Qb}CHc(Ga){return(Ga=
Ga.results)&&Ga.length?!0:!1}}Object(la.a)(Te,"FormulaColumnPreviewManager",null,[743]);const We=(Ga,Qb)=>({success:!1,error:{kind:Ga,data:Qb}}),qf=Ga=>new xc.Range(Ga.row+1,Ga.col+1,Ga.row+1,Ga.col+1,!0,!0),bf=Ga=>{switch(Ga){case 1:return 1;case 2:return 2;case 8:return 4;case 4:return 3;default:return 0}};var af=a(40),Nf=a(427),uf=a(264);Object(db.b)(gb.Wc,{Fk:"singleton"})(Ga=>Lo(function*(){var Qb;const wc=yield db.a.resolve(gb.Nb,Ga);if(gb.Ec.Aa())return new pf(wc);const S=yield db.a.resolve(gb.vg,
Ga),eb=yield db.a.resolve(gb.Qf,Ga);var ec=null!==(Qb=null===Ga||void 0===Ga?void 0:Ga.va)&&void 0!==Qb?Qb:0;Qb=yield Object(jf.e)(Cf.GetServiceTaskFactory.create(wc.la,449,wc.ya,ec));ec=yield db.a.resolve(Gf.g,Ga);const Lc=yield db.a.resolve(gb.E,Ga),Ad=yield db.a.resolve(gb.Fc,Ga),pd=yield db.a.resolve(Gf.e,Ga),de=new pf(wc);let Ge=wc.la.kh(464);Ge||(Ge=new Af(wc,de,Lc,ec,Qb,pd,eb.nzd(wc,S)),Ad.I9e(Ge.BQb),Ad.J9e(Ge.oga),Ad.K9e(Ge.oga));return de}));class pf extends af.a{constructor(Ga){super();
this.Rlh=[];this.ACf={};this.mJd={};this.t3=null;this.Dka=[];this.NZa={};this.RWd=this.Edd=!1;this.gqj=wd.a.fqj();this.flg=(Qb,wc)=>{Ca.ULS.sendTraceTag(537161987,0,50,"FunctionInfoManager.OnGetFunctionListPartialSucceeded");this.Rkg(Qb,!!wc&&1!==wc.FilterType,!0)};this.elg=()=>{Ca.ULS.sendTraceTag(537161986,0,50,"FunctionInfoManager.OnGetFunctionListPartialFailed -  reset varaible to ensure we will re-issue the webservice call");this.t3=null};this.Qkg=Qb=>{Ca.ULS.sendTraceTag(537161985,0,50,"FunctionInfoManager.OnFullFunctionListLoaded - full list was loaded");
this.che(Qb.Qwa,!0,!1)};this.dlg=Qb=>{Ca.ULS.sendTraceTag(537161984,0,50,"FunctionInfoManager.OnGetFunctionListFullSucceeded");this.Rkg(Qb,!0,!1)};this.th=Ga}Jmc(Ga){this.addHandler("FunctionInfoLoaded",Ga)}Vie(Ga){this.removeHandler("FunctionInfoLoaded",Ga)}get qoa(){return this.Edd}get wCf(){return this.t3}get nzc(){return this.Dka}get $(){return this.th}dispose(){const Ga=db.a.nh(gb.Cd);Ga&&Ga.Wie(this.Qkg);this.th=null;super.dispose()}ble(){this.Edd=!1;this.t3=null;this.RWd=!0;this.gqj&&this.Gjb(null)}Gjb(Ga,
Qb){Qb=void 0===Qb?!1:Qb;if(this.qoa)this.vzg();else{Ca.ULS.sendTraceTag(537161991,0,50,`Retrieving the list of function names for culture '${this.$.ua.UICultureTag}' from the server.`);let S=null;(S=db.a.nh(gb.Cd))||Ca.ULS.sendTraceTag(537161990,0,50,"instantaneousSupportInformationManager == null");if((null===S||void 0===S?0:S.Qwa)&&0<S.Qwa.length)ac.EwaSettings.Ra(114)?S.jzi(this.dlg):this.che(S.Qwa,!0,!1);else{var wc=this.$.pa.ta.Vh();Ga&&(this.$.ea.ki||Qb)&&!this.RWd&&(Qb?Nf.a(this.$.userOperationManager,
(eb,ec,Lc)=>Dc.p(this.$.pa.ta,Ga,uf.c(eb,this.flg),uf.b(ec,this.elg),Lc,Ga,wc),eb=>new me.a(130,0,eb,16),null):Dc.p(this.$.pa.ta,Ga,this.flg,this.elg,null,Ga,wc));!this.qoa&&this.$.ea.ki&&(S?(Ca.ULS.sendTraceTag(537161989,0,50,`FunctionInfoManager.EnsureFunctionInfoAsync - Functions not loaded yet, wait for them. IsFullyLoaded=${this.qoa}, IsSessionActive=${this.$.ea.ki}`),S.j4e(this.Qkg)):(Ca.ULS.sendTraceTag(537161988,0,50,"FunctionInfoManager.EnsureFunctionInfoAsync - instantaneousSupportInformationManager is null"),
Dc.p(this.$.pa.ta,{FilterType:0},this.dlg,null,null,null,wc),this.RWd=!1))}}}lHf(Ga){return 0>Ga||Ga>=this.t3.length?null:this.t3[Ga]}mHf(Ga){return pb.a.wj(this.mJd,Ga.toUpperCase())}Dlb(Ga){return pb.a.wj(this.NZa,Ga)}ZZf(Ga){return!Ga.GroupUI}Rkg(Ga,Qb,wc){const S=Vd.a(Ga);Ca.ULS.sendTraceTag(537161955,0,50,`FunctionInfoManager.OnFunctionListSucceeded: areNonStatusMessagesPresentInResult=${S}`);S?($a.f(this.$).endEdit(!1,"FunctionInfoManager.OnFunctionListSucceeded"),this.$.ea.sx(Ga.Errors)):this.che(Ga.Result,
Qb,wc)}che(Ga,Qb,wc){Ca.ULS.sendTraceTag(537161954,0,50,`FunctionInfoManager.RefreshFunctionList: functionsInfo count = ${Ga.length}, isCategorized = ${Qb}, partialResult = ${wc} IsFullyLoaded = ${this.qoa}`);this.qoa||(this.t3=Ga,this.yOh(Qb),this.Edd=!wc,this.vzg())}vzg(){this.raiseEvent("FunctionInfoLoaded")}yOh(Ga){var Qb=lb.a.instance.ia(1032),wc=[];this.NZa={};this.Dka=[];this.NZa[Qb]=wc;const S=lb.a.instance.ia(1033),eb=[];this.Dka.push(Qb);this.Dka.push(S);for(let Lc=0,Ad=this.t3.length;Lc<
Ad;Lc++){Qb=this.t3[Lc];Qb.IsCompatibility||eb.push(Qb);var ec=Qb.NameUI;const pd=Qb.NameDataStrings;this.ACf[pd.toUpperCase()]||(this.ACf[pd.toUpperCase()]=Qb);this.mJd[ec.toUpperCase()]||(this.mJd[ec.toUpperCase()]=Qb);if(!this.ZZf(Qb)){if(Ga){ec=Qb.GroupUI;let de=pb.a.wj(this.NZa,ec);de||(de=[],this.NZa[ec]=de,this.Dka.push(ec));de.push(Qb)}Qb.IsCommonlyUsed&&wc.push(Qb);Qb.IsCompatibility||this.Rlh.push(pd)}}this.NZa[S]=eb;Ga&&(pf.rDg(wc,[2,3,0,5,4,9,1,7,8,6]),wc=Array(14),wc[0]=0,wc[1]=1,wc[2]=
7,wc[3]=11,wc[4]=5,wc[5]=2,wc[6]=6,wc[7]=10,wc[8]=9,wc[9]=3,wc[10]=4,wc[11]=13,wc[12]=12,wc[13]=8,pf.rDg(this.Dka,wc),wc=[],wc.push(...this.Dka),wc.splice(13,1),this.Dka=wc);wc=(Lc,Ad)=>Lc.NameUI.localeCompare(Ad.NameUI);this.t3=[...this.t3];this.t3.sort((Lc,Ad)=>Lc.NameDataStrings.localeCompare(Ad.NameDataStrings));for(let Lc=1,Ad=this.Dka.length;Lc<Ad&&Ga;Lc++)this.NZa[this.Dka[Lc]].sort(wc);for(let Lc=0,Ad=this.t3.length;Lc<Ad;Lc++)this.t3[Lc].FunctionIndex=Lc}static rDg(Ga,Qb){const wc=[...Ga];
for(let S=0;S<wc.length&&S<Qb.length;S++)Ga[S]=wc[Qb[S]]}}Object(la.a)(pf,"FunctionInfoManager",af.a,[741,742,4]);class ff{constructor(Ga){this.pluginScheduler=Ga}request(Ga){const Qb=this;return Lo(function*(){var wc=yield Qb.pluginScheduler.requester().gotoCtrlClick(Ga,vc.PluginGroup.Excel,null);if("Done"!==wc.kind&&"Superseded"===wc.kind)return null;wc=wc.payload;if(Object(Id.c)(wc))return{kind:vc.GotoCtrlClickResultKind.Failure};switch(wc.kind){case vc.GotoCtrlClickResultKind.RangeResolutionFailure:case vc.GotoCtrlClickResultKind.NoReferenceFound:case vc.GotoCtrlClickResultKind.Failure:return wc;
case vc.GotoCtrlClickResultKind.ReferenceFound:return wc;default:return Ca.ULS.sendTraceTag(507339545,0,15,"GotoCtrlClickRequester.request: unexpected GotoCtrlClickResultKind"),null}})}}Object(la.a)(ff,"GotoCtrlClickRequester",null,[]);class Qa{constructor(Ga,Qb,wc,S){this.$=Ga;this.onHoverEnter=Qb;this.onHoverLeave=wc;this.t9d=S;this.H4a=(eb,ec)=>{switch(ec.state){case 0:(ec=this.getSelection(ec.event,eb))?(this.tAd=ec,this.onHoverEnter(eb,ec)):(this.UVb=void 0,this.gwd());break;case 1:this.gwd();
this.onHoverLeave(eb);break;case 2:break;default:return ec}};this.bPc=eb=>{this.UVb!==eb.ctrlKey&&(this.UVb=eb.ctrlKey,this.t9d(this.UVb))};this.da=Object($a.f)(this.$);this.editBox=this.da.cellTextEditBox;this.formulaBar=Object(vb.a)(this.$);this.Hp()}gwd(){this.tAd=void 0}dispose(){this.to()}Hp(){this.editBox.aIb(this.H4a);this.formulaBar.aIb(this.H4a);document.addEventListener("keyup",this.bPc,{capture:!0});document.addEventListener("keydown",this.bPc,{capture:!0})}to(){this.editBox.f5b(this.H4a);
this.formulaBar.f5b(this.H4a);document.removeEventListener("keyup",this.bPc,{capture:!0});document.removeEventListener("keydown",this.bPc,{capture:!0})}getSelection(Ga,Qb){Ga=new Sys.UI.Point(Ga.clientX,Ga.clientY);{Qb=Qb.Wa.Yl;var wc=void 0,{x:S,y:eb}=Ga;wc=void 0===wc?document:wc;Ga=-1;let ec=null;void 0!==wc.caretPositionFromPoint?(wc=wc.caretPositionFromPoint(S,eb),null!==wc&&(Ga=wc.offset,ec=wc.offsetNode)):void 0!==wc.caretRangeFromPoint&&(wc=wc.caretRangeFromPoint(S,eb),null!==wc&&(Ga=wc.startOffset,
ec=wc.startContainer));null===ec||-1===Ga?(Ca.ULS.sendTraceTag(507339543,0,15,"getEditorCaretPositionFromPoint - failed to get relevant range"),Qb=-1):Qb.contains(ec)?Qb=k(Qb,ec,Ga):(Ca.ULS.sendTraceTag(507339542,0,15,"getEditorCaretPositionFromPoint - relavant node not inside root"),Qb=-1)}if(!Qb||-1===Qb)return null;Qb={index:Qb,length:0};return this.Ure(Qb)?Qb:null}Ure(Ga){return!this.tAd||!this.Rmi(this.tAd,Ga)}Rmi(Ga,Qb){return Ga.index===Qb.index&&Ga.length===Qb.length}}Object(la.a)(Qa,"GotoCtrlClickHandler",
null,[4]);const Ob={underline:!0,bold:!0};class Pc{constructor(){this.ptg=void 0}dispose(){this.hide()}show(Ga,Qb){Ga=Object.assign({},Qb,{pB:Ga});this.jQa(Ga)&&(this.Tqa(Ga)&&this.hide(),this.dx=Ga,this.GIh())}hide(){this.dx&&(this.zkk(),this.dx=void 0)}jQa(Ga){var Qb;if(!(Qb=!this.dx)){Qb=this.dx;if(Qb===Ga)Ga=!0;else if(Qb&&Ga&&Qb.pB===Ga.pB&&Qb.kind!==Ga.kind)if(Qb.kind===vc.GotoCtrlClickResultKind.ReferenceFound&&Ga.kind===vc.GotoCtrlClickResultKind.ReferenceFound){var wc=Qb.sharedSheetRange,
S=Ga.sharedSheetRange;Ga=!!wc&&!!S&&wc.SheetName===S.SheetName&&wc.FirstColumn===S.FirstColumn&&wc.FirstRow===S.FirstRow&&wc.LastRow===S.LastRow&&wc.LastColumn===S.LastColumn&&wc.NamedObjectName===S.NamedObjectName&&Qb.span.start===Ga.span.start&&Qb.span.end===Qb.span.end}else Ga=!0;else Ga=!1;Qb=!Ga}return Qb}Tqa(Ga){var Qb;if(Qb=this.dx)Qb=this.dx,Qb=!(Qb.pB===Ga.pB&&Qb.span.start===Ga.span.start&&Qb.span.end===Ga.span.end);return Qb}GIh(){const Ga=this.dx.pB,Qb=this.dx.span;this.ptg=Ga.Wa.getFormattedText();
Ga.Wa.formatText(Qb.start,Qb.end-Qb.start,Ob);Ga.Wa.style.cursor="pointer"}zkk(){const Ga=this.dx.pB,Qb=this.dx.span,wc=Ga.text;wc.length<Qb.end?Ca.ULS.shipAssertTag(507339544,0,!1,`GotoCtrlClickControl.removeGotoFormat - unexpected editor state: ${wc.length}:${Qb.start}:${Qb.end}`):(Ga.isEditing?this.fEk(Ga):Ga.Wa.setFormattedText(this.ptg),Ga.Wa.style.cursor="text")}fEk(Ga){Ga=Ga.Wa;Ga.QM=!0;const Qb=Ga.selection,wc=Qb.index,S=Ga.text.length;Ga.selectRange(Math.min(wc,S),Math.min(wc+Qb.length,S));
this.dx.pB.$Z(null);Ga.QM=!1}}Object(la.a)(Pc,"GotoCtrlClickControl",null,[4]);var Cd=a(159);const Ud=(Ga,Qb,wc,S)=>(eb,ec,Lc)=>{const Ad=$a.f(Ga),pd=Ga.pa.ta.Vh();eb=uf.c(eb,Wd(wc,S));ec=uf.b(ec,le(S));return Ga.sa.ma?Dc.x(Ga.pa.ta,Qb,Ga.sa.ma.name,eb,ec,Lc,Ad,pd):Dc.w(Ga.pa.ta,Qb,-1,eb,ec,Lc,Ad,pd)},Wd=(Ga,Qb)=>wc=>{Vd.a(wc)?Qb(wc):(wc=wc.Result,wc=hb.m(wc.Ranges[0],wc.SheetName),Ga(wc))},le=Ga=>Qb=>{Ga(Qb)};let Fa=class{constructor(Ga,Qb,wc){this.$=Ga;this.pluginScheduler=Qb;this.da=wc;this.onHoverEnter=
(S,eb)=>{const ec=this;return Lo(function*(){ec.cnf=S;ec.$mf=Cd.a.instance.Yk(S.Wa.domElement);ec.$mf.Ba("mouseup",ec.LS);void ec.pak({text:S.text,index:eb.index,length:eb.length},ec.requester.request.bind(ec.requester),S)})};this.onHoverLeave=()=>{var S;this.hide();null===(S=this.$mf)||void 0===S?void 0:S.zM();this.cnf=this.qib=void 0};this.t9d=S=>{var eb;(this.UVb=S)&&(null===(eb=this.qib)||void 0===eb?void 0:eb.kind)===vc.GotoCtrlClickResultKind.ReferenceFound?this.show(this.fs.pB,this.qib):this.hide()};
this.d4i=S=>{const eb=this;return Lo(function*(){eb.qib=S;const ec=eb.fs.pB;switch(S.kind){case vc.GotoCtrlClickResultKind.RangeResolutionFailure:case vc.GotoCtrlClickResultKind.Failure:eb.hide();Ca.ULS.sendTraceTag(507339546,0,15,`GotoCtrlClick.handleResult: Request Failed with error: ${vc.GotoCtrlClickResultKind[S.kind]}`);break;case vc.GotoCtrlClickResultKind.NoReferenceFound:eb.hide();break;case vc.GotoCtrlClickResultKind.ReferenceFound:eb.UVb&&eb.show(ec,S);break;default:return S}})};this.LS=
S=>{var eb;S.ctrlKey&&(null===(eb=this.qib)||void 0===eb?void 0:eb.kind)===vc.GotoCtrlClickResultKind.ReferenceFound&&((S=this.qib.sharedSheetRange)?this.YHg(S):(eb=this.qib.span,S=this.$,eb=new me.a(562,0,Ud(S,this.cnf.text.substring(eb.start,eb.end),this.YHg,this.OZj),18,null),S=S.userOperationManager.enqueueOperation(eb,null),Ca.ULS.shipAssertTag(507331929,0,!!S,"RangeAndSheetNameExtractor.InvokeWebMethodRequest: queueItem is null after scheduling the web method call.")))};this.YHg=S=>{this.reset();
this.da.ep(S,null,null,null,60,"GotoCtrlClick")};this.OZj=()=>{Ca.ULS.sendTraceTag(507331928,0,15,"GotoCtrlClick.onServerOperationFailure: Request Failed")};this.reset=()=>{this.hide();this.handler.gwd()};this.control=new Pc;this.requester=new ff(this.pluginScheduler);this.handler=new Qa(this.$,this.onHoverEnter,this.onHoverLeave,this.t9d);this.Hp()}dispose(){this.to();this.handler.dispose();this.control.dispose()}Hp(){this.da.Fh.Jx(this.reset);this.da.ha.kGa(this.reset);this.$.ea.dK(this.reset)}to(){this.da.Fh.Lw(this.reset);
this.da.ha.RAa(this.reset);this.$.ea.hL(this.reset)}pak(Ga,Qb,wc){const S=this;return Lo(function*(){const eb=Object.assign({},Ga,{pB:wc});S.fs=eb;const ec=yield Qb(Ga);!Object(Id.c)(ec)&&S.gZd(eb)&&(yield S.d4i(ec))})}show(Ga,Qb){this.control.show(Ga,Qb)}hide(){this.control.hide()}gZd(Ga){return this.fs?this.fs.text===Ga.text&&this.fs.index===Ga.index&&this.fs.length===Ga.length&&this.fs.pB===Ga.pB:!1}};Fa=Object(za.__decorate)([Object(db.d)(gb.Yc),Object(za.__param)(0,Object(gb.Nb)()),Object(za.__param)(1,
Object(Gf.g)()),Object(za.__param)(2,Object(gb.id)())],Fa);Object(la.a)(Fa,"GotoCtrlClick",null,[4]);Object(db.b)(gb.td,{Fk:"singleton"})(()=>Lo(function*(){return mb}));const mb=(Ga,Qb)=>Lo(function*(){if(y(Ga)&&y(Qb)){var wc=C(Ga),S=C(Qb),eb=yield E(wc),ec=yield E(S);var Lc=B(wc.value,S.value);"different"===Lc.kind&&(wc=B(wc.unformattedValue,S.unformattedValue),Lc={kind:"different",diff:Lc.diff,unformatted:wc});eb={cse:eb,immediate:ec,diagnostic:Lc,cellValueFix:ac.EwaSettings.HGc()};Ca.ULS.sendTraceTag(507646813,
1,20,`ImmediateCellComparison.compareCells, result: ${JSON.stringify(eb)}`)}});let e=class{constructor(Ga,Qb){this.$=Ga;this.clearContentNotifier=Qb;this.keptData={suggestionsKept:0,suggestionsCommitted:0,suggestionsChanged:0,suggestionsReverted:0,suggestionsDeleted:0};this.Rl=(wc,S)=>{this.G8g()&&S.committed&&S.Bq.equals(this.iza.suggestion.Bq)&&this.iza.suggestion.cellText!==S.cellText&&this.keptData.suggestionsChanged++};this.gsb=()=>{var wc;if(this.G8g()){var S=this.da.ha.qa.selectedRanges,eb=
null===(wc=this.iza)||void 0===wc?void 0:wc.suggestion.Bq;S.some(ec=>ec.contains(eb))&&this.keptData.suggestionsDeleted++}};this.fAa=(wc,S)=>{0===S.tx&&(170===S.Ul.operation.operationName&&this.keptData.suggestionsReverted++,this.$.userOperationManager.uu(this.fAa))};this.da=$a.f(this.$)}JMd(){this.keptData.suggestionsKept=this.IOi();return this.keptData}frg(Ga){this.keptData.suggestionsCommitted++;this.iza={suggestion:Ga,stateId:this.$.ea.Ek};this.Hp()}Hp(){this.da.cellTextEditBox.Jx(this.Rl);this.clearContentNotifier.Vod(this.gsb);
this.$.userOperationManager.mw(this.fAa)}to(){this.da.cellTextEditBox.Lw(this.Rl);this.clearContentNotifier.RUc(this.gsb)}G8g(){this.to();if(null!==this.iza&&1===this.$.ea.Ek-this.iza.stateId)return!0;this.iza=null;return!1}IOi(){return this.keptData.suggestionsCommitted-(this.keptData.suggestionsChanged+this.keptData.suggestionsDeleted+this.keptData.suggestionsReverted)}};e=Object(za.__decorate)([Object(db.d)(gb.Hd,{Fk:"transient"}),Object(za.__param)(0,Object(gb.Nb)()),Object(za.__param)(1,Object(gb.X)())],
e);Object(la.a)(e,"KeptTelemetryHandler",null,[]);var Ra=a(1399),O=a(428),qa=a(1023);class ob extends O.a{constructor(Ga){super();this.$=Ga;this.gm()}create(){(Ga=>db.a.resolve(gb.E).then(Qb=>setTimeout(()=>Ga(Qb),0)))(Ga=>{Ga=this.$.la.kh(294)||this.$.la.Hh(294,new qa.RelativeAndAbsoluteReferencesManager(Ga));this.Bk(Ga)})}static Ba(Ga){Ga.la.Hh(295,new ob(Ga))}}Object(la.a)(ob,"RelativeAndAbsoluteReferencesManagerFactory",O.a,[]);var R=a(9),Za=a(916);class Cb extends O.a{constructor(Ga){super();
this.Nxk="formulaAssistance";this.$=Ga;this.gm()}create(){let Ga=this.$.la.kh(448);Ga?this.Bk(Ga):void Object(Za.a)(this.Nxk,{va:this.xh}).then(()=>{Ga=this.$.la.kh(448);Ga||(Ga=this.$.la.Hh(448,formulaAssistance.FormulaAssistanceUIFactoryGlobal.create({isFeedbackAllowed:this.$.isFeedbackEnabled})),this.$.Ovd(()=>{const Qb={};Qb.isFeedbackAllowed=this.$.isFeedbackEnabled;Ga.updateContext(Qb)}));this.Bk(Ga)})}static Ba(Ga){Ga.la.Hh(449,new Cb(Ga))}}Object(la.a)(Cb,"FormulaAssistanceUIControlFactory",
O.a,[]);var rc=a(1105),ma=a(224),qb=a(256),Xb=a(62);class qc{constructor(Ga){this.scheduler=Ga;this.HAb=void 0}qUf(){const Ga=this;return Lo(function*(){Ga.HAb||(Ga.HAb=yield db.a.resolve(gb.p));return Ga.HAb})}registerOnAnnotation(Ga,Qb,wc,S){const eb=this;return Lo(function*(){var ec;const Lc=(pd,de)=>{(0,eb.scheduler.alAnnotationNotifier()[Ga])(de.annotation).catch(Ge=>{Ca.ULS.sendTraceTag(508048724,0,10,`IALInterop.onAnnotationReceived: Failed to send annotation to x10 handlers. ${Ge}`)})},Ad=
null!==(ec=eb.HAb)&&void 0!==ec?ec:yield eb.qUf();return null===Ad||void 0===Ad?void 0:Ad.register(Ad.J5().n8(wc).m8(()=>{}).activateAnnotation({annotationType:Qb,Ny:S,BV:Lc}).build())})}sendSignal(Ga){const Qb=this;return Lo(function*(){var wc;const S=null!==(wc=Qb.HAb)&&void 0!==wc?wc:yield Qb.qUf();return null===S||void 0===S?void 0:S.oyb(Ga)})}}Object(la.a)(qc,"ALProvider",null,[]);class Uc{constructor(Ga){this.cdl=Ga;this.value=void 0}CK(){void 0===this.value&&(this.value=this.cdl());return this.value}reset(){this.value=
void 0}}Object(la.a)(Uc,"ResettableLazy",null,[]);class ld{constructor(){this.wYd=new Map;this.xwj=new Uc(()=>Lo(function*(){return(yield db.a.resolve(gb.ug,{va:0})).Caa()}));this.wYd.set(vc.PluginFactoryName.FormulaByExamplePlugin,new Uc(()=>Lo(function*(){const Ga=yield db.a.resolve(gb.Nb);return wd.a.R1a(Ga)})));this.wYd.set(vc.PluginFactoryName.TestPlugin,new Uc(()=>Lo(function*(){return!0})))}getRecognizedRangeTablesInfo(Ga,Qb,wc,S,eb){const ec=this;return Lo(function*(){var Lc,Ad;if(null===
(Ad=yield null===(Lc=ec.wYd.get(S))||void 0===Lc?void 0:Lc.CK())||void 0===Ad||!Ad)return Ca.ULS.sendTraceTag(507794771,306,50,`x10TableIntelligenceService.getRecognizedRangeTablesInfo: plugin ${S} is not licensed for user`),[];Lc=Qb?new ye.a(Object(hb.C)(Qb),Ga):null;a:{switch(wc){case vc.RecognizedTablesMetadataState.Valid:Ad=2;break a;case vc.RecognizedTablesMetadataState.Invalid:Ad=4;break a;case vc.RecognizedTablesMetadataState.All:Ad=6;break a}Ad=void 0}return(yield ec.xwj.CK()).sKa(Lc,Ad,eb).map(K)})}}
Object(la.a)(ld,"X10TableIntelligenceProvider",null,[]);class yd extends O.a{constructor(Ga){super();this.$=Ga;this.ttc=null;this.tjk=new Uc(()=>{const Qb=this;return Lo(function*(){const wc=yield Qb.Vdj.CK();Qb.$.la.Hh(413,wc);return wc})});this.Vdj=new Uc(()=>{const Qb=this;return Lo(function*(){yield db.a.resolve(gb.Ub,{va:Qb.xh});const wc=excelOnlineCalc.PluginSchedulerSingletonGlobal.instance();if(zc.a.iS)return wc;var S=yield db.a.resolve(gb.Hb,{va:Qb.xh});excelOnlineCalc.x10.resolveScriptLoaderPromise(S.HE());
wc.registerALProvider(new qc(wc));wc.registerTableIntelligenceProvider(new ld);excelOnlineCalc.x10.setX10Features(Qb.ONf());S=(yield Promise.all([excelOnlineCalc.x10.ensureGroupAttached(vc.PluginAttachGroup.Core),wd.a.oob(Qb.$)?excelOnlineCalc.x10.ensureGroupAttached(vc.PluginAttachGroup.SmartSuggestionsAutoComplete):0])).reduce((eb,ec)=>eb+ec,0);(yield db.a.resolve(Gf.e,{va:Qb.xh})).iW.anyPluginInitialized=0<S;return wc})});this.gm()}create(){Ca.ULS.sendTraceTag(537154643,0,50,"PluginSchedulerFactory.Create: Loading scheduler slice");
ac.EwaSettings.isChangeGateEnabled("OfficeVSO:8763136_UseNewXPlatEwaX10Init")?this.tjk.CK().then(Ga=>{this.Bk(Ga)},Ga=>{Ca.ULS.sendTraceTag(507381790,0,10,"PluginSchedulerFactory.Create: Error loading scheduler slice: "+Ga)}):rc.a.then(this.J8h(),Ga=>{this.Bk(Ga)})}J8h(){if(this.ttc)return this.ttc;const Ga=qb.a.hib(Xb.b(),ma.a.none,"LoadResource","x10Scheduler loading");if(ac.EwaSettings.isChangeGateEnabled("OfficeVSO:5789323_disableSchedulerForIE")&&zc.a.iS){const Qb=excelOnlineCalc.PluginSchedulerSingletonGlobal.instance();
this.$.la.Hh(413,Qb);Ga.setResult(Qb);return this.ttc=Ga.task}(Qb=>db.a.resolve(gb.E,{va:this.xh}).then(wc=>setTimeout(()=>Qb(wc),0)))(()=>{this.Nxj(Qb=>{const wc=excelOnlineCalc.PluginSchedulerSingletonGlobal.instance();Qb=Qb.HE();Qb=jf.c(wb.Task.Ua(Qb));wc.registerALProvider(new qc(wc));ac.EwaSettings.isChangeGateEnabled("OfficeVSO:8479330_enableTableIntelligenceInX10")&&wc.registerTableIntelligenceProvider(new ld);const S=this.ONf();ac.EwaSettings.isChangeGateEnabled("OfficeVSO:7913510_sendSchedulerFeaturesNOtification")&&
wc.notifier().setSchedulerFeatures(S.map(eb=>vc.SchedulerFeature[eb]));Promise.all([excelOnlineCalc.x10.ensureGroupAttachedLegacy(Qb,vc.PluginAttachGroup.Core,S),wd.a.oob(this.$)?excelOnlineCalc.x10.ensureGroupAttachedLegacy(Qb,vc.PluginAttachGroup.SmartSuggestionsAutoComplete,S):0]).then(eb=>eb.some(ec=>0<ec)).then(eb=>{this.$.la.Hh(413,wc);Ga.setResult(wc);this.$.la.fi(491,ec=>{ec.iW.anyPluginInitialized=eb})})})});return this.ttc=Ga.task}Nxj(Ga){void db.a.resolve(gb.Hb,{va:this.xh}).then(Qb=>Ga(Qb))}ONf(){const Ga=
[];fe.forEach((Qb,wc)=>{Qb(this.$)&&Ga.push(wc)});return Ga}static Ba(Ga){Ga.la.Hh(414,new yd(Ga))}}Object(la.a)(yd,"PluginSchedulerFactory",O.a,[]);const fe=new Map([["ArgumentAssistance",()=>!0],["SimpleAutoComplete",()=>!0],["SmartSuggestionsAutoComplete",Ga=>wd.a.oob(Ga)],["ValuePreview",()=>wd.a.poa()],["ColoredReferences",()=>!0],["ParenthesisCoupling",()=>!0],["SyntaxErrors",()=>wd.a.tWb()],["EnumAutoComplete",()=>!0],["GotoCtrlClick",()=>wd.a.e_f()]]);var De=a(210);const Tb={selectByArrowKeyCounter:0,
selectByMouseHoverCounter:0,commitByTabKeyCounter:0,commitByEnterKeyCounter:0,commitByMouseClickCounter:0,commitWhileRequestPending:0,dismissSmartSuggestionExplicitlyCounter:0,dismissSmartSuggestionImplicitlyCounter:0},Yc={formulaAssistanceRequestAttemptedCounter:0,formulaAssistanceRequestOptimizedCounter:0},Ld={argumentAssistanceCardInitialMode:void 0,argumentAssistanceCollapseCounter:0,argumentAssistanceExpandCounter:0,argumentAssistanceLearnMoreCounter:0,argumentAssistanceDragCounter:0,argumentAssistanceDragTotalCounter:0,
argumentAssistanceMoveCounter:0,argumentAssistanceMoveTotalCounter:0,argumentAssistanceCardIsInitialModeDefault:!1},he={smartSuggestionShownCounter:0,smartSuggestionSelectedCounter:0,smartSuggestionCommittedCounter:0,smartSuggestionKeptCounter:0,smartSuggestionChangedCounter:0,smartSuggestionDeletedCounter:0,smartSuggestionRevertedCounter:0,isCellContentOnlyEqualDuringEditCounter:0,isCellContentFormulaCounter:0,smartSuggestionWouldSuggestInsidePivotCounter:0},Ke={parenthesesCouplingCounter:0,formulaHighlightsCounter:0},
Me={dialogCommittedCounter:0,dialogShownCounter:0,argsDialogOpenedByRibbonCounter:0,argsDialogOpenedByDialogCounter:0,argsDialogCommittedCounter:0},df={argumentAssistanceFlight:void 0,autoCompleteUIFlight:void 0,smartFormulaBarAutoCompletePluginFlight:void 0,anyPluginInitialized:void 0,formulaAssistanceRedesignFlight:void 0,smartFormulaSuggestionsFeatureEnabled:void 0,parenthesesCouplingFlight:void 0,coloredReferencesFlight:void 0,uILocale:void 0,dataLocale:void 0,country:void 0,formulaAssistanceUiPositionFlight:void 0,
argumentAssistanceUxFlight:void 0};var xf;(function(Ga){Ga.RenderDown="rd";Ga.RenderUp="ru";Ga.Expand="e";Ga.Collapse="c";Ga.Drag="d";Ga.Move="m";Ga.GiveFeedback="gf";Ga.InitialModeExpanded="ie";Ga.InitialModeCollapsed="ic";Ga.LearnMore="lm";Ga.ESC="esc";Ga.SecondESC="2ndEsc"})(xf||(xf={}));Object(la.b)("argumentAssistanceUsageActions",xf);var fg=a(61),xg=a(47),lg=a(106);const Vf={["argumentAssistanceOverall"]:[50,80,100,130,150,170,200],["autoCompleteOverall"]:[50,80,100,130,150,170,200,250,300,
350,400],["autoCompleteOverallSimpleAndSmart"]:[50,80,100,130,150,170,200],["autoCompleteOverallSmartOnly"]:[50,80,100,130,150,170,200],["autoCompleteOverallSimpleOnly"]:[50,80,100,130,150,170,200],["tryUpdateHighlightsFromCellContentEditor"]:[50,80,100,130,150,170,200],["autoCompleteComputation"]:[50,80,100,130,150,170,200,250,300,350,400],["autoCompleteComputationNoResult"]:[50,80,100,130,150,170,200,250,300,350,400]};class dg{constructor(Ga,Qb){this.$=Ga;this.fXg=Qb;this.hMa=wd.a.cIc();this.AP=
null;this.uLc=-1;this.K1d=null;this.L1d=this.vLc=0;this.Gla=Object.assign({},Ld);this.PU=Object.assign({},he);this.Eua=Object.assign({},Tb);this.Hsd=Object.assign({},Yc);this.TId=Object.assign({},Ke);this.iW=Object.assign({},df);this.wJb={};this.Ukb=Object.assign({},Me);this.dJb=[];this.qoc=ac.EwaSettings.isChangeGateEnabled("OfficeVSO:7376612_argumentAssistanceOrderedActionsTelemetry");this.eYa={};this.Rl=(wc,S)=>{null!=this.AP&&(1==Math.abs(this.uLc-this.$.ea.Ek)&&(wc=this.$.sa.ma.sheetId,S.committed&&
S.Bq.equals(this.AP.Bq)&&this.K1d===wc&&this.AP.cellText!==S.cellText&&this.vLc++),1<=Math.abs(this.uLc-this.$.ea.Ek)&&(this.AP=null,this.uLc=-1,this.K1d=null));0<Object.keys(this.eYa).length&&(Ca.ULS.sendTraceTag(509658956,0,50,`FormulaAssistanceTelemetryManager.onEditEnded: current edit's completion items data: ${JSON.stringify(this.eYa)}`),this.eYa={})};this.ej=(wc,S)=>{S.dm||S.bWb||(this.SQg(),this.aHk(),this.$.sendBeaconTraceTag(88392384,50,!1,"{0}",this.getJsonForLogging()))};this.Etb=new lg.a;
Ga.gq(this.ej);this.hMa||$a.f(this.$).Bp.Jx(this.Rl);this.SQg();this.MBj()}dispose(){!this.hMa&&this.$&&$a.f(this.$).Bp.Lw(this.Rl)}tQa(Ga){Ga.forEach(Qb=>{this.Etb.lh(Qb)||this.Etb.ga(Qb,new cb(Vf[Qb]));this.Etb.na(Qb).g9a()})}k5(Ga,Qb){Qb=void 0===Qb?!0:Qb;Ga.forEach(wc=>{this.Etb.lh(wc)&&this.Etb.na(wc).Wfa(Qb)})}YBk(Ga){this.qla(Ga?"ie":"ic")}XBk(){this.Gla.argumentAssistanceCardIsInitialModeDefault=!0}QOb(Ga){window.requestAnimationFrame(()=>{this.k5([Ga])})}sqk(Ga){Ga.forEach(Qb=>{Qb=vc.CompletionItemKind[Qb.kind];
this.Z8g(Qb);this.wJb[Qb].shownCounter++;this.eYa[Qb].shownCounter++})}rqk(Ga){Ga=vc.CompletionItemKind[Ga];this.Z8g(Ga);this.wJb[Ga].committedCounter++;this.eYa[Ga].committedCounter++}qla(Ga){if(this.qoc){const Qb=this.dJb.length;0===Qb||this.dJb[Qb-1][0]!==Ga?this.dJb.push([Ga,1]):this.dJb[Qb-1][1]++}else switch(Ga){case "e":this.Gla.argumentAssistanceExpandCounter++;break;case "c":this.Gla.argumentAssistanceCollapseCounter++;break;case "d":this.Gla.argumentAssistanceDragCounter++;break;case "m":this.Gla.argumentAssistanceMoveCounter++;
break;case "lm":this.Gla.argumentAssistanceLearnMoreCounter++;break;case "ie":this.Gla.argumentAssistanceCardInitialMode="Expanded";break;case "ic":this.Gla.argumentAssistanceCardInitialMode="Collapsed"}}ZEk(Ga){this.fXg.frg(Ga)}MBj(){Ca.ULS.sendTraceTag(509140996,0,50,`FormulaAssistanceTelemetryManager.SessionDetails: ${fg.a.Ci(this.iW)}`)}getJsonForLogging(){return"{"+this.NX("SessionDetails",this.iW)+","+this.NX("ArgumentAssistanceUsage",this.Gla)+","+this.NX("argumentAssistanceOrderedActions",
this.dJb)+","+this.NX("FormulaSuggestionsUsage",this.PU)+","+this.NX("FunctionDialogUsage",this.Ukb)+","+this.NX("AutocompleteCardInteraction",this.Eua)+","+this.NX("AutocompleteRenderOptimization",this.Hsd)+","+this.NX("AutocompleteUsageByKind",this.wJb)+","+this.NX("FormulaHighlightsUsage",this.TId)+","+this.pWi()+"}"}aHk(){if(this.hMa){var Ga=this.fXg.JMd();this.PU.smartSuggestionKeptCounter=Ga.suggestionsKept;this.PU.smartSuggestionChangedCounter=Ga.suggestionsChanged;this.PU.smartSuggestionDeletedCounter=
Ga.suggestionsDeleted;this.PU.smartSuggestionRevertedCounter=Ga.suggestionsReverted}else this.PU.smartSuggestionChangedCounter=this.vLc,this.PU.smartSuggestionDeletedCounter=this.L1d,this.PU.smartSuggestionKeptCounter=this.PU.smartSuggestionCommittedCounter-this.vLc-this.L1d;for(Ga=0;Ga<this.PU.smartSuggestionKeptCounter;Ga++)Object(yb.c)(bc)}SQg(){this.iW.argumentAssistanceFlight="T";this.iW.autoCompleteUIFlight=this.PGf("Microsoft.Office.Excel.","AutoCompleteNewUI");this.iW.smartFormulaBarAutoCompletePluginFlight=
"T";this.iW.formulaAssistanceRedesignFlight="T";this.iW.coloredReferencesFlight="T";this.iW.parenthesesCouplingFlight="T";this.iW.formulaAssistanceUiPositionFlight="T";this.iW.smartFormulaSuggestionsFeatureEnabled=wd.a.oob(this.$);this.iW.argumentAssistanceUxFlight="T";this.iW.uILocale=this.$.fda;this.iW.dataLocale=this.$.dataCultureTag;this.iW.country=JSON.parse(this.$.ua.SessionStartInfoJson).LocationCountry}pWi(){const Ga=new De.a;for(const Qb of this.Etb)Qb.value.Jzf(),Ga.add(`"${Qb.key}":${fg.a.Ci(Qb.value.v7)}`);
return`"PerfMeasurements": {${Ga.toArray().join(",")}}`}PGf(Ga,Qb){return Hc.a.contains(this.$.ua.FlightHolder.FlightId,Qb,!0)?ac.EwaSettings.getBooleanFeatureGate(Ga+Qb,!1)?"T":"C":"None"}NX(Ga,Qb){return`"${Ga.toString()}":${xg.c(Qb)}`}Z8g(Ga){this.wJb[Ga]||(this.wJb[Ga]={shownCounter:0,committedCounter:0});this.eYa[Ga]||(this.eYa[Ga]={shownCounter:0,committedCounter:0})}}Object(la.a)(dg,"FormulaAssistanceTelemetryManager",null,[748]);class Gg extends O.a{constructor(Ga){super();this.$=Ga;this.gm()}static Ba(Ga){Ga.la.Hh(492,
new Gg(Ga))}create(){void db.a.resolve(gb.Hd).then(Ga=>{var Qb;this.Bk(null!==(Qb=this.$.la.kh(491))&&void 0!==Qb?Qb:this.$.la.Hh(491,new dg(this.$,Ga)))})}}Object(la.a)(Gg,"FormulaAssistanceTelemetryManagerFactory",O.a,[]);var Hg=a(914),Mg=a(39),Ff=a(1411);class yf extends jd.a{constructor(Ga){super(Ga,yf.featureName);this.efj=ac.EwaSettings.isChangeGateEnabled("OfficeVSO:8582031_FormulaByExampleAsYouType")}static init(Ga){yf.Va?Ca.ULS.sendTraceTag(509122372,1,15,"FormulaSuggestionUIControl.init: unexpected call after already being inited."):
yf.Va=new yf(Ga)}static instance(){return yf.Va}get hl(){return Xd.a.PId}show(Ga,Qb,wc,S,eb,ec,Lc,Ad){ec=void 0===ec?null:ec;return this.Qxb(void 0===Lc?null:Lc,pd=>{appChrome.renderFormulaSuggestionCard(Ga,Qb,this.domElement,pd.y,pd.x,pd.y+pd.height,pd.x+pd.width,wc,S,eb,ec,this.bxb,Ad?{explanationKey:Ad.explanationKey,replacements:Ad.explanationReplacements,notifyExplanationSuccessful:Ad.G9d}:void 0)})}Bte(Ga,Qb,wc,S,eb,ec,Lc,Ad,pd,de,Ge){return this.Qxb(Ge,Re=>{appChrome.renderRowNumberingSuggestionCard(Ga,
Qb,this.domElement,Re.y,Re.x,Re.y+Re.height,Re.x+Re.width,wc,S,eb,ec,Lc,Ad,pd,de,this.bxb)})}QZ(Ga,Qb,wc){ac.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FBECurtainLifterCalloutForTestingOnlyEnabled",!1)&&(this.T4&&Ga.equals(this.z1d)||(this.T4&&document.body.removeChild(this.T4),this.z1d=Ga,Ga=this.grid.zh(Ga),Ga=this.grid.getCellBounds(Ga.cell,!0),this.T4=document.createElement("div"),this.T4.setAttribute("style",`position:fixed;
        left: ${Ga.x+Ga.width}px;
        top: ${Ga.y+Ga.height/2}px`),document.body.appendChild(this.T4)),Ga=new $c.a(-847286761,0,this.$.hi,0,null),this.$.Ma.qh(Ga,{["CalloutName"]:15,["Target"]:this.T4,["NewState"]:Qb,["Reason"]:wc}))}}Object(la.a)(yf,"FormulaByExampleCardUIControl",jd.a,[744]);class mg extends Hg.a{constructor(Ga){super(Ga)}Kt(){Ca.ULS.sendTraceTag(528758224,0,50,"FormulaByExampleCommandHandlerFactory.CreateCommandHandlersAsync: FormulaByExampleCommandHandler init flow started.");const Ga=Cf.GetServiceTaskFactory.Tj(this.$.la,
453,454,1),Qb=Object(jf.d)(db.a.resolve(gb.Nc,{va:this.xh})),wc=Object(jf.d)(db.a.resolve(gb.Oc,{va:this.xh}));Mg.TaskExtensions.Xa(Mg.TaskExtensions.Vo([Ga,Qb,wc],this.ya),()=>{const S=new Ff.a(Qb.result,Ga.result,yf.instance(),wc.result);this.Qr([S]);Ca.ULS.sendTraceTag(537161924,0,50,"FormulaByExampleCommandHandlerFactory.CreateCommandHandlersAsync: FormulaByExampleCommandHandler initialized successfully")},this.ya)}static Ba(Ga){Hg.a.qy(455,new mg(Ga))}}Object(la.a)(mg,"FormulaByExampleCommandHandlerFactory",
Hg.a,[]);var jh=a(107),bg=a(1044);class Og{constructor(Ga,Qb,wc,S,eb){this.kind=Ga;this.value=Qb;this.formatted=wc;this.numFmt=S;this.cellStyle=eb}get displayText(){var Ga;return null!==(Ga=this.formatted)&&void 0!==Ga?Ga:this.value}}Object(la.a)(Og,"CloneEvaluatedEdit",null,[]);class rg{constructor(Ga,Qb,wc){this.status=Ga;this.lPb=void 0===Qb?null:Qb;this.dub=wc}}Object(la.a)(rg,"FormulaByExampleFormulaEvalResult",null,[]);var Ma=a(1069),Na;(function(Ga){Ga[Ga.none=0]="none";Ga[Ga.number=1]="number";
Ga[Ga.string=2]="string";Ga[Ga.boolean=3]="boolean";Ga[Ga.error=4]="error"})(Na||(Na={}));Object(la.b)("CellValueType",Na);var Qc;(function(Ga){Ga[Ga.none=0]="none";Ga[Ga.number=1]="number";Ga[Ga.string=2]="string";Ga[Ga.boolean=4]="boolean";Ga[Ga.error=8]="error";Ga[Ga.range=16]="range";Ga[Ga.array=32]="array";Ga[Ga.missing=64]="missing";Ga[Ga.blank=128]="blank";Ga[Ga.rich=256]="rich"})(Qc||(Qc={}));Object(la.b)("OperKind",Qc);var ce;(function(Ga){Ga[Ga.NoMismatch=0]="NoMismatch";Ga[Ga.Mismatch=
1]="Mismatch";Ga[Ga.HashesValueMismatch=2]="HashesValueMismatch"})(ce||(ce={}));Object(la.b)("EcsMismatchResult",ce);class ve extends Set{constructor(Ga){super();this.Iba=Ga}add(Ga){if(this.has(Ga))return this;if(this.size>=this.Iba){const Qb=this.entries().next().value[0];this.delete(Qb)}return super.add(Ga)}has(Ga){const Qb=super.has(Ga);return Qb?(this.delete(Ga),super.add(Ga),!0):Qb}}Object(la.a)(ve,"LimitedSizeSet",Set,[]);class Ve{constructor(Ga,Qb){this.Jh=null;this.RSg=this.QZf=this.sL=!1;
this.F1d=null;this.Lee=(wc,S,eb)=>{if(!this.CHc(wc))return Object(bg.h)(S,"Result object from EvalOnClone API is empty or null.",this.ap,8),new rg(2);const ec=this.xcl(wc,S);if(!eb&&"OnlyPreviousFailureFound"===ec.reason)return new rg(4);if(!ec.success)return Object(bg.h)(S,`Evaluated results from calc do not match the user data in the grid or had errors from calc. reason: ${ec.reason}`,this.ap,8),Ca.ULS.sendTraceTag(537161880,0,50,"FormulaByExampleModelUpdater:EvalFormulaRangeOnClone:Formula results from Calc.ts do not match grid data."),
new rg(2);this.ap.Zv(S.flowId,11);Ca.ULS.sendTraceTag(537161879,0,50,"FormulaByExampleModelUpdater:EvalFormulaRangeOnClone: EvalFormulaRange CSE: Result received from calc.");return new rg(0,wc.results,ec.dub)};this.Jh=Ga;this.sL=Qb;this.ap=Ma.a.getInstance(this.Jh);this.QZf=ac.EwaSettings.isChangeGateEnabled("OfficeVSO:6327953_FormatOutputResultsOfFBE_V2");this.RSg=ac.EwaSettings.isChangeGateEnabled("OfficeVSO:7549840_DontShowFBESuggestionsWithErrorInTriggerCell")}ake(Ga){this.F1d&&this.c6g(this.F1d,
!0,void 0,void 0,Ga)}iEk(Ga,Qb,wc,S,eb){wc=void 0===wc?null:wc;S=void 0===S?!1:S;Qb=Ga.range.Ik(Qb);return Qb?this.Luf(Ga,Qb,wc).then(ec=>{this.sL&&!S&&Ga.flowId&&Object(bg.f)("CALCULATIONED",Ga.flowId,eb);if(2===ec.status)return ec;Ca.ULS.sendTraceTag(537161881,0,50,"FormulaByExampleModelUpdater:setFormulaPreviewOnRangeModel: evalFormulaRangeOnClone CSE: Result received from calc.");this.F1d=ec;return this.c6g(ec,S,Ga.flowId,eb)}).catch(ec=>{Object(bg.h)(Ga,`failed to setFormulaPreviewOnRangeModel, error in calc API: ${ec.toString()}`,
this.ap,8);return Promise.reject(`FormulaByExampleModelUpdater:setFormulaPreviewOnRangeModel: Unable to EvalFormulaRange, e: ${ec.toString()}`)}):(Object(bg.h)(Ga,"Annotation range does not intersect loaded range",this.ap,6),Promise.reject("FormulaByExampleModelUpdater:setFormulaPreviewOnRangeModel: Annotation range does not intersect loaded range."))}Luf(Ga,Qb,wc){wc=void 0===wc?null:wc;const S=this;return Lo(function*(){let eb,ec;const Lc=Ve.wzi(wc);S.ap.Zv(Ga.flowId,7);try{return ac.EwaSettings.isChangeGateEnabled("OfficeVSO:7974673_FBECircularReferenceFixCalcMitigation")?
(eb=yield S.Jh.q5(null,Qb,Ga.originCell,Ga.formula,!0),ec=S.Lee(eb,Ga,!1),4===ec.status&&(Ca.ULS.sendTraceTag(508683744,0,50,`FormulaByExampleModelUpdater:EvalFormulaRangeOnClone: previous failure found, with no other errors, retry with cloneWrites. flow id: ${Ga.flowId}`),eb=yield S.Jh.q5(Lc,Qb,Ga.originCell,Ga.formula,!0),ec=S.Lee(eb,Ga,!0))):(eb=yield S.Jh.q5(Lc,Qb,Ga.originCell,Ga.formula,!0),ec=S.Lee(eb,Ga,!0)),ec}catch(Ad){return Object(bg.h)(Ga,`failed to EvalFormulaRangeOnClone, error in calc API: ${Ad.toString()}`,
S.ap,8),Promise.reject(`FormulaByExampleModelUpdater:EvalFormulaOnRange: Unable to EvalFormulaRange, e: ${Ad.toString()}`)}})}o8e(Ga,Qb,wc){var S;if(Ga){var eb=[];for(const Ad of Ga){if(!tb.a.fHc(Ad))continue;var ec=Ad;Ga=J(ec.value.cell);var Lc=this.Jh.zh(Ga);if(!Lc)continue;ec=this.uLd(ec);Lc=Lc.cell;const pd=Lc.KV;(null===(S=ec.cellStyle)||void 0===S?0:S.HorizontalAlignment)&&Lc.PZ(ec.cellStyle.HorizontalAlignment,!0,!0);pd||Ca.ULS.sendTraceTag(508179167,0,50,`FormulaByExampleModelUpdater:applyFormulaCSE: cell CSE failed for flow ${wc}`);
Lc.text=pd;Lc.formulaBarText=Qb;eb.push({text:pd,value:ec.value,kind:ec.kind,range:Ga})}W(this.Jh,eb,wc)}}static wzi(Ga){const Qb=wc=>({row:wc.cell.xH,column:wc.cell.IK,Ln:wc.Ln,formulaBarText:wc.Ln.value,text:wc.cell.text,qo:wc.cell.qo});return Ga?Ga.map(Qb):null}CHc(Ga){return(Ga=Ga.results)&&Ga.length?!0:!1}c6g(Ga,Qb,wc,S,eb){var ec=Ga.lPb;for(const Lc of ec){if(!tb.a.fHc(Lc)){"Unavailable"!==Lc.reason.kind&&(Ga.status|=2);continue}ec=Lc.value.cell;if(!ec){Ga.status|=2;continue}ec=J(ec);if(eb&&
!ec.Xi(eb))continue;ec=this.Jh.zh(ec);if(!ec){Ga.status|=2;continue}const Ad=ec.cell,pd=this.uLd(Lc);Ad.KV=pd.displayText;Ad.y3b=pd.numFmt;Ad.w3b=pd.cellStyle;ac.EwaSettings.isChangeGateEnabled("OfficeVSO:8618122_NLNPreviewChange")&&(Ad.aJg=L(ec,Lc));Ga.status|=1}this.sL&&!Qb&&wc&&Object(bg.f)("MODELUPDATED",wc,S);return Ga}xcl(Ga,Qb){let wc=null,S=!1,eb=!1,ec=!1,Lc=!1,Ad=!1,pd=!1,de=!1,Ge=!1,Re=!1;Ga=Ga.results;const kf=new ve(5);var Xf=Ga.entries();for(const kg of Xf){Xf=kg[0];const Yf=this.ycl(kg[1],
Qb);Yf.Bpb&&(S=Yf.VNb);Yf.y_d&&(eb=!0,ec||(ec=Yf.isInViewport),Ad||(Ad=Yf.isInViewport&&!Yf.HWb));Lc||(Lc=Yf.HWb);pd||(pd=Yf.WQf);wc=null!==wc&&void 0!==wc?wc:Yf.ZWa;de||(de=Yf.F1f);Ge||(Ge=Yf.T0f);Yf.VNb&&(Yf.X6e||Yf.W6e)&&kf.add(`grid: ${Yf.X6e}, clone: ${Yf.W6e}`);(Yf.y_d||Yf.HWb)&&Ga.splice(Xf,1);Re||Yf.Lbg||(Re=!0)}S?this.ap.Zv(Qb.flowId,10):this.ap.Zv(Qb.flowId,9);return wc?{success:!1,reason:wc}:de?{success:!1,reason:"OnlyPreviousFailureFound"}:{success:!0,dub:{["hasUnavailableCells"]:eb,["hasUnexpectedUnavailableCellsInViewport"]:Ad,
["hasHiddenRows"]:Lc,["hasUnavailableCellsInViewport"]:ec,["hasErrorCells"]:pd,["hasNumFmtInSuggestion"]:Ge,["formattedResultsGridComparisons"]:[...kf],["renderedPreviewIsDirty"]:Re}}}ycl(Ga,Qb){var wc;const S={Bpb:!1,y_d:!1,isInViewport:!1,HWb:!1,F1f:!1,ZWa:null,WQf:!1,VNb:!1,T0f:!1,Lbg:!1};if(!tb.a.fHc(Ga)){Ga=Ga.reason;var eb=xc.Range.vi(Ga.cell.row+1,Ga.cell.col+1);S.Bpb=eb.equals(Qb.originCell);this.xzf(S,eb);if("Unavailable"===Ga.kind)return S.y_d=!0,S;if("PreviousFailure"===Ga.kind)return S.F1f=
!0,S;S.ZWa=JSON.stringify({kind:Ga.kind,innerKind:Ga.innerKind});S.ZWa=null!==(wc=S.ZWa)&&void 0!==wc?wc:"failure in calc";return S}var ec=J(Ga.value.cell);S.Bpb=ec.equals(Qb.originCell);this.xzf(S,ec);wc=this.Jh.zh(ec);if(!wc){if(S.isInViewport&&!S.HWb)return S.ZWa="formatted grid cell is null",S;Ca.ULS.sendTraceTag(509682371,0,50,"FormulaByExampleModelUpdater:validateCalcResultMatchesCellData: did not fail suggestion when a formatted grid cell is null as this cell is hidden or not in view.");return S}eb=
this.uLd(Ga,this.QZf?wc:null);if(8===eb.kind)return S.WQf=!0,this.RSg&&S.Bpb&&(S.ZWa=`suggestion has error of kind ${eb.value} in cell.`),S;const Lc=wc.text;if(!Lc)return S.VNb=!0,S;const Ad=eb.displayText;S.VNb=L(wc,Ga);S.W6e=Hc.a.L_(Ad);S.X6e=Hc.a.L_(Lc);S.Lbg=wc.cell.y3b?wc.cell.y3b===Ga.value.value.numFmt:wc.cell.KV===Ga.value.value.formattedText;S.VNb||(ec=Qb.hZf(ec)?S.Bpb?"MODIFIEDEXAMPLE":"EXAMPLE":S.Bpb?"MODIFIEDRESTOFRANGE":"RESTOFRANGE",Object(bg.g)(S.T0f?"numFmtMismatch":"textMismatch",
Lc,Ad.toString(),wc.cell.qo,"evalFormulaOnCloneToShowPreview",Qb,ec,L(wc,Ga),wc.cell.numFmt,eb.numFmt),S.ZWa="data strings do not match");return S}xzf(Ga,Qb){Ga.isInViewport=this.Jh.bG(Qb);Ga.HWb=this.Jh.kj.Coa(Qb)}uLd(Ga,Qb){const wc=Ga.value.value,S=vf(Ga).toString();if(Qb&&!wc.formattedText&&""!==wc.formattedText){Ga=Ga.value.formatted;var eb=Kf(wc.kind);Ga=this.Jh.gaa(Ga,eb,Ae.a,Qb);Object(Zd.c)(Ga)&&(wc.formattedText=Ga.value.text,wc.numFmt=Ga.value.numFmt,eb=new Ze.a,eb.HorizontalAlignment=
0===Qb.cell.horizontalAlignment?Ga.value.horizontalAlignment:null,wc.cellStyle=eb)}return new Og(wc.kind,S,wc.formattedText,wc.numFmt,wc.cellStyle)}}Object(la.a)(Ve,"FormulaByExampleModelUpdater",null,[]);const vf=Ga=>{Ga=Ga.value.value;return 1===Ga.kind?Ga._valueXL:8===Ga.kind?sa.a.hPb[Ga.type-1]:Ga.value},Kf=Ga=>{switch(Ga){case 1:return 1;case 2:return 2;case 8:return 4;case 4:return 3;default:return 0}};var ng=a(1246),Bf=a(1245);class Uf extends Bf.a{constructor(Ga,Qb,wc,S){super(Ga,Qb,wc,S);
this.kind="Table"}get table(){void 0===this.Hdb&&(this.Hdb=this.Jh.Kl(this.originCell,!1));return this.Hdb}set table(Ga){this.Hdb=Ga}get zx(){return this.table?tb.a.Lga(this.table):null}}Object(la.a)(Uf,"FormulaByExampleTableSuggestion",Bf.a,[788]);var Qf=a(1106),ug=a(1178),ag=a(1107),Dg=a(1248),Tg=a(1208),ig=a(1384);class Yg{constructor(Ga){this.IOf=!1;this.Jh=Ga}xwh(Ga){"ACCEPT"===Ga?this.Jh.si(-458824895,-1,0,null):"DECLINE"===Ga?this.Jh.si(-1726708382,-1,0,null):"IGNORE"===Ga&&(this.IOf?this.Jh.si(-1227021552,
-1,0,null):this.IOf=!0)}}Object(la.a)(Yg,"FormulaByExampleSurveyManager",null,[]);const vh=[Object(Ta.d)("featureNameField","FormulaByExample"),Object(Ta.d)("ver","1.0.0")],Zg={eventName:"Office.Excel.FormulaByExample.Seen",eventFlags:yb.a,dataFields:[...vh,Object(Ta.a)("isFeatureSeen",!0)]},Qg={eventName:"Office.Excel.FormulaByExample.Tried",eventFlags:yb.a,dataFields:[...vh,Object(Ta.a)("isFeatureTried",!0)]},Wg={eventName:"Office.Excel.FormulaByExample.Succeeded",eventFlags:yb.a,dataFields:[...vh,
Object(Ta.a)("isFeatureSucceeded",!0)]};var dh=a(143),gh=a(129);class Gh extends Sys.EventArgs{constructor(Ga){super();this.suggestion=Ga}}Object(la.a)(Gh,"FormulaByExampleAnnotationArrivedEventArgs",Sys.EventArgs,[]);class Ch{constructor(Ga,Qb,wc){this.formulaByExampleManager=Ga;this.nra=Qb;this.ap=wc;this.QDf=S=>"Table"===S.kind?this.ap.Nzc(S.table.name,S.column):this.ap.YQb(S.zx,S.column,S.sheetId);this.Q9d=(S,eb)=>{S=eb.suggestion;eb=this.QDf(S);this.BLb.has(eb)&&this.BLb.get(eb).Q9d(M(S))};this.JSj=
(S,eb)=>{S=eb.suggestion;eb=this.QDf(S);let ec;this.BLb.has(eb)?(ec=this.BLb.get(eb),ec.P1g(M(S),S.anonymizedFormula,S.flowId)):(ec=new Dh(eb,S),this.BLb.set(eb,ec))};this.BLb=new Map;this.formulaByExampleManager.rBh(this.Q9d);this.nra.sBh(this.JSj)}}Object(la.a)(Ch,"FormulaByExamplePostSuggestionSpiesManager",null,[]);class Dh{constructor(Ga,Qb){this.Wqd=Ga;this.rLc=null;this.Vge=new Map;this.P1g(M(Qb),Qb.anonymizedFormula,Qb.flowId)}P1g(Ga,Qb,wc){this.VZf(Ga)||(this.Vge.set(Ga,new Xg(Ga,Qb,wc,!0)),
this.rLc=Ga)}Q9d(Ga){if(this.rLc){var Qb=this.UKf(this.rLc);Qb?(Ga!==this.rLc&&(Qb.tpc=!0,this.Y8f(Qb)),this.VZf(Ga)&&(Ga=this.UKf(Ga),Ga.r$i(),Ga.tpc&&(Ga.Sle=!0),this.Y8f(Ga))):Ca.ULS.sendTraceTag(508687501,306,50,`FormulaByExampleColumnSpy.onFormulaAnnotationForColumn: failed to get latest rejected formula records for column ${this.Wqd}`)}else Ca.ULS.sendTraceTag(508687502,306,15,`FormulaByExampleColumnSpy.onFormulaAnnotationForColumn: unexpected state - latest rejected formula is null for column ${this.Wqd}`)}UKf(Ga){return this.Vge.get(Ga)}VZf(Ga){return this.Vge.has(Ga)}Y8f(Ga){Ca.ULS.sendTraceTag(137687059,
306,20,`FormulaByExampleColumnSpy.logRejectedFormulaRecords: ${JSON.stringify({["anonymousColumnId"]:this.Wqd,["suggestionFlowId"]:Ga.QWk,["formulaAnonymized"]:Ga.mna,["inPatternEditsPostSuggestion"]:Ga.b$i,["brokePattern"]:Ga.tpc,["resumedPattern"]:Ga.Sle,["latestEditInPattern"]:Ga.qLc})}`)}}Object(la.a)(Dh,"ColumnSpy",null,[]);class Xg{constructor(Ga,Qb,wc,S){this.qEa=Ga;this.Dfc=Qb;this.Sth=wc;this.SNe=0;this.bjd=this.D8c=!1;this.kRe=S}get formula(){return this.qEa}get mna(){return this.Dfc}get QWk(){return this.Sth}get b$i(){return this.SNe}r$i(){this.SNe++}get tpc(){return this.D8c}set tpc(Ga){if(this.D8c=
Ga)this.qLc=!1}get Sle(){return this.bjd}set Sle(Ga){if(this.bjd=Ga)this.qLc=!0}get qLc(){return this.kRe}set qLc(Ga){this.kRe=Ga}}Object(la.a)(Xg,"ColumnSpyFormulaRecords",null,[]);class og extends af.a{constructor(Ga,Qb,wc){super();this.zWg=wc;this.AP=this.rH=this.nra=this.ZMa=this.Jh=null;this.G2a=this.sL=!1;this.XE=null;this.V8b=!1;this.kQb=null;this.UTg=!1;this.pcg=2E3;this.$Bf=null;this.d8g=0;this.Xrd=!1;this.nFc=[];this.Kw=null;this.UEj=1E4;this.kPj=S=>{Ca.ULS.sendTraceTag(520987789,306,50,
`FormulaByExampleManager.onCloseCallback: closeReason = ${Tg.a[S]}`)};this.Ozi=(S,eb)=>{var ec,Lc,Ad,pd,de,Ge;Ca.ULS.sendTraceTag(528758222,306,50,"FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation received.");(S=eb.annotation)?(eb=parseInt(S.guid,10),0>eb||ac.EwaSettings.isChangeGateEnabled("OfficeVSO:7417755_FormulaByExampleVerifyDuplicatedAnnotation")&&!this.ap.GZf(eb)||(Ca.ULS.sendTraceTag(526984792,306,50,`FormulaByExampleManager.formulaByExampleAnnotationHandler: received annotation's flowId: ${eb}, containsRowPlaceholder: ${null===
(Lc=null===(ec=S.generatedFormula)||void 0===ec?void 0:ec.formula)||void 0===Lc?void 0:Lc.includes(Qf.b)}`),this.ap.Zv(eb,14),ec=this.e7j(eb),Lc=this.Jh,Lc=ec.jV?new Uf(Lc,S,eb,ec):new Qf.a(Lc,S,eb,ec),this.Kw&&(this.Kw.Jja(eb,4,{formula:null===(Ad=S.generatedFormula)||void 0===Ad?void 0:Ad.formula,mna:null===(pd=S.generatedFormula)||void 0===pd?void 0:pd.anonymizedFormula}),this.Kw.zjb(eb)),this.raiseEvent("fbeaa",new Gh(Lc)),Object(ig.b)(Lc)||this.Jh.R1a()?(this.sL&&!this.G2a&&Object(bg.f)("ANNOTATIONRECEIVED",
Lc.flowId),null!=Lc.errorMessage?(Ca.ULS.sendTraceTag(527005666,306,10,`FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation arrived with error message: ${Lc.errorMessage}, flowId: ${Lc.flowId}`),this.ap.Zv(Lc.flowId,15,{reason:"Annotation arrived with error message"})):Lc.formula?(null===(Ge=this.zWg)||void 0===Ge?void 0:Ge.HSj(Lc.flowId),Ca.ULS.sendTraceTag(509679808,306,20,`FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation with a formula suggestion arrived. flowId: ${Lc.flowId} isTableSuggestion: ${Object(ig.b)(Lc)}}`),
this.ap.Zv(Lc.flowId,16,{YNc:Lc.formula}),this.AP=Lc,(Ad=this.nra.Yea(Lc))?this.UTg||1!==Lc.invocationMethod?Lc.vE<ag.a?Ca.ULS.sendTraceTag(528758220,306,50,"FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation does not have enough examples to prompt a suggestion."):(Ca.ULS.sendTraceTag(527005665,306,50,`FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation with formula suggestion arrived. trying to suggest/apply it. flowID: ${Lc.flowId}`),0===Lc.invocationMethod?
this.hEk(Ad):(pd=Object(bg.c)(Lc.flowId),pd>this.pcg?(Ca.ULS.sendTraceTag(509636688,306,50,`FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation arrived after the maximal wait time for suggestions. flowId: ${Lc.flowId}, duration: ${pd}`),this.ap.Zv(Lc.flowId,6,{reason:"annotation arrived after the maximal wait time for suggestions"})):(pd=this.STg(Ad,ec),pd.value?this.O2g(Ad,!1,`${(null===ec||void 0===ec?0:ec.ZZ)?tb.a.NKd(ec.ZZ):"UnknownCommand"} - UponAnnotationReceived`,ec):(Ca.ULS.sendTraceTag(509636687,
306,50,`FormulaByExampleManager.formulaByExampleAnnotationHandler: shouldShowPreview returned false for suggestion with flowId: ${Lc.flowId}, reason: ${pd.reason}`),this.ap.Zv(Lc.flowId,6,{reason:pd.reason}))))):Ca.ULS.sendTraceTag(523850754,306,50,"FormulaByExampleManager.formulaByExampleAnnotationHandler: session supports suggestions from cache only. returning early after caching suggestion."):Ca.ULS.sendTraceTag(509678998,306,15,`FormulaByExampleManager.formulaByExampleAnnotationHandler: failed to cache suggestion for flowId: ${Lc.flowId}.`)):
(Ca.ULS.sendTraceTag(528758221,306,50,`FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation does not have any formula suggestions. deleting existing entry, if any. flowId: ${Lc.flowId}`),this.nra.Iib(Lc),this.rH.QZ(Lc.originCell,2),this.ap.Zv(Lc.flowId,15),null===(de=this.zWg)||void 0===de?void 0:de.ISj(Lc.flowId))):Ca.ULS.sendTraceTag(509204251,306,10,"FormulaByExampleManager.formulaByExampleAnnotationHandler: range table suggestions should not be created in this session."))):Ca.ULS.sendTraceTag(537161922,
306,15,"FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation is null.")};this.LXc=()=>{Ca.ULS.sendTraceTag(537161889,306,50,"FormulaByExampleManager.SendByExampleFeedback: opening send feedback dialog after click on card.");const S={};S[wa.a.cP]="FormulaByExampleCard";this.Jh.si(802602464,0,8,S)};this.Q1b=S=>{this.V8b=!0;Ca.ULS.sendTraceTag(537161888,306,50,`FormulaByExampleManager.OnShowFormula: user clicked ShowFormula button in the card for flow ${S}`)};this.hTb=S=>{Ca.ULS.sendTraceTag(528758219,
306,50,"FormulaByExampleManager.HandleNewBlocksDuringPreview: new block arrived during preview mode.");const eb=S.mj.block,ec=this.AP.zx,Lc=this.AP.range.Ik(eb.yj);this.ZMa.ake(Lc);const Ad=(new xc.Range(ec.top,ec.left,ec.bottom,ec.right,!0,!0)).Ik(eb.yj),pd=Array.from(this.Jh.yga(Ad,eb));Ca.ULS.sendTraceTag(537161886,306,50,`FormulaByExampleManager.HandleNewBlocksDuringPreview: putting skeleton for preview cells in new block ${S.mj.hash}.`);this.nFc.includes(S.mj.hash)||this.xAe(Lc,!0);const de=
()=>{this.Muf(this.AP,Ad,pd).then(Ge=>{Ca.ULS.sendTraceTag(537161885,306,50,`FormulaByExampleManager.HandleNewBlocksDuringPreview: putting calculated data into model and demanding re-render for block ${S.mj.hash}.`);this.nFc.includes(S.mj.hash)||this.xAe(Lc,!1);Ge.dub.renderedPreviewIsDirty&&this.Jh.m_b(S.mj.block);Ca.ULS.sendTraceTag(512508567,306,50,`FormulaByExampleManager.handleNewBlocksDuringPreview: new FormulaByExample suggestion block rendered during preview. results: ${JSON.stringify({["flowId"]:this.AP.flowId,
["originalFlowId"]:this.AP.lZ.flowId,["formulaAnonymized"]:this.AP.anonymizedFormula,["originalFormulaAnonymized"]:this.AP.lZ.anonymizedFormula,["annotationRange"]:this.AP.range.toString(),["previewCellsMetadata"]:Ge.dub})}`);return!0}).catch(Ge=>{Object(bg.h)(this.AP,`Exception when rendering new block during preview. ${Ge}`);Ca.ULS.sendTraceTag(537161884,306,50,`FormulaByExampleManager.HandleNewBlocksDuringPreview: caught exception: ${Ge}.`)})};if(ac.EwaSettings.isChangeGateEnabled("OfficeVSO:8198794_FBEPreviewAwaitsDataFlushToCalc")){const Ge=
()=>{this.Jh.Kie(Ge);de()};this.Jh.Dmc(Ge)}else de()};this.kEg=()=>{this.Jh.uu(this.U4a);this.U4a=null};this.gia=(S,eb)=>{0!=eb.tx||ac.EwaSettings.isChangeGateEnabled("OfficeVSO:8190374_FixDDARequestCloseFBE")&&576===eb.Ul.operation.operationName||(this.G2a&&this.XE.Naa(`UserOperation: ${tb.a.rfh(eb.Ul.operation.operationName)}`),this.Jh.uu(this.gia))};this.m$d=S=>{const eb=S.suggestion.flowId;Ca.ULS.sendTraceTag(528023709,306,20,`FormulaByExampleManager.onImmediateUndo: undo operation queued following a formula by example suggestion application. flowId=${eb} originalFlowId=${S.suggestion.lZ.flowId} isTableSuggestion=${Object(ig.b)(S.suggestion)}`);
this.nra.$Qg(S,"UNDO");this.Kw&&ac.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExamplePluginCacheEnabled",!1)&&void this.Jh.pluginScheduler.eventEmitter().FBEOutcomeUpdate({flowId:eb,suggestionOutcome:{outcome:"UNDO"}})};this.UTg=ac.EwaSettings.isChangeGateEnabled("OfficeVSO:6169955_ShowFormulaByExampleSuggestionsUponArrivalFromServer");this.pcg=ac.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleMaximalWaitingTimeForSuggestionsMs",2E3);this.Xrd=ac.EwaSettings.isChangeGateEnabled("OfficeVSO:8582031_FormulaByExampleAsYouType");
this.Jh=Ga;this.kQb=new Map;this.rH=Qb;this.ap=Ma.a.getInstance(this.Jh);this.bee=!1;Ga.Q1a()?this.init():Ca.ULS.sendTraceTag(537161923,306,10,"FormulaByExampleManager.Ctor: not expected to be constructed when FG is off.")}c1j(Ga,Qb){const wc=Qb.gRc;this.kQb.set(Ga,Qb);this.bee=!1;const S=this.nra.RZi(Qb,Ga);if(S){this.Kw&&ac.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExamplePluginCacheEnabled",!1)&&(this.Kw.Jja(Ga,3,{formula:S.suggestion.formula,mna:S.suggestion.anonymizedFormula,
Taa:!0,hT:S.hT,Uoa:S.state}),this.Kw.zjb(Ga));this.ap.Zv(Ga,4);S.suggestion.flowId=Ga;S.suggestion.originCell=wc;var eb=this.STg(S,Qb);eb.value?(Ca.ULS.sendTraceTag(529109774,306,50,"FormulaByExampleManager.onUserInput: A cached formula suggestion found for current input."),this.O2g(S,!0,`${Qb.ZZ?tb.a.NKd(Qb.ZZ):"UnknownCommand"} - FromCache`,Qb)):(this.ap.Zv(Ga,6,{reason:eb.reason}),this.pdl(Ga,S.suggestion,wc))}else this.ap.Zv(Ga,5),this.Kw&&ac.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExamplePluginCacheEnabled",
!1)&&this.Kw.Jja(Ga,2,{Taa:!1,Uoa:ug.b.unseen,hT:0})}rBh(Ga){this.addHandler("fbeaa",Ga)}pdl(Ga,Qb,wc){ac.EwaSettings.isChangeGateEnabled("OfficeVSO:7041480_FormulaByExampleFlowAggregatorFixed")&&this.Jh.evalFormula(Qb.formula,wc,tb.a.S0(this.Jh.ma),excelOnlineCalc.calc.evalFormulaFormatOrigin()).then(S=>{var eb=this.Jh.zh(wc);const ec=eb.text;eb=eb.cell.qo;S=S.value.value.toString();Hc.a.equals(ec,S,!1)?this.ap.Zv(Ga,10):(Object(bg.g)("textMismatch",ec,S,eb,"evalFormulaToVeriySuggestionWithoutShowingPreview",
Qb,Qb.hZf(wc)?"MODIFIEDEXAMPLE":"MODIFIEDRESTOFRANGE",null),this.ap.Zv(Ga,9))}).catch(S=>{S=`Failed to evalFormula, error in calc API: ${S.toString()}`;Ca.ULS.sendTraceTag(512341207,306,50,`FormulaByExampleMangaer.verifySuggestionOnEditedCell: ${S}`);this.ap.Zv(Ga,9,{reason:S})})}dispose(){this.Jh.uu(this.gia);this.kEg();this.Jh.s5k();super.dispose()}init(){const {FormulaByExampleAutoSuggestActor:Ga}=a(1446);this.Jh.Gbh(this.kPj,{annotationType:ng.a.getTypeName(),Ny:!1,BV:this.Ozi});this.sL=Object(bg.a)(this.Jh);
new Ga(this.Jh,this.sL);this.nra=new ig.a(this.Jh,this.rH,this.ap);this.ZMa=new Ve(this.Jh,this.sL);this.$Bf=new Yg(this.Jh);ac.EwaSettings.isChangeGateEnabled("OfficeVSO:7959804_FormulaByExampleSpies")&&new Ch(this,this.nra,this.ap);this.Kw=this.Jh.Kw;Ca.ULS.sendTraceTag(528758223,306,50,"FormulaByExampleManager.init: init complete.")}e7j(Ga){if(!this.kQb.has(Ga))return null;const Qb=this.kQb.get(Ga);this.kQb.delete(Ga);return Qb}hEk(Ga){const Qb=Ga.suggestion;this.ZMa.Luf(Qb,Qb.range,null).then(wc=>
{this.qrd(Ga,1===wc.status?wc.lPb:null,!1);return null}).catch(()=>{Ca.ULS.sendTraceTag(537161921,306,50,"FormulaByExampleManager.setFormulaOnRangeExplicit: client estimation failed for explicit by example flow.");this.qrd(Ga,null,!1)})}O2g(Ga,Qb,wc,S){Ca.ULS.sendTraceTag(527713160,306,20,`FormulaByExampleManager.tryDisplayFormulaSuggestionPreview: starting flow to show a formula suggestion. isFromCache: ${Qb} isTableSuggestion: ${Object(ig.b)(Ga.suggestion)} flowId: ${Ga.suggestion.flowId})}`);const eb=
Ga.suggestion;this.sL&&!this.G2a&&Object(bg.f)("CALCULATIONSTART",eb.flowId,Qb);const ec=this.cHf(eb.zx);var Lc=Promise.resolve();ac.EwaSettings.isChangeGateEnabled("OfficeVSO:8198743_FormulaByExampleTier1Langs")&&eb.formula&&(Lc=this.Jh.localizeEnglishFormula(eb.formula,this.Jh.sZc,eb.originCell).then(jg=>{if(Object(Zd.c)(jg))return eb.Tzi=jg.value,Promise.resolve();jg=`FormulaByExampleManager.tryDisplayFormulaSuggestionPreview: failed to print formula. error: ${JSON.stringify(jg.reason.kind)}`;
Ca.ULS.sendTraceTag(508160210,306,10,jg);return Promise.reject(jg)}));Lc=Lc.then(()=>this.Muf(eb,this.Jh.getLoadedRange(),ec,Qb));let Ad=0,pd=null,de=null,Ge=!1,Re=!1,kf=void 0,Xf=!1,kg=null,Yf=!1;const eh=Lc.then(jg=>{const Se={FirstRow:eb.range.top,FirstColumn:eb.range.left,LastRow:eb.range.bottom,LastColumn:eb.range.right};let P=void 0;if(this.Xrd&&504848446===S.ZZ){const Da=jg.lPb.find(ib=>J(ib.value.cell).equals(eb.originCell));P=vf(Da).toString()}return this.Jh.w8(eb.range,this.hTb,ac.EwaSettings.isChangeGateEnabled("OfficeVSO:8618122_NLNPreviewChange")?
{PreviewCellsRange:Se,RetainCellTextOnPreview:!0}:void 0,P?{KV:P,pte:S.pte}:void 0).then(Da=>{this.G2a=!0;this.XE=Da;this.XE.dEh((Rc,kd)=>{this.rH.hide();Ad++;1===Ad?pd=kd.reason:de=kd.reason});this.XE.cEh(()=>{const Rc=this.Utg(eb,eb.generatedFormula.explanationReplacements);this.ZMa.ake();({iVd:Yf,u7a:kg}=this.pUg(eb,Da,ib,"Success"===Rc.kind?{explanationKey:eb.generatedFormula.explanationKey,explanationReplacements:Rc.explanationReplacements,G9d:kd=>{Xf=kd}}:void 0));Yf||(this.XE.Naa("CardUI failure"),
this.sle());Ge=!0});if(this.XE.didPrime)this.ZMa.ake(),Re=!0;else if(ac.EwaSettings.isChangeGateEnabled("OfficeVSO:8560939_FormulaByExampleAsYouTypeVerifiesContentOnEndEdit")&&P){const Rc=(kd,td)=>{Ca.ULS.sendTraceTag(6370629,306,20,JSON.stringify({flowId:eb.flowId,knl:P===td.cellText,lnl:td.committed}));this.Jh.i2(Rc)};this.Jh.uX(Rc)}let ib=null;ib=ac.EwaSettings.isChangeGateEnabled("OfficeVSO:7858168_FBEHideFeedbackButton")?this.Jh.isFeedbackEnabled?this.LXc:null:this.LXc;const ic=this.Utg(eb,eb.generatedFormula.explanationReplacements);
"Failure"===ic.kind&&"FG disabled"!==ic.failureReason&&Ca.ULS.sendTraceTag(507593605,306,10,`FormulaByExampleManager.tryDisplayFormulaSuggestionPreview: failed to parse explanation replacements. error: ${ic.failureReason}, flowId: ${eb.flowId}`);({iVd:Yf,u7a:kg}=this.pUg(eb,Da,ib,"Success"===ic.kind?{explanationKey:eb.generatedFormula.explanationKey,explanationReplacements:ic.explanationReplacements,G9d:Rc=>{Xf=Rc}}:void 0));if(ac.EwaSettings.isChangeGateEnabled("OfficeVSO:8329602_AbortPreviewIfCardFailedToRender")&&
!Yf)return this.XE.Naa("CardUI failure"),this.sle(),Promise.reject("Failed to show card UI");this.Jh.mw(this.gia);this.rH.QZ(eb.originCell,0);this.sL&&tb.a.tKg(()=>{var Rc,kd;Object(bg.f)("PREVIEWRENDERED",eb.flowId,Qb);const td={["flowId"]:eb.flowId,["originalFlowId"]:eb.lZ.flowId,["displayTrigger"]:wc,["formulaAnonymized"]:eb.anonymizedFormula,["originalFormulaAnonymized"]:eb.lZ.anonymizedFormula,["annotationRange"]:eb.range.toString(),["isFullyInViewport"]:this.Jh.bG(eb.range),["isCachedSuggestion"]:Qb,
["exampleCount"]:eb.vE,["originalExampleCount"]:eb.lZ.vE,["seenCount"]:Ga.hT,["previewCellsMetadata"]:jg.dub,["previewShownDurations"]:Object(bg.e)(Qb,eb.flowId),["isSuggestionOnTable"]:Object(ig.b)(eb),["isNewRowPrediction"]:!Object(ig.b)(eb)&&eb.XWb,["sheetId"]:eb.sheetId,["areAllHeadersLoaded"]:Object(ig.b)(eb)?null===(Rc=eb.table.E8)||void 0===Rc?void 0:Rc.IsFullTableHeaders:"nonTableSuggestion",["tableRange"]:null===(kd=eb.zx)||void 0===kd?void 0:kd.toString(),["dataCulture"]:this.Jh.$.dataCultureTag,
["UICulture"]:this.Jh.$.fda};this.Jh.P1a()&&(kf=this.nWh(jg.lPb,eb.originCell));Ca.ULS.sendTraceTag(84165903,306,50,`FormulaByExampleManager.TryDisplayFormulaSuggestionPreview: Suggestion shown, awaiting user decision. flowData: ${JSON.stringify(td)}`)},this.Jh.ya);return Da.d6b})});Promise.all([Lc,eh]).then(jg=>{var [Se,P]=jg;this.bee=!0;this.k4i(Se,P,Ga,Qb,wc,{["softIgnoreCount"]:Ad,["softIgnoreReasons"]:[pd,de],["didReshow"]:Ge,["didPrime"]:Re},{Smi:kf},Xf,kg)}).catch(jg=>{Object(bg.h)(eb,`Failed to show formula preview due to a promise (model update or preview render) rejection. rejection reason: ${jg}`);
Ca.ULS.sendTraceTag(537161920,306,15,`FormulaByExampleManager.TryDisplayFormulaSuggestionPreview: failed to show formula preview due to promise rejection. rejection reason: ${jg}`);this.rH.QZ(eb.originCell,5,jg);Ga.state=ug.b.unseen})}pUg(Ga,Qb,wc,S){if(ac.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExample.ShowRowNumberingCard",!1)&&this.Aqj(Ga.anonymizedFormula)){const eb={isAcceptAsValues:!1,maxTooltipOpenDurationMS:0,isFurtherExplanationHyperlinkClicked:!1,disableApplyAsValue:Ga.range.uz>
this.UEj};return{iVd:this.rH.Bte(Ga.formula,Ga.range.toString(),()=>{Qb.Ita("CardUI")},()=>{eb.isAcceptAsValues=!0;Qb.Ita("CardUI")},eb.disableApplyAsValue,()=>Qb.fIa("CardUI"),ec=>{eb.maxTooltipOpenDurationMS=Math.max(eb.maxTooltipOpenDurationMS,ec)},()=>{eb.isFurtherExplanationHyperlinkClicked=!0},wc,()=>this.Q1b(Ga.flowId),Ga.originCell),u7a:eb}}return{iVd:this.rH.show(Ga.formula,Ga.range.toString(),()=>{Qb.Ita("CardUI")},()=>Qb.fIa("CardUI"),wc,()=>this.Q1b(Ga.flowId),Ga.originCell,S),u7a:null}}Aqj(Ga){const Qb=
/^ROW\(\) [-+] ROW\(\w+\)( [-+] \d+)?$/;return/^ROW\(\) [-+] \d+$/.test(Ga)||"ROW()"===Ga||ac.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleReferenceRowFormula",!1)&&Qb.test(Ga)}Utg(Ga,Qb){var wc;if(!ac.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleExplanations",!1))return{kind:"Failure",failureReason:"FG disabled"};if(!Qb||0===Qb.length)return{kind:"Failure",failureReason:"No explanation replacements"};const S=[];for(const Lc of Qb){if(!["ColumnName",
"LeftColumnName","RightColumnName","ColumnNames"].includes(Lc.replacementPlaceHolder)){S.push(Lc);continue}Qb=[];"ColumnNames"!==Lc.replacementPlaceHolder?Qb.push(Lc.replacementValue):Qb=Lc.replacementValue.split(", ");let Ad=0;for(const pd of Qb){if(Object(ig.b)(Ga)){var eb=this.Jh.extractReferences(`=${pd}`,this.Jh.ma.name,this.Jh.zCe,!0,Ga.originCell);if(!eb||!eb.Items||1!==eb.Items.length)return{kind:"Failure",failureReason:`Failed to extract singular ref from column replacement. refs non null: ${!!eb}, refs count: ${null===
(wc=null===eb||void 0===eb?void 0:eb.Items)||void 0===wc?void 0:wc.length}`};const de=eb.Items[0];eb=Ga.table.E8.HeadersList.find(Ge=>Ge.Index===de.Range.FirstColumn);if(!eb)return{kind:"Failure",failureReason:`Failed to find header for column replacement index in grid. ref: ${de.Range.FirstColumn}`};Qb[Ad]=eb.Name}else{eb=pd.replace(Qf.b,"");var ec=Object(hb.D)(`${eb}:${eb}`);if(!ec)return{kind:"Failure",failureReason:`Failed to parse column replacement ref. columnLetter: ${eb}, columnName: ${pd}`};
ec=Ga.headerRow.get(ec.left);Qb[Ad]=ec?ec:eb}Ad++}S.push({replacementPlaceHolder:Lc.replacementPlaceHolder,replacementValue:Qb.join(", ")})}return{kind:"Success",explanationReplacements:S}}nWh(Ga,Qb){const wc=this.Jh.yva("FormulaByExampleManager:checkIfPreviewResultsEqualOtherColumn",this.AP.zx);let S=null,eb=!0,ec=0;const Lc=[Qb.left];let Ad;try{for(;wc.$$mn();){const pd=wc.$$cu();Ad&&Ad!==pd.range.top&&(eb=!1,S=null);Ad=pd.range.top;if(eb)ec++;else if(Lc.length===ec)return!1;if(!Lc.includes(pd.range.left)){if(!S){const de=
new xc.Range(pd.range.top,Qb.left,pd.range.bottom,Qb.left,!0,!0),Ge=Ga.find(Re=>J(Re.value.cell).equals(de));S=vf(Ge).toString()}pd.Ln.value.toString()===S||"0"===S&&""===pd.Ln.value.toString()||Lc.push(pd.range.left)}}}catch(pd){throw Error(`Error while iterating over cells: ${pd}`);}finally{wc&&wc.dispose()}return!0}Muf(Ga,Qb,wc,S){return this.ZMa.iEk(Ga,Qb,void 0===wc?null:wc,this.G2a,S).then(eb=>{Ca.ULS.sendTraceTag(537161887,306,50,`FormulaByExampleManager.EvaluateFormulaAndUpdateModel: model update completed. result: ${eb.status}.`);
switch(eb.status){case 3:case 1:return 3===eb.status&&Object(bg.h)(Ga,"Preview shown, but only partially. some cells failed to evaluate."),Promise.resolve(eb);case 2:return Promise.reject("Calc estimation or model update failed");default:return Promise.reject("Calc estimation failed")}})}k4i(Ga,Qb,wc,S,eb,ec,Lc,Ad,pd){const de=this.V8b;this.sle();const Ge=wc.suggestion;this.sL&&Object(bg.f)("USERINPUTARRIVED",Ge.flowId,S);const Re=ac.EwaSettings.isChangeGateEnabled("OfficeVSO:8215633_FixFBEFreezeFrameBigTable")?
Ge.range.Ik(this.Jh.getLoadedRange()):Ge.range;this.xAe(Re,!1);this.rH.hide();tb.a.tKg(()=>{var kf,Xf;this.sL&&Object(bg.f)("PREVIEWREMOVEDWITHCSE",Ge.flowId,S);const kg={["flowId"]:Ge.flowId,["originalFlowId"]:Ge.lZ.flowId,["caller"]:Qb.fqc,["displayTrigger"]:eb,["formulaAnonymized"]:Ge.anonymizedFormula,["originalFormulaAnonymized"]:Ge.lZ.anonymizedFormula,["suggestionOutcome"]:Qb.B7,["annotationRange"]:Ge.range.toString(),["isFullyInViewport"]:this.Jh.bG(Ge.range),["isCachedSuggestion"]:S,["showFormulaClicked"]:de,
["exampleCount"]:Ge.vE,["originalExampleCount"]:Ge.lZ.vE,["seenCount"]:wc.hT,["previewCellsMetadata"]:Ga.dub,["previewShownDurations"]:this.sL?Object(bg.e)(S,Ge.flowId):"none",["previewRemovedDurations"]:this.sL?Object(bg.d)(S,Ge.flowId):"none",["isSuggestionOnTable"]:Object(ig.b)(Ge),["isNewRowPrediction"]:!Object(ig.b)(Ge)&&Ge.XWb,["sheetId"]:Ge.sheetId,["areAllHeadersLoaded"]:Object(ig.b)(Ge)?null===(kf=Ge.table.E8)||void 0===kf?void 0:kf.IsFullTableHeaders:"nonTableSuggestion",["tableRange"]:null===
(Xf=Ge.zx)||void 0===Xf?void 0:Xf.toString(),["dataCulture"]:this.Jh.$.dataCultureTag,["UICulture"]:this.Jh.$.fda,["previewEvents"]:ec,["Hypotheses"]:{["areHypothesesEnabled"]:this.Jh.P1a(),["isNewColumnHeuristic"]:Ge.YWj,["previewEqualsOtherColumn"]:Lc.Smi},["formulaExplanation"]:{explanationSuccessful:Ad,explanationKey:Ge.generatedFormula.explanationKey},["RowNumbering"]:pd?{["isAcceptAsValues"]:pd.isAcceptAsValues,["maxTooltipOpenDurationMS"]:pd.maxTooltipOpenDurationMS,["isFurtherExplanationHyperlinkClicked"]:pd.isFurtherExplanationHyperlinkClicked,
["disableApplyAsValue"]:pd.disableApplyAsValue}:null};Ca.ULS.sendTraceTag(388780100,306,ac.EwaSettings.isChangeGateEnabled("OfficeVSO:7896248_XLFBELogLevelImportant")?20:50,`FormulaByExampleManager.handlePreviewResult: FormulaByExample flow results: ${JSON.stringify(kg)}`);ac.EwaSettings.isChangeGateEnabled("OfficeVSO:7705932_FBESendsOtelEvents")&&tb.a.sendOtelEvent(Zg);Object(bg.b)(Ge.flowId)},this.Jh.ya);Ca.ULS.sendTraceTag(523842074,306,50,`FormulaByExampleManager.handlePreviewResult: User ${Qb.B7} the formula via ${Qb.fqc}`);
this.nra.$Qg(wc,Qb.B7,null===pd||void 0===pd?void 0:pd.isAcceptAsValues);"ACCEPT"===Qb.B7?(this.qrd(wc,Ga.lPb,null===pd||void 0===pd?void 0:pd.isAcceptAsValues),this.Kw&&ac.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExamplePluginCacheEnabled",!1)&&void this.Jh.pluginScheduler.eventEmitter().FBEOutcomeUpdate({flowId:Ge.flowId,suggestionOutcome:{outcome:"ACCEPT"}}),ac.EwaSettings.isChangeGateEnabled("OfficeVSO:7705932_FBESendsOtelEvents")&&tb.a.sendOtelEvent(Qg)):"IGNORE"===
Qb.B7?this.Kw&&ac.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExamplePluginCacheEnabled",!1)&&void this.Jh.pluginScheduler.eventEmitter().FBEOutcomeUpdate({flowId:Ge.flowId,suggestionOutcome:{outcome:"IGNORE"}}):"DECLINE"===Qb.B7&&(this.Kw&&ac.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExamplePluginCacheEnabled",!1)&&void this.Jh.pluginScheduler.eventEmitter().FBEOutcomeUpdate({flowId:Ge.flowId,suggestionOutcome:{outcome:"DECLINE"}}),this.d8g++,3===this.d8g&&
jh.Health.instance.recordQosError(dh.a.Pzi,[gh.a.Szi],!0,!0,!1,!1,{Zxa:!0}));this.$Bf.xwh(Qb.B7);this.Jh.uu(this.gia)}sle(){this.G2a=!1;this.XE=null;this.V8b=!1}qrd(Ga,Qb,wc){const S=Ga.suggestion;wc?(ac.EwaSettings.isChangeGateEnabled("OfficeVSO:8656119_FormulaByExample_RowNumbering_ApplyFormulaCSE")&&this.ZMa.o8e(Qb,null,S.flowId),this.Jh.q5(null,S.range,S.originCell,S.formula,!0).then(eb=>{eb=eb.results.map(ec=>[this.l2h(ec)]);this.Jh.B6c({FirstRow:S.range.top-1,FirstColumn:S.range.left-1,LastRow:S.range.bottom-
1,LastColumn:S.range.right-1,SheetName:this.Jh.sZc.name,NamedObjectName:"Table"===S.kind?S.table.name:null},eb);Ca.ULS.sendTraceTag(507604995,306,50,`FormulaByExampleManager.applyFormulaSuggestionOnRange: applied values on table, range: ${S.range}`)}).catch(eb=>{Ca.ULS.sendTraceTag(507585377,306,10,`FormulaByExampleManager.applySuggestionOnRange: failed to apply values on table, range: ${S.range} error: ${eb}`);this.Jh.Ip()})):(wc=Object(dc.a)(new Gc.a,{Text:S.formula}),this.Jh.setCell(wc,S.originCell,
1,127,null,0,{range:S.range,origin:S.originCell},2),this.ZMa.o8e(Qb,S.formula,S.flowId),Ca.ULS.sendTraceTag(537161883,306,50,`FormulaByExampleManager.applyFormulaSuggestionOnRange: applied formula on table, range: ${S.range}`));this.U4a=(eb,ec)=>{0===ec.tx&&(170==ec.Ul.operation.operationName?this.m$d(Ga):ac.EwaSettings.isChangeGateEnabled("OfficeVSO:7705932_FBESendsOtelEvents")&&tb.a.sendOtelEvent(Wg),this.kEg())};this.Jh.mw(this.U4a)}l2h(Ga){if(!tb.a.fHc(Ga))throw Error("FormulaByExampleManager.convertEvalOnCloneResultToString: EvalOnCloneResult is not successful.");
return vf(Ga).toString()}STg(Ga,Qb){if(ac.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExamplePluginSuggestionShowing",!1))return{value:!1,reason:"Sessions shows plugin suggestions"};const wc=Ga.suggestion;Qb=this.oij(wc.flowId,Qb.ZZ);return Qb.value?Ga.state===ug.b.decline?(this.rH.QZ(Ga.suggestion.originCell,6,Dg.a.Xeh),Ca.ULS.sendTraceTag(528758217,306,50,`FormulaByExampleManager.shouldShowPreview: user declined this suggestion before, not showing again. flowId: ${wc.flowId}`),
{value:!1,reason:"User declined this suggestion before."}):wc.vE<ag.a?(this.rH.QZ(Ga.suggestion.originCell,6,Dg.a.Edh),Ca.ULS.sendTraceTag(528758215,306,50,`FormulaByExampleManager.shouldShowPreview: cached suggestion does not have enough examples. not showing preview. flowId: ${wc.flowId}`),{value:!1,reason:"Cached suggestion does not have enough examples."}):Ga.state===ug.b.ignore&&2<=Ga.hT?(this.rH.QZ(Ga.suggestion.originCell,6,Dg.a.Weh),Ca.ULS.sendTraceTag(528758216,306,50,`FormulaByExampleManager.shouldShowPreview: user saw suggestion at least twice and ignored last time. not showing again. flowId: ${wc.flowId}`),
{value:!1,reason:"User saw suggestion at least twice and ignored last time"}):ac.EwaSettings.isChangeGateEnabled("OfficeVSO:7654591_FormulaByExampleForbiddenFormulas")&&this.nra.Clj(wc)?(Ca.ULS.sendTraceTag(509195993,306,20,`FormulaByExampleManager.shouldShowPreview: suggestion is forbidden. not showing preview. flowId: ${wc.flowId}, anonymizedFormula: ${wc.anonymizedFormula}`),{value:!1,reason:"Suggestion is forbidden as it wasn't wanted before."}):ac.EwaSettings.isChangeGateEnabled("OfficeVSO:7300192_FBETextCellsUnsupported")&&
this.cHf(wc.range).some(S=>this.Jh.h_d(S.cell.qo))?{value:!1,reason:"At least 1 cell in the loaded suggestion range is formatted as Text"}:ac.EwaSettings.isChangeGateEnabled("OfficeVSO:7464540_FBENoneValueTypesUnsupported")&&0===wc.Hci?{value:!1,reason:"suggestion's default value type cannot be none."}:ac.EwaSettings.isChangeGateEnabled("OfficeVSO:7669810_ValidateRangeIsInsideTableUponShowingSuggestion")&&Object(ig.b)(wc)&&!wc.table?{value:!1,reason:"table suggestion's table object is null."}:{value:!0}:
(this.rH.QZ(Ga.suggestion.originCell,6,Dg.a.xbh),{value:!1,reason:Qb.reason})}xAe(Ga,Qb){if(Ga)for(let S=Ga.top;S<=Ga.bottom;S++)for(let eb=Ga.left;eb<=Ga.right;eb++){var wc=xc.Range.vi(S,eb);if(wc=this.Jh.zh(wc))wc.cell.Dte=Qb&&!wc.cell.KV}}oij(Ga,Qb){if(this.bee)return Ca.ULS.sendTraceTag(528758218,306,50,`FormulaByExampleManager.shouldShowPreview: can't show preview again as preview already was shown for the current edit. flowId: ${Ga}`),{value:!1,reason:"Preview already shown for the latest edit."};
if(this.G2a)return Ca.ULS.sendTraceTag(527005664,306,50,`FormulaByExampleManager.shouldShowPreview: can't show preview for this suggestion as preview is already showing. flowId: ${Ga}`),{value:!1,reason:"Preview is already showing."};if(this.Xrd){if(504848446===Qb&&!this.Jh.isEditing())return Ca.ULS.sendTraceTag(507855E3,306,50,`FormulaByExampleManager.shouldShowPreview: AsYouType UX enabled. can't show preview for this suggestion as user is not editing. flowId: ${Ga}`),{value:!1,reason:"User is not editing."};
if(324156914===Qb)return Ca.ULS.sendTraceTag(507836041,306,50,`FormulaByExampleManager.shouldShowPreview: AsYouType UX enabled. preview shown only when editing, or by priming. flowId: ${Ga}`),{value:!1,reason:"After edit preview only handled by preview priming."}}else if(this.Jh.isEditing())return Ca.ULS.sendTraceTag(524813027,306,50,`FormulaByExampleManager.shouldShowPreview: AsYouType UX disabled. can't show preview for this suggestion as user is editing. flowId: ${Ga}`),{value:!1,reason:"User is editing."};
return{value:!0}}cHf(Ga){const Qb=[];this.nFc=[];const wc=this.Jh.waa(Ga,this.Jh.activeItemName);for(const S of wc)Qb.push(...this.Jh.yga(Ga.Ik(S.yj),S)),this.nFc.push(S.Pi);return Qb}}Object(la.a)(og,"FormulaByExampleManager",af.a,[747,4]);class Ug extends O.a{constructor(Ga){super();this.$=Ga;this.gm()}create(){Ca.ULS.sendTraceTag(528758214,0,50,"FormulaByExampleManagerFactory.Create: starting service creation flow.");const Ga=Object(jf.d)(db.a.resolve(gb.Oc,{va:this.xh})),Qb=Object(jf.d)(db.a.resolve(gb.Nc,
{va:this.xh}));Mg.TaskExtensions.Xa(Mg.TaskExtensions.Vo([Qb,Ga],this.ya),()=>{Ca.ULS.sendTraceTag(528758213,0,50,"FormulaByExampleManagerFactory.Create: augmentationLoopManager and calcManager creation tasks resolved.");yf.init(this.$);const wc=new og(Qb.result,yf.instance(),Ga.result);this.Bk(this.$.la.kh(453)||this.$.la.Hh(453,wc));Ca.ULS.sendTraceTag(537161882,0,50,"FormulaByExampleManagerFactory.Create: FormulaByExampleManager initialized successfully")},this.ya)}static Ba(Ga){Ga.la.Hh(454,new Ug(Ga))}}
Object(la.a)(Ug,"FormulaByExampleManagerFactory",O.a,[]);var Rg=a(234);class fi{constructor(Ga,Qb,wc){this.$=Ga;this.QBf=Qb;this.ariaLiveNotifier=wc;this.ZVb=ac.EwaSettings.isChangeGateEnabled("OfficeVSO:8501487_ValuePreviewDetectVolatile");this.ibj();this.editBox=Object($a.f)(this.$).Fh}get fD(){return rd.getInstance(this.$)}get zoomManager(){this.WFa||(this.WFa=Object(Lb.a)());return this.WFa}dispose(){this.hide()}show(Ga,Qb,wc,S){S=Object.assign({},Qb,{pB:Ga,uCe:wc,source:S});if(!this.jQa(S))return!1;
this.Tqa(S)&&this.hide();this.dx=S;this.fD.setResult(Qb,Ga);this.iQ();wc&&this.y8i();return!0}hide(Ga){if(!this.dx||Object(Id.b)(Ga)&&Ga!==this.dx.pB)return!1;Ga=this.dx.uCe;this.Vfi();Ga&&this.Ekk();this.dx=void 0;return!0}jQa(Ga){return!this.dx||!Q(this.dx,Ga,this.ZVb)}Tqa(Ga){return this.dx&&!H(this.dx,Ga)}y8i(){const Ga=this.dx.length;0!==Ga&&this.dx.pB.Wa.formatText(this.dx.index,Ga,{background:"rgba(202,234,216,0.6)"})}Ekk(){const Ga=this.dx.pB;Ga.Wa.formatText(0,Ga.text.length,{background:!1});
Ga.$Z(null)}iQ(){let Ga;switch(this.dx.kind){case "Success":Ga={isLoaded:!0,value:this.dx.value,textColor:this.dx.color};break;case "Loading":Ga={isLoaded:!1,value:null,textColor:null};break;default:return}this.aal();this.QBf.renderValuePreview(this.SA,this.eac,Ga);this.P5j(Ga)}Vfi(){this.QBf.dismiss(this.SA)}ibj(){this.SA=document.createElement("div");this.eac=document.createElement("div");this.eac.style.position="absolute";this.eac.style.visibility="hidden";this.$.domElement.appendChild(this.eac)}aal(){var Ga=
this.dx.pB;const Qb=this.dx.index,wc=this.dx.length;var S=this.dx.source;let eb;switch(S.trigger){case "hover":eb=Ga.Wa.getBounds(S.index,1);break;case "shortcut":eb=Ga.Wa.getBounds(S.index);break;case "selection":S=Ga.text.substring(Qb,Qb+wc).indexOf("\n"),-1!==S?eb=Ga.Wa.getBounds(Qb,S):(S=Ga.Wa.getBounds(Qb),Ga=Ga.Wa.getBounds(Qb,wc),eb={left:S.left,top:S.top,width:Ga.right-S.left,height:Ga.height})}this.$$k(eb)}$$k(Ga){const Qb=new Rg.a(this.eac.style);Qb.hF.left=this.B_c(Ga.left);Qb.hF.top=this.B_c(Ga.top);
Qb.hF.width=this.B_c(Ga.width);Qb.hF.height=this.B_c(Ga.height);Qb.n$()}B_c(Ga){var Qb=this.dx.pB;Qb=Object(Id.b)(this.zoomManager)&&Qb===this.editBox;return Jb.HelperMethods.Ki(Qb?this.zoomManager.jo(Ga):Ga)}P5j(Ga){var {isLoaded:Qb,value:wc}=Ga;Qb?this.ariaLiveNotifier.readText(String.format(lb.a.instance.sh(179),wc)):this.ariaLiveNotifier.readText(lb.a.instance.ia(866))}}Object(la.a)(fi,"FormulaAssistanceValuePreviewControl",null,[4]);class Sg{constructor(Ga){this.cache=Ga}clearCache(){this.cache=
void 0}}Object(la.a)(Sg,"Cacheable",null,[]);class Bg extends Sg{constructor(Ga,Qb){super();this.$=Ga;this.callbacks=Qb;this.H4a=(wc,S)=>{const eb=this.da.Bp;if(!(0<(eb.isEditing?eb.Wa.selection:{index:0,length:0}).length))switch(S.state){case 0:this.onHoverEnter(wc,S.event);break;case 1:this.onHoverLeave(wc);break;case 2:this.dVj(wc);break;default:return Ca.ULS.shipAssertTag(521446489,0,!1,"FormulaAssistanceValuePreviewHandler.onHoverChange unxpected HoverState"),S}};this.Ujg=(wc,S)=>{const eb=S.selection;
S={source:"selection",text:S.text,index:eb.index,length:eb.length};if(0<eb.length)this.onSelectionChange(wc,S);else this.wae(wc,S)};this.da=Object($a.f)(this.$);this.editBox=this.da.cellTextEditBox;this.Hp(this.editBox);this.formulaBar=Object(vb.a)(this.$);Object(Id.b)(this.formulaBar)?this.Hp(this.formulaBar):Object(vb.b)(this.$,wc=>{this.formulaBar=wc;this.Hp(this.formulaBar);Ca.ULS.sendTraceTag(509870663,1,50,"FormulaAssistanceValuePreviewHandler: formulaBar async")})}get fD(){return rd.getInstance(this.$)}dispose(){this.to(this.editBox);
this.to(this.formulaBar)}trigger(){const Ga=this.da.Bp,Qb=Ga.Wa.selection;this.onSelectionChange(Ga,{source:"shortcut",text:Ga.text,index:Qb.index,length:Qb.length})}Hp(Ga){Ga.aIb(this.H4a);Ga.cpd(this.Ujg)}to(Ga){null===Ga||void 0===Ga?void 0:Ga.f5b(this.H4a);null===Ga||void 0===Ga?void 0:Ga.WUc(this.Ujg)}onHoverEnter(Ga,Qb){var wc=new Sys.UI.Point(Qb.clientX,Qb.clientY);{Qb=Ga.Wa.Yl;var S=void 0,{x:eb,y:ec}=wc;S=void 0===S?document:S;wc=-1;let Lc=null;void 0!==S.caretPositionFromPoint?(S=S.caretPositionFromPoint(eb,
ec),null!==S&&(wc=S.offset,Lc=S.offsetNode)):void 0!==S.caretRangeFromPoint&&(S=S.caretRangeFromPoint(eb,ec),null!==S&&(wc=S.startOffset,Lc=S.startContainer));null===Lc||-1===wc?(Ca.ULS.sendTraceTag(521446491,0,15,"getEditorCaretPositionFromPoint - failed to get relevant range"),Qb=-1):Qb.contains(Lc)?Qb=ba(Qb,Lc,wc):(Ca.ULS.sendTraceTag(521446490,0,15,"getEditorCaretPositionFromPoint - relavant node not inside root"),Qb=-1)}if(-1!==Qb)this.onSelectionChange(Ga,{source:"hover",text:Ga.text,index:Qb,
length:0})}onHoverLeave(Ga){this.wae(Ga)}dVj(Ga){this.wae(Ga)}onSelectionChange(Ga,Qb){this.Ure(Qb)&&!Ga.lha&&(this.cache=Qb,this.callbacks.tae(Ga,{index:Qb.index,length:Qb.length,trigger:Qb.source}),this.fD.trigger=Qb.source)}wae(Ga,Qb){this.yLk(Qb)&&(this.clearCache(),this.callbacks.Sba(Ga))}Ure(Ga){return!this.cache||!U(this.cache,Ga)}yLk(Ga){return this.cache&&Ga?"shortcut"!==this.cache.source||!U(this.cache,Ga):!0}}Object(la.a)(Bg,"FormulaAssistanceValuePreviewHandler",Sg,[4]);class zg{constructor(Ga){this.$=
Ga;this.m9b=0;this.w9a=!1;this.hza=null;this.Rl=()=>{this.da.cellTextEditBox.i2(this.Rl);this.dda()};this.da=Object($a.f)(Ga)}onShow(){this.w9a||(this.hza=performance.now())}onHide(){this.w9a||null===this.hza||(400<performance.now()-this.hza&&(this.m9b++,this.hza=null),2===this.m9b&&this.qye())}qye(){this.da.isEditing?this.da.cellTextEditBox.uX(this.Rl):this.dda()}dda(){this.$.si(1684822464,-1,0,null);this.w9a=!0}}Object(la.a)(zg,"ValuePreviewSurveyHandler",null,[]);class Ng{constructor(Ga,Qb,wc,
S){this.$=Ga;this.requester=Qb;this.YPk=200;this.EHg=3E3;this.iha=ac.EwaSettings.isChangeGateEnabled("OfficeVSO:8550405_ValuePreviewDismissOnScroll");this.tae=(eb,ec)=>{const Lc=this;return Lo(function*(){const Ad={text:eb.text,index:ec.index,length:ec.length};void Lc.gyg(Ad,Lc.Qrk(Ad),eb,0===Ad.length,ec.trigger)})};this.Sba=()=>{this.hide()};this.reset=()=>{this.handler.clearCache();this.requester.clearCache();this.hide()};this.MH=()=>{this.handler.clearCache();this.requester.clearCache()};this.Uy=
()=>{this.hide(this.da.Fh)};this.ePc=eb=>{this.hide(eb)};this.da=Object($a.f)(this.$);this.control=new fi(this.$,wc,S);this.handler=new Bg(this.$,{tae:this.tae,Sba:this.Sba});this.Wca=new zg(this.$);this.Hp()}get fD(){return rd.getInstance(this.$)}trigger(){this.handler.trigger()}dispose(){this.to();this.handler.dispose();this.control.dispose()}Hp(){this.da.Fh.uX(this.reset);this.da.ha.add_activeCellChanged(this.reset);this.$.ea.dK(this.MH);this.iha&&(this.da.view.oz(this.Uy),this.da.cellTextEditBox.d4e(this.ePc),
Object(vb.b)(this.$,Ga=>{Ga.d4e(this.ePc)}))}to(){var Ga;this.da.Fh.i2(this.reset);this.da.ha.remove_activeCellChanged(this.reset);this.$.ea.hL(this.MH);this.iha&&(this.da.view.dy(this.Uy),this.da.cellTextEditBox.gFg(this.ePc),null===(Ga=Object(vb.a)(this.$))||void 0===Ga?void 0:Ga.gFg(this.ePc))}gyg(Ga,Qb,wc,S,eb){const ec=this;return Lo(function*(){const Lc=Object.assign({},Ga,{pB:wc,DZc:S,trigger:eb});ec.fs=Lc;const Ad=yield Qb;Object(Id.c)(Ad)||ec.gZd(Lc)&&void ec.QQd(Ad)})}QQd(Ga){const Qb=this;
return Lo(function*(){const wc=Qb.fs.text,S=Qb.fs.pB,eb=Qb.fs.DZc,ec=Qb.fs.trigger;switch(Ga.kind){case "Failure":Qb.fD.setResult(Ga,S);Qb.hide();break;case "Success":Qb.show(Ga);break;case "Loading":Qb.show(Ga);void Qb.gyg({text:wc,index:Ga.index,length:Ga.length},Ga.promise,S,eb,ec);break;default:return Ga}})}Qrk(Ga){const Qb=this.requester.Wke(Ga,this.EHg,!0);let wc;const S=new Promise(eb=>{wc=window.setTimeout(()=>{eb(Object.assign({},Ga,{kind:"Loading",promise:Qb}))},this.YPk)});return Promise.race([Qb,
S]).finally(()=>{window.clearTimeout(wc)})}show(Ga){const Qb=this.fs.index,wc=this.fs.pB,S=this.fs.DZc,eb=this.fs.trigger;this.fs=void 0;if(this.nqj(Ga)&&(Ga=this.control.show(wc,Ga,S,{trigger:eb,index:Qb}),!this.iha||Ga))this.Wca.onShow()}hide(Ga){Ga=this.control.hide(Ga);this.fs=void 0;if(!this.iha||Ga)this.Wca.onHide()}gZd(Ga){var Qb;if(Qb=this.fs)Qb=this.fs,Qb=Qb.text===Ga.text&&Qb.index===Ga.index&&Qb.length===Ga.length&&Qb.pB===Ga.pB&&Qb.DZc===Ga.DZc;return Qb}nqj(Ga){switch(Ga.kind){case "Success":return Object(Id.b)(Ga.value)&&
""!==Ga.value;case "Loading":return!0;default:return Ga}}}Object(la.a)(Ng,"FormulaAssistanceValuePreview",null,[749,4]);var Ig=a(261);class bh extends O.a{constructor(Ga){super();this.$=Ga;this.gm()}static Ba(Ga){Ga.la.Hh(497,new bh(Ga))}create(){let Ga=this.$.la.kh(496);Ga&&this.Bk(Ga);const Qb=Cf.GetServiceTaskFactory.Tj(this.$.la,448,449,this.xh);var wc=gb.Ec.Aa();const S=wc?Ig.a.Ua(void 0):Object(jf.d)(db.a.resolve(gb.Wc,{va:this.xh}));wc=wc?Object(jf.d)(db.a.resolve(gb.Ec,{va:this.xh})):Ig.a.Ua(void 0);
const eb=ac.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FixMigrate2AriaLiveNotifier",!1)?Object(jf.d)(db.a.resolve(gb.l,{va:this.xh})):Cf.GetServiceTaskFactory.Tj(this.$.la,211,212,this.xh),ec=Object(jf.d)(db.a.resolve(gb.Hc));Mg.TaskExtensions.Xa(Mg.TaskExtensions.Vo([Qb,S,eb,ec,wc],this.ya),()=>{Ga=this.$.la.kh(496);Ga||(Ga=new Ng(this.$,ec.result,Qb.result,eb.result),this.$.la.Hh(496,Ga));this.Bk(Ga)},this.ya,3)}}Object(la.a)(bh,"FormulaAssistanceValuePreviewFactory",O.a,[]);class wh extends Hg.a{constructor(Ga){super(Ga)}Kt(){const Ga=
Cf.GetServiceTaskFactory.Tj(this.$.la,496,497,this.xh);Mg.TaskExtensions.Xa(Ga,()=>{this.Qr([new Hf(Ga.result)])},this.ya)}static Ba(Ga){Hg.a.qy(515,new wh(Ga))}}Object(la.a)(wh,"FormulaAssistanceValuePreviewCommandHandlerFactory",Hg.a,[]);String(ha);String(ea);window.___1710758616426_closurehack=ha;window.___1710758616426_closurehack=ea;R.a.gh(ob.Ba);(()=>{R.a.gh(Ga=>{Cb.Ba(Ga)})})();(()=>{R.a.gh(Ga=>{yd.Ba(Ga)})})();(()=>{R.a.gh(Ga=>{Gg.Ba(Ga)})})();(()=>{R.a.gh(Ga=>{Ug.Ba(Ga);mg.Ba(Ga)})})();(()=>
{R.a.gh(Ga=>{bh.Ba(Ga);gb.Gc.Aa()||wh.Ba(Ga)})})();String(D);String(I);String(X);String(Y);String(ja);String(Ua);String(ka);String(fb);String(ea);String(aa);String(ca);String(xa);String(Oa);String(ua);String(Ia);String(Sa);String(Ya);String(da);String(Ea);String(oa);String(Ra);window.___1710758652243_closurehack=D;window.___1710758652243_closurehack=I;window.___1710758652243_closurehack=X;window.___1710758652243_closurehack=Y;window.___1710758652243_closurehack=ja;window.___1710758652243_closurehack=
Ua;window.___1710758652243_closurehack=ka;window.___1710758652243_closurehack=fb;window.___1710758652243_closurehack=ea;window.___1710758652243_closurehack=aa;window.___1710758652243_closurehack=ca;window.___1710758652243_closurehack=xa;window.___1710758652243_closurehack=Oa;window.___1710758652243_closurehack=ua;window.___1710758652243_closurehack=Ia;window.___1710758652243_closurehack=Sa;window.___1710758652243_closurehack=Ya;window.___1710758652243_closurehack=da;window.___1710758652243_closurehack=
Ea;window.___1710758652243_closurehack=oa;window.___1710758652243_closurehack=Ra},960:function(A,u,a){a.d(u,"a",function(){return K});A=a(0);var c=a(190),b=a(23),h=a(25),r=a(73),f=a(46),l=a(156),m=a(485),x=a(119),n=a(945),t=a(1247);a(120);var w=a(70),v=a(217),k=a(64),y=a(216),C=a(36),B=a(44),E=a(15);class K{constructor(F,W,J,L,M,Q,H,ba,U,D){this.$=F;this.Sj=W;this.Yo=J;this.cI=L;this.yk=M;this.ylj=H;this.indexedDB=ba;this.pluginScheduler=D;this.da=b.f(F);this.Kw=null===U||void 0===U?void 0:U.xNf("Legacy")}Ip(){const F=
C.a.nj(1,0,0,0,0,0,"FormulaByExampleApplyAsValueFailed");B.a(this.da.$).Ip(F)}B6c(F,W){const J=new y.a(163,0,(L,M,Q)=>{const H=this.$.pa.ta,ba=H.$a(0);ba.rangeToSet=F;ba.rangeValues=W;return k.h(H,"SetRange",ba,(U,D,I)=>{E.ULS.sendTraceTag(507585379,306,20,"FormulaByExampleServiceProxy.SetRange: the operation has succeeded");L(U,D,I)},(U,D,I)=>{E.ULS.sendTraceTag(507585378,306,10,"FormulaByExampleServiceProxy.SetRange: the operation has failed");M(U,D,I)},Q,this.$.pa.ta.Vh(),0)},65);this.$.userOperationManager.enqueueOperation(J,
null)}uX(...F){return this.da.Fh.uX(...F)}i2(...F){return this.da.Fh.i2(...F)}mO(...F){return this.da.Fh.mO(...F)}uN(...F){return this.da.Fh.uN(...F)}Kl(...F){return this.da.oh.Kl(...F)}jYi(F){return v.a(this.$,F,!1)}w8(...F){return this.da.qN.w8(...F)}m_b(...F){return this.da.qN.m_b(...F)}getLoadedRange(){return this.da.Dp}isEditing(){return this.da.isEditing}waa(...F){return this.da.za.waa(...F)}getActiveCell(){return this.da.ha.qa.activeCell}Aba(){return this.da.za.Aba}ux(...F){return this.da.za.ux(...F)}ny(...F){return this.da.za.ny(...F)}nz(...F){return this.da.za.nz(...F)}Zy(...F){return this.da.za.Zy(...F)}Eeb(...F){return this.da.za.Eeb(...F)}a5b(...F){return this.da.za.a5b(...F)}Wmc(...F){return this.da.Wmc(...F)}Xmc(...F){this.Dvk(W=>
{W.Xmc(...F)})}zh(...F){return this.da.zh(...F)}yga(...F){return this.da.yga(...F)}bG(...F){return this.da.bG(...F)}setCell(...F){return this.da.setCell(...F)}yva(...F){return this.da.ot(...F)}get kj(){return this.da.kj}GNa(...F){return this.da.za.GNa(...F)}evalFormula(...F){return this.Sj.evalFormula(...F)}q5(...F){return this.Sj.q5(...F)}BHc(...F){return this.Sj.BHc(...F)}h_d(...F){return this.Sj.h_d(...F)}O_a(...F){return this.Sj.O_a(...F)}hJh(...F){return this.Sj.d6e(...F)}extractReferences(...F){return this.Sj.extractReferences(...F)}wna(...F){return this.Sj.wna(...F)}bpd(...F){return this.Sj.bpd(...F)}Dmc(...F){return this.Sj.Dmc(...F)}Kie(...F){return this.Sj.Kie(...F)}localizeEnglishFormula(...F){return this.Sj.localizeEnglishFormula(...F)}si(...F){return this.$.si(...F)}qh(...F){return this.$.Ma.qh(...F)}gq(...F){return this.$.gq(...F)}sendBeaconTraceTag(...F){return this.$.sendBeaconTraceTag(...F)}uu(...F){return this.$.userOperationManager.uu(...F)}mw(...F){return this.$.userOperationManager.mw(...F)}get isFeedbackEnabled(){return this.$.isFeedbackEnabled}get ya(){return this.$.ya}get ma(){return this.$.ma}get activeItemName(){return this.da.$.activeItemName}get sZc(){var F;
return null===(F=this.$.sa)||void 0===F?void 0:F.ma}get NC(){return this.$.ea.NC}get displayRtl(){return this.$.ma.displayRtl}get zCe(){return this.$.workbookContext.WorkbookFileName}W_i(){return w.a(this.$)}static fHc(F){return Object(t.a)(F)}static sendOtelEvent(...F){return Object(n.c)(...F)}static rfh(...F){return x.a(...F)}static tKg(...F){Object(l.c)(...F)}static NKd(...F){return Object(m.a)(...F)}static Wfl(){return Object(l.f)()}static xAi(...F){return Object(f.H)(...F)}static S0(...F){return Object(r.d)(...F)}R1a(){return this.ylj}CLa(){return h.a.CLa(this.$)}Q1a(){return h.a.Q1a(this.$)}P1a(){return h.a.P1a()}static Lga(...F){return Object(c.a)(...F)}Laj(){this.A9a=
this.cI.Caa()}TXk(...F){var W;return null===(W=this.A9a)||void 0===W?void 0:W.sKa(...F)}HId(...F){return this.yk.HId(...F)}gaa(...F){return this.yk.gaa(...F)}xjj(){var F=[];return!!this.indexedDB&&this.indexedDB.zl(...F)}Rbj(...F){this.indexedDB.initialize(...F)}LMi(...F){return this.indexedDB.fxa(...F)}Iwk(...F){this.indexedDB.lBa(...F)}deleteDatabase(...F){return this.indexedDB.deleteDatabase(...F)}Gbh(F,W){this.Yo.register(this.Yo.J5().n8("FormulaByExample").m8(F).activateAnnotation(W).build())}Djj(){return!!this.Yo}s5k(){this.Yo.unregister(...["FormulaByExample"])}tWk(...F){this.Yo.oyb(...F)}S7(F,
W){this.Kw&&(this.Kw.Jja(F,1,{errorMessage:W}),this.Kw.zjb(F))}Dvk(F){this.$.la.fi(254,F)}}Object(A.a)(K,"FormulaByExampleServiceProxy",null,[])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaTS.edt.js.map/a19e5cd158931f64ce969a9c078e5e38/EwaTS.edt.js.map