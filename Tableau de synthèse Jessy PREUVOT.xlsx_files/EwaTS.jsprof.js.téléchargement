'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[29],{698:function(A,u,a){a.r(u);A={};a.r(A);a.d(A,"JsSelfProfilerManager",function(){return H});u={};a.r(u);var c=a(0),b=a(15),h=a(94),r=a(540),f=a(6),l=a(142),m=a(10),x=a(58),n=a(54),t=a(1),w=a(61);class v{constructor(U){this.YSk=U}getCustomProperties(U){const D=new Map;if(U.hasOwnProperty("startTimeInMs")&&U.hasOwnProperty("totalExecutionTimeInMs")){const I=U.startTimeInMs;U=this.YSk.retrieveSlowActionsBetweenTimeRange(I,
I+U.totalExecutionTimeInMs);D.set("actions",w.a.Ci(U))}return D}}Object(c.a)(v,"CallTreeCustomPropertiesRetriever",null,[130]);class k{constructor(U){this.yvk=U}getCustomProperties(U){const D=new Map;if(U.hasOwnProperty("startTimeInMs")&&U.hasOwnProperty("totalExecutionTimeInMs")){const I=U.startTimeInMs;U=this.yvk.retrieveRumShepherdEventsBetweenTimeRange(I,I+U.totalExecutionTimeInMs);D.set("rumShepherdData",JSON.stringify(U))}return D}}Object(c.a)(k,"CallTreeRumShepherdCustomPropertiesRetriever",
null,[130]);class y{constructor(){this.customProperties=new Map}addCustomProperty(U,D){this.customProperties.set(U,D)}getCustomProperties(){return this.customProperties}}Object(c.a)(y,"CustomPropertiesRetriever",null,[129]);class C{isFeatureEnabled(U,D){return t.EwaSettings.getBooleanFeatureGate(U,D)}}Object(c.a)(C,"ExcelFeatureChecker",null,[128]);class B{isProfilingEnabled(){return!0}}Object(c.a)(B,"ExcelProfilingFeatureChecker",null,[127]);class E{constructor(U,D){this.K_j=U;this.M_j=D}onProfilerEvent(U){switch(U.eventId){case 1:this.K_j(t.EwaSettings.isChangeGateEnabled("OfficeVSO:6144046_KeepOldCollectedActions"));
break;case 0:this.M_j();break;default:b.ULS.sendTraceTag(537155529,0,15,`JSCPUIJSCPUProfilerObserver.OnProfilerEvent: got unhandled profilerEventId ${U.eventId}`)}}}Object(c.a)(E,"JSCPUProfilerObserver",null,[126]);class K{constructor(){this.samplingIntervalInMs=0;this.idleIntervalInMs=this.profilingIntervalInMs=this.maximumNumberOfSamplesToTake=null}}Object(c.a)(K,"JSCPUProfilerInitOptions",null,[]);class F{constructor(){this.profilerTraceLoggingChunkSize=this.shouldLogRawProfilerTrace=this.shouldRecordFrameCounts=
this.shouldMakeSerializedCallTreesFullyReconstructible=this.shouldKeepQueryParamsInResourceURLs=this.shouldProcessProfileCapturedWhileUserIsIdle=this.shouldSendProfilesForDeobfuscationImmediately=this.canUseMultipleWebWorkers=this.shouldUseInMemoryLogger=this.featureEnabledChecker=this.deObfuscationRequestQueryParamsRetriever=this.deObfuscationRequestBodyPropertiesRetriever=this.durationThresholdInMsToLogOperationData=this.shouldAlwaysLogOperationsData=this.shouldUseSendBeaconForSendingCallTrees=
this.shouldSendAllCallTreesFromProfileInASingleRequest=this.frameTotalExecutionTimeFilteringThresholdInMs=this.shouldCompressSerializedCallTrees=this.shouldRecordExpandedTimeStamps=this.profilerTraceProcessingWebWorkerSourceURL=this.useMainEventLoopForProfilerTraceProcessing=this.shouldKeepSamplesOutsideOfProfilingInterval=this.shouldProfilingStartInAHiddenDocument=this.shouldProcessProfileCapturedInAHiddenDocument=this.callTreeFilteringThresholdInMs=this.deObfuscationEndpoint=this.ulsInstance=this.buildVersion=
this.appName=null}}Object(c.a)(F,"JSCPUProfilingPackageInitOptions",null,[]);var W=a(45);class J{filter(U){var D,I,X;const Y=!W.a.instance.TTSI||(null===(D=U.serializedFrames[0])||void 0===D?void 0:D.startTimeInMs)<W.a.instance.t4k;D=(null===(I=U.propertyBag)||void 0===I?void 0:I.actions)&&"[]"!==U.propertyBag.actions;U=0<(null===(X=U.serializedFrames[0])||void 0===X?void 0:X.totalExecutionTimeInMs);return Y&&U||D}}Object(c.a)(J,"CallTreeCustomFilterer",null,[59]);var L=a(5),M=a(95),Q=a(9);Object(M.b)(L.Fd,
{Fk:"singleton"})(()=>Lo(function*(){const [U,D]=yield Promise.all([M.a.resolve(L.Nb),M.a.resolve(L.Ed),M.a.resolve(L.me)]);return new H(U,D,0)}));Object(M.b)(L.Gd,{Fk:"singleton"})(()=>new H(Q.a.P8a,null,1));class H{constructor(U,D,I){this.mLa=this.YXg=this.Uee=this.oub=this.Vee=this.myg=this.oyg=null;this.Fak=new Set([1,0]);b.ULS.sendTraceTag(537155528,0,50,"JsSelfProfilerManager.Ctor: creating new JsSelfProfilerManager");this.$=U;this.mLa=D;this.jdj();this.idj();this.Cuj=t.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.JsProfilingSampleIntervalInMs",
16);this.profilingIntervalInMs=t.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.JsProfilingWindowDurationInMs",1E4);this.Wif=t.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.JsProfilingIdleIntervalInMs",3E5);b.ULS.sendTraceTag(507593507,0,50,`JsSelfProfilerManager: starting profiler: ${I.toString()}`);switch(I){case 1:this.PUk(t.EwaSettings.getIntFeatureGate("Microsoft.Office.ExcelOnline.JsProfilerOnBootMaximumProfilingDurationMs",6E4));this.$.ea.lw(()=>{this.KVk()});break;case 0:this.r3j=
t.EwaSettings.getStringFeatureGate("Microsoft.Office.Excel.ProfilerName",""),this.tUk()}}dispose(){b.ULS.sendTraceTag(537155527,0,50,"JsSelfProfilerManager.Dispose");h.a.dh(this.YXg);this.Uee=this.$=null;this.Vee.clear();this.oub.clear()}tUk(){const U=Math.random()*this.Wif;b.ULS.sendTraceTag(537155526,0,50,`JsSelfProfilerManager.Ctor: starting ContinuousSessionProfiler in: ${U}`);this.YXg=x.a.instance.create(()=>{this.XJf("ExcelOnlineContinuousSessionProfiler",2).start()},U,n.a.tJk,!0)}PUk(U){U=
void 0===U?1E4:U;b.ULS.sendTraceTag(537155524,0,50,"JsSelfProfilerManager.StartManualProfiler: Starting a new profiler");this.XJf("BootProfiler",0,U).start()}KVk(){var U=this.DKf("BootProfiler");U&&U.stop()}nyg(U){return this.oub.has(U)}createProfiler(U,D,I,X,Y,ja){b.ULS.sendTraceTag(537155521,0,50,"JsSelfProfilerManager.CreateProfiler: Creating a new profiler");const Ua=new K;Ua.samplingIntervalInMs=D;Ua.maximumNumberOfSamplesToTake=I;Ua.idleIntervalInMs=X;Ua.profilingIntervalInMs=Y;return this.V8h(U,
ja,Ua)}idj(){const U=new B,D=new F;D.ulsInstance=new r.a;D.deObfuscationEndpoint="ProfilerReporting.ashx";D.shouldCompressSerializedCallTrees=!1;D.shouldKeepSamplesOutsideOfProfilingInterval=!1;D.shouldSendAllCallTreesFromProfileInASingleRequest=!t.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ShouldSendEachCallTreeIndividuallyFromProfile",!1);D.shouldUseSendBeaconForSendingCallTrees=t.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ShouldUseSendBeaconForSendingCallTrees",!1);
D.callTreeFilteringThresholdInMs=t.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.JsProfilerCallTreeFilteringThresholdInMs",-1);D.frameTotalExecutionTimeFilteringThresholdInMs=t.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.JsProfilerFrameTotalExecutionTimeFilteringThresholdInMs",-1);D.shouldRecordFrameCounts=!0;D.deObfuscationRequestQueryParamsRetriever=this.D5h();D.deObfuscationRequestBodyPropertiesRetriever=this.C5h();D.featureEnabledChecker=new C;D.useMainEventLoopForProfilerTraceProcessing=
!1;D.profilerTraceProcessingWebWorkerSourceURL=this.$.ua.JSProfilerProcessingWebWorkerJsScriptUrl;D.shouldProcessProfileCapturedWhileUserIsIdle=t.EwaSettings.isChangeGateEnabled("OfficeVSO:6144063_ShouldProcessProfileCapturedWhileUserIsIdle");t.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ShouldLogRawProfilerTrace",!1)&&(D.shouldLogRawProfilerTrace=!0,D.profilerTraceLoggingChunkSize=t.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.ProfilerTraceLoggingChunkSize",30));this.Uee=this.oyg.retrievePackage(U,
D).retrieveProfilerFactory()}D5h(){const U=new y;U.addCustomProperty(m.a.$yg,f.AFrameworkApplication.userType);U.addCustomProperty(f.AFrameworkApplication.vRa,f.AFrameworkApplication.userSessionId);U.addCustomProperty(m.a.t7d,this.$.ua.SkipAuthentication?m.a.afg:null);U.addCustomProperty(m.a.tfe,this.$.ua.MachineCluster);return U}C5h(){const U=new y;U.addCustomProperty("appName","Excel");U.addCustomProperty("buildVersion",f.AFrameworkApplication.buildVersion);U.addCustomProperty("shouldUseSourceMaps",
"true");U.addCustomProperty("shouldFilterSensitiveResources","true");U.addCustomProperty("shouldUseJSSelfProfilerSpecificDeobfuscator","false");return U}V8h(U,D,I){const X=new y;X.addCustomProperty("ProfilerName",U);this.myg.set(U,X);D=this.Uee.createProfiler(D,I,X);this.oub.set(U,D);return t.EwaSettings.d2a()?t.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.AddRumShepherdDataToCallTree",!1)?this.M4h(D):D:this.a7h(U,D)}a7h(U,D){U=this.b7h(U);D.subscribeProfilerObserver(U,this.Fak);U=new J;
D.subscribeCallTreeCustomFilterer(U);return D}M4h(U){var D=t.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CollectRumShepherdComponentDataOnly",!1);D=rumShepherd.RumShepherdFactoryGlobal.createAndInitRumShepherdDataRetriever(!D);if(!D)return b.ULS.sendTraceTag(507368864,0,15,"JsSelfProfilerManager.createProfilerWithOptions.createBootProfiler.createAndInitRumShepherdDataRetriever returned null"),U;D=new k(D);U.subscribeCallTreeCustomPropertiesRetriever(D);return U}DKf(U){return this.nyg(U)?
this.oub.get(U):(b.ULS.shipAssertTag(537155520,0,!1,`JsSelfProfilerManager.GetProfiler: Profiler with such name (${U}) does not exist`),null)}XJf(U,D,I){I=void 0===I?null:I;U=this.r3j||U;if(this.nyg(U))return this.DKf(U);const X=this.Cuj;return this.createProfiler(U,X,null!=I&&0<X?I/X:2E6,2===D?this.Wif:null,0===D?null:this.profilingIntervalInMs,D)}b7h(U){var D=this.mLa;if(D){const I=D.qmf();if(I){D=this.oub.get(U);const X=new v(I);D.subscribeCallTreeCustomPropertiesRetriever(X);D=new E(Y=>{I.startCollectingSlowActions(Y)},
Object(l.a)(I,I.stopCollectingSlowActions,"stopCollectingSlowActions"));this.Vee.set(U,D);return D}b.ULS.sendTraceTag(537155491,0,15,"JsSelfProfilerManager.CreateInteractivityTrackerObserver: CreateSlowActionsRetriever returned null");return null}b.ULS.sendTraceTag(537155490,0,15,"JsSelfProfilerManager.CreateInteractivityTrackerObserver: call to InteractivityTracker returned null");return null}jdj(){this.oyg=officeOnlineCpuProfiling.getJSCPUProfilingPackageRetriever();this.myg=new Map;this.Vee=new Map;
this.oub=new Map}}Object(c.a)(H,"JsSelfProfilerManager",null,[40,4]);var ba=a(916);Object(M.b)(L.me)(()=>Lo(function*(){yield Object(ba.a)("officeOnlineCpuProfiling",{va:0});return officeOnlineCpuProfiling}));window.jsprof=!0;String(A);String(u);window.___1710758652268_closurehack=A;window.___1710758652268_closurehack=u},916:function(A,u,a){function c(f,l){l=void 0===l?{}:l;return b.AFrameworkApplication.fa.ka("IsWebpack5RibbonEnabled")?h.a.resolve(r.vf,l).then(m=>m.loadChunk(f)):h.a.resolve(r.Gb,
l).then(m=>m(f))}a.d(u,"a",function(){return c});var b=a(6),h=a(95),r=a(5)}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaTS.jsprof.js.map/5eeb29774acfe31df50286f2c99849b2/EwaTS.jsprof.js.map